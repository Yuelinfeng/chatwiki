import{C as ue}from"./cu-scroll-ChKD2tbP.js";import{b as ce,$ as me,br as pe,a0 as fe,k as $,d as he,M as ge,be as ke}from"../../index-DrRzkLrM.js";import{a4 as ve,a3 as ye,A as F,r as f,L as d,P as b,Q as _,V as s,j as n,U as S,u as C,a6 as k,M as g,_ as G,X as h,Y as I,F as w,E as be,G as we,a5 as Q,a0 as xe,a1 as Ce,k as Be}from"./vue-chunks-Be7x44a8.js";import{a as Le,h as Me,k as ze}from"./index-DJ_e7lS-.js";import{c as Se}from"./index-BTuZjiB5.js";import{A as Ie}from"./avatar-input-D9Yp9XxS.js";import{M as Ne}from"./model-select-Br8n12E9.js";import{O as Ae}from"./open-grapg-modal-B5Lq2onL.js";import{F as P,_ as Oe}from"./index-DiumbRRT.js";import"./index-CA_jlLpR.js";import{I as Ue}from"./Input-BoEXW7Ed.js";import{Q as Ve}from"./QuestionCircleOutlined-C1VUeDko.js";import{_ as qe}from"./TextArea-CnprCuXF.js";import{_ as Ee}from"./index-BQkhi28h.js";import{S as De,a as Re,_ as Te}from"./index-olzhrUzL.js";import{_ as $e}from"./index-DmIygWCJ.js";import{_ as Fe}from"./index-Dq7pg9aM.js";import{_ as Ge}from"./index-B4_Ve-Su.js";import{_ as Qe}from"./index-oRdc9kyy.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs-DBZYvUeR.js";import"./crypto-js-5KTNdlTg.js";import"./dayjs-B2GD4xRt.js";import"./PlusOutlined-BjJbDYD_.js";import"./index-DI5MN6Ih.js";import"./partition-wrgnp58x.js";import"./Trigger-QcvDPnyC.js";import"./Password-B58O6Jw3.js";import"./inputProps-D4I2pN7C.js";import"./CheckOutlined-CoztOWtC.js";import"./useRefs-Ctm-zX-7.js";import"./collapseMotion-D9n-d2nt.js";import"./FormItemContext-DlzjcwaL.js";import"./isPlainObject-BILoaqPQ.js";import"./responsiveObserve-Ca0NCZ8D.js";import"./index-DtPUy1JV.js";import"./Search-Bp_yeyzm.js";import"./SearchOutlined-CH2PxTj7.js";import"./statusUtils-BM8Tk6m7.js";import"./index-BFFBEz-T.js";import"./slide-C3j77thT.js";import"./DownOutlined-Cp0vVtPD.js";import"./move-D51iXHK1.js";import"./UpOutlined-BEHaof9n.js";import"./colors-CGmsXzSB.js";const B=x=>(xe("data-v-19d11182"),x=x(),Ce(),x),Pe={class:"add-library-page"},je={class:"form-box"},Xe=B(()=>s("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const Ye=["src"],He={key:0},Je={key:1},Ke=B(()=>s("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1)),We={class:"select-card-box"},Ze={class:"card-title"},ea=B(()=>s("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),aa={class:"card-title"},oa=B(()=>s("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),na={__name:"knowledge-config",setup(x){const N=ve(),j=ye(),A=N.query,O=pe,e=F({library_name:"",library_intro:"",use_model:"",is_offline:"",model_config_id:"",avatar:O,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90}),U=f(""),X=f(0),V=f({}),q=f([]);Le().then(a=>{q.value=a.data.map(o=>({label:o.name,value:o.no}))});const E=f(!0);(()=>{Me({id:A.id}).then(a=>{V.value=a.data,X.value=V.value.is_offline?2:1,e.library_name=a.data.library_name,e.library_intro=a.data.library_intro,e.use_model=a.data.use_model,e.is_offline=a.data.is_offline,e.model_config_id=a.data.model_config_id,e.avatar=a.data.avatar?a.data.avatar:O,e.avatar_file=a.data.avatar_file?a.data.avatar_file:"",e.graph_switch=a.data.graph_switch!="0",e.graph_model_config_id=a.data.graph_model_config_id>0?a.data.graph_model_config_id:void 0,e.graph_use_model=a.data.graph_use_model,e.chunk_type=+a.data.chunk_type,e.normal_chunk_default_separators_no=a.data.normal_chunk_default_separators_no?a.data.normal_chunk_default_separators_no.split(",").map(o=>+o):[],e.normal_chunk_default_chunk_size=a.data.normal_chunk_default_chunk_size,e.normal_chunk_default_chunk_overlap=a.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=a.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=a.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=a.data.semantic_chunk_default_threshold,E.value=a.data.type==2})})();const la=f([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),Y=P.useForm,H=F({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:L}=Y(e,H),J=(a,o)=>{const i=o.current_obj;e.use_model=M.indexOf(i.model_define)>-1&&i.deployment_name?i.deployment_name:i.name,U.value=i.model_define,e.model_config_id=i.id||o.model_config_id,r()},K=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file,r()},_a=()=>!1,v=f([]),M=["azure","ollama","xinference","openaiAgent"],W=["azure"];function Z(a,o,i){const l=new Set(a.map(c=>c.model_define));return o.filter(c=>{let m=c[i];l.has(m)&&a.filter(p=>{if(p.model_define==m)return p.children=fe(p.children,c.children),!1})}),a}(()=>{Se({model_type:"TEXT EMBEDDING",is_offline:!1}).then(a=>{let o=a.data||[],i=[];v.value=o.map(l=>{i=[];for(let c=0;c<l.model_info.vector_model_list.length;c++){const m=l.model_info.vector_model_list[c];i.push({name:m,deployment_name:l.model_config.deployment_name,id:l.model_config.id,model_define:l.model_info.model_define})}return{id:l.model_config.id,name:l.model_info.model_name,model_define:l.model_info.model_define,icon:l.model_info.model_icon_url,children:i,deployment_name:l.model_config.deployment_name}}),v.value=Z(me(v.value,"model_define"),v.value,"model_define")})})();const ee=()=>{r()},z=f([]),ae=a=>{z.value=a},D=f(null),oe=a=>{if(a){e.graph_switch=!1;let o={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&z.value.length>0){let i=z.value[0];if(i){let l=i.children[0];o.graph_use_model=l.name,o.graph_model_config_id=l.model_config_id}}D.value.show(o)}else e.graph_switch=!1,r()},R=a=>{e.chunk_type=a,r()},ne=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model,r(()=>{ge.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:Be(ke,{style:{color:"#52c41a"}}),onOk:()=>j.push({path:"/library/details/knowledge-document",query:{id:A.id}})})}))},r=(a=null)=>{if(!e.library_name)return $.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:e.normal_chunk_default_separators_no.join(","),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,id:N.query.id};W.indexOf(U.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),ze(o).then(i=>{typeof a=="function"?a():$.success("修改成功")})};return(a,o)=>{const i=Ue,l=Oe,c=qe,m=he,p=Ee,te=De,le=Re,T=Te,_e=$e,ie=Fe,y=Ge,re=Qe,de=P,se=ue;return d(),b(se,null,{default:_(()=>[s("div",Pe,[s("div",je,[n(de,{"label-col":{span:5}},{default:_(()=>[n(l,S({ref:"name",label:"知识库名称"},C(L).library_name),{default:_(()=>[n(i,{onBlur:r,value:e.library_name,"onUpdate:value":o[0]||(o[0]=t=>e.library_name=t),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(l,{label:"知识库简介"},{default:_(()=>[n(c,{onBlur:r,value:e.library_intro,"onUpdate:value":o[1]||(o[1]=t=>e.library_intro=t),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(l,S({ref:"name",label:"知识库封面"},C(L).avatar),{default:_(()=>[n(Ie,{value:e.avatar,"onUpdate:value":o[2]||(o[2]=t=>e.avatar=t),onChange:K},null,8,["value"]),Xe]),_:1},16),n(l,S({label:"嵌入模型"},C(L).use_model),{default:_(()=>[k("",!0),n(T,{onChange:J,value:e.use_model,"onUpdate:value":o[3]||(o[3]=t=>e.use_model=t),placeholder:"请选择嵌入模型"},{default:_(()=>[(d(!0),g(w,null,G(v.value,t=>(d(),b(le,{key:t.id},{label:_(()=>[n(p,{align:"center",gap:6},{default:_(()=>[s("img",{class:"model-icon",src:t.icon,alt:""},null,8,Ye),h(I(t.name),1)]),_:2},1024)]),default:_(()=>[(d(!0),g(w,null,G(t.children,u=>(d(),b(te,{value:M.indexOf(t.model_define)>-1&&u.deployment_name?u.deployment_name:u.name+u.id,model_config_id:t.id,current_obj:u,key:u.name+u.id},{default:_(()=>[M.indexOf(t.model_define)>-1&&u.deployment_name?(d(),g("span",He,I(u.deployment_name),1)):(d(),g("span",Je,I(u.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16),n(l,{label:"生成知识图谱"},{default:_(()=>[n(_e,{onChange:oe,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),Ke]),_:1}),be(n(l,{label:"知识图谱模型"},{default:_(()=>[n(Ne,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":o[4]||(o[4]=t=>e.graph_use_model=t),modeId:e.graph_model_config_id,"onUpdate:modeId":o[5]||(o[5]=t=>e.graph_model_config_id=t),style:{width:"300px"},onChange:ee,onLoaded:ae},null,8,["modeName","modeId"])]),_:1},512),[[we,e.graph_switch]]),E.value?k("",!0):(d(),g(w,{key:0},[n(l,{label:"分段方式",required:""},{default:_(()=>[s("div",We,[s("div",{class:Q(["select-card-item",{active:e.chunk_type==1}]),onClick:o[6]||(o[6]=t=>R(1))},[n(m,{class:"check-arrow",name:"check-arrow-filled"}),s("div",Ze,[n(m,{name:"ordinary-segmentation",class:"title-icon"}),h(" 普通分段 ")]),ea],2),s("div",{class:Q(["select-card-item",{active:e.chunk_type==2}]),onClick:o[7]||(o[7]=t=>R(2))},[n(m,{class:"check-arrow",name:"check-arrow-filled"}),s("div",aa,[n(m,{name:"semantic-segmentation",class:"title-icon"}),h(" 语义分段 ")]),oa],2)]),e.chunk_type==2?(d(),b(ie,{key:0,style:{"margin-top":"12px",width:"650px"},message:"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段"})):k("",!0)]),_:1}),e.chunk_type==1?(d(),g(w,{key:0},[n(l,{label:"分段标识符",required:""},{default:_(()=>[n(T,{onChange:r,value:e.normal_chunk_default_separators_no,"onUpdate:value":o[8]||(o[8]=t=>e.normal_chunk_default_separators_no=t),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:q.value},null,8,["value","options"])]),_:1}),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.normal_chunk_default_chunk_size,"onUpdate:value":o[9]||(o[9]=t=>e.normal_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":o[10]||(o[10]=t=>e.normal_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1})],64)):k("",!0),e.chunk_type==2?(d(),g(w,{key:1},[e.chunk_type==2?(d(),b(l,{key:0,required:""},{label:_(()=>[h(" 分段阈值 "),n(re,null,{title:_(()=>[h("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:_(()=>[n(C(Ve),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_threshold,"onUpdate:value":o[11]||(o[11]=t=>e.semantic_chunk_default_threshold=t),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):k("",!0),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":o[12]||(o[12]=t=>e.semantic_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(p,{gap:8,align:"center"},{default:_(()=>[n(y,{onBlur:r,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":o[13]||(o[13]=t=>e.semantic_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),h(" 字符 ")]),_:1})]),_:1})],64)):k("",!0)],64))]),_:1})]),n(Ae,{onOk:ne,ref_key:"openGrapgModalRef",ref:D},null,512)])]),_:1})}}},ao=ce(na,[["__scopeId","data-v-19d11182"]]);export{ao as default};
