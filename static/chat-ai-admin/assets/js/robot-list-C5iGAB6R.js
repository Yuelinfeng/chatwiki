import{_ as D,L as Y,e as P,M as T,S as K,c as W,T as tt,U as ot,l as et,E as at}from"../../index-CWYf_R7c.js";import{r as m,w as st,L as _,M as k,j as s,Q as d,P as I,u as y,V as o,a3 as N,a4 as E,$ as Q,A as q,a2 as z,a6 as j,U as S,k as nt,b as G,v as rt,F as it,a1 as lt,a8 as U,Y as B,X as J}from"./vue-chunks-Bxyh5WP6.js";import{c as ct,g as pt,e as dt}from"./index-xJ7lndAQ.js";import{c as _t}from"./index-DFKCqvOx.js";import{F as Z,_ as ut}from"./index-Cm_NtOSH.js";import{P as mt}from"./PlusOutlined-Cu0dwBBw.js";import{_ as vt}from"./index-D70JqhWj.js";import"./index-mQw8zXXP.js";import{I as ft}from"./Input-BW-N7Cx9.js";import{_ as bt}from"./TextArea-C1_B5Wm2.js";import{T as gt,_ as Ct}from"./index-CLcBLQ2O.js";import{P as ht}from"./PlusCircleOutlined-BrtonEcE.js";import{M as kt}from"./MoreOutlined-BRtG5uPc.js";import{_ as yt,M as wt}from"./index-Cyz9zV9F.js";import"./index-Dy5dJRfD.js";import{D as xt}from"./dropdown-BMPfc6hB.js";import"./axios-Cm0UX6qg.js";import"./qs-CEiBKtbM.js";import"./crypto-js-C0fK7Mgg.js";import"./dayjs-BgtA0fgD.js";import"./Trigger-DXFMCREP.js";import"./isPlainObject-Q-ndSLdg.js";import"./responsiveObserve-BtDP6tEg.js";import"./collapseMotion-DDsixTll.js";import"./index-C1M6HpEG.js";import"./colors-CmI3I2v0.js";import"./QuestionCircleOutlined-BggeZNYy.js";import"./FormItemContext-CY3sS3S3.js";import"./partition-Dd7XR8Em.js";import"./Password-BrrLsfMb.js";import"./inputProps-CuDRpClH.js";import"./CheckOutlined-DAabT47N.js";import"./useRefs-DgEUwJAf.js";import"./index-BYiIgJN3.js";import"./Search-C52Nu70G.js";import"./SearchOutlined-gkqcN_Zr.js";import"./statusUtils-D2ojHtZY.js";import"./index-C_rHdEod.js";import"./Dropdown-BiMe9RPS.js";import"./pick-D5pnwb9s.js";import"./isMobile-D_4OiXLP.js";import"./slide-BHEoaamw.js";import"./shallowequal-Do1xa-L4.js";import"./RightOutlined-BOQt46xG.js";import"./move-DtLl1qq4.js";const Lt="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2040%2040'%20class='design-iconfont'%3e%3cpath%20d='M31.6194%2022.1391H15.7352C13.316%2022.1391%2011.3545%2020.1776%2011.3545%2017.7584V9.9027C11.3545%207.48352%2013.316%205.52197%2015.7352%205.52197H31.6194C34.0386%205.52197%2036.0001%207.48352%2036.0001%209.9027V17.7584C36.0001%2020.1776%2034.0386%2022.1391%2031.6194%2022.1391Z'%20fill='%232475FC'/%3e%3cpath%20d='M27.6433%2029.4327H19.9034L13.3845%2034.178C12.4009%2034.8939%2010.9673%2034.2483%2010.9521%2033.0843L10.9084%2029.4327H9.1918C6.32448%2029.4327%204.00024%2027.2604%204.00024%2024.583V14.8075C4.00024%2012.1282%206.32448%209.95776%209.1918%209.95776H27.6452C30.5125%209.95776%2032.8367%2012.1301%2032.8367%2014.8075V24.5811C32.8367%2027.2604%2030.5125%2029.4327%2027.6433%2029.4327Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M25.5317%2018.6604H10.9482C10.1792%2018.6604%209.55444%2018.0375%209.55444%2017.2666C9.55444%2016.4956%2010.1773%2015.8728%2010.9482%2015.8728H25.5317C26.3007%2015.8728%2026.9254%2016.4956%2026.9254%2017.2666C26.9254%2018.0375%2026.3007%2018.6604%2025.5317%2018.6604ZM17.3%2024.3475H10.9482C10.1792%2024.3475%209.55444%2023.7247%209.55444%2022.9537C9.55444%2022.1828%2010.1773%2021.56%2010.9482%2021.56H17.3C18.069%2021.56%2018.6938%2022.1828%2018.6938%2022.9537C18.6938%2023.7247%2018.069%2024.3475%2017.3%2024.3475Z'%20fill='%23fff'/%3e%3c/svg%3e",Mt="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2040%2040'%20class='design-iconfont'%3e%3cpath%20d='M30.125%207.625C31.9152%207.625%2033.6321%208.33616%2034.898%209.60203C36.1638%2010.8679%2036.875%2012.5848%2036.875%2014.375C36.875%2016.1652%2036.1638%2017.8821%2034.898%2019.148C33.6321%2020.4138%2031.9152%2021.125%2030.125%2021.125H26.75V18.875H30.125C31.2603%2018.8754%2032.3538%2018.4466%2033.1862%2017.6746C34.0187%2016.9027%2034.5286%2015.8446%2034.6138%2014.7125L34.625%2014.375C34.625%2013.1815%2034.1509%2012.0369%2033.307%2011.193C32.4631%2010.3491%2031.3185%209.875%2030.125%209.875H26.75V7.625H30.125ZM11%2017.75C9.20979%2017.75%207.4929%2018.4612%206.22703%2019.727C4.96116%2020.9929%204.25%2022.7098%204.25%2024.5C4.25%2026.2902%204.96116%2028.0071%206.22703%2029.273C7.4929%2030.5388%209.20979%2031.25%2011%2031.25H14.375V29H11C9.8647%2029.0004%208.77122%2028.5716%207.93877%2027.7996C7.10631%2027.0277%206.5964%2025.9696%206.51125%2024.8375L6.5%2024.5C6.5%2023.3065%206.97411%2022.1619%207.81802%2021.318C8.66193%2020.4741%209.80653%2020%2011%2020H14.375V17.75H11Z'%20fill='%232475FC'/%3e%3cpath%20d='M13.25%204.25H26.75C28.25%204.25%2029%205%2029%206.5V11C29%2012.5%2028.25%2013.25%2026.75%2013.25H13.25C11.75%2013.25%2011%2012.5%2011%2011V6.5C11%205%2011.75%204.25%2013.25%204.25Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M13.25%2015.5H26.75C28.25%2015.5%2029%2016.25%2029%2017.75V22.25C29%2023.75%2028.25%2024.5%2026.75%2024.5H13.25C11.75%2024.5%2011%2023.75%2011%2022.25V17.75C11%2016.25%2011.75%2015.5%2013.25%2015.5Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M13.25%2026.75H26.75C28.25%2026.75%2029%2027.5%2029%2029V33.5C29%2035%2028.25%2035.75%2026.75%2035.75H13.25C11.75%2035.75%2011%2035%2011%2033.5V29C11%2027.5%2011.75%2026.75%2013.25%2026.75Z'%20fill='%232475FC'/%3e%3c/svg%3e",$t=i=>(N("data-v-60ead55d"),i=i(),E(),i),Ft={class:"avatar-uploader"},Ht=["src"],Vt={key:1},At=$t(()=>o("div",{class:"ant-upload-text"},"上传照片",-1)),It=["src"],Pt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(i,{emit:H}){function w(t){return new Promise((l,r)=>{const e=new FileReader;e.readAsDataURL(t),e.onload=()=>l(e.result),e.onerror=g=>r(g)})}const f=H,x=i,c=m([]),u=m(!1),a=m("");st(()=>x.value,t=>{a.value=t},{immediate:!0});const L=Z.useInjectFormItemContext(),M=()=>{let t={imageUrl:a.value,file:c.value[0].originFileObj};f("change",t),f("update:value",t.imageUrl),L.onFieldChange()},C=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(c.value=[t],w(t).then(e=>{a.value=e,u.value=!1,M()}),!1):(P.error("机器人头像图片大小不能超过100kb"),!1):(P.error("机器人头像只支持JPG、PNG格式的图片"),!1),b=m(!1),$=m(""),h=m(""),V=()=>{b.value=!1,h.value=""},n=async t=>{!t.url&&!t.preview&&(t.preview=await w(t.originFileObj)),$.value=t.url||t.preview,b.value=!0,h.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,l)=>{const r=vt,e=T;return _(),k("div",Ft,[s(r,{"file-list":c.value,"onUpdate:fileList":l[0]||(l[0]=g=>c.value=g),"list-type":"picture-card","show-upload-list":!1,"before-upload":C,accept:".jpg,.png,.jpeg",onPreview:n},{default:d(()=>[i.value?(_(),k("img",{key:0,class:"avatar",src:i.value,alt:"avatar"},null,8,Ht)):(_(),k("div",Vt,[u.value?(_(),I(y(Y),{key:0})):(_(),I(y(mt),{key:1})),At]))]),_:1},8,["file-list"]),s(e,{open:b.value,title:h.value,footer:null,onCancel:V},{default:d(()=>[o("img",{alt:"example",style:{width:"100%"},src:$.value},null,8,It)]),_:1},8,["open","title"])])}}},Rt=D(Pt,[["__scopeId","data-v-60ead55d"]]),R=i=>(N("data-v-a2347256"),i=i(),E(),i),Ot={class:"form-box"},Tt={class:"robot-type-box"},St=R(()=>o("div",{class:"avatar-box"},[o("img",{src:Lt,alt:""}),o("div",{class:"robot-item-title"},"聊天机器人")],-1)),Ut=R(()=>o("div",{class:"desc"},"简易的基于LLM和知识库的聊天应用，配置简单，适合新人上手",-1)),Bt=R(()=>o("div",{class:"avatar-box"},[o("img",{src:Mt,alt:""}),o("div",{class:"robot-item-title"},"工作流")],-1)),jt=R(()=>o("div",{class:"desc"},"可编排的任务工作流，将任务拆解成多个步骤逐步执行",-1)),Zt=R(()=>o("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Dt={__name:"add-robot-alert",setup(i,{expose:H}){const{setStorage:w}=ot("localStorage"),f=Q(),x=Z.useForm,c=m(!1),u=m(!1),a=q({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),L=q({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:M,validateInfos:C,clearValidate:b}=x(a,L),$=r=>{a.robot_avatar=r.file},h=()=>{let r={robot_name:a.robot_name,robot_intro:a.robot_intro,robot_avatar:a.robot_avatar||K};u.value=!0,ct(r,a.application_type).then(e=>{if(u.value=!1,e.res!=0)return P.error(e.msg);P.success("机器人创建成功"),a.application_type==0?(w("showNoLibraryTip",!0),f.push("/robot/config/basic-config?id="+e.data.id+"&robot_key="+e.data.robot_key)):f.push("/robot/config/workflow?id="+e.data.id+"&robot_key="+e.data.robot_key)}).catch(()=>{u.value=!1})},V=async()=>{let r=await _t({model_type:"LLM"});return!r||r.data.length==0?(T.confirm({title:"请先添加LLM模型服务商?",icon:nt(tt,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){f.push("/user/model")},onCancel(){}}),!1):!0},n=async()=>{await V()&&(a.robot_avatar="",a.robot_avatar_url=K,a.robot_name="",a.robot_intro="",c.value=!0)},t=()=>{b()},l=()=>{M().then(()=>{h()}).catch(r=>{})};return H({open:n}),(r,e)=>{const g=W,F=ut,O=ft,p=bt,A=Z,X=T;return _(),I(X,{width:"746px",open:c.value,"onUpdate:open":e[5]||(e[5]=v=>c.value=v),confirmLoading:u.value,title:"新建机器人",onOk:l,onCancel:t},{default:d(()=>[o("div",Ot,[s(A,{layout:"vertical"},{default:d(()=>[s(F,{label:"应用类型",required:""},{default:d(()=>[o("div",Tt,[o("div",{class:z(["robot-item",{active:a.application_type==0}]),onClick:e[0]||(e[0]=v=>a.application_type=0)},[a.application_type==0?(_(),I(g,{key:0,class:"check-arrow",name:"check-arrow-filled"})):j("",!0),St,Ut],2),o("div",{class:z(["robot-item",{active:a.application_type==1}]),onClick:e[1]||(e[1]=v=>a.application_type=1)},[a.application_type==1?(_(),I(g,{key:0,class:"check-arrow",name:"check-arrow-filled"})):j("",!0),Bt,jt],2)])]),_:1}),s(F,S({ref:"name",label:"应用名称"},y(C).robot_name),{default:d(()=>[s(O,{value:a.robot_name,"onUpdate:value":e[2]||(e[2]=v=>a.robot_name=v),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),s(F,S({label:"简介"},y(C).robot_intro),{default:d(()=>[s(p,{rows:3,value:a.robot_intro,"onUpdate:value":e[3]||(e[3]=v=>a.robot_intro=v),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),s(F,S({ref:"name",label:"机器人头像"},y(C).robot_avatar_url),{default:d(()=>[s(Rt,{value:a.robot_avatar_url,"onUpdate:value":e[4]||(e[4]=v=>a.robot_avatar_url=v),onChange:$},null,8,["value"]),Zt]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Nt=D(Dt,[["__scopeId","data-v-a2347256"]]),Et=i=>(N("data-v-e3f02239"),i=i(),E(),i),Kt={class:"robot-page"},qt={class:"list-box"},zt={key:0,class:"list-item-wrapper"},Gt=Et(()=>o("span",{class:"add-text"},"新增应用",-1)),Jt=["onClick"],Wt={class:"list-item"},Qt=["onClick"],Xt={class:"robot-info"},Yt=["src"],to={class:"robot-info-content"},oo={class:"robot-name"},eo={class:"robot-desc"},ao={class:"robot-type-tag"},so=["onClick"],no=["onClick"],ro={__name:"robot-list",setup(i){const H=et();let{role_permission:w}=H;const f=G(()=>w.includes("RobotCreate")),x=Q(),c=m("2"),u=m([]),a=G(()=>c.value==2?u.value:u.value.filter(n=>n.application_type==c.value)),L=()=>{pt().then(n=>{u.value=n.data}).catch(()=>{})},M=m(null),C=()=>{M.value.open()},b=({id:n,robot_key:t,application_type:l})=>{l==0?x.push({path:"/robot/config/basic-config",query:{id:n,robot_key:t}}):x.push({path:"/robot/config/workflow",query:{id:n,robot_key:t}})},$=n=>{let t=3,l=T.confirm({title:`删除机器人${n.robot_name}`,icon:s(at),content:"您确定要删除此机器人吗？",okText:t+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){h(n)},onCancel(){}}),r=setInterval(()=>{t==1?(l.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(r),r=void 0):(t-=1,l.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},h=({id:n})=>{dt({id:n}).then(()=>{P.success("删除成功"),L()})},V=n=>{window.open(`#/robot/test?robot_key=${n.robot_key}&id=${n.id}`)};return rt(()=>{L()}),(n,t)=>{const l=Ct,r=gt,e=yt,g=wt,F=xt,O=W;return _(),k("div",Kt,[s(r,{activeKey:c.value,"onUpdate:activeKey":t[0]||(t[0]=p=>c.value=p)},{default:d(()=>[s(l,{key:"2",tab:"全部"}),s(l,{key:"0",tab:"聊天机器人"}),s(l,{key:"1",tab:"工作流"})]),_:1},8,["activeKey"]),o("div",qt,[f.value?(_(),k("div",zt,[o("div",{class:"list-item add-robot",onClick:C},[s(y(ht),{class:"add-icon"}),Gt])])):j("",!0),(_(!0),k(it,null,lt(a.value,p=>(_(),k("div",{class:"list-item-wrapper",key:p.id,onClick:A=>b(p)},[o("div",Wt,[o("span",{class:"item-action",onClick:t[2]||(t[2]=U(()=>{},["stop"]))},[s(F,null,{overlay:d(()=>[s(g,null,{default:d(()=>[s(e,null,{default:d(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:A=>$(p)},"删 除",8,Qt)]),_:2},1024)]),_:2},1024)]),default:d(()=>[o("span",{class:"menu-btn",onClick:t[1]||(t[1]=U(()=>{},["stop"]))},[s(y(kt))])]),_:2},1024)]),o("div",Xt,[o("img",{class:"robot-avatar",src:p.robot_avatar,alt:""},null,8,Yt),o("div",to,[o("div",oo,B(p.robot_name),1)])]),o("div",eo,B(p.robot_intro),1),o("div",ao,B(p.application_type==0?"聊天机器人":"工作流"),1),o("div",{class:"robot-action",onClick:t[3]||(t[3]=U(()=>{},["stop"]))},[o("div",{class:"robot-action-item",onClick:A=>b(p)},[s(O,{class:"action-icon",name:"jibenpeizhi"}),J(" 管理")],8,so),o("div",{class:"robot-action-item",onClick:A=>V(p)},[s(O,{class:"action-icon",name:"cmd"}),J(" 测试")],8,no)])])],8,Jt))),128))]),s(Nt,{ref_key:"addRobotAlertRef",ref:M},null,512)])}}},Yo=D(ro,[["__scopeId","data-v-e3f02239"]]);export{Yo as default};
