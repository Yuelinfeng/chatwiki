import{L as i,M as y,V as e,j as t,X as U,Y as R,S as ce,a8 as T,P as z,Q as s,W as et,a2 as we,r as x,d as G,A as P,E as ne,G as ie,u as C,a9 as K,a3 as H,a4 as W,a0 as tt,F as B,a1 as F,w as me,k as ot,ac as be,ae as ye,b as Se,h as je,v as qe,y as st,ab as nt,U as it,a6 as at,p as lt}from"./vue-chunks-CwaUyaYI.js";import{_ as Q,c as le,B as te,O as ct,P as ze,e as Z,M as ae,Q as ve,S as rt,T as dt,N as _t,U as ke,E as ut}from"../../index-CyiwD4fB.js";import{_ as he}from"./index-BttTL6gl.js";import{C as pt,E as mt}from"./cu-upload-BxiShhPT.js";import"./index-D8wyBl4m.js";import{I as re}from"./Input-Da8aOOO7.js";import{_ as ge}from"./TextArea-CBrdn4Xi.js";import{C as vt}from"./cu-scroll-D0ctTl0C.js";import{c as ht,s as ft}from"./index-BfI87oHE.js";import{_ as bt}from"./index-DqYwG0cW.js";import{S as Ce}from"./index-DPSrDAUj.js";import{_ as De,T as Ne}from"./index-kZ6bFQxN.js";import{P as Ie}from"./PlusOutlined-C0mU79gr.js";import{_ as de}from"./index-DP3Kq1OL.js";import{c as Ve}from"./index-BWAwk653.js";import{S as Te,a as Be,_ as Pe}from"./index-BfzgEQpv.js";import{_ as Qe}from"./index-DJKcP780.js";import{_ as Re}from"./index-B1XzzhJR.js";import{Q as Y}from"./QuestionCircleOutlined-CGJPYPeU.js";import{_ as Le}from"./index-CI7N2kRa.js";import{_ as yt,a as kt}from"./index-zwpid9vL.js";import{_ as _e}from"./index-D97187b8.js";import{g as Fe}from"./index-CnXWAABj.js";import{S as gt}from"./SearchOutlined-eG2BTg8a.js";import{S as $t}from"./SyncOutlined-BcikCGg4.js";import{C as Je,_ as Ke}from"./index-CZI6jsTS.js";import{_ as xt}from"./index-mTt8gwjX.js";import{g as He}from"./index-BOFl4aVW.js";import{_ as wt}from"./empty-CzGZrENG.js";import{d as Ee}from"./vuedraggable.umd-B2neqUi2.js";import"./index-DzmLM5l_.js";import{R as St,_ as qt}from"./RadioButton-DM2pQQZg.js";import{F as Me,_ as Ct}from"./index-BfwAi9te.js";import{u as It}from"./robot-BRWNUWrg.js";import"./dayjs-9pTjq58W.js";import"./axios-Cm0UX6qg.js";import"./qs-DFTLuGGg.js";import"./crypto-js-Dhiry31a.js";import"./FormItemContext-P-hc85qB.js";import"./index-B-VUp88E.js";import"./Search-DC1Sahrq.js";import"./inputProps-CBCbV3dR.js";import"./Password-DAieTXDw.js";import"./index-gIgkZ2l6.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./colors-DcCY69fx.js";import"./index-CJQbsUHv.js";import"./shallowequal-Cp-ZNK9a.js";import"./collapseMotion-1cFzdZPo.js";import"./slide-kUXvfLu3.js";import"./Dropdown-McYrymK_.js";import"./useRefs-kFALIf8n.js";import"./pick-DbbaBqpV.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-s6Wk7FwS.js";import"./DownOutlined-D6oDy9l0.js";import"./move-7FTT7O3Y.js";import"./responsiveObserve-DlRq3u3d.js";const Rt={class:"edit-box-header"},Lt={class:"left-box"},Et={class:"edit-box-title"},Ut={key:0},At={key:0,class:"title-tip"},Ot={class:"right-box"},zt={class:"extra-box"},Mt={class:"actions-box"},jt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(m,{emit:r}){const k=r,h=m,a=o=>{k("edit"),k("update:isEdit",o)},_=()=>{k("save")};return(o,S)=>{const n=le,$=te,c=he;return i(),y("div",{class:we(["edit-box",{"is-edit":m.isEdit}])},[e("div",Rt,[e("div",Lt,[t(n,{class:"edit-box-icon",name:h.iconName},null,8,["name"]),e("span",Et,[U(R(h.title)+" ",1),o.$slots.icon?(i(),y("span",Ut,[ce(o.$slots,"icon",{},void 0,!0)])):T("",!0)]),o.$slots.tip?(i(),y("span",At,[ce(o.$slots,"tip",{},void 0,!0)])):T("",!0)]),e("div",Ot,[e("div",zt,[ce(o.$slots,"extra",{},()=>[e("div",Mt,[h.isEdit?(i(),z(c,{key:0,gap:8},{default:s(()=>[t($,{onClick:_,size:"small",type:"primary"},{default:s(()=>[U("保存")]),_:1}),t($,{onClick:S[0]||(S[0]=w=>a(!1)),size:"small"},{default:s(()=>[U("取消")]),_:1})]),_:1})):(i(),z($,{key:1,onClick:S[1]||(S[1]=w=>a(!0)),size:"small"},{default:s(()=>[U("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:et({...m.bodyStyle})},[ce(o.$slots,"default",{},void 0,!0)],4)],2)}}},X=Q(jt,[["__scopeId","data-v-dbe09743"]]),We=m=>(H("data-v-899bcb03"),m=m(),W(),m),Dt={class:"robot-form-box"},Nt={class:"form-item"},Vt=We(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Tt={class:"form-item-body robot-name-item"},Bt={class:"robot-avetar-upload"},Pt=["src"],Qt={class:"robot-name-box"},Ft={class:"form-item"},Jt=We(()=>e("div",{class:"form-item-label"},"简介",-1)),Kt={class:"form-item-body"},Ht={class:"robot-info-box"},Wt={class:"robot-name-box"},Gt=["src"],Zt={class:"robot-name"},Yt={class:"robot-intro"},Xt={__name:"basic-config",setup(m){const r=x(!1),{robotInfo:k,updateRobotInfo:h}=G("robotInfo"),a=P({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),_=()=>{h({...K(a)}),r.value=!1},o=n=>{let $=n[0];return a.robot_avatar=$,ct($).then(c=>{a.robot_avatar_url=c}),!1},S=()=>{a.robot_name=k.robot_name,a.robot_intro=k.robot_intro,a.robot_avatar=k.robot_avatar,a.robot_avatar_url=k.robot_avatar_url};return(n,$)=>{const c=re,w=ge;return i(),z(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:r.value,"onUpdate:isEdit":$[2]||($[2]=l=>r.value=l),onSave:_,onEdit:S},{default:s(()=>[ne(e("div",Dt,[e("div",Nt,[Vt,e("div",Tt,[t(pt,{accept:"image/*",onChange:o},{default:s(()=>[e("div",Bt,[a.robot_avatar_url?(i(),y("img",{key:0,class:"robot-avetar",src:a.robot_avatar_url},null,8,Pt)):T("",!0)])]),_:1}),e("div",Qt,[t(c,{value:a.robot_name,"onUpdate:value":$[0]||($[0]=l=>a.robot_name=l),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Ft,[Jt,e("div",Kt,[t(w,{rows:3,value:a.robot_intro,"onUpdate:value":$[1]||($[1]=l=>a.robot_intro=l),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ie,r.value]]),ne(e("div",Ht,[e("div",Wt,[e("img",{class:"robot-avatar",src:C(k).robot_avatar_url,alt:""},null,8,Gt),e("span",Zt,R(C(k).robot_name),1)]),e("div",Yt,R(C(k).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ie,!r.value]])]),_:1},8,["isEdit"])}}},eo=Q(Xt,[["__scopeId","data-v-899bcb03"]]),Ge=m=>(H("data-v-896a48d0"),m=m(),W(),m),to={class:"ai-create-box"},oo={class:"input-box"},so=Ge(()=>e("span",null,"生成",-1)),no={class:"quick-tags-box"},io=Ge(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),ao={class:"ai-list-box"},lo={key:0,class:"loading-box"},co={key:0,class:"prompt-list-box"},ro={class:"prompt-list"},_o={class:"prompt-header"},uo={class:"prompt-title"},po={class:"prompt-content"},mo={class:"prompt-list"},vo={class:"prompt-header"},ho={class:"prompt-title"},fo={class:"prompt-content"},bo={class:"prompt-list"},yo={class:"prompt-header"},ko={class:"prompt-title"},go={class:"prompt-content"},$o={class:"prompt-list"},xo={class:"prompt-header"},wo={class:"prompt-title"},So={class:"prompt-content"},qo={class:"prompt-list"},Co={class:"prompt-header"},Io={class:"prompt-title"},Ro={class:"prompt-content"},Lo={class:"prompt-header"},Eo={class:"prompt-title"},Uo={class:"prompt-content"},Ao={key:1,class:"empty-box"},Oo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(m,{expose:r,emit:k}){const h=ze.PRESENTED_IMAGE_SIMPLE,a=x(!1),_=x(!1),o=tt().query,S=k,n=x(""),$=x(!1),c=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],w=x("在上方输入框输入要求，点击生成提示词"),l=()=>{d.value=!1,b.promptStruct=I,n.value="",w.value="在上方输入框输入要求，点击生成提示词",a.value=!0},d=x(!1),I={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},b=P({promptStruct:I}),q=p=>{n.value=p},f=()=>{if(!n.value)return Z.error("请输入AI 生成提示词");if($.value)return Z.error("正在生成中...");$.value=!0,ht({id:o.id,demand:n.value}).then(p=>{b.promptStruct=JSON.parse(p.data.promptStruct),d.value=!0}).finally(()=>{$.value=!1}).catch(p=>{d.value=!1,w.value=p.msg})},g=()=>{if(!d.value)return Z.error("请先生成提示词");S("handleAiSave",b.promptStruct),a.value=!1};return r({show:l}),(p,u)=>{const O=te,N=re,j=le,M=bt,v=Ce,A=ze,J=vt,ee=ae;return i(),y("div",null,[t(ee,{open:a.value,"onUpdate:open":u[1]||(u[1]=V=>a.value=V),title:"AI 生成提示词",width:746},{footer:s(()=>[t(O,{type:"primary",loading:_.value,onClick:g},{default:s(()=>[U("使用该提示")]),_:1},8,["loading"])]),default:s(()=>[e("div",to,[e("div",oo,[t(N,{style:{width:"100%"},value:n.value,"onUpdate:value":u[0]||(u[0]=V=>n.value=V),size:"large",onPressEnter:f,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:f},[t(j,{name:"ai-mark"}),so])]),e("div",no,[io,(i(),y(B,null,F(c,V=>t(M,{key:V.title,onClick:L=>q(V.title),color:"blue"},{default:s(()=>[U(R(V.title),1)]),_:2},1032,["onClick"])),64))]),e("div",ao,[t(J,{style:{height:"100%"}},{default:s(()=>[$.value?(i(),y("div",lo,[t(v,{tip:"正在生成中..."})])):(i(),y(B,{key:1},[d.value?(i(),y("div",co,[e("div",ro,[e("div",_o,[e("div",uo,R(b.promptStruct.role.subject),1)]),e("div",po,R(b.promptStruct.role.describe),1)]),e("div",mo,[e("div",vo,[e("div",ho,R(b.promptStruct.task.subject),1)]),e("div",fo,R(b.promptStruct.task.describe),1)]),e("div",bo,[e("div",yo,[e("div",ko,R(b.promptStruct.constraints.subject),1)]),e("div",go,R(b.promptStruct.constraints.describe),1)]),e("div",$o,[e("div",xo,[e("div",wo,R(b.promptStruct.output.subject),1)]),e("div",So,R(b.promptStruct.output.describe),1)]),e("div",qo,[e("div",Co,[e("div",Io,R(b.promptStruct.tone.subject),1)]),e("div",Ro,R(b.promptStruct.tone.describe),1)]),(i(!0),y(B,null,F(b.promptStruct.custom,(V,L)=>(i(),y("div",{class:"prompt-list",key:L+V.key?V.key:""},[e("div",Lo,[e("div",Eo,R(V.subject),1)]),e("div",Uo,R(V.describe),1)]))),128))])):(i(),y("div",Ao,[t(A,{image:C(h),description:w.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},zo=Q(Oo,[["__scopeId","data-v-896a48d0"]]),Mo={class:"prompt-box"},jo={class:"tab-header"},Do={key:0,class:"opt-block"},No={key:1,class:"opt-block"},Vo={key:0,class:"prompt-list-box"},To={class:"prompt-list"},Bo={class:"prompt-header"},Po={class:"prompt-title"},Qo={key:0,class:"btn-wrapper-box"},Fo={class:"prompt-content"},Jo={class:"prompt-list"},Ko={class:"prompt-header"},Ho={class:"prompt-title"},Wo={key:0,class:"btn-wrapper-box"},Go={class:"prompt-content"},Zo={class:"prompt-list"},Yo={class:"prompt-header"},Xo={class:"prompt-title"},es={key:0,class:"btn-wrapper-box"},ts={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={key:0,class:"btn-wrapper-box"},as={class:"swich-item"},ls={class:"swich-item"},cs={class:"prompt-content"},rs={class:"prompt-list"},ds={class:"prompt-header"},_s={class:"prompt-title"},us={key:0,class:"btn-wrapper-box"},ps={class:"prompt-content"},ms={class:"prompt-header"},vs={class:"prompt-title",style:{flex:"1"}},hs={key:0,class:"btn-wrapper-box"},fs=["onClick"],bs={class:"prompt-content"},ys={key:0,class:"add-theme-block"},ks={key:1,class:"diy-prompt-box"},gs={key:0,class:"diy-switch-box"},$s={class:"swich-item"},xs={class:"swich-item"},oe="- 请使用markdown格式回答问题。",se="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",ws={__name:"system-prompt-words",setup(m){const r=x(!1),{robotInfo:k,updateRobotInfo:h}=G("robotInfo");let a={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const _=x({}),o=x(!1),S=x(!1),n=x(!1),$=x(!1),c=P({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),w=(M,v)=>M.includes(v),l=x(k.prompt_type);me(()=>k,()=>{c.prompt=k.prompt,c.prompt_struct=k.prompt_struct,_.value=k.prompt_struct_default},{immediate:!0,deep:!0}),me(()=>c.prompt_struct.output.describe,M=>{o.value=w(M,oe),S.value=w(M,se)},{immediate:!0,deep:!0}),me(()=>c.prompt,M=>{n.value=w(M,oe),$.value=w(M,se)},{immediate:!0,deep:!0});const d=(M,v)=>{M?(v=="outSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+oe:c.prompt_struct.output.describe+=oe),v=="imgSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+se:c.prompt_struct.output.describe+=se)):(v=="outSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(oe,"g"),"")),v=="imgSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(se,"g"),"")),c.prompt_struct.output.describe=c.prompt_struct.output.describe.trim())},I=(M,v)=>{M?(v=="outDiySwitch"&&(c.prompt?c.prompt+=`
`+oe:c.prompt+=oe),v=="imgDiySwitch"&&(c.prompt?c.prompt+=`
`+se:c.prompt+=se)):(v=="outDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(oe,"g"),"")),v=="imgDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(se,"g"),"")),c.prompt=c.prompt.trim())},b=M=>{c.prompt_struct[M].describe=_.value[M].describe},q=()=>{c.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),l.value=1},f=M=>{c.prompt_struct.custom.splice(M,1)},g=()=>{h({...K(c),prompt_type:l.value}),r.value=!1},p=M=>{l.value=1,h({prompt_type:l.value,prompt:c.prompt,prompt_struct:M}),r.value=!1},u=()=>{r.value=!0},O=()=>{r.value=!1},N=x(null),j=()=>{N.value.show()};return(M,v)=>{const A=De,J=Ne,ee=le,V=te,L=he,D=ge,pe=de,Xe=re;return i(),y("div",Mo,[e("div",jo,[t(J,{activeKey:l.value,"onUpdate:activeKey":v[0]||(v[0]=E=>l.value=E)},{default:s(()=>[(i(),z(A,{key:1,tab:"结构化提示词"})),(i(),z(A,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),r.value?(i(),y("div",Do,[e("div",{class:"ai-mark-box",onClick:j},[t(ee,{name:"ai-mark"}),U(" AI自动生成 ")]),t(L,{gap:8},{default:s(()=>[t(V,{size:"small",type:"primary",onClick:g},{default:s(()=>[U("保存")]),_:1}),t(V,{size:"small",onClick:O},{default:s(()=>[U("取消")]),_:1})]),_:1})])):(i(),y("div",No,[t(V,{size:"small",onClick:u},{default:s(()=>[U("修改")]),_:1})]))]),l.value==1?(i(),y("div",Vo,[e("div",To,[e("div",Bo,[e("div",Po,R(c.prompt_struct.role.subject),1),r.value?(i(),y("div",Qo,[e("a",{onClick:v[1]||(v[1]=E=>b("role"))},"恢复默认")])):T("",!0)]),e("div",Fo,[t(D,{bordered:!1,disabled:!r.value,value:c.prompt_struct.role.describe,"onUpdate:value":v[2]||(v[2]=E=>c.prompt_struct.role.describe=E),placeholder:C(a).role,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Jo,[e("div",Ko,[e("div",Ho,R(c.prompt_struct.task.subject),1),r.value?(i(),y("div",Wo,[e("a",{onClick:v[3]||(v[3]=E=>b("task"))},"恢复默认")])):T("",!0)]),e("div",Go,[t(D,{bordered:!1,disabled:!r.value,value:c.prompt_struct.task.describe,"onUpdate:value":v[4]||(v[4]=E=>c.prompt_struct.task.describe=E),placeholder:C(a).task,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Zo,[e("div",Yo,[e("div",Xo,R(c.prompt_struct.constraints.subject),1),r.value?(i(),y("div",es,[e("a",{onClick:v[5]||(v[5]=E=>b("constraints"))},"恢复默认")])):T("",!0)]),e("div",ts,[t(D,{bordered:!1,disabled:!r.value,value:c.prompt_struct.constraints.describe,"onUpdate:value":v[6]||(v[6]=E=>c.prompt_struct.constraints.describe=E),placeholder:C(a).constraints,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",os,[e("div",ss,[e("div",ns,R(c.prompt_struct.output.subject),1),r.value?(i(),y("div",is,[e("div",as,[U(" 输出markdown： "),t(pe,{onChange:v[7]||(v[7]=E=>d(E,"outSwitch")),checked:o.value,"onUpdate:checked":v[8]||(v[8]=E=>o.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ls,[U(" 回复图片： "),t(pe,{onChange:v[9]||(v[9]=E=>d(E,"imgSwitch")),checked:S.value,"onUpdate:checked":v[10]||(v[10]=E=>S.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:v[11]||(v[11]=E=>b("output"))},"恢复默认")])):T("",!0)]),e("div",cs,[t(D,{bordered:!1,disabled:!r.value,value:c.prompt_struct.output.describe,"onUpdate:value":v[12]||(v[12]=E=>c.prompt_struct.output.describe=E),placeholder:C(a).output,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",rs,[e("div",ds,[e("div",_s,R(c.prompt_struct.tone.subject),1),r.value?(i(),y("div",us,[e("a",{onClick:v[13]||(v[13]=E=>b("tone"))},"恢复默认")])):T("",!0)]),e("div",ps,[t(D,{bordered:!1,disabled:!r.value,value:c.prompt_struct.tone.describe,"onUpdate:value":v[14]||(v[14]=E=>c.prompt_struct.tone.describe=E),placeholder:C(a).tone,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),(i(!0),y(B,null,F(c.prompt_struct.custom,(E,Oe)=>(i(),y("div",{class:"prompt-list",key:Oe+E.key?E.key:""},[e("div",ms,[e("div",vs,[t(Xe,{bordered:!1,disabled:!r.value,style:{width:"100%"},value:E.subject,"onUpdate:value":fe=>E.subject=fe,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),r.value?(i(),y("div",hs,[e("div",{class:"hover-btn-box",onClick:fe=>f(Oe)},[t(C(ve))],8,fs)])):T("",!0)]),e("div",bs,[t(D,{bordered:!1,disabled:!r.value,value:E.describe,"onUpdate:value":fe=>E.describe=fe,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","onUpdate:value"])])]))),128)),r.value?(i(),y("div",ys,[t(V,{onClick:q,block:"",icon:ot(C(Ie))},{default:s(()=>[U("添加主题")]),_:1},8,["icon"])])):T("",!0)])):(i(),y("div",ks,[r.value?(i(),y("div",gs,[e("div",$s,[U(" 输出markdown： "),t(pe,{size:"small",onChange:v[15]||(v[15]=E=>I(E,"outDiySwitch")),checked:n.value,"onUpdate:checked":v[16]||(v[16]=E=>n.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",xs,[U(" 回复图片： "),t(pe,{size:"small",onChange:v[17]||(v[17]=E=>I(E,"imgDiySwitch")),checked:$.value,"onUpdate:checked":v[18]||(v[18]=E=>$.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):T("",!0),t(D,{bordered:r.value,value:c.prompt,"onUpdate:value":v[19]||(v[19]=E=>c.prompt=E),disabled:!r.value,placeholder:"请输入","auto-size":{minRows:5,maxRows:15}},null,8,["bordered","value","disabled"])])),t(zo,{onHandleAiSave:p,ref_key:"aiCreatePromptRef",ref:N},null,512)])}}},Ss=Q(ws,[["__scopeId","data-v-3ca1638d"]]),$e=m=>(H("data-v-ce956f07"),m=m(),W(),m),qs={class:"actions-box"},Cs={class:"model-name"},Is={key:0,class:"form-box"},Rs={class:"form-item"},Ls=$e(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),Es={class:"form-item-body"},Us=["src"],As={key:0},Os={key:1},zs={class:"form-item"},Ms={class:"form-item-label"},js=$e(()=>e("span",null,"温度 ",-1)),Ds={class:"form-item-body"},Ns={class:"number-box"},Vs={class:"number-slider-box"},Ts={class:"number-input-box"},Bs={class:"form-item"},Ps={class:"form-item-label"},Qs=$e(()=>e("span",null,"最大token ",-1)),Fs={class:"form-item-body"},Js={class:"number-box"},Ks={class:"number-slider-box"},Hs={class:"number-input-box"},Ws={class:"form-item"},Gs={class:"form-item-label"},Zs=$e(()=>e("span",null,"上下文数量 ",-1)),Ys={class:"form-item-body"},Xs={class:"number-box"},en={class:"number-slider-box"},tn={class:"number-input-box"},on={__name:"model-settings",setup(m){const r=["azure","ollama","xinference","openaiAgent"],k=["azure"],h=P({sm:24,md:24,lg:12,xl:8,xxl:8}),a=x([]),_=x(!1),{robotInfo:o,updateRobotInfo:S}=G("robotInfo"),n=P({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0}),$=x(""),c=x(""),w=x(""),l=(f,g)=>{const p=g.current_obj;n.use_model=r.indexOf(p.model_define)>-1&&p.deployment_name?p.deployment_name:p.name,$.value=p.model_define,n.model_config_id=p.id||g.model_config_id},d=()=>{w.value=n.use_model,k.indexOf($.value)>-1&&(n.use_model="默认"),S({...K(n)}),_.value=!1},I=f=>{f||($.value=c.value),r.indexOf($.value)>-1?n.use_model=w.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,_.value=f};function b(f,g,p){const u=new Set(f.map(O=>O.model_define));return g.filter(O=>{let N=O[p];u.has(N)&&f.filter(j=>{if(j.model_define==N)return j.children=dt(j.children,O.children),!1})}),f}return(()=>{Ve({model_type:"LLM"}).then(f=>{w.value=o.use_model;let g=f.data||[],p=[];a.value=g.map(u=>{p=[];for(let O=0;O<u.model_info.llm_model_list.length;O++){const N=u.model_info.llm_model_list[O];r.indexOf(u.model_info.model_define)>-1&&o.model_config_id==u.model_config.id&&(w.value=u.model_config.deployment_name,$.value=u.model_info.model_define,c.value=u.model_info.model_define),p.push({name:N,deployment_name:u.model_config.deployment_name,id:u.model_config.id,model_define:u.model_info.model_define})}return{id:u.model_config.id,name:u.model_info.model_name,model_define:u.model_info.model_define,icon:u.model_info.model_icon_url,children:p,deployment_name:u.model_config.deployment_name}}),a.value=b(rt(a.value,"model_define"),a.value,"model_define")})})(),(f,g)=>{const p=te,u=he,O=Le,N=Te,j=Be,M=Pe,v=yt,A=_e,J=Qe,ee=Re,V=kt;return i(),z(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:_.value,"onUpdate:isEdit":g[9]||(g[9]=L=>_.value=L)},{extra:s(()=>[e("div",qs,[_.value?(i(),z(u,{key:0,gap:8},{default:s(()=>[t(p,{onClick:d,size:"small",type:"primary"},{default:s(()=>[U("保存")]),_:1}),t(p,{onClick:g[0]||(g[0]=L=>I(!1)),size:"small"},{default:s(()=>[U("取消")]),_:1})]),_:1})):(i(),y(B,{key:1},[e("span",Cs,R(w.value),1),t(O,{type:"vertical"}),t(p,{onClick:g[1]||(g[1]=L=>I(!0)),size:"small"},{default:s(()=>[U("修改")]),_:1})],64))])]),default:s(()=>[_.value?(i(),y("div",Is,[t(V,{gutter:[32,16]},{default:s(()=>[t(v,be(ye(h)),{default:s(()=>[e("div",Rs,[Ls,e("div",Es,[t(M,{value:n.use_model,"onUpdate:value":g[2]||(g[2]=L=>n.use_model=L),placeholder:"请选择LLM模型",onChange:l,style:{width:"100%"}},{default:s(()=>[(i(!0),y(B,null,F(a.value,L=>(i(),z(j,{key:L.id},{label:s(()=>[t(u,{align:"center",gap:6},{default:s(()=>[e("img",{class:"model-icon",src:L.icon,alt:""},null,8,Us),U(R(L.name),1)]),_:2},1024)]),default:s(()=>[(i(!0),y(B,null,F(L.children,D=>(i(),z(N,{value:r.indexOf(L.model_define)>-1&&D.deployment_name?D.deployment_name:D.name+D.id,model_config_id:L.id,current_obj:D,key:D.name+D.id},{default:s(()=>[r.indexOf(L.model_define)>-1&&D.deployment_name?(i(),y("span",As,R(D.deployment_name),1)):(i(),y("span",Os,R(D.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(v,be(ye(h)),{default:s(()=>[e("div",zs,[e("div",Ms,[js,t(A,null,{title:s(()=>[U("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Ds,[e("div",Ns,[e("div",Vs,[t(J,{class:"custom-slider",value:n.temperature,"onUpdate:value":g[3]||(g[3]=L=>n.temperature=L),min:0,max:2,step:.1},null,8,["value"])]),e("div",Ts,[t(ee,{value:n.temperature,"onUpdate:value":g[4]||(g[4]=L=>n.temperature=L),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(v,be(ye(h)),{default:s(()=>[e("div",Bs,[e("div",Ps,[Qs,t(A,null,{title:s(()=>[U("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Fs,[e("div",Js,[e("div",Ks,[t(J,{class:"custom-slider",value:n.max_token,"onUpdate:value":g[5]||(g[5]=L=>n.max_token=L),min:0,max:100*1024},null,8,["value"])]),e("div",Hs,[t(ee,{value:n.max_token,"onUpdate:value":g[6]||(g[6]=L=>n.max_token=L),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(v,be(ye(h)),{default:s(()=>[e("div",Ws,[e("div",Gs,[Zs,t(A,null,{title:s(()=>[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Ys,[e("div",Xs,[e("div",en,[t(J,{class:"custom-slider",value:n.context_pair,"onUpdate:value":g[7]||(g[7]=L=>n.context_pair=L),min:0,max:10},null,8,["value"])]),e("div",tn,[t(ee,{value:n.context_pair,"onUpdate:value":g[8]||(g[8]=L=>n.context_pair=L),min:0,max:10},null,8,["value"])])])])])]),_:1},16)]),_:1})])):T("",!0)]),_:1},8,["isEdit"])}}},sn=Q(on,[["__scopeId","data-v-ce956f07"]]),nn={class:"library-checkbox-box"},an={class:"list-tools"},ln={class:"list-box",ref:"scrollContainer"},cn={class:"library-name"},rn={class:"library-desc"},dn={__name:"library-select-alert",emits:["change"],setup(m,{expose:r,emit:k}){const h=k,a=P({indeterminate:!1,checkAll:!1,checkedList:[]}),_=x(!1),o=q=>{l(),a.checkedList=q,_.value=!0},S=()=>{_.value=!1,w()},n=x(""),$=()=>{l()},c=x([]),w=()=>{h("change",[...a.checkedList])},l=async()=>{const q=await Fe({library_name:n.value});if(q){let f=q.data||[];c.value=f}},d=x(!1),I=async()=>{d.value=!0,await l(),d.value=!1,Z.success("刷新完成")},b=()=>{window.open("/#/library/add")};return r({open:o}),(q,f)=>{const g=xt,p=re,u=te,O=Je,N=Ke,j=Ce,M=ae;return i(),z(M,{width:"746px",open:_.value,"onUpdate:open":f[2]||(f[2]=v=>_.value=v),title:"关联知识库",onOk:S},{default:s(()=>[e("div",nn,[t(g,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",an,[e("div",null,[t(p,{style:{width:"282px"},value:n.value,"onUpdate:value":f[0]||(f[0]=v=>n.value=v),placeholder:"请输入知识库名称搜索",onChange:$},{suffix:s(()=>[t(C(gt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(u,{style:{"margin-right":"8px"},onClick:I},{default:s(()=>[t(C($t)),U(" 刷新 ")]),_:1}),t(u,{type:"primary",ghost:"",onClick:b},{default:s(()=>[U("新建知识库")]),_:1})])]),t(j,{spinning:d.value,delay:100},{default:s(()=>[t(N,{value:a.checkedList,"onUpdate:value":f[1]||(f[1]=v=>a.checkedList=v),style:{width:"100%"}},{default:s(()=>[e("div",ln,[(i(!0),y(B,null,F(c.value,v=>(i(),y("div",{class:"list-item-wraapper",key:v.id},[t(O,{class:"list-item",value:v.id},{default:s(()=>[e("div",cn,R(v.library_name),1),e("div",rn,R(v.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},_n=Q(dn,[["__scopeId","data-v-f9210a6f"]]),xe=m=>(H("data-v-2a603da6"),m=m(),W(),m),un={class:"recall-settings-box"},pn={class:"form-box"},mn={class:"form-item is-required"},vn=xe(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),hn={class:"form-item-body"},fn={class:"retrieval-mode-items"},bn=["onClick"],yn={class:"retrieval-mode-title"},kn={class:"title-text"},gn={class:"retrieval-mode-desc"},$n={class:"form-item"},xn={class:"form-item-label"},wn=xe(()=>e("span",null,"Top K ",-1)),Sn={class:"form-item-body"},qn={class:"number-box"},Cn={class:"number-slider-box"},In={class:"number-input-box"},Rn={class:"form-item"},Ln={class:"form-item-label"},En=xe(()=>e("span",null,"相似度阈值 ",-1)),Un={class:"form-item-body"},An={class:"number-box"},On={class:"number-slider-box"},zn={class:"number-input-box"},Mn={class:"form-item"},jn={class:"form-item-label"},Dn=xe(()=>e("span",null,"Rerank模型",-1)),Nn={class:"form-item-body"},Vn=["src"],Tn={__name:"recall-settings-alert",emits:["change"],setup(m,{expose:r,emit:k}){const h=k,a=x([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),_=P({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),o=x(!1),S=b=>{I(),_.rerank_status=b.rerank_status||0,_.rerank_use_model=b.rerank_use_model||void 0,_.rerank_model_config_id=b.rerank_model_config_id||"",_.top_k=b.top_k,_.similarity=b.similarity,_.search_type=b.search_type,o.value=!0},n=(b,q)=>{_.rerank_model_config_id=q.rerank_model_config_id},$=b=>{_.search_type=b},c=()=>_.rerank_status==1&&!_.rerank_model_config_id,w=()=>{if(c())return Z.error("请选择Rerank模型");o.value=!1,l()},l=()=>{h("change",K(_))},d=x([]),I=()=>{Ve({model_type:"RERANK"}).then(b=>{let q=b.data||[];d.value=q.map(f=>({id:f.model_config.id,name:f.model_info.model_name,icon:f.model_info.model_icon_url,children:f.model_info.rerank_model_list}))})};return r({open:S}),(b,q)=>{const f=le,g=_e,p=Qe,u=Re,O=de,N=Te,j=Be,M=Pe,v=ae;return i(),z(v,{width:"472px",open:o.value,"onUpdate:open":q[6]||(q[6]=A=>o.value=A),title:"召回设置",onOk:w},{default:s(()=>[e("div",un,[e("div",pn,[e("div",mn,[vn,e("div",hn,[e("div",fn,[(i(!0),y(B,null,F(a.value,A=>(i(),y("div",{class:we(["retrieval-mode-item",{active:_.search_type==A.value}]),key:A.value,onClick:J=>$(A.value)},[_.search_type==A.value?(i(),z(f,{key:0,class:"check-arrow",name:"check-arrow-filled"})):T("",!0),e("div",yn,[t(f,{name:A.iconName,class:"title-icon"},null,8,["name"]),e("span",kn,R(A.title),1),A.isRecommendation?(i(),z(f,{key:0,class:"recommendation-icon",name:"recommendation"})):T("",!0)]),e("div",gn,R(A.desc),1)],10,bn))),128))])])]),e("div",$n,[e("div",xn,[wn,t(g,null,{title:s(()=>[U("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Sn,[e("div",qn,[e("div",Cn,[t(p,{class:"custom-slider",value:_.top_k,"onUpdate:value":q[0]||(q[0]=A=>_.top_k=A),min:1,max:10},null,8,["value"])]),e("div",In,[t(u,{value:_.top_k,"onUpdate:value":q[1]||(q[1]=A=>_.top_k=A),min:1,max:10},null,8,["value"])])])])]),e("div",Rn,[e("div",Ln,[En,t(g,null,{title:s(()=>[U("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Un,[e("div",An,[e("div",On,[t(p,{class:"custom-slider",value:_.similarity,"onUpdate:value":q[2]||(q[2]=A=>_.similarity=A),min:0,max:1,step:.01},null,8,["value"])]),e("div",zn,[t(u,{value:_.similarity,"onUpdate:value":q[3]||(q[3]=A=>_.similarity=A),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",Mn,[e("div",jn,[Dn,U("   "),t(O,{checkedValue:1,unCheckedValue:0,checked:_.rerank_status,"onUpdate:checked":q[4]||(q[4]=A=>_.rerank_status=A)},null,8,["checked"])]),e("div",Nn,[t(M,{value:_.rerank_use_model,"onUpdate:value":q[5]||(q[5]=A=>_.rerank_use_model=A),placeholder:"请选择Rerank模型",onChange:n,style:{width:"320px"}},{default:s(()=>[(i(!0),y(B,null,F(d.value,A=>(i(),z(j,{key:A.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:A.icon,alt:""},null,8,Vn)])]),default:s(()=>[(i(!0),y(B,null,F(A.children,J=>(i(),z(N,{value:J,rerank_model_config_id:A.id,key:J},{default:s(()=>[e("span",null,R(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},Bn=Q(Tn,[["__scopeId","data-v-2a603da6"]]),Pn={class:"actions-box"},Qn={key:0,class:"library-list"},Fn=["onClick"],Jn={class:"library-name"},Kn={class:"library-intro"},Hn={__name:"index",setup(m){const{getStorage:r,removeStorage:k}=_t("localStorage"),h=x(!1),{robotInfo:a,updateRobotInfo:_}=G("robotInfo"),o=P({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),S=x([]),n=x(null),$=Se(()=>S.value.filter(p=>o.library_ids.includes(p.id))),c=p=>{let u=o.library_ids.indexOf(p.id);o.library_ids.splice(u,1),q()},w=p=>{o.library_ids=[...p],q()},l=()=>{n.value.open([...o.library_ids])},d=x(null),I=()=>{d.value.open(K(o))},b=p=>{o.rerank_status=p.rerank_status,o.rerank_use_model=p.rerank_use_model,o.rerank_model_config_id=p.rerank_model_config_id,o.top_k=p.top_k,o.similarity=p.similarity,o.search_type=p.search_type,q()},q=()=>{let p={...K(o)};p.library_ids=p.library_ids.join(","),_({...p})},f=async()=>{const p=await Fe();p&&(S.value=p.data||[])},g=()=>{ae.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){l()}})};return o.rerank_use_model=a.rerank_use_model||void 0,je(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type}),qe(()=>{f(),r("showNoLibraryTip")&&(g(),k("showNoLibraryTip"))}),(p,u)=>{const O=te,N=he;return i(),z(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:h.value,"onUpdate:isEdit":u[0]||(u[0]=j=>h.value=j),bodyStyle:{padding:0}},{extra:s(()=>[e("div",Pn,[t(N,{gap:8},{default:s(()=>[t(O,{size:"small",onClick:I},{default:s(()=>[U("召回设置")]),_:1}),t(O,{size:"small",onClick:l},{default:s(()=>[U("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[$.value.length>0?(i(),y("div",Qn,[(i(!0),y(B,null,F($.value,j=>(i(),y("div",{class:"library-item",key:j.id},[e("span",{class:"close-btn",onClick:M=>c(j)},[t(C(ve))],8,Fn),e("div",Jn,R(j.library_name),1),e("div",Kn,R(j.library_intro),1)]))),128))])):T("",!0),t(_n,{ref_key:"librarySelectAlertRef",ref:n,onChange:w},null,512),t(Bn,{ref_key:"recallSettingsAlertRef",ref:d,onChange:b},null,512)]),_:1},8,["isEdit"])}}},Wn=Q(Hn,[["__scopeId","data-v-999a5a72"]]),Gn=m=>(H("data-v-b559dd08"),m=m(),W(),m),Zn={class:"library-checkbox-box"},Yn={class:"list-box",ref:"scrollContainer"},Xn={class:"library-name"},ei={class:"library-desc"},ti={key:0,class:"empty-box"},oi=Gn(()=>e("img",{src:wt,alt:""},null,-1)),si={__name:"library-select-alert",emits:["change"],setup(m,{expose:r,emit:k}){const h=k,a=P({indeterminate:!1,checkAll:!1,checkedList:[]}),_=x(!1),o=d=>{c(),a.checkedList=d,_.value=!0},S=()=>{_.value=!1,$()};x("");const n=x([]),$=()=>{h("change",[...a.checkedList])},c=async()=>{const d=await He();if(d){let I=d.data||[];n.value=I}},w=x(!1),l=()=>{window.open("/#/database/list")};return r({open:o}),(d,I)=>{const b=Je,q=Ke,f=Ce,g=ae;return i(),z(g,{width:"746px",open:_.value,"onUpdate:open":I[1]||(I[1]=p=>_.value=p),title:"关联数据表",onOk:S},{default:s(()=>[e("div",Zn,[t(f,{spinning:w.value,delay:100},{default:s(()=>[t(q,{value:a.checkedList,"onUpdate:value":I[0]||(I[0]=p=>a.checkedList=p),style:{width:"100%"}},{default:s(()=>[e("div",Yn,[(i(!0),y(B,null,F(n.value,p=>(i(),y("div",{class:"list-item-wraapper",key:p.id},[t(b,{class:"list-item",value:p.id},{default:s(()=>[e("div",Xn,R(p.name),1),e("div",ei,R(p.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!w.value&&!n.value.length?(i(),y("div",ti,[oi,e("div",null,[U(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:l}," 去添加")])])):T("",!0)])]),_:1},8,["open"])}}},ni=Q(si,[["__scopeId","data-v-b559dd08"]]),ii=m=>(H("data-v-de8ee53c"),m=m(),W(),m),ai=ii(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),li={class:"actions-box"},ci={key:0,class:"library-list"},ri=["onClick"],di={class:"library-name"},_i={class:"library-intro"},ui={__name:"index",setup(m){const r=x(!1),{robotInfo:k,updateRobotInfo:h}=G("robotInfo"),a=P({form_ids:[]}),_=x([]),o=x(null),S=Se(()=>_.value.filter(d=>a.form_ids.includes(d.id))),n=d=>{let I=a.form_ids.indexOf(d.id);a.form_ids.splice(I,1),w()},$=d=>{a.form_ids=[...d],w()},c=()=>{o.value.open([...a.form_ids])},w=()=>{let d={...K(a)};d.form_ids=d.form_ids.join(","),h({...d})};return(async()=>{const d=await He();d&&(_.value=d.data||[])})(),je(()=>{a.form_ids=k.form_ids.split(",")}),(d,I)=>{const b=_e,q=te,f=he;return i(),z(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:r.value,"onUpdate:isEdit":I[0]||(I[0]=g=>r.value=g),bodyStyle:{padding:0}},{tip:s(()=>[t(b,{placement:"top"},{title:s(()=>[ai]),default:s(()=>[t(C(Y))]),_:1})]),extra:s(()=>[e("div",li,[t(f,{gap:8},{default:s(()=>[t(q,{size:"small",onClick:c},{default:s(()=>[U("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[S.value.length>0?(i(),y("div",ci,[(i(!0),y(B,null,F(S.value,g=>(i(),y("div",{class:"library-item",key:g.id},[e("span",{class:"close-btn",onClick:p=>n(g)},[t(C(ve))],8,ri),e("div",di,R(g.name),1),e("div",_i,R(g.description),1)]))),128))])):T("",!0),t(ni,{ref_key:"librarySelectAlertRef",ref:o,onChange:$},null,512)]),_:1},8,["isEdit"])}}},pi=Q(ui,[["__scopeId","data-v-de8ee53c"]]),mi={class:"form-box"},vi={class:"question-title"},hi={class:"question-options"},fi={class:"question-option"},bi={class:"drag-btn"},yi={class:"action-box"},ki={class:"robot-info-box"},gi={class:"robot-welcome-content"},$i={class:"robot-welcome-question"},xi={__name:"welcome-words",setup(m){const r=x(!1),k=x(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:_}=G("robotInfo"),o=P({welcomes:{content:"",question:[]}}),S=()=>{let l=!1;if(o.welcomes.question.length>0){for(let d=0;d<o.welcomes.question.length;d++)if(!o.welcomes.question[d].content){l=d+1;break}}return l},n=()=>{o.welcomes.question.push({content:"",id:ke(8)})},$=l=>{o.welcomes.question.splice(l,1)},c=()=>{if(!o.welcomes.content)return Z.error("请输入欢迎语");if(S())return Z.error("引导问题内容不能为空");a({...K(o)}),r.value=!1},w=()=>{let l={...h.welcomes},d=[];l.question.forEach(({content:I,id:b})=>{let q={id:b,content:I};q.id||(q.id=ke(6)),d.push(q)}),o.welcomes.content=l.content,o.welcomes.question=d};return(l,d)=>{const I=ge,b=le,q=re;return i(),z(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:r.value,"onUpdate:isEdit":d[4]||(d[4]=f=>r.value=f),onSave:c,onEdit:w},{default:s(()=>[ne(e("div",mi,[e("div",vi,[t(I,{value:o.welcomes.content,"onUpdate:value":d[0]||(d[0]=f=>o.welcomes.content=f),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",hi,[t(C(Ee),{modelValue:o.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=f=>o.welcomes.question=f),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=f=>k.value=!0),onEnd:d[3]||(d[3]=f=>k.value=!1)},{item:s(({element:f,index:g})=>[e("div",fi,[e("span",bi,[t(b,{name:"drag"})]),t(q,{class:"question-option-content",value:f.content,"onUpdate:value":p=>f.content=p,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",yi,[t(C(ve),{class:"del-btn",onClick:p=>$(g)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:n},[t(C(Ie),{class:"add-btn-icon"}),U("添加引导问题 ")])])],512),[[ie,r.value]]),ne(e("div",ki,[e("div",gi,R(C(h).welcomes.content),1),e("div",$i,[(i(!0),y(B,null,F(C(h).welcomes.question,(f,g)=>(i(),y("div",{class:"question-item",key:g},R(f.content),1))),128))])],512),[[ie,!r.value]])]),_:1},8,["isEdit"])}}},wi=Q(xi,[["__scopeId","data-v-ea227a87"]]),Si=m=>(H("data-v-bc797bf6"),m=m(),W(),m),qi=Si(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Ci={class:"form-box"},Ii={class:"question-title"},Ri={class:"question-options"},Li={class:"question-option"},Ei={class:"drag-btn"},Ui={class:"action-box"},Ai={class:"robot-info-box"},Oi={class:"robot-unknown-content"},zi={class:"robot-unknown-question"},Mi={__name:"unknown-problem-prompt",setup(m){const r=x(!1),k=x(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:_}=G("robotInfo"),o=P({unknown_question_prompt:{content:"",question:[]}}),S=()=>{o.unknown_question_prompt.question.push({content:"",id:ke(8)}),st(()=>{_()})},n=w=>{o.unknown_question_prompt.question.splice(w,1)},$=()=>{a({...K(o)}),r.value=!1},c=()=>{let w={...h.unknown_question_prompt},l=[];w.question&&w.question.forEach(({content:d,id:I})=>{let b={id:I,content:d};b.id||(b.id=ke(6)),l.push(b)}),w.content&&(o.unknown_question_prompt.content=w.content),l&&(o.unknown_question_prompt.question=l)};return qe(()=>{}),(w,l)=>{const d=_e,I=ge,b=le,q=re;return i(),z(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:r.value,"onUpdate:isEdit":l[4]||(l[4]=f=>r.value=f),onSave:$,onEdit:c},{tip:s(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[qi]),default:s(()=>[t(C(Y))]),_:1})]),default:s(()=>[ne(e("div",Ci,[e("div",Ii,[t(I,{value:o.unknown_question_prompt.content,"onUpdate:value":l[0]||(l[0]=f=>o.unknown_question_prompt.content=f),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Ri,[t(C(Ee),{modelValue:o.unknown_question_prompt.question,"onUpdate:modelValue":l[1]||(l[1]=f=>o.unknown_question_prompt.question=f),"item-key":"id",handle:".drag-btn",onStart:l[2]||(l[2]=f=>k.value=!0),onEnd:l[3]||(l[3]=f=>k.value=!1)},{item:s(({element:f,index:g})=>[e("div",Li,[e("span",Ei,[t(b,{name:"drag"})]),t(q,{class:"question-option-content",value:f.content,"onUpdate:value":p=>f.content=p,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ui,[t(C(ve),{class:"del-btn",onClick:p=>n(g)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:S},[t(C(Ie),{class:"add-btn-icon"}),U("添加引导问题 ")])])],512),[[ie,r.value]]),ne(e("div",Ai,[e("div",Oi,R(C(h).unknown_question_prompt.content),1),e("div",zi,[(i(!0),y(B,null,F(C(h).unknown_question_prompt.question,(f,g)=>(i(),y("div",{class:"question-item",key:g},R(f.content),1))),128))])],512),[[ie,!r.value]])]),_:1},8,["isEdit"])}}},ji=Q(Mi,[["__scopeId","data-v-bc797bf6"]]),Ze=m=>(H("data-v-c60b8d8e"),m=m(),W(),m),Di=Ze(()=>e("span",null,null,-1)),Ni=Ze(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Vi={__name:"problem-optimization",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:k}=G("robotInfo");P({prompt:""});const h=a=>{k({})};return(a,_)=>{const o=de;return i(),z(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[Di]),default:s(()=>[Ni,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_question_optimize,"onUpdate:checked":_[0]||(_[0]=S=>C(r).enable_question_optimize=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ti=Q(Vi,[["__scopeId","data-v-c60b8d8e"]]),Ye=m=>(H("data-v-34918831"),m=m(),W(),m),Bi=Ye(()=>e("span",null,null,-1)),Pi=Ye(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),Qi={__name:"suggested-issues",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:k}=G("robotInfo"),h=a=>{k({})};return(a,_)=>{const o=de;return i(),z(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[Bi]),default:s(()=>[Pi,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_question_guide,"onUpdate:checked":_[0]||(_[0]=S=>C(r).enable_question_guide=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Fi=Q(Qi,[["__scopeId","data-v-34918831"]]),Ue=m=>(H("data-v-a0ec9e93"),m=m(),W(),m),Ji={class:"direct-title"},Ki={class:"direct-desc"},Hi={class:"qa"},Wi={class:"prompt-form-item-label"},Gi=Ue(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Zi={class:"direct-switch"},Yi={class:"similarity"},Xi=Ue(()=>e("span",null,"相似度超过",-1)),ea={class:"number-input-box"},ta=Ue(()=>e("span",null,"时直接回复答案",-1)),oa={__name:"chat-edit-alert",emits:["save"],setup(m,{expose:r,emit:k}){const h=k,a=x(1),_=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],o=P(_()),S=x(!1),n=P({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),$=()=>{n.chat_type=a.value.toString(),o.forEach(l=>{l.chat_type==a.value&&(n.chat_type=="3"?(n.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch==1?"true":"false",n.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score.toString()):n.chat_type=="1"&&(n.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch==1?"true":"false",n.library_qa_direct_reply_score=l.library_qa_direct_reply_score.toString()))}),c(),Object.assign(o,_()),S.value=!1},c=()=>{h("save",K(n))};qe(()=>{});const w=l=>{a.value=parseInt(l.chat_type),n.chat_type=l.chat_type,n.library_qa_direct_reply_score=l.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch,o.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=l.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch=="true"?1:0)}),S.value=!0};return me(()=>S.value,l=>{l===!1&&Object.assign(o,_())},{immediate:!0}),r({open:w}),(l,d)=>{const I=_e,b=de,q=Re,f=St,g=qt,p=ae;return i(),z(p,{width:"746px",open:S.value,"onUpdate:open":d[1]||(d[1]=u=>S.value=u),title:"聊天模式设置",onOk:$},{default:s(()=>[t(g,{class:"direct-box",value:a.value,"onUpdate:value":d[0]||(d[0]=u=>a.value=u)},{default:s(()=>[(i(!0),y(B,null,F(o,u=>(i(),z(f,{class:we(["direct-item",{active:a.value==u.direct_id}]),value:u.direct_id,key:u.direct_id},{default:s(()=>[e("div",Ji,R(u.direct_title),1),e("div",Ki,R(u.direct_desc),1),ne(e("div",Hi,[e("div",Wi,[Gi,t(I,null,nt({default:s(()=>[t(C(Y),{class:"question-icon"})]),_:2},[u.chat_type=="1"?{name:"title",fn:s(()=>[U("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:u.chat_type=="3"?{name:"title",fn:s(()=>[U("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Zi,[u.chat_type=="1"?(i(),z(b,{key:0,checkedValue:1,unCheckedValue:0,checked:u.library_qa_direct_reply_switch,"onUpdate:checked":O=>u.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):u.chat_type=="3"?(i(),z(b,{key:1,checkedValue:1,unCheckedValue:0,checked:u.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>u.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):T("",!0)])])],512),[[ie,u.isQaDirectReply&&a.value==u.direct_id]]),ne(e("div",Yi,[Xi,e("div",ea,[u.chat_type=="1"?(i(),z(q,{key:0,value:u.library_qa_direct_reply_score,"onUpdate:value":O=>u.library_qa_direct_reply_score=O,disabled:!u.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):u.chat_type=="3"?(i(),z(q,{key:1,value:u.mixture_qa_direct_reply_score,"onUpdate:value":O=>u.mixture_qa_direct_reply_score=O,disabled:!u.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):T("",!0)]),ta],512),[[ie,u.isQaDirectReply&&a.value==u.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},sa=Q(oa,[["__scopeId","data-v-a0ec9e93"]]),Ae=m=>(H("data-v-2a920ba8"),m=m(),W(),m),na=Ae(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),ia=Ae(()=>e("br",null,null,-1)),aa=Ae(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),la={class:"actions-box"},ca={class:"model-name"},ra={class:"form-box"},da={__name:"index",setup(m){const r=x(!1),k=x(null),{robotInfo:h,updateRobotInfo:a}=G("robotInfo"),_=P({chat_type:h.chat_type,library_qa_direct_reply_score:h.library_qa_direct_reply_score,library_qa_direct_reply_switch:h.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:h.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:h.mixture_qa_direct_reply_switch}),o=$=>{_.chat_type=$.chat_type,_.library_qa_direct_reply_score=$.library_qa_direct_reply_score,_.library_qa_direct_reply_switch=$.library_qa_direct_reply_switch,_.mixture_qa_direct_reply_score=$.mixture_qa_direct_reply_score,_.mixture_qa_direct_reply_switch=$.mixture_qa_direct_reply_switch,S()},S=()=>{a({...K(_)}),r.value=!1},n=()=>{k.value.open(K(_)),r.value=!0};return($,c)=>{const w=_e,l=Le,d=te;return i(),z(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:r.value,"onUpdate:isEdit":c[1]||(c[1]=I=>r.value=I),bodyStyle:{padding:0}},{tip:s(()=>[t(w,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[na,ia,aa]),default:s(()=>[t(C(Y))]),_:1})]),extra:s(()=>[e("div",la,[e("span",ca,R(C(h).chat_type=="1"?"仅知识库":C(h).chat_type=="2"?"直连模式":"混合模式"),1),t(l,{type:"vertical"}),t(d,{size:"small",onClick:c[0]||(c[0]=I=>n(!0))},{default:s(()=>[U("修改")]),_:1})])]),default:s(()=>[e("div",ra,[t(sa,{ref_key:"ChatEditAlertRef",ref:k,onSave:o},null,512)])]),_:1},8,["isEdit"])}}},_a=Q(da,[["__scopeId","data-v-2a920ba8"]]),ua=m=>(H("data-v-8d185d5f"),m=m(),W(),m),pa={class:"switch-box"},ma={class:"switch-box-body"},va={class:"switch-box-header"},ha={class:"left-box"},fa={class:"switch-box-title"},ba={key:0,class:"title-tip"},ya={class:"right-box"},ka={class:"extra-box"},ga=ua(()=>e("div",{class:"extra-box"},null,-1)),$a={class:"switch-desc"},xa={class:"switch-box-right"},wa={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(m,{emit:r}){const k=r,h=m,a=x(h.value),_=o=>{k("update:value",o),k("change",o)};return(o,S)=>{const n=le,$=de;return i(),y("div",pa,[e("div",ma,[e("div",va,[e("div",ha,[t(n,{class:"switch-box-icon",name:h.iconName},null,8,["name"]),e("span",fa,R(h.title),1),o.$slots.tip?(i(),y("span",ba,[ce(o.$slots,"tip",{},void 0,!0)])):T("",!0)]),e("div",ya,[e("div",ka,[ce(o.$slots,"extra",{},()=>[ga],!0)])])]),e("div",$a,[ce(o.$slots,"default",{},void 0,!0)])]),e("div",xa,[t($,{checked:a.value,"onUpdate:checked":S[0]||(S[0]=c=>a.value=c),onChange:_,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Sa=Q(wa,[["__scopeId","data-v-8d185d5f"]]),qa="/assets/img/empty-Bx9z1cwf.png",Ca="/assets/img/phone-head-CDwwPhYa.png",Ia="/assets/img/phone-body-CbEf8GZP.png",Ra="/assets/img/phone-footer-ClQtNpln.png",ue=m=>(H("data-v-5125783f"),m=m(),W(),m),La={class:"common-problem-box"},Ea={class:"left-content-box"},Ua={key:0,class:"empty-box"},Aa=ue(()=>e("img",{src:qa,alt:""},null,-1)),Oa=ue(()=>e("div",{class:"title"},"暂无数据",-1)),za=ue(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Ma={key:1,class:"lists-box"},ja={class:"drag-btn"},Da={class:"title"},Na={class:"opration-box"},Va={class:"preview-box"},Ta=ue(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ca,alt:""})],-1)),Ba={class:"phone-body"},Pa=ue(()=>e("div",null,[e("img",{class:"body-img",src:Ia,alt:""})],-1)),Qa={key:0,class:"question-box"},Fa=ue(()=>e("div",{class:"name"},"常见问题",-1)),Ja=ue(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Ra,alt:""})],-1)),Ka={__name:"common-problem",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:k}=G("robotInfo"),h=Se(()=>r.common_question_list?JSON.parse(r.common_question_list):[]),a=x([]);a.value=h.value,me(h,()=>{a.value=h.value});const _=Me.useForm,o=x(!1),S=x("添加问题"),n=P({question:"",index:-1}),$=P({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:c,validate:w,validateInfos:l}=_(n,$),d=()=>{if(h.value.length>=10)return Z.error("最多设置10条常用问题");o.value=!0,c(),n.question="",n.index=-1},I=(p,u)=>{o.value=!0,c(),n.question=p,n.index=u},b=p=>{let u=[];u=h.value.filter((O,N)=>p!=N),ae.confirm({title:"提醒",icon:t(ut),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){k({common_question_list:JSON.stringify(u)})},onCancel(){}})},q=()=>{w().then(()=>{let p=[];n.index>=0?p=h.value.map((u,O)=>O===n.index?n.question:u):p=[n.question,...h.value],k({common_question_list:JSON.stringify(p)}),o.value=!1})},f=p=>{k({})},g=p=>{k({common_question_list:JSON.stringify(a.value)})};return(p,u)=>{const O=_e,N=de,j=Le,M=te,v=le,A=re,J=Ct,ee=Me,V=ae;return i(),y("div",La,[e("div",Ea,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(O,null,{title:s(()=>[U("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(C(Y),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(N,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_common_question,"onUpdate:checked":u[0]||(u[0]=L=>C(r).enable_common_question=L),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(j,{type:"vertical"}),t(M,{type:"primary",size:"small",onClick:d},{default:s(()=>[U("添加")]),_:1})]),default:s(()=>[h.value.length==0?(i(),y("div",Ua,[Aa,Oa,za,t(M,{onClick:d,type:"primary"},{default:s(()=>[U("立即添加")]),_:1})])):(i(),y("div",Ma,[t(C(Ee),{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=L=>a.value=L),handle:".drag-btn","item-key":"index",onEnd:g},{item:s(({element:L,index:D})=>[(i(),y("div",{class:"list-item",key:D},[e("span",ja,[t(v,{name:"drag"})]),e("div",Da,R(L),1),e("div",Na,[t(C(mt),{onClick:pe=>I(L,D)},null,8,["onClick"]),t(C(ve),{onClick:pe=>b(D)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Va,[Ta,e("div",Ba,[Pa,h.value.length&&C(r).enable_common_question=="true"?(i(),y("div",Qa,[Fa,(i(!0),y(B,null,F(h.value,L=>(i(),y("div",{class:"list-item",key:L},R(L),1))),128))])):T("",!0)]),Ja]),t(V,{open:o.value,"onUpdate:open":u[3]||(u[3]=L=>o.value=L),title:S.value,onOk:q,width:"476px"},{default:s(()=>[t(ee,{class:"form-box",layout:"vertical"},{default:s(()=>[t(J,it({label:"问题名称"},C(l).question),{default:s(()=>[t(A,{maxLength:100,value:n.question,"onUpdate:value":u[2]||(u[2]=L=>n.question=L),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ha=Q(Ka,[["__scopeId","data-v-5125783f"]]),Wa=e("span",null,null,-1),Ga=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),Za={__name:"display-aitations",setup(m){const{robotInfo:r,updateRobotInfo:k}=G("robotInfo"),h=x(!1);me(()=>r.answer_source_switch,_=>{h.value=_=="true"},{immediate:!0});const a=()=>{k({answer_source_switch:h.value?"true":"false"})};return(_,o)=>(i(),z(Sa,{title:"显示引文","icon-name":"jibenpeizhi",value:h.value,"onUpdate:value":o[0]||(o[0]=S=>h.value=S),onChange:a},{extra:s(()=>[Wa]),default:s(()=>[Ga]),_:1},8,["value"]))}},Ya={key:0,class:"robot-config-page"},Xa={class:"setting-box"},el={class:"setting-box"},tl={class:"setting-box"},ol={class:"setting-box"},sl={class:"setting-box"},nl={class:"setting-box"},il={class:"setting-box"},al={class:"setting-box"},ll={class:"setting-box"},cl={class:"setting-box"},rl={class:"setting-box"},dl={key:1,class:"robot-config-page"},_l={__name:"index",setup(m){const r=It(),k=x(null),{robotInfo:h}=at(r),{getRobot:a}=r,_=()=>{k.value.scrollTop=k.value.scrollHeight},o=x(1),S=x(!1),n=P(h.value);lt("robotInfo",{robotInfo:n,updateRobotInfo:w=>{let l=JSON.parse(JSON.stringify(w));w.robot_avatar&&(l.robot_avatar=new File([w.robot_avatar],w.robot_avatar.name)),Object.assign(n,l),c()},scrollBoxToBottom:_});const c=()=>{let w;n.robot_avatar&&(w=new File([n.robot_avatar],n.robot_avatar.name));let l=JSON.parse(JSON.stringify(K(n)));w&&(l.robot_avatar=w);let d=l.welcomes;d.question=d.question.map(b=>b.content),l.welcomes=JSON.stringify(d),l.prompt_struct=JSON.stringify(l.prompt_struct);let I=l.unknown_question_prompt;I.question=I.question.map(b=>b.content),l.unknown_question_prompt=JSON.stringify(I),delete l.robot_avatar_url,S.value=!0,ft(l).then(b=>{if(b.res!=0)return Z.error(b.msg);S.value=!1,Z.success("保存成功"),a(n.id)}).catch(()=>{S.value=!1})};return(w,l)=>{const d=De,I=Ne;return i(),y(B,null,[t(I,{activeKey:o.value,"onUpdate:activeKey":l[0]||(l[0]=b=>o.value=b)},{default:s(()=>[(i(),z(d,{key:1,tab:"基础配置"})),(i(),z(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),o.value==1?(i(),y("div",Ya,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:k},[e("div",Xa,[t(eo)]),e("div",el,[t(Ss)]),e("div",tl,[t(sn)]),e("div",ol,[t(Wn)]),e("div",sl,[t(pi)]),e("div",nl,[t(wi)]),e("div",il,[t(_a)]),e("div",al,[t(ji)]),e("div",ll,[t(Ti)]),e("div",cl,[t(Fi)]),e("div",rl,[t(Za)])],512)])):(i(),y("div",dl,[t(Ha)]))],64)}}},hc=Q(_l,[["__scopeId","data-v-fd5b3ab0"]]);export{hc as default};
