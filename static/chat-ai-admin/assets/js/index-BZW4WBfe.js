import{L as i,M as y,V as e,j as t,X as A,Y as R,S as de,a8 as V,P as z,Q as s,W as et,a2 as we,r as x,d as Z,A as B,E as ie,G as ae,u as C,a9 as H,a3 as W,a4 as G,a0 as tt,F as P,a1 as J,w as me,k as ot,ac as fe,ae as be,b as Se,h as je,v as qe,y as st,ab as nt,U as it,a6 as at,p as lt}from"./vue-chunks-CX0PHdkT.js";import{_ as Q,c as ce,B as oe,U as ct,V as ze,e as X,M as le,W as ve,X as rt,Y as dt,T as _t,Z as ge,E as ut}from"../../index-CstSXCdU.js";import{_ as ye}from"./index-gmAqmiUj.js";import{C as pt,E as mt}from"./cu-upload-CAt4XPeF.js";import"./index-mgtqK7H6.js";import{I as _e}from"./Input-CCZkwFQT.js";import{_ as $e}from"./TextArea-tZiQ0s1q.js";import{C as vt}from"./cu-scroll-qHXUFabe.js";import{c as ht,s as ft}from"./index-BKhu31L8.js";import{_ as bt}from"./index-id_ibJK0.js";import{S as Ce}from"./index-BmmwwUfg.js";import{_ as De,T as Ne}from"./index-ecTSolhs.js";import{P as Ie}from"./PlusOutlined-4Hup-Qb7.js";import{_ as re}from"./index-D9e-I9bu.js";import{c as Ve}from"./index-BYlluNLD.js";import{S as Te,a as Pe,_ as Be}from"./index-DTk_Cj8_.js";import{_ as Qe}from"./index-DOM3eXPE.js";import{_ as Re}from"./index-Dv2rxu3d.js";import{Q as Y}from"./QuestionCircleOutlined-DWuvpisG.js";import{_ as Le}from"./index-DNKktQkL.js";import{_ as yt,a as kt}from"./index-12sq64S6.js";import{_ as ue}from"./index-bwfsT3yL.js";import{g as Fe}from"./index-Bnyi_NyK.js";import{S as gt}from"./SearchOutlined-CTCDQEDm.js";import{S as $t}from"./SyncOutlined-C3neS6yO.js";import{C as Je,_ as Ke}from"./index-Dj5lKekl.js";import{_ as xt}from"./index-BxOFKC0L.js";import{g as He}from"./index-DVIscWFo.js";import{_ as wt}from"./empty-CzGZrENG.js";import{d as Ue}from"./vuedraggable.umd-Di2MWAVJ.js";import"./index-C4FMmkgb.js";import{R as St,_ as qt}from"./RadioButton-DFertNr3.js";import{F as Me,_ as Ct}from"./index-L1GceNF2.js";import{u as It}from"./robot-DP8aUH6y.js";import"./axios-Cm0UX6qg.js";import"./qs-D52wVmk8.js";import"./crypto-js-ZYyBUTQg.js";import"./dayjs-DItM2b4N.js";import"./FormItemContext-BHAiblOr.js";import"./index-BHTxBMxE.js";import"./Search-DdoCxxLO.js";import"./isPlainObject-DadmzF58.js";import"./inputProps-BGPPkc5V.js";import"./Password-BPL4Bd2T.js";import"./statusUtils-DAHCu8QH.js";import"./index-v-hTEyV7.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-JZ91zQ8P.js";import"./colors-C2VfdtVY.js";import"./index-CPSClIuB.js";import"./shallowequal-BtoafKsn.js";import"./collapseMotion-7Vnsd4b5.js";import"./slide-C2DT8m2K.js";import"./Dropdown-BXle2wjv.js";import"./useRefs-DaOtXq3f.js";import"./pick-BiMyb7X9.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-VXIK4oM4.js";import"./DownOutlined-DGhSUoaY.js";import"./move-7f3qAgDa.js";import"./index-BpvDS-2z.js";import"./responsiveObserve-S5D8rlR7.js";const Rt={class:"edit-box-header"},Lt={class:"left-box"},Ut={class:"edit-box-title"},Et={key:0},At={key:0,class:"title-tip"},Ot={class:"right-box"},zt={class:"extra-box"},Mt={class:"actions-box"},jt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(m,{emit:r}){const g=r,h=m,a=o=>{g("edit"),g("update:isEdit",o)},_=()=>{g("save")};return(o,S)=>{const n=ce,$=oe,c=ye;return i(),y("div",{class:we(["edit-box",{"is-edit":m.isEdit}])},[e("div",Rt,[e("div",Lt,[t(n,{class:"edit-box-icon",name:h.iconName},null,8,["name"]),e("span",Ut,[A(R(h.title)+" ",1),o.$slots.icon?(i(),y("span",Et,[de(o.$slots,"icon",{},void 0,!0)])):V("",!0)]),o.$slots.tip?(i(),y("span",At,[de(o.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Ot,[e("div",zt,[de(o.$slots,"extra",{},()=>[e("div",Mt,[h.isEdit?(i(),z(c,{key:0,gap:8},{default:s(()=>[t($,{onClick:_,size:"small",type:"primary"},{default:s(()=>[A("保存")]),_:1}),t($,{onClick:S[0]||(S[0]=w=>a(!1)),size:"small"},{default:s(()=>[A("取消")]),_:1})]),_:1})):(i(),z($,{key:1,onClick:S[1]||(S[1]=w=>a(!0)),size:"small"},{default:s(()=>[A("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:et({...m.bodyStyle})},[de(o.$slots,"default",{},void 0,!0)],4)],2)}}},ee=Q(jt,[["__scopeId","data-v-dbe09743"]]),We=m=>(W("data-v-899bcb03"),m=m(),G(),m),Dt={class:"robot-form-box"},Nt={class:"form-item"},Vt=We(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Tt={class:"form-item-body robot-name-item"},Pt={class:"robot-avetar-upload"},Bt=["src"],Qt={class:"robot-name-box"},Ft={class:"form-item"},Jt=We(()=>e("div",{class:"form-item-label"},"简介",-1)),Kt={class:"form-item-body"},Ht={class:"robot-info-box"},Wt={class:"robot-name-box"},Gt=["src"],Zt={class:"robot-name"},Yt={class:"robot-intro"},Xt={__name:"basic-config",setup(m){const r=x(!1),{robotInfo:g,updateRobotInfo:h}=Z("robotInfo"),a=B({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),_=()=>{h({...H(a)}),r.value=!1},o=n=>{let $=n[0];return a.robot_avatar=$,ct($).then(c=>{a.robot_avatar_url=c}),!1},S=()=>{a.robot_name=g.robot_name,a.robot_intro=g.robot_intro,a.robot_avatar=g.robot_avatar,a.robot_avatar_url=g.robot_avatar_url};return(n,$)=>{const c=_e,w=$e;return i(),z(ee,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:r.value,"onUpdate:isEdit":$[2]||($[2]=l=>r.value=l),onSave:_,onEdit:S},{default:s(()=>[ie(e("div",Dt,[e("div",Nt,[Vt,e("div",Tt,[t(pt,{accept:"image/*",onChange:o},{default:s(()=>[e("div",Pt,[a.robot_avatar_url?(i(),y("img",{key:0,class:"robot-avetar",src:a.robot_avatar_url},null,8,Bt)):V("",!0)])]),_:1}),e("div",Qt,[t(c,{value:a.robot_name,"onUpdate:value":$[0]||($[0]=l=>a.robot_name=l),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Ft,[Jt,e("div",Kt,[t(w,{rows:3,value:a.robot_intro,"onUpdate:value":$[1]||($[1]=l=>a.robot_intro=l),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ae,r.value]]),ie(e("div",Ht,[e("div",Wt,[e("img",{class:"robot-avatar",src:C(g).robot_avatar_url,alt:""},null,8,Gt),e("span",Zt,R(C(g).robot_name),1)]),e("div",Yt,R(C(g).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ae,!r.value]])]),_:1},8,["isEdit"])}}},eo=Q(Xt,[["__scopeId","data-v-899bcb03"]]),Ge=m=>(W("data-v-896a48d0"),m=m(),G(),m),to={class:"ai-create-box"},oo={class:"input-box"},so=Ge(()=>e("span",null,"生成",-1)),no={class:"quick-tags-box"},io=Ge(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),ao={class:"ai-list-box"},lo={key:0,class:"loading-box"},co={key:0,class:"prompt-list-box"},ro={class:"prompt-list"},_o={class:"prompt-header"},uo={class:"prompt-title"},po={class:"prompt-content"},mo={class:"prompt-list"},vo={class:"prompt-header"},ho={class:"prompt-title"},fo={class:"prompt-content"},bo={class:"prompt-list"},yo={class:"prompt-header"},ko={class:"prompt-title"},go={class:"prompt-content"},$o={class:"prompt-list"},xo={class:"prompt-header"},wo={class:"prompt-title"},So={class:"prompt-content"},qo={class:"prompt-list"},Co={class:"prompt-header"},Io={class:"prompt-title"},Ro={class:"prompt-content"},Lo={class:"prompt-header"},Uo={class:"prompt-title"},Eo={class:"prompt-content"},Ao={key:1,class:"empty-box"},Oo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(m,{expose:r,emit:g}){const h=ze.PRESENTED_IMAGE_SIMPLE,a=x(!1),_=x(!1),o=tt().query,S=g,n=x(""),$=x(!1),c=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],w=x("在上方输入框输入要求，点击生成提示词"),l=()=>{d.value=!1,b.promptStruct=I,n.value="",w.value="在上方输入框输入要求，点击生成提示词",a.value=!0},d=x(!1),I={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},b=B({promptStruct:I}),q=p=>{n.value=p},f=()=>{if(!n.value)return X.error("请输入AI 生成提示词");if($.value)return X.error("正在生成中...");$.value=!0,ht({id:o.id,demand:n.value}).then(p=>{b.promptStruct=JSON.parse(p.data.promptStruct),d.value=!0}).finally(()=>{$.value=!1}).catch(p=>{d.value=!1,w.value=p.msg})},k=()=>{if(!d.value)return X.error("请先生成提示词");S("handleAiSave",b.promptStruct),a.value=!1};return r({show:l}),(p,u)=>{const O=oe,D=_e,j=ce,M=bt,v=Ce,U=ze,K=vt,te=le;return i(),y("div",null,[t(te,{open:a.value,"onUpdate:open":u[1]||(u[1]=N=>a.value=N),title:"AI 生成提示词",width:746},{footer:s(()=>[t(O,{type:"primary",loading:_.value,onClick:k},{default:s(()=>[A("使用该提示")]),_:1},8,["loading"])]),default:s(()=>[e("div",to,[e("div",oo,[t(D,{style:{width:"100%"},value:n.value,"onUpdate:value":u[0]||(u[0]=N=>n.value=N),size:"large",onPressEnter:f,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:f},[t(j,{name:"ai-mark"}),so])]),e("div",no,[io,(i(),y(P,null,J(c,N=>t(M,{key:N.title,onClick:T=>q(N.title),color:"blue"},{default:s(()=>[A(R(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",ao,[t(K,{style:{height:"100%"}},{default:s(()=>[$.value?(i(),y("div",lo,[t(v,{tip:"正在生成中..."})])):(i(),y(P,{key:1},[d.value?(i(),y("div",co,[e("div",ro,[e("div",_o,[e("div",uo,R(b.promptStruct.role.subject),1)]),e("div",po,R(b.promptStruct.role.describe),1)]),e("div",mo,[e("div",vo,[e("div",ho,R(b.promptStruct.task.subject),1)]),e("div",fo,R(b.promptStruct.task.describe),1)]),e("div",bo,[e("div",yo,[e("div",ko,R(b.promptStruct.constraints.subject),1)]),e("div",go,R(b.promptStruct.constraints.describe),1)]),e("div",$o,[e("div",xo,[e("div",wo,R(b.promptStruct.output.subject),1)]),e("div",So,R(b.promptStruct.output.describe),1)]),e("div",qo,[e("div",Co,[e("div",Io,R(b.promptStruct.tone.subject),1)]),e("div",Ro,R(b.promptStruct.tone.describe),1)]),(i(!0),y(P,null,J(b.promptStruct.custom,(N,T)=>(i(),y("div",{class:"prompt-list",key:T+N.key?N.key:""},[e("div",Lo,[e("div",Uo,R(N.subject),1)]),e("div",Eo,R(N.describe),1)]))),128))])):(i(),y("div",Ao,[t(U,{image:C(h),description:w.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},zo=Q(Oo,[["__scopeId","data-v-896a48d0"]]),Mo={class:"prompt-box"},jo={class:"tab-header"},Do={key:0,class:"opt-block"},No={key:1,class:"opt-block"},Vo={key:0,class:"prompt-list-box"},To={class:"prompt-list"},Po={class:"prompt-header"},Bo={class:"prompt-title"},Qo={key:0,class:"btn-wrapper-box"},Fo={class:"prompt-content"},Jo={class:"prompt-list"},Ko={class:"prompt-header"},Ho={class:"prompt-title"},Wo={key:0,class:"btn-wrapper-box"},Go={class:"prompt-content"},Zo={class:"prompt-list"},Yo={class:"prompt-header"},Xo={class:"prompt-title"},es={key:0,class:"btn-wrapper-box"},ts={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={key:0,class:"btn-wrapper-box"},as={class:"swich-item"},ls={class:"swich-item"},cs={class:"prompt-content"},rs={class:"prompt-list"},ds={class:"prompt-header"},_s={class:"prompt-title"},us={key:0,class:"btn-wrapper-box"},ps={class:"prompt-content"},ms={class:"prompt-header"},vs={class:"prompt-title",style:{flex:"1"}},hs={key:0,class:"btn-wrapper-box"},fs=["onClick"],bs={class:"prompt-content"},ys={key:0,class:"add-theme-block"},ks={key:1,class:"diy-prompt-box"},gs={key:0,class:"diy-switch-box"},$s={class:"swich-item"},xs={class:"swich-item"},se="- 请使用markdown格式回答问题。",ne="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",ws={__name:"system-prompt-words",setup(m){const r=x(!1),{robotInfo:g,updateRobotInfo:h}=Z("robotInfo");let a={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const _=x({}),o=x(!1),S=x(!1),n=x(!1),$=x(!1),c=B({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),w=(M,v)=>M.includes(v),l=x(g.prompt_type);me(()=>g,()=>{c.prompt=g.prompt,c.prompt_struct=g.prompt_struct,_.value=g.prompt_struct_default},{immediate:!0,deep:!0}),me(()=>c.prompt_struct.output.describe,M=>{o.value=w(M,se),S.value=w(M,ne)},{immediate:!0,deep:!0}),me(()=>c.prompt,M=>{n.value=w(M,se),$.value=w(M,ne)},{immediate:!0,deep:!0});const d=(M,v)=>{M?(v=="outSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+se:c.prompt_struct.output.describe+=se),v=="imgSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+ne:c.prompt_struct.output.describe+=ne)):(v=="outSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(se,"g"),"")),v=="imgSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(ne,"g"),"")),c.prompt_struct.output.describe=c.prompt_struct.output.describe.trim())},I=(M,v)=>{M?(v=="outDiySwitch"&&(c.prompt?c.prompt+=`
`+se:c.prompt+=se),v=="imgDiySwitch"&&(c.prompt?c.prompt+=`
`+ne:c.prompt+=ne)):(v=="outDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(se,"g"),"")),v=="imgDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(ne,"g"),"")),c.prompt=c.prompt.trim())},b=M=>{c.prompt_struct[M].describe=_.value[M].describe},q=()=>{c.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),l.value=1},f=M=>{c.prompt_struct.custom.splice(M,1)},k=()=>{h({...H(c),prompt_type:l.value}),r.value=!1},p=M=>{l.value=1,h({prompt_type:l.value,prompt:c.prompt,prompt_struct:M}),r.value=!1},u=()=>{r.value=!0},O=()=>{r.value=!1},D=x(null),j=()=>{D.value.show()};return(M,v)=>{const U=De,K=Ne,te=ce,N=oe,T=ye,E=$e,F=re,Xe=_e;return i(),y("div",Mo,[e("div",jo,[t(K,{activeKey:l.value,"onUpdate:activeKey":v[0]||(v[0]=L=>l.value=L)},{default:s(()=>[(i(),z(U,{key:1,tab:"结构化提示词"})),(i(),z(U,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),r.value?(i(),y("div",Do,[e("div",{class:"ai-mark-box",onClick:j},[t(te,{name:"ai-mark"}),A(" AI自动生成 ")]),t(T,{gap:8},{default:s(()=>[t(N,{size:"small",type:"primary",onClick:k},{default:s(()=>[A("保存")]),_:1}),t(N,{size:"small",onClick:O},{default:s(()=>[A("取消")]),_:1})]),_:1})])):(i(),y("div",No,[t(N,{size:"small",onClick:u},{default:s(()=>[A("修改")]),_:1})]))]),l.value==1?(i(),y("div",Vo,[e("div",To,[e("div",Po,[e("div",Bo,R(c.prompt_struct.role.subject),1),r.value?(i(),y("div",Qo,[e("a",{onClick:v[1]||(v[1]=L=>b("role"))},"恢复默认")])):V("",!0)]),e("div",Fo,[t(E,{bordered:!1,disabled:!r.value,value:c.prompt_struct.role.describe,"onUpdate:value":v[2]||(v[2]=L=>c.prompt_struct.role.describe=L),placeholder:C(a).role,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Jo,[e("div",Ko,[e("div",Ho,R(c.prompt_struct.task.subject),1),r.value?(i(),y("div",Wo,[e("a",{onClick:v[3]||(v[3]=L=>b("task"))},"恢复默认")])):V("",!0)]),e("div",Go,[t(E,{bordered:!1,disabled:!r.value,value:c.prompt_struct.task.describe,"onUpdate:value":v[4]||(v[4]=L=>c.prompt_struct.task.describe=L),placeholder:C(a).task,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Zo,[e("div",Yo,[e("div",Xo,R(c.prompt_struct.constraints.subject),1),r.value?(i(),y("div",es,[e("a",{onClick:v[5]||(v[5]=L=>b("constraints"))},"恢复默认")])):V("",!0)]),e("div",ts,[t(E,{bordered:!1,disabled:!r.value,value:c.prompt_struct.constraints.describe,"onUpdate:value":v[6]||(v[6]=L=>c.prompt_struct.constraints.describe=L),placeholder:C(a).constraints,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",os,[e("div",ss,[e("div",ns,R(c.prompt_struct.output.subject),1),r.value?(i(),y("div",is,[e("div",as,[A(" 输出markdown： "),t(F,{onChange:v[7]||(v[7]=L=>d(L,"outSwitch")),checked:o.value,"onUpdate:checked":v[8]||(v[8]=L=>o.value=L),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ls,[A(" 回复图片： "),t(F,{onChange:v[9]||(v[9]=L=>d(L,"imgSwitch")),checked:S.value,"onUpdate:checked":v[10]||(v[10]=L=>S.value=L),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:v[11]||(v[11]=L=>b("output"))},"恢复默认")])):V("",!0)]),e("div",cs,[t(E,{bordered:!1,disabled:!r.value,value:c.prompt_struct.output.describe,"onUpdate:value":v[12]||(v[12]=L=>c.prompt_struct.output.describe=L),placeholder:C(a).output,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",rs,[e("div",ds,[e("div",_s,R(c.prompt_struct.tone.subject),1),r.value?(i(),y("div",us,[e("a",{onClick:v[13]||(v[13]=L=>b("tone"))},"恢复默认")])):V("",!0)]),e("div",ps,[t(E,{bordered:!1,disabled:!r.value,value:c.prompt_struct.tone.describe,"onUpdate:value":v[14]||(v[14]=L=>c.prompt_struct.tone.describe=L),placeholder:C(a).tone,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),(i(!0),y(P,null,J(c.prompt_struct.custom,(L,Oe)=>(i(),y("div",{class:"prompt-list",key:Oe+L.key?L.key:""},[e("div",ms,[e("div",vs,[t(Xe,{bordered:!1,disabled:!r.value,style:{width:"100%"},value:L.subject,"onUpdate:value":ke=>L.subject=ke,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),r.value?(i(),y("div",hs,[e("div",{class:"hover-btn-box",onClick:ke=>f(Oe)},[t(C(ve))],8,fs)])):V("",!0)]),e("div",bs,[t(E,{bordered:!1,disabled:!r.value,value:L.describe,"onUpdate:value":ke=>L.describe=ke,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","onUpdate:value"])])]))),128)),r.value?(i(),y("div",ys,[t(N,{onClick:q,block:"",icon:ot(C(Ie))},{default:s(()=>[A("添加主题")]),_:1},8,["icon"])])):V("",!0)])):(i(),y("div",ks,[r.value?(i(),y("div",gs,[e("div",$s,[A(" 输出markdown： "),t(F,{size:"small",onChange:v[15]||(v[15]=L=>I(L,"outDiySwitch")),checked:n.value,"onUpdate:checked":v[16]||(v[16]=L=>n.value=L),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",xs,[A(" 回复图片： "),t(F,{size:"small",onChange:v[17]||(v[17]=L=>I(L,"imgDiySwitch")),checked:$.value,"onUpdate:checked":v[18]||(v[18]=L=>$.value=L),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):V("",!0),t(E,{bordered:r.value,value:c.prompt,"onUpdate:value":v[19]||(v[19]=L=>c.prompt=L),disabled:!r.value,placeholder:"请输入","auto-size":{minRows:5,maxRows:15}},null,8,["bordered","value","disabled"])])),t(zo,{onHandleAiSave:p,ref_key:"aiCreatePromptRef",ref:D},null,512)])}}},Ss=Q(ws,[["__scopeId","data-v-3ca1638d"]]),he=m=>(W("data-v-2b58ac3e"),m=m(),G(),m),qs={class:"actions-box"},Cs={class:"model-name"},Is={key:0,class:"form-box"},Rs={class:"form-item"},Ls=he(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),Us={class:"form-item-body"},Es=["src"],As={key:0},Os={key:1},zs={class:"form-item"},Ms={class:"form-item-label"},js=he(()=>e("span",null,"温度 ",-1)),Ds={class:"form-item-body"},Ns={class:"number-box"},Vs={class:"number-slider-box"},Ts={class:"number-input-box"},Ps={class:"form-item"},Bs={class:"form-item-label"},Qs=he(()=>e("span",null,"最大token ",-1)),Fs={class:"form-item-body"},Js={class:"number-box"},Ks={class:"number-slider-box"},Hs={class:"number-input-box"},Ws={class:"form-item"},Gs={class:"form-item-label"},Zs=he(()=>e("span",null,"上下文数量 ",-1)),Ys={class:"form-item-body"},Xs={class:"number-box"},en={class:"number-slider-box"},tn={class:"number-input-box"},on={class:"form-item"},sn={class:"form-item-label"},nn=he(()=>e("span",null,"显示推理过程 ",-1)),an=he(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),ln={class:"form-item-body",style:{"padding-top":"5px"}},cn={__name:"model-settings",setup(m){const r=["azure","ollama","xinference","openaiAgent"],g=["azure"],h=B({sm:24,md:24,lg:12,xl:8,xxl:8}),a=x([]),_=x(!1),{robotInfo:o,updateRobotInfo:S}=Z("robotInfo"),n=B({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),$=x(""),c=x(""),w=x(""),l=(f,k)=>{const p=k.current_obj;n.use_model=r.indexOf(p.model_define)>-1&&p.deployment_name?p.deployment_name:p.name,$.value=p.model_define,n.model_config_id=p.id||k.model_config_id},d=()=>{w.value=n.use_model,g.indexOf($.value)>-1&&(n.use_model="默认"),S({...H(n)}),_.value=!1},I=f=>{f||($.value=c.value),r.indexOf($.value)>-1?n.use_model=w.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,n.think_switch=Number(o.think_switch),_.value=f};function b(f,k,p){const u=new Set(f.map(O=>O.model_define));return k.filter(O=>{let D=O[p];u.has(D)&&f.filter(j=>{if(j.model_define==D)return j.children=dt(j.children,O.children),!1})}),f}return(()=>{Ve({model_type:"LLM"}).then(f=>{w.value=o.use_model;let k=f.data||[],p=[];a.value=k.map(u=>{p=[];for(let O=0;O<u.model_info.llm_model_list.length;O++){const D=u.model_info.llm_model_list[O];r.indexOf(u.model_info.model_define)>-1&&o.model_config_id==u.model_config.id&&(w.value=u.model_config.deployment_name,$.value=u.model_info.model_define,c.value=u.model_info.model_define),p.push({name:D,deployment_name:u.model_config.deployment_name,id:u.model_config.id,model_define:u.model_info.model_define})}return{id:u.model_config.id,name:u.model_info.model_name,model_define:u.model_info.model_define,icon:u.model_info.model_icon_url,children:p,deployment_name:u.model_config.deployment_name}}),a.value=b(rt(a.value,"model_define"),a.value,"model_define")})})(),(f,k)=>{const p=oe,u=ye,O=Le,D=Te,j=Pe,M=Be,v=yt,U=ue,K=Qe,te=Re,N=re,T=kt;return i(),z(ee,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:_.value,"onUpdate:isEdit":k[10]||(k[10]=E=>_.value=E)},{extra:s(()=>[e("div",qs,[_.value?(i(),z(u,{key:0,gap:8},{default:s(()=>[t(p,{onClick:d,size:"small",type:"primary"},{default:s(()=>[A("保存")]),_:1}),t(p,{onClick:k[0]||(k[0]=E=>I(!1)),size:"small"},{default:s(()=>[A("取消")]),_:1})]),_:1})):(i(),y(P,{key:1},[e("span",Cs,R(w.value),1),t(O,{type:"vertical"}),t(p,{onClick:k[1]||(k[1]=E=>I(!0)),size:"small"},{default:s(()=>[A("修改")]),_:1})],64))])]),default:s(()=>[_.value?(i(),y("div",Is,[t(T,{gutter:[32,16]},{default:s(()=>[t(v,fe(be(h)),{default:s(()=>[e("div",Rs,[Ls,e("div",Us,[t(M,{value:n.use_model,"onUpdate:value":k[2]||(k[2]=E=>n.use_model=E),placeholder:"请选择LLM模型",onChange:l,style:{width:"100%"}},{default:s(()=>[(i(!0),y(P,null,J(a.value,E=>(i(),z(j,{key:E.id},{label:s(()=>[t(u,{align:"center",gap:6},{default:s(()=>[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,Es),A(R(E.name),1)]),_:2},1024)]),default:s(()=>[(i(!0),y(P,null,J(E.children,F=>(i(),z(D,{value:r.indexOf(E.model_define)>-1&&F.deployment_name?F.deployment_name:F.name+F.id,model_config_id:E.id,current_obj:F,key:F.name+F.id},{default:s(()=>[r.indexOf(E.model_define)>-1&&F.deployment_name?(i(),y("span",As,R(F.deployment_name),1)):(i(),y("span",Os,R(F.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",zs,[e("div",Ms,[js,t(U,null,{title:s(()=>[A("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Ds,[e("div",Ns,[e("div",Vs,[t(K,{class:"custom-slider",value:n.temperature,"onUpdate:value":k[3]||(k[3]=E=>n.temperature=E),min:0,max:2,step:.1},null,8,["value"])]),e("div",Ts,[t(te,{value:n.temperature,"onUpdate:value":k[4]||(k[4]=E=>n.temperature=E),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",Ps,[e("div",Bs,[Qs,t(U,null,{title:s(()=>[A("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Fs,[e("div",Js,[e("div",Ks,[t(K,{class:"custom-slider",value:n.max_token,"onUpdate:value":k[5]||(k[5]=E=>n.max_token=E),min:0,max:100*1024},null,8,["value"])]),e("div",Hs,[t(te,{value:n.max_token,"onUpdate:value":k[6]||(k[6]=E=>n.max_token=E),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",Ws,[e("div",Gs,[Zs,t(U,null,{title:s(()=>[A("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Ys,[e("div",Xs,[e("div",en,[t(K,{class:"custom-slider",value:n.context_pair,"onUpdate:value":k[7]||(k[7]=E=>n.context_pair=E),min:0,max:10},null,8,["value"])]),e("div",tn,[t(te,{value:n.context_pair,"onUpdate:value":k[8]||(k[8]=E=>n.context_pair=E),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",on,[e("div",sn,[nn,t(U,null,{title:s(()=>[an]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",ln,[t(N,{checked:n.think_switch,"onUpdate:checked":k[9]||(k[9]=E=>n.think_switch=E),checkedValue:1,unCheckedValue:0},null,8,["checked"])])])]),_:1},16)]),_:1})])):V("",!0)]),_:1},8,["isEdit"])}}},rn=Q(cn,[["__scopeId","data-v-2b58ac3e"]]),dn={class:"library-checkbox-box"},_n={class:"list-tools"},un={class:"list-box",ref:"scrollContainer"},pn={class:"library-name"},mn={class:"library-desc"},vn={__name:"library-select-alert",emits:["change"],setup(m,{expose:r,emit:g}){const h=g,a=B({indeterminate:!1,checkAll:!1,checkedList:[]}),_=x(!1),o=q=>{l(),a.checkedList=q,_.value=!0},S=()=>{_.value=!1,w()},n=x(""),$=()=>{l()},c=x([]),w=()=>{h("change",[...a.checkedList])},l=async()=>{const q=await Fe({library_name:n.value,type:""});if(q){let f=q.data||[];c.value=f}},d=x(!1),I=async()=>{d.value=!0,await l(),d.value=!1,X.success("刷新完成")},b=()=>{window.open("/#/library/list")};return r({open:o}),(q,f)=>{const k=xt,p=_e,u=oe,O=Je,D=Ke,j=Ce,M=le;return i(),z(M,{width:"746px",open:_.value,"onUpdate:open":f[2]||(f[2]=v=>_.value=v),title:"关联知识库",onOk:S},{default:s(()=>[e("div",dn,[t(k,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",_n,[e("div",null,[t(p,{style:{width:"282px"},value:n.value,"onUpdate:value":f[0]||(f[0]=v=>n.value=v),placeholder:"请输入知识库名称搜索",onChange:$},{suffix:s(()=>[t(C(gt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(u,{style:{"margin-right":"8px"},onClick:I},{default:s(()=>[t(C($t)),A(" 刷新 ")]),_:1}),t(u,{type:"primary",ghost:"",onClick:b},{default:s(()=>[A("新建知识库")]),_:1})])]),t(j,{spinning:d.value,delay:100},{default:s(()=>[t(D,{value:a.checkedList,"onUpdate:value":f[1]||(f[1]=v=>a.checkedList=v),style:{width:"100%"}},{default:s(()=>[e("div",un,[(i(!0),y(P,null,J(c.value,v=>(i(),y("div",{class:"list-item-wraapper",key:v.id},[t(O,{class:"list-item",value:v.id},{default:s(()=>[e("div",pn,R(v.library_name),1),e("div",mn,R(v.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},hn=Q(vn,[["__scopeId","data-v-75c5cc9c"]]),xe=m=>(W("data-v-2a603da6"),m=m(),G(),m),fn={class:"recall-settings-box"},bn={class:"form-box"},yn={class:"form-item is-required"},kn=xe(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),gn={class:"form-item-body"},$n={class:"retrieval-mode-items"},xn=["onClick"],wn={class:"retrieval-mode-title"},Sn={class:"title-text"},qn={class:"retrieval-mode-desc"},Cn={class:"form-item"},In={class:"form-item-label"},Rn=xe(()=>e("span",null,"Top K ",-1)),Ln={class:"form-item-body"},Un={class:"number-box"},En={class:"number-slider-box"},An={class:"number-input-box"},On={class:"form-item"},zn={class:"form-item-label"},Mn=xe(()=>e("span",null,"相似度阈值 ",-1)),jn={class:"form-item-body"},Dn={class:"number-box"},Nn={class:"number-slider-box"},Vn={class:"number-input-box"},Tn={class:"form-item"},Pn={class:"form-item-label"},Bn=xe(()=>e("span",null,"Rerank模型",-1)),Qn={class:"form-item-body"},Fn=["src"],Jn={__name:"recall-settings-alert",emits:["change"],setup(m,{expose:r,emit:g}){const h=g,a=x([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),_=B({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),o=x(!1),S=b=>{I(),_.rerank_status=b.rerank_status||0,_.rerank_use_model=b.rerank_use_model||void 0,_.rerank_model_config_id=b.rerank_model_config_id||"",_.top_k=b.top_k,_.similarity=b.similarity,_.search_type=b.search_type,o.value=!0},n=(b,q)=>{_.rerank_model_config_id=q.rerank_model_config_id},$=b=>{_.search_type=b},c=()=>_.rerank_status==1&&!_.rerank_model_config_id,w=()=>{if(c())return X.error("请选择Rerank模型");o.value=!1,l()},l=()=>{h("change",H(_))},d=x([]),I=()=>{Ve({model_type:"RERANK"}).then(b=>{let q=b.data||[];d.value=q.map(f=>({id:f.model_config.id,name:f.model_info.model_name,icon:f.model_info.model_icon_url,children:f.model_info.rerank_model_list}))})};return r({open:S}),(b,q)=>{const f=ce,k=ue,p=Qe,u=Re,O=re,D=Te,j=Pe,M=Be,v=le;return i(),z(v,{width:"472px",open:o.value,"onUpdate:open":q[6]||(q[6]=U=>o.value=U),title:"召回设置",onOk:w},{default:s(()=>[e("div",fn,[e("div",bn,[e("div",yn,[kn,e("div",gn,[e("div",$n,[(i(!0),y(P,null,J(a.value,U=>(i(),y("div",{class:we(["retrieval-mode-item",{active:_.search_type==U.value}]),key:U.value,onClick:K=>$(U.value)},[_.search_type==U.value?(i(),z(f,{key:0,class:"check-arrow",name:"check-arrow-filled"})):V("",!0),e("div",wn,[t(f,{name:U.iconName,class:"title-icon"},null,8,["name"]),e("span",Sn,R(U.title),1),U.isRecommendation?(i(),z(f,{key:0,class:"recommendation-icon",name:"recommendation"})):V("",!0)]),e("div",qn,R(U.desc),1)],10,xn))),128))])])]),e("div",Cn,[e("div",In,[Rn,t(k,null,{title:s(()=>[A("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",Ln,[e("div",Un,[e("div",En,[t(p,{class:"custom-slider",value:_.top_k,"onUpdate:value":q[0]||(q[0]=U=>_.top_k=U),min:1,max:10},null,8,["value"])]),e("div",An,[t(u,{value:_.top_k,"onUpdate:value":q[1]||(q[1]=U=>_.top_k=U),min:1,max:10},null,8,["value"])])])])]),e("div",On,[e("div",zn,[Mn,t(k,null,{title:s(()=>[A("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:s(()=>[t(C(Y),{class:"question-icon"})]),_:1})]),e("div",jn,[e("div",Dn,[e("div",Nn,[t(p,{class:"custom-slider",value:_.similarity,"onUpdate:value":q[2]||(q[2]=U=>_.similarity=U),min:0,max:1,step:.01},null,8,["value"])]),e("div",Vn,[t(u,{value:_.similarity,"onUpdate:value":q[3]||(q[3]=U=>_.similarity=U),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",Tn,[e("div",Pn,[Bn,A("   "),t(O,{checkedValue:1,unCheckedValue:0,checked:_.rerank_status,"onUpdate:checked":q[4]||(q[4]=U=>_.rerank_status=U)},null,8,["checked"])]),e("div",Qn,[t(M,{value:_.rerank_use_model,"onUpdate:value":q[5]||(q[5]=U=>_.rerank_use_model=U),placeholder:"请选择Rerank模型",onChange:n,style:{width:"320px"}},{default:s(()=>[(i(!0),y(P,null,J(d.value,U=>(i(),z(j,{key:U.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:U.icon,alt:""},null,8,Fn)])]),default:s(()=>[(i(!0),y(P,null,J(U.children,K=>(i(),z(D,{value:K,rerank_model_config_id:U.id,key:K},{default:s(()=>[e("span",null,R(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},Kn=Q(Jn,[["__scopeId","data-v-2a603da6"]]),Hn={class:"actions-box"},Wn={key:0,class:"library-list"},Gn=["onClick"],Zn={class:"library-name"},Yn={class:"library-intro"},Xn={__name:"index",setup(m){const{getStorage:r,removeStorage:g}=_t("localStorage"),h=x(!1),{robotInfo:a,updateRobotInfo:_}=Z("robotInfo"),o=B({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),S=x([]),n=x(null),$=Se(()=>S.value.filter(p=>o.library_ids.includes(p.id))),c=p=>{let u=o.library_ids.indexOf(p.id);o.library_ids.splice(u,1),q()},w=p=>{o.library_ids=[...p],q()},l=()=>{n.value.open([...o.library_ids])},d=x(null),I=()=>{d.value.open(H(o))},b=p=>{o.rerank_status=p.rerank_status,o.rerank_use_model=p.rerank_use_model,o.rerank_model_config_id=p.rerank_model_config_id,o.top_k=p.top_k,o.similarity=p.similarity,o.search_type=p.search_type,q()},q=()=>{let p={...H(o)};p.library_ids=p.library_ids.join(","),_({...p})},f=async()=>{const p=await Fe({type:""});p&&(S.value=p.data||[])},k=()=>{le.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){l()}})};return o.rerank_use_model=a.rerank_use_model||void 0,je(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type}),qe(()=>{f(),r("showNoLibraryTip")&&(k(),g("showNoLibraryTip"))}),(p,u)=>{const O=oe,D=ye;return i(),z(ee,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:h.value,"onUpdate:isEdit":u[0]||(u[0]=j=>h.value=j),bodyStyle:{padding:0}},{extra:s(()=>[e("div",Hn,[t(D,{gap:8},{default:s(()=>[t(O,{size:"small",onClick:I},{default:s(()=>[A("召回设置")]),_:1}),t(O,{size:"small",onClick:l},{default:s(()=>[A("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[$.value.length>0?(i(),y("div",Wn,[(i(!0),y(P,null,J($.value,j=>(i(),y("div",{class:"library-item",key:j.id},[e("span",{class:"close-btn",onClick:M=>c(j)},[t(C(ve))],8,Gn),e("div",Zn,R(j.library_name),1),e("div",Yn,R(j.library_intro),1)]))),128))])):V("",!0),t(hn,{ref_key:"librarySelectAlertRef",ref:n,onChange:w},null,512),t(Kn,{ref_key:"recallSettingsAlertRef",ref:d,onChange:b},null,512)]),_:1},8,["isEdit"])}}},ei=Q(Xn,[["__scopeId","data-v-67e83246"]]),ti=m=>(W("data-v-b559dd08"),m=m(),G(),m),oi={class:"library-checkbox-box"},si={class:"list-box",ref:"scrollContainer"},ni={class:"library-name"},ii={class:"library-desc"},ai={key:0,class:"empty-box"},li=ti(()=>e("img",{src:wt,alt:""},null,-1)),ci={__name:"library-select-alert",emits:["change"],setup(m,{expose:r,emit:g}){const h=g,a=B({indeterminate:!1,checkAll:!1,checkedList:[]}),_=x(!1),o=d=>{c(),a.checkedList=d,_.value=!0},S=()=>{_.value=!1,$()};x("");const n=x([]),$=()=>{h("change",[...a.checkedList])},c=async()=>{const d=await He();if(d){let I=d.data||[];n.value=I}},w=x(!1),l=()=>{window.open("/#/database/list")};return r({open:o}),(d,I)=>{const b=Je,q=Ke,f=Ce,k=le;return i(),z(k,{width:"746px",open:_.value,"onUpdate:open":I[1]||(I[1]=p=>_.value=p),title:"关联数据表",onOk:S},{default:s(()=>[e("div",oi,[t(f,{spinning:w.value,delay:100},{default:s(()=>[t(q,{value:a.checkedList,"onUpdate:value":I[0]||(I[0]=p=>a.checkedList=p),style:{width:"100%"}},{default:s(()=>[e("div",si,[(i(!0),y(P,null,J(n.value,p=>(i(),y("div",{class:"list-item-wraapper",key:p.id},[t(b,{class:"list-item",value:p.id},{default:s(()=>[e("div",ni,R(p.name),1),e("div",ii,R(p.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!w.value&&!n.value.length?(i(),y("div",ai,[li,e("div",null,[A(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:l}," 去添加")])])):V("",!0)])]),_:1},8,["open"])}}},ri=Q(ci,[["__scopeId","data-v-b559dd08"]]),di=m=>(W("data-v-de8ee53c"),m=m(),G(),m),_i=di(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),ui={class:"actions-box"},pi={key:0,class:"library-list"},mi=["onClick"],vi={class:"library-name"},hi={class:"library-intro"},fi={__name:"index",setup(m){const r=x(!1),{robotInfo:g,updateRobotInfo:h}=Z("robotInfo"),a=B({form_ids:[]}),_=x([]),o=x(null),S=Se(()=>_.value.filter(d=>a.form_ids.includes(d.id))),n=d=>{let I=a.form_ids.indexOf(d.id);a.form_ids.splice(I,1),w()},$=d=>{a.form_ids=[...d],w()},c=()=>{o.value.open([...a.form_ids])},w=()=>{let d={...H(a)};d.form_ids=d.form_ids.join(","),h({...d})};return(async()=>{const d=await He();d&&(_.value=d.data||[])})(),je(()=>{a.form_ids=g.form_ids.split(",")}),(d,I)=>{const b=ue,q=oe,f=ye;return i(),z(ee,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:r.value,"onUpdate:isEdit":I[0]||(I[0]=k=>r.value=k),bodyStyle:{padding:0}},{tip:s(()=>[t(b,{placement:"top"},{title:s(()=>[_i]),default:s(()=>[t(C(Y))]),_:1})]),extra:s(()=>[e("div",ui,[t(f,{gap:8},{default:s(()=>[t(q,{size:"small",onClick:c},{default:s(()=>[A("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[S.value.length>0?(i(),y("div",pi,[(i(!0),y(P,null,J(S.value,k=>(i(),y("div",{class:"library-item",key:k.id},[e("span",{class:"close-btn",onClick:p=>n(k)},[t(C(ve))],8,mi),e("div",vi,R(k.name),1),e("div",hi,R(k.description),1)]))),128))])):V("",!0),t(ri,{ref_key:"librarySelectAlertRef",ref:o,onChange:$},null,512)]),_:1},8,["isEdit"])}}},bi=Q(fi,[["__scopeId","data-v-de8ee53c"]]),yi={class:"form-box"},ki={class:"question-title"},gi={class:"question-options"},$i={class:"question-option"},xi={class:"drag-btn"},wi={class:"action-box"},Si={class:"robot-info-box"},qi={class:"robot-welcome-content"},Ci={class:"robot-welcome-question"},Ii={__name:"welcome-words",setup(m){const r=x(!1),g=x(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:_}=Z("robotInfo"),o=B({welcomes:{content:"",question:[]}}),S=()=>{let l=!1;if(o.welcomes.question.length>0){for(let d=0;d<o.welcomes.question.length;d++)if(!o.welcomes.question[d].content){l=d+1;break}}return l},n=()=>{o.welcomes.question.push({content:"",id:ge(8)})},$=l=>{o.welcomes.question.splice(l,1)},c=()=>{if(!o.welcomes.content)return X.error("请输入欢迎语");if(S())return X.error("引导问题内容不能为空");a({...H(o)}),r.value=!1},w=()=>{let l={...h.welcomes},d=[];l.question.forEach(({content:I,id:b})=>{let q={id:b,content:I};q.id||(q.id=ge(6)),d.push(q)}),o.welcomes.content=l.content,o.welcomes.question=d};return(l,d)=>{const I=$e,b=ce,q=_e;return i(),z(ee,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:r.value,"onUpdate:isEdit":d[4]||(d[4]=f=>r.value=f),onSave:c,onEdit:w},{default:s(()=>[ie(e("div",yi,[e("div",ki,[t(I,{value:o.welcomes.content,"onUpdate:value":d[0]||(d[0]=f=>o.welcomes.content=f),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",gi,[t(C(Ue),{modelValue:o.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=f=>o.welcomes.question=f),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=f=>g.value=!0),onEnd:d[3]||(d[3]=f=>g.value=!1)},{item:s(({element:f,index:k})=>[e("div",$i,[e("span",xi,[t(b,{name:"drag"})]),t(q,{class:"question-option-content",value:f.content,"onUpdate:value":p=>f.content=p,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",wi,[t(C(ve),{class:"del-btn",onClick:p=>$(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:n},[t(C(Ie),{class:"add-btn-icon"}),A("添加引导问题 ")])])],512),[[ae,r.value]]),ie(e("div",Si,[e("div",qi,R(C(h).welcomes.content),1),e("div",Ci,[(i(!0),y(P,null,J(C(h).welcomes.question,(f,k)=>(i(),y("div",{class:"question-item",key:k},R(f.content),1))),128))])],512),[[ae,!r.value]])]),_:1},8,["isEdit"])}}},Ri=Q(Ii,[["__scopeId","data-v-ea227a87"]]),Li=m=>(W("data-v-bc797bf6"),m=m(),G(),m),Ui=Li(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Ei={class:"form-box"},Ai={class:"question-title"},Oi={class:"question-options"},zi={class:"question-option"},Mi={class:"drag-btn"},ji={class:"action-box"},Di={class:"robot-info-box"},Ni={class:"robot-unknown-content"},Vi={class:"robot-unknown-question"},Ti={__name:"unknown-problem-prompt",setup(m){const r=x(!1),g=x(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:_}=Z("robotInfo"),o=B({unknown_question_prompt:{content:"",question:[]}}),S=()=>{o.unknown_question_prompt.question.push({content:"",id:ge(8)}),st(()=>{_()})},n=w=>{o.unknown_question_prompt.question.splice(w,1)},$=()=>{a({...H(o)}),r.value=!1},c=()=>{let w={...h.unknown_question_prompt},l=[];w.question&&w.question.forEach(({content:d,id:I})=>{let b={id:I,content:d};b.id||(b.id=ge(6)),l.push(b)}),w.content&&(o.unknown_question_prompt.content=w.content),l&&(o.unknown_question_prompt.question=l)};return qe(()=>{}),(w,l)=>{const d=ue,I=$e,b=ce,q=_e;return i(),z(ee,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:r.value,"onUpdate:isEdit":l[4]||(l[4]=f=>r.value=f),onSave:$,onEdit:c},{tip:s(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Ui]),default:s(()=>[t(C(Y))]),_:1})]),default:s(()=>[ie(e("div",Ei,[e("div",Ai,[t(I,{value:o.unknown_question_prompt.content,"onUpdate:value":l[0]||(l[0]=f=>o.unknown_question_prompt.content=f),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Oi,[t(C(Ue),{modelValue:o.unknown_question_prompt.question,"onUpdate:modelValue":l[1]||(l[1]=f=>o.unknown_question_prompt.question=f),"item-key":"id",handle:".drag-btn",onStart:l[2]||(l[2]=f=>g.value=!0),onEnd:l[3]||(l[3]=f=>g.value=!1)},{item:s(({element:f,index:k})=>[e("div",zi,[e("span",Mi,[t(b,{name:"drag"})]),t(q,{class:"question-option-content",value:f.content,"onUpdate:value":p=>f.content=p,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ji,[t(C(ve),{class:"del-btn",onClick:p=>n(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:S},[t(C(Ie),{class:"add-btn-icon"}),A("添加引导问题 ")])])],512),[[ae,r.value]]),ie(e("div",Di,[e("div",Ni,R(C(h).unknown_question_prompt.content),1),e("div",Vi,[(i(!0),y(P,null,J(C(h).unknown_question_prompt.question,(f,k)=>(i(),y("div",{class:"question-item",key:k},R(f.content),1))),128))])],512),[[ae,!r.value]])]),_:1},8,["isEdit"])}}},Pi=Q(Ti,[["__scopeId","data-v-bc797bf6"]]),Ze=m=>(W("data-v-c60b8d8e"),m=m(),G(),m),Bi=Ze(()=>e("span",null,null,-1)),Qi=Ze(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Fi={__name:"problem-optimization",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:g}=Z("robotInfo");B({prompt:""});const h=a=>{g({})};return(a,_)=>{const o=re;return i(),z(ee,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[Bi]),default:s(()=>[Qi,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_question_optimize,"onUpdate:checked":_[0]||(_[0]=S=>C(r).enable_question_optimize=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ji=Q(Fi,[["__scopeId","data-v-c60b8d8e"]]),Ye=m=>(W("data-v-34918831"),m=m(),G(),m),Ki=Ye(()=>e("span",null,null,-1)),Hi=Ye(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),Wi={__name:"suggested-issues",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:g}=Z("robotInfo"),h=a=>{g({})};return(a,_)=>{const o=re;return i(),z(ee,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[Ki]),default:s(()=>[Hi,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_question_guide,"onUpdate:checked":_[0]||(_[0]=S=>C(r).enable_question_guide=S),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Gi=Q(Wi,[["__scopeId","data-v-34918831"]]),Ee=m=>(W("data-v-a0ec9e93"),m=m(),G(),m),Zi={class:"direct-title"},Yi={class:"direct-desc"},Xi={class:"qa"},ea={class:"prompt-form-item-label"},ta=Ee(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),oa={class:"direct-switch"},sa={class:"similarity"},na=Ee(()=>e("span",null,"相似度超过",-1)),ia={class:"number-input-box"},aa=Ee(()=>e("span",null,"时直接回复答案",-1)),la={__name:"chat-edit-alert",emits:["save"],setup(m,{expose:r,emit:g}){const h=g,a=x(1),_=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],o=B(_()),S=x(!1),n=B({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),$=()=>{n.chat_type=a.value.toString(),o.forEach(l=>{l.chat_type==a.value&&(n.chat_type=="3"?(n.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch==1?"true":"false",n.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score.toString()):n.chat_type=="1"&&(n.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch==1?"true":"false",n.library_qa_direct_reply_score=l.library_qa_direct_reply_score.toString()))}),c(),Object.assign(o,_()),S.value=!1},c=()=>{h("save",H(n))};qe(()=>{});const w=l=>{a.value=parseInt(l.chat_type),n.chat_type=l.chat_type,n.library_qa_direct_reply_score=l.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch,o.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=l.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch=="true"?1:0)}),S.value=!0};return me(()=>S.value,l=>{l===!1&&Object.assign(o,_())},{immediate:!0}),r({open:w}),(l,d)=>{const I=ue,b=re,q=Re,f=St,k=qt,p=le;return i(),z(p,{width:"746px",open:S.value,"onUpdate:open":d[1]||(d[1]=u=>S.value=u),title:"聊天模式设置",onOk:$},{default:s(()=>[t(k,{class:"direct-box",value:a.value,"onUpdate:value":d[0]||(d[0]=u=>a.value=u)},{default:s(()=>[(i(!0),y(P,null,J(o,u=>(i(),z(f,{class:we(["direct-item",{active:a.value==u.direct_id}]),value:u.direct_id,key:u.direct_id},{default:s(()=>[e("div",Zi,R(u.direct_title),1),e("div",Yi,R(u.direct_desc),1),ie(e("div",Xi,[e("div",ea,[ta,t(I,null,nt({default:s(()=>[t(C(Y),{class:"question-icon"})]),_:2},[u.chat_type=="1"?{name:"title",fn:s(()=>[A("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:u.chat_type=="3"?{name:"title",fn:s(()=>[A("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",oa,[u.chat_type=="1"?(i(),z(b,{key:0,checkedValue:1,unCheckedValue:0,checked:u.library_qa_direct_reply_switch,"onUpdate:checked":O=>u.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):u.chat_type=="3"?(i(),z(b,{key:1,checkedValue:1,unCheckedValue:0,checked:u.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>u.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):V("",!0)])])],512),[[ae,u.isQaDirectReply&&a.value==u.direct_id]]),ie(e("div",sa,[na,e("div",ia,[u.chat_type=="1"?(i(),z(q,{key:0,value:u.library_qa_direct_reply_score,"onUpdate:value":O=>u.library_qa_direct_reply_score=O,disabled:!u.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):u.chat_type=="3"?(i(),z(q,{key:1,value:u.mixture_qa_direct_reply_score,"onUpdate:value":O=>u.mixture_qa_direct_reply_score=O,disabled:!u.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):V("",!0)]),aa],512),[[ae,u.isQaDirectReply&&a.value==u.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ca=Q(la,[["__scopeId","data-v-a0ec9e93"]]),Ae=m=>(W("data-v-2a920ba8"),m=m(),G(),m),ra=Ae(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),da=Ae(()=>e("br",null,null,-1)),_a=Ae(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),ua={class:"actions-box"},pa={class:"model-name"},ma={class:"form-box"},va={__name:"index",setup(m){const r=x(!1),g=x(null),{robotInfo:h,updateRobotInfo:a}=Z("robotInfo"),_=B({chat_type:h.chat_type,library_qa_direct_reply_score:h.library_qa_direct_reply_score,library_qa_direct_reply_switch:h.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:h.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:h.mixture_qa_direct_reply_switch}),o=$=>{_.chat_type=$.chat_type,_.library_qa_direct_reply_score=$.library_qa_direct_reply_score,_.library_qa_direct_reply_switch=$.library_qa_direct_reply_switch,_.mixture_qa_direct_reply_score=$.mixture_qa_direct_reply_score,_.mixture_qa_direct_reply_switch=$.mixture_qa_direct_reply_switch,S()},S=()=>{a({...H(_)}),r.value=!1},n=()=>{g.value.open(H(_)),r.value=!0};return($,c)=>{const w=ue,l=Le,d=oe;return i(),z(ee,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:r.value,"onUpdate:isEdit":c[1]||(c[1]=I=>r.value=I),bodyStyle:{padding:0}},{tip:s(()=>[t(w,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[ra,da,_a]),default:s(()=>[t(C(Y))]),_:1})]),extra:s(()=>[e("div",ua,[e("span",pa,R(C(h).chat_type=="1"?"仅知识库":C(h).chat_type=="2"?"直连模式":"混合模式"),1),t(l,{type:"vertical"}),t(d,{size:"small",onClick:c[0]||(c[0]=I=>n(!0))},{default:s(()=>[A("修改")]),_:1})])]),default:s(()=>[e("div",ma,[t(ca,{ref_key:"ChatEditAlertRef",ref:g,onSave:o},null,512)])]),_:1},8,["isEdit"])}}},ha=Q(va,[["__scopeId","data-v-2a920ba8"]]),fa=m=>(W("data-v-8d185d5f"),m=m(),G(),m),ba={class:"switch-box"},ya={class:"switch-box-body"},ka={class:"switch-box-header"},ga={class:"left-box"},$a={class:"switch-box-title"},xa={key:0,class:"title-tip"},wa={class:"right-box"},Sa={class:"extra-box"},qa=fa(()=>e("div",{class:"extra-box"},null,-1)),Ca={class:"switch-desc"},Ia={class:"switch-box-right"},Ra={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(m,{emit:r}){const g=r,h=m,a=x(h.value),_=o=>{g("update:value",o),g("change",o)};return(o,S)=>{const n=ce,$=re;return i(),y("div",ba,[e("div",ya,[e("div",ka,[e("div",ga,[t(n,{class:"switch-box-icon",name:h.iconName},null,8,["name"]),e("span",$a,R(h.title),1),o.$slots.tip?(i(),y("span",xa,[de(o.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",wa,[e("div",Sa,[de(o.$slots,"extra",{},()=>[qa],!0)])])]),e("div",Ca,[de(o.$slots,"default",{},void 0,!0)])]),e("div",Ia,[t($,{checked:a.value,"onUpdate:checked":S[0]||(S[0]=c=>a.value=c),onChange:_,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},La=Q(Ra,[["__scopeId","data-v-8d185d5f"]]),Ua="/assets/img/empty-Bx9z1cwf.png",Ea="/assets/img/phone-head-CDwwPhYa.png",Aa="/assets/img/phone-body-CbEf8GZP.png",Oa="/assets/img/phone-footer-ClQtNpln.png",pe=m=>(W("data-v-5125783f"),m=m(),G(),m),za={class:"common-problem-box"},Ma={class:"left-content-box"},ja={key:0,class:"empty-box"},Da=pe(()=>e("img",{src:Ua,alt:""},null,-1)),Na=pe(()=>e("div",{class:"title"},"暂无数据",-1)),Va=pe(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Ta={key:1,class:"lists-box"},Pa={class:"drag-btn"},Ba={class:"title"},Qa={class:"opration-box"},Fa={class:"preview-box"},Ja=pe(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ea,alt:""})],-1)),Ka={class:"phone-body"},Ha=pe(()=>e("div",null,[e("img",{class:"body-img",src:Aa,alt:""})],-1)),Wa={key:0,class:"question-box"},Ga=pe(()=>e("div",{class:"name"},"常见问题",-1)),Za=pe(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Oa,alt:""})],-1)),Ya={__name:"common-problem",setup(m){x(!1);const{robotInfo:r,updateRobotInfo:g}=Z("robotInfo"),h=Se(()=>r.common_question_list?JSON.parse(r.common_question_list):[]),a=x([]);a.value=h.value,me(h,()=>{a.value=h.value});const _=Me.useForm,o=x(!1),S=x("添加问题"),n=B({question:"",index:-1}),$=B({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:c,validate:w,validateInfos:l}=_(n,$),d=()=>{if(h.value.length>=10)return X.error("最多设置10条常用问题");o.value=!0,c(),n.question="",n.index=-1},I=(p,u)=>{o.value=!0,c(),n.question=p,n.index=u},b=p=>{let u=[];u=h.value.filter((O,D)=>p!=D),le.confirm({title:"提醒",icon:t(ut),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){g({common_question_list:JSON.stringify(u)})},onCancel(){}})},q=()=>{w().then(()=>{let p=[];n.index>=0?p=h.value.map((u,O)=>O===n.index?n.question:u):p=[n.question,...h.value],g({common_question_list:JSON.stringify(p)}),o.value=!1})},f=p=>{g({})},k=p=>{g({common_question_list:JSON.stringify(a.value)})};return(p,u)=>{const O=ue,D=re,j=Le,M=oe,v=ce,U=_e,K=Ct,te=Me,N=le;return i(),y("div",za,[e("div",Ma,[t(ee,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(O,null,{title:s(()=>[A("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(C(Y),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(D,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(r).enable_common_question,"onUpdate:checked":u[0]||(u[0]=T=>C(r).enable_common_question=T),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(j,{type:"vertical"}),t(M,{type:"primary",size:"small",onClick:d},{default:s(()=>[A("添加")]),_:1})]),default:s(()=>[h.value.length==0?(i(),y("div",ja,[Da,Na,Va,t(M,{onClick:d,type:"primary"},{default:s(()=>[A("立即添加")]),_:1})])):(i(),y("div",Ta,[t(C(Ue),{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=T=>a.value=T),handle:".drag-btn","item-key":"index",onEnd:k},{item:s(({element:T,index:E})=>[(i(),y("div",{class:"list-item",key:E},[e("span",Pa,[t(v,{name:"drag"})]),e("div",Ba,R(T),1),e("div",Qa,[t(C(mt),{onClick:F=>I(T,E)},null,8,["onClick"]),t(C(ve),{onClick:F=>b(E)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Fa,[Ja,e("div",Ka,[Ha,h.value.length&&C(r).enable_common_question=="true"?(i(),y("div",Wa,[Ga,(i(!0),y(P,null,J(h.value,T=>(i(),y("div",{class:"list-item",key:T},R(T),1))),128))])):V("",!0)]),Za]),t(N,{open:o.value,"onUpdate:open":u[3]||(u[3]=T=>o.value=T),title:S.value,onOk:q,width:"476px"},{default:s(()=>[t(te,{class:"form-box",layout:"vertical"},{default:s(()=>[t(K,it({label:"问题名称"},C(l).question),{default:s(()=>[t(U,{maxLength:100,value:n.question,"onUpdate:value":u[2]||(u[2]=T=>n.question=T),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Xa=Q(Ya,[["__scopeId","data-v-5125783f"]]),el=e("span",null,null,-1),tl=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),ol={__name:"display-aitations",setup(m){const{robotInfo:r,updateRobotInfo:g}=Z("robotInfo"),h=x(!1);me(()=>r.answer_source_switch,_=>{h.value=_=="true"},{immediate:!0});const a=()=>{g({answer_source_switch:h.value?"true":"false"})};return(_,o)=>(i(),z(La,{title:"显示引文","icon-name":"jibenpeizhi",value:h.value,"onUpdate:value":o[0]||(o[0]=S=>h.value=S),onChange:a},{extra:s(()=>[el]),default:s(()=>[tl]),_:1},8,["value"]))}},sl={key:0,class:"robot-config-page"},nl={class:"setting-box"},il={class:"setting-box"},al={class:"setting-box"},ll={class:"setting-box"},cl={class:"setting-box"},rl={class:"setting-box"},dl={class:"setting-box"},_l={class:"setting-box"},ul={class:"setting-box"},pl={class:"setting-box"},ml={class:"setting-box"},vl={key:1,class:"robot-config-page"},hl={__name:"index",setup(m){const r=It(),g=x(null),{robotInfo:h}=at(r),{getRobot:a}=r,_=()=>{g.value.scrollTop=g.value.scrollHeight},o=x(1),S=x(!1),n=B(h.value);lt("robotInfo",{robotInfo:n,updateRobotInfo:w=>{let l=JSON.parse(JSON.stringify(w));w.robot_avatar&&(l.robot_avatar=new File([w.robot_avatar],w.robot_avatar.name)),Object.assign(n,l),c()},scrollBoxToBottom:_});const c=()=>{let w;n.robot_avatar&&(w=new File([n.robot_avatar],n.robot_avatar.name));let l=JSON.parse(JSON.stringify(H(n)));w&&(l.robot_avatar=w);let d=l.welcomes;d.question=d.question.map(b=>b.content),l.welcomes=JSON.stringify(d),l.prompt_struct=JSON.stringify(l.prompt_struct);let I=l.unknown_question_prompt;I.question=I.question.map(b=>b.content),l.unknown_question_prompt=JSON.stringify(I),delete l.robot_avatar_url,S.value=!0,ft(l).then(b=>{if(b.res!=0)return X.error(b.msg);S.value=!1,X.success("保存成功"),a(n.id)}).catch(()=>{S.value=!1})};return(w,l)=>{const d=De,I=Ne;return i(),y(P,null,[t(I,{activeKey:o.value,"onUpdate:activeKey":l[0]||(l[0]=b=>o.value=b)},{default:s(()=>[(i(),z(d,{key:1,tab:"基础配置"})),(i(),z(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),o.value==1?(i(),y("div",sl,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:g},[e("div",nl,[t(eo)]),e("div",il,[t(Ss)]),e("div",al,[t(rn)]),e("div",ll,[t(ei)]),e("div",cl,[t(bi)]),e("div",rl,[t(Ri)]),e("div",dl,[t(ha)]),e("div",_l,[t(Pi)]),e("div",ul,[t(Ji)]),e("div",pl,[t(Gi)]),e("div",ml,[t(ol)])],512)])):(i(),y("div",vl,[t(Xa)]))],64)}}},Sc=Q(hl,[["__scopeId","data-v-620ecc5f"]]);export{Sc as default};
