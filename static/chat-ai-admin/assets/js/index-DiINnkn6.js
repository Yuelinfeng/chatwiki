import{L as i,M as f,V as e,j as t,X as O,Y as I,S as _e,a8 as D,P as j,Q as s,W as ot,a2 as xe,r as $,d as Y,A as Q,E as ae,G as le,u as C,a9 as Z,a3 as H,a4 as W,a0 as st,F as T,a1 as J,w as ue,k as nt,ac as fe,ae as be,v as we,B as it,b as ge,h as je,a7 as at,y as lt,ab as ct,U as rt,a6 as dt,p as _t}from"./vue-chunks-C0QQWOCx.js";import{_ as B,c as ce,B as se,V as ut,W as Me,e as ee,M as oe,X as ve,Y as pt,Z as mt,U as vt,$ as $e,E as ht}from"../../index-BNfL3w2j.js";import{_ as ye}from"./index-C7qXvCWR.js";import{C as ft,E as bt}from"./cu-upload-MAO2WTjr.js";import"./index-BoBIAv4a.js";import{I as pe}from"./Input-CkTCA1H7.js";import{_ as Se}from"./TextArea-Cl8pxwyC.js";import{C as De}from"./cu-scroll-CdZK1_Dd.js";import{c as yt,s as kt}from"./index-Clj0PDHt.js";import{_ as gt}from"./index-BFqiXgiA.js";import{S as Ce}from"./index-Dhs-V5_s.js";import{_ as Ne,T as Ve}from"./index-Dl4bin6G.js";import{P as Ie}from"./PlusOutlined-B5cXtakc.js";import{_ as re}from"./index-ISsoQRoP.js";import{c as Pe}from"./index-BXwHCWt_.js";import{S as Te,a as Be,_ as Qe}from"./index-0s7_DZpf.js";import{_ as Fe}from"./index-MY1WHiJp.js";import{_ as Re}from"./index-BukpQ8RZ.js";import{Q as X}from"./QuestionCircleOutlined-4KQaJWl2.js";import{_ as Le}from"./index-BszAReYL.js";import{_ as $t,a as xt}from"./index-BuA75OZo.js";import{_ as de}from"./index-3k2SlWGM.js";import{g as Je}from"./index-CNcS6db8.js";import{S as wt}from"./SearchOutlined-COjt0mX8.js";import{S as St}from"./SyncOutlined-HAKVvUV-.js";import{C as Ke,_ as Ge}from"./index-BPxS37Xo.js";import{_ as He}from"./index-BfzZQ1Qe.js";import{_ as qt}from"./recommendation-AQ4_FPQ9.js";import{R as Ct}from"./RightOutlined-DnfX1v3R.js";import{g as We}from"./index-Cuemeb_K.js";import{_ as It}from"./empty-CzGZrENG.js";import{d as Ee}from"./vuedraggable.umd-BPMdmnah.js";import"./index-C-pm-tzm.js";import{R as Rt,_ as Lt}from"./RadioButton-DYoB577d.js";import{F as ze,_ as Et}from"./index-yFqc4cD2.js";import{u as Ut}from"./robot-BWgmiav_.js";import"./axios-Cm0UX6qg.js";import"./qs-CnxcMLjH.js";import"./crypto-js-C2SrYqGA.js";import"./dayjs-CsGPDCY7.js";import"./FormItemContext-DCiQBKp-.js";import"./index-CqC-D0MF.js";import"./Search-DP6Te_4V.js";import"./isPlainObject-B4InAXj5.js";import"./inputProps-CkRR1l6t.js";import"./Password-C3rJAIql.js";import"./statusUtils-D6YMZbpq.js";import"./index-B4Ve0Gtb.js";import"./colors-B6m1To83.js";import"./pull-up.esm-JZ91zQ8P.js";import"./index-bCnK99Cb.js";import"./shallowequal-Fk1l6xhN.js";import"./collapseMotion-BOXZQl9Y.js";import"./slide-jWfiTdSY.js";import"./Dropdown-BO8OtH1l.js";import"./useRefs-DDwzsqEq.js";import"./pick-BU4xQU6b.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-D8d6FGqD.js";import"./DownOutlined-DZkW1qbV.js";import"./move-Bt6G5yRx.js";import"./index-BQz4ljyr.js";import"./responsiveObserve-BS_1XHbF.js";const Ot={class:"edit-box-header"},At={class:"left-box"},Mt={class:"edit-box-title"},zt={key:0},jt={key:0,class:"title-tip"},Dt={class:"right-box"},Nt={class:"extra-box"},Vt={class:"actions-box"},Pt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(u,{emit:d}){const y=d,h=u,a=o=>{y("edit"),y("update:isEdit",o)},l=()=>{y("save")};return(o,q)=>{const n=ce,k=se,c=ye;return i(),f("div",{class:xe(["edit-box",{"is-edit":u.isEdit}])},[e("div",Ot,[e("div",At,[t(n,{class:"edit-box-icon",name:h.iconName},null,8,["name"]),e("span",Mt,[O(I(h.title)+" ",1),o.$slots.icon?(i(),f("span",zt,[_e(o.$slots,"icon",{},void 0,!0)])):D("",!0)]),o.$slots.tip?(i(),f("span",jt,[_e(o.$slots,"tip",{},void 0,!0)])):D("",!0)]),e("div",Dt,[e("div",Nt,[_e(o.$slots,"extra",{},()=>[e("div",Vt,[h.isEdit?(i(),j(c,{key:0,gap:8},{default:s(()=>[t(k,{onClick:l,size:"small",type:"primary"},{default:s(()=>[O("保存")]),_:1}),t(k,{onClick:q[0]||(q[0]=x=>a(!1)),size:"small"},{default:s(()=>[O("取消")]),_:1})]),_:1})):(i(),j(k,{key:1,onClick:q[1]||(q[1]=x=>a(!0)),size:"small"},{default:s(()=>[O("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:ot({...u.bodyStyle})},[_e(o.$slots,"default",{},void 0,!0)],4)],2)}}},te=B(Pt,[["__scopeId","data-v-1b63f826"]]),Ze=u=>(H("data-v-c384f413"),u=u(),W(),u),Tt={class:"robot-form-box"},Bt={class:"form-item"},Qt=Ze(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Ft={class:"form-item-body robot-name-item"},Jt={class:"robot-avetar-upload"},Kt=["src"],Gt={class:"robot-name-box"},Ht={class:"form-item"},Wt=Ze(()=>e("div",{class:"form-item-label"},"简介",-1)),Zt={class:"form-item-body"},Yt={class:"robot-info-box"},Xt={class:"robot-name-box"},eo=["src"],to={class:"robot-name"},oo={class:"robot-intro"},so={__name:"basic-config",setup(u){const d=$(!1),{robotInfo:y,updateRobotInfo:h}=Y("robotInfo"),a=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),l=()=>{h({...Z(a)}),d.value=!1},o=n=>{let k=n[0];return a.robot_avatar=k,ut(k).then(c=>{a.robot_avatar_url=c}),!1},q=()=>{a.robot_name=y.robot_name,a.robot_intro=y.robot_intro,a.robot_avatar=y.robot_avatar,a.robot_avatar_url=y.robot_avatar_url};return(n,k)=>{const c=pe,x=Se;return i(),j(te,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:d.value,"onUpdate:isEdit":k[2]||(k[2]=r=>d.value=r),onSave:l,onEdit:q},{default:s(()=>[ae(e("div",Tt,[e("div",Bt,[Qt,e("div",Ft,[t(ft,{accept:"image/*",onChange:o},{default:s(()=>[e("div",Jt,[a.robot_avatar_url?(i(),f("img",{key:0,class:"robot-avetar",src:a.robot_avatar_url},null,8,Kt)):D("",!0)])]),_:1}),e("div",Gt,[t(c,{value:a.robot_name,"onUpdate:value":k[0]||(k[0]=r=>a.robot_name=r),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Ht,[Wt,e("div",Zt,[t(x,{rows:3,value:a.robot_intro,"onUpdate:value":k[1]||(k[1]=r=>a.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[le,d.value]]),ae(e("div",Yt,[e("div",Xt,[e("img",{class:"robot-avatar",src:C(y).robot_avatar_url,alt:""},null,8,eo),e("span",to,I(C(y).robot_name),1)]),e("div",oo,I(C(y).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[le,!d.value]])]),_:1},8,["isEdit"])}}},no=B(so,[["__scopeId","data-v-c384f413"]]),Ye=u=>(H("data-v-87ba79c2"),u=u(),W(),u),io={class:"ai-create-box"},ao={class:"input-box"},lo=Ye(()=>e("span",null,"生成",-1)),co={class:"quick-tags-box"},ro=Ye(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),_o={class:"ai-list-box"},uo={key:0,class:"loading-box"},po={key:0,class:"prompt-list-box"},mo={class:"prompt-list"},vo={class:"prompt-header"},ho={class:"prompt-title"},fo={class:"prompt-content"},bo={class:"prompt-list"},yo={class:"prompt-header"},ko={class:"prompt-title"},go={class:"prompt-content"},$o={class:"prompt-list"},xo={class:"prompt-header"},wo={class:"prompt-title"},So={class:"prompt-content"},qo={class:"prompt-list"},Co={class:"prompt-header"},Io={class:"prompt-title"},Ro={class:"prompt-content"},Lo={class:"prompt-list"},Eo={class:"prompt-header"},Uo={class:"prompt-title"},Oo={class:"prompt-content"},Ao={class:"prompt-header"},Mo={class:"prompt-title"},zo={class:"prompt-content"},jo={key:1,class:"empty-box"},Do={__name:"ai-create-prompt",emits:["handleAiSave"],setup(u,{expose:d,emit:y}){const h=Me.PRESENTED_IMAGE_SIMPLE,a=$(!1),l=$(!1),o=st().query,q=y,n=$(""),k=$(!1),c=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],x=$("在上方输入框输入要求，点击生成提示词"),r=()=>{_.value=!1,S.promptStruct=w,n.value="",x.value="在上方输入框输入要求，点击生成提示词",a.value=!0},_=$(!1),w={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},S=Q({promptStruct:w}),R=g=>{n.value=g},m=()=>{if(!n.value)return ee.error("请输入AI 生成提示词");if(k.value)return ee.error("正在生成中...");k.value=!0,yt({id:o.id,demand:n.value}).then(g=>{S.promptStruct=JSON.parse(g.data.promptStruct),_.value=!0}).finally(()=>{k.value=!1}).catch(g=>{_.value=!1,x.value=g.msg})},b=()=>{if(!_.value)return ee.error("请先生成提示词");q("handleAiSave",S.promptStruct),a.value=!1};return d({show:r}),(g,p)=>{const M=se,L=pe,V=ce,z=gt,v=Ce,G=Me,E=De,K=oe;return i(),f("div",null,[t(K,{open:a.value,"onUpdate:open":p[1]||(p[1]=N=>a.value=N),title:"AI 生成提示词",width:746},{footer:s(()=>[t(M,{type:"primary",loading:l.value,onClick:b},{default:s(()=>[O("使用该提示")]),_:1},8,["loading"])]),default:s(()=>[e("div",io,[e("div",ao,[t(L,{style:{width:"100%"},value:n.value,"onUpdate:value":p[0]||(p[0]=N=>n.value=N),size:"large",onPressEnter:m,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:m},[t(V,{name:"ai-mark"}),lo])]),e("div",co,[ro,(i(),f(T,null,J(c,N=>t(z,{key:N.title,onClick:P=>R(N.title),color:"blue"},{default:s(()=>[O(I(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",_o,[t(E,{style:{height:"100%"}},{default:s(()=>[k.value?(i(),f("div",uo,[t(v,{tip:"正在生成中..."})])):(i(),f(T,{key:1},[_.value?(i(),f("div",po,[e("div",mo,[e("div",vo,[e("div",ho,I(S.promptStruct.role.subject),1)]),e("div",fo,I(S.promptStruct.role.describe),1)]),e("div",bo,[e("div",yo,[e("div",ko,I(S.promptStruct.task.subject),1)]),e("div",go,I(S.promptStruct.task.describe),1)]),e("div",$o,[e("div",xo,[e("div",wo,I(S.promptStruct.constraints.subject),1)]),e("div",So,I(S.promptStruct.constraints.describe),1)]),e("div",qo,[e("div",Co,[e("div",Io,I(S.promptStruct.output.subject),1)]),e("div",Ro,I(S.promptStruct.output.describe),1)]),e("div",Lo,[e("div",Eo,[e("div",Uo,I(S.promptStruct.tone.subject),1)]),e("div",Oo,I(S.promptStruct.tone.describe),1)]),(i(!0),f(T,null,J(S.promptStruct.custom,(N,P)=>(i(),f("div",{class:"prompt-list",key:P+N.key?N.key:""},[e("div",Ao,[e("div",Mo,I(N.subject),1)]),e("div",zo,I(N.describe),1)]))),128))])):(i(),f("div",jo,[t(G,{image:C(h),description:x.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},No=B(Do,[["__scopeId","data-v-87ba79c2"]]),Vo={class:"prompt-box"},Po={class:"tab-header"},To={key:0,class:"opt-block"},Bo={key:1,class:"opt-block"},Qo={key:0,class:"prompt-list-box"},Fo={class:"prompt-list"},Jo={class:"prompt-header"},Ko={class:"prompt-title"},Go={key:0,class:"btn-wrapper-box"},Ho={class:"prompt-content"},Wo={class:"prompt-list"},Zo={class:"prompt-header"},Yo={class:"prompt-title"},Xo={key:0,class:"btn-wrapper-box"},es={class:"prompt-content"},ts={class:"prompt-list"},os={class:"prompt-header"},ss={class:"prompt-title"},ns={key:0,class:"btn-wrapper-box"},is={class:"prompt-content"},as={class:"prompt-list"},ls={class:"prompt-header"},cs={class:"prompt-title"},rs={key:0,class:"btn-wrapper-box"},ds={class:"swich-item"},_s={class:"swich-item"},us={class:"prompt-content"},ps={class:"prompt-list"},ms={class:"prompt-header"},vs={class:"prompt-title"},hs={key:0,class:"btn-wrapper-box"},fs={class:"prompt-content"},bs={class:"prompt-header"},ys={class:"prompt-title",style:{flex:"1"}},ks={key:0,class:"btn-wrapper-box"},gs=["onClick"],$s={class:"prompt-content"},xs={key:0,class:"add-theme-block"},ws={key:1,class:"diy-prompt-box"},Ss={key:0,class:"diy-switch-box"},qs={class:"swich-item"},Cs={class:"swich-item"},ne="- 请使用markdown格式回答问题。",ie="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Is={__name:"system-prompt-words",setup(u){const d=$(!1),{robotInfo:y,updateRobotInfo:h}=Y("robotInfo");let a={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const l=$({}),o=$(!1),q=$(!1),n=$(!1),k=$(!1),c=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),x=(z,v)=>z.includes(v),r=$(y.prompt_type);ue(()=>y,()=>{c.prompt=y.prompt,c.prompt_struct=y.prompt_struct,l.value=y.prompt_struct_default},{immediate:!0,deep:!0}),ue(()=>c.prompt_struct.output.describe,z=>{o.value=x(z,ne),q.value=x(z,ie)},{immediate:!0,deep:!0}),ue(()=>c.prompt,z=>{n.value=x(z,ne),k.value=x(z,ie)},{immediate:!0,deep:!0});const _=(z,v)=>{z?(v=="outSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+ne:c.prompt_struct.output.describe+=ne),v=="imgSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+ie:c.prompt_struct.output.describe+=ie)):(v=="outSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(ne,"g"),"")),v=="imgSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),c.prompt_struct.output.describe=c.prompt_struct.output.describe.trim())},w=(z,v)=>{z?(v=="outDiySwitch"&&(c.prompt?c.prompt+=`
`+ne:c.prompt+=ne),v=="imgDiySwitch"&&(c.prompt?c.prompt+=`
`+ie:c.prompt+=ie)):(v=="outDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(ne,"g"),"")),v=="imgDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(ie,"g"),"")),c.prompt=c.prompt.trim())},S=z=>{c.prompt_struct[z].describe=l.value[z].describe},R=()=>{c.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),r.value=1},m=z=>{c.prompt_struct.custom.splice(z,1)},b=()=>{h({...Z(c),prompt_type:r.value}),d.value=!1},g=z=>{r.value=1,h({prompt_type:r.value,prompt:c.prompt,prompt_struct:z}),d.value=!1},p=()=>{d.value=!0},M=()=>{d.value=!1},L=$(null),V=()=>{L.value.show()};return(z,v)=>{const G=Ne,E=Ve,K=ce,N=se,P=ye,A=Se,F=re,tt=pe;return i(),f("div",Vo,[e("div",Po,[t(E,{activeKey:r.value,"onUpdate:activeKey":v[0]||(v[0]=U=>r.value=U)},{default:s(()=>[(i(),j(G,{key:1,tab:"结构化提示词"})),(i(),j(G,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),d.value?(i(),f("div",To,[e("div",{class:"ai-mark-box",onClick:V},[t(K,{name:"ai-mark"}),O(" AI自动生成 ")]),t(P,{gap:8},{default:s(()=>[t(N,{size:"small",type:"primary",onClick:b},{default:s(()=>[O("保存")]),_:1}),t(N,{size:"small",onClick:M},{default:s(()=>[O("取消")]),_:1})]),_:1})])):(i(),f("div",Bo,[t(N,{size:"small",onClick:p},{default:s(()=>[O("修改")]),_:1})]))]),r.value==1?(i(),f("div",Qo,[e("div",Fo,[e("div",Jo,[e("div",Ko,I(c.prompt_struct.role.subject),1),d.value?(i(),f("div",Go,[e("a",{onClick:v[1]||(v[1]=U=>S("role"))},"恢复默认")])):D("",!0)]),e("div",Ho,[t(A,{bordered:!1,disabled:!d.value,value:c.prompt_struct.role.describe,"onUpdate:value":v[2]||(v[2]=U=>c.prompt_struct.role.describe=U),placeholder:C(a).role,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Wo,[e("div",Zo,[e("div",Yo,I(c.prompt_struct.task.subject),1),d.value?(i(),f("div",Xo,[e("a",{onClick:v[3]||(v[3]=U=>S("task"))},"恢复默认")])):D("",!0)]),e("div",es,[t(A,{bordered:!1,disabled:!d.value,value:c.prompt_struct.task.describe,"onUpdate:value":v[4]||(v[4]=U=>c.prompt_struct.task.describe=U),placeholder:C(a).task,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",ts,[e("div",os,[e("div",ss,I(c.prompt_struct.constraints.subject),1),d.value?(i(),f("div",ns,[e("a",{onClick:v[5]||(v[5]=U=>S("constraints"))},"恢复默认")])):D("",!0)]),e("div",is,[t(A,{bordered:!1,disabled:!d.value,value:c.prompt_struct.constraints.describe,"onUpdate:value":v[6]||(v[6]=U=>c.prompt_struct.constraints.describe=U),placeholder:C(a).constraints,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",as,[e("div",ls,[e("div",cs,I(c.prompt_struct.output.subject),1),d.value?(i(),f("div",rs,[e("div",ds,[O(" 输出markdown： "),t(F,{onChange:v[7]||(v[7]=U=>_(U,"outSwitch")),checked:o.value,"onUpdate:checked":v[8]||(v[8]=U=>o.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",_s,[O(" 回复图片： "),t(F,{onChange:v[9]||(v[9]=U=>_(U,"imgSwitch")),checked:q.value,"onUpdate:checked":v[10]||(v[10]=U=>q.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:v[11]||(v[11]=U=>S("output"))},"恢复默认")])):D("",!0)]),e("div",us,[t(A,{bordered:!1,disabled:!d.value,value:c.prompt_struct.output.describe,"onUpdate:value":v[12]||(v[12]=U=>c.prompt_struct.output.describe=U),placeholder:C(a).output,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",ps,[e("div",ms,[e("div",vs,I(c.prompt_struct.tone.subject),1),d.value?(i(),f("div",hs,[e("a",{onClick:v[13]||(v[13]=U=>S("tone"))},"恢复默认")])):D("",!0)]),e("div",fs,[t(A,{bordered:!1,disabled:!d.value,value:c.prompt_struct.tone.describe,"onUpdate:value":v[14]||(v[14]=U=>c.prompt_struct.tone.describe=U),placeholder:C(a).tone,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),(i(!0),f(T,null,J(c.prompt_struct.custom,(U,Ae)=>(i(),f("div",{class:"prompt-list",key:Ae+U.key?U.key:""},[e("div",bs,[e("div",ys,[t(tt,{bordered:!1,disabled:!d.value,style:{width:"100%"},value:U.subject,"onUpdate:value":ke=>U.subject=ke,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),d.value?(i(),f("div",ks,[e("div",{class:"hover-btn-box",onClick:ke=>m(Ae)},[t(C(ve))],8,gs)])):D("",!0)]),e("div",$s,[t(A,{bordered:!1,disabled:!d.value,value:U.describe,"onUpdate:value":ke=>U.describe=ke,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","onUpdate:value"])])]))),128)),d.value?(i(),f("div",xs,[t(N,{onClick:R,block:"",icon:nt(C(Ie))},{default:s(()=>[O("添加主题")]),_:1},8,["icon"])])):D("",!0)])):(i(),f("div",ws,[d.value?(i(),f("div",Ss,[e("div",qs,[O(" 输出markdown： "),t(F,{size:"small",onChange:v[15]||(v[15]=U=>w(U,"outDiySwitch")),checked:n.value,"onUpdate:checked":v[16]||(v[16]=U=>n.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Cs,[O(" 回复图片： "),t(F,{size:"small",onChange:v[17]||(v[17]=U=>w(U,"imgDiySwitch")),checked:k.value,"onUpdate:checked":v[18]||(v[18]=U=>k.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):D("",!0),t(A,{bordered:d.value,value:c.prompt,"onUpdate:value":v[19]||(v[19]=U=>c.prompt=U),disabled:!d.value,placeholder:"请输入","auto-size":{minRows:5,maxRows:15}},null,8,["bordered","value","disabled"])])),t(No,{onHandleAiSave:g,ref_key:"aiCreatePromptRef",ref:L},null,512)])}}},Rs=B(Is,[["__scopeId","data-v-d7a4087c"]]),he=u=>(H("data-v-7139584f"),u=u(),W(),u),Ls={class:"actions-box"},Es={class:"model-name"},Us={key:0,class:"form-box"},Os={class:"form-item"},As=he(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),Ms={class:"form-item-body"},zs=["src"],js={key:0},Ds={key:1},Ns={class:"form-item"},Vs={class:"form-item-label"},Ps=he(()=>e("span",null,"温度 ",-1)),Ts={class:"form-item-body"},Bs={class:"number-box"},Qs={class:"number-slider-box"},Fs={class:"number-input-box"},Js={class:"form-item"},Ks={class:"form-item-label"},Gs=he(()=>e("span",null,"最大token ",-1)),Hs={class:"form-item-body"},Ws={class:"number-box"},Zs={class:"number-slider-box"},Ys={class:"number-input-box"},Xs={class:"form-item"},en={class:"form-item-label"},tn=he(()=>e("span",null,"上下文数量 ",-1)),on={class:"form-item-body"},sn={class:"number-box"},nn={class:"number-slider-box"},an={class:"number-input-box"},ln={class:"form-item"},cn={class:"form-item-label"},rn=he(()=>e("span",null,"显示推理过程 ",-1)),dn=he(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),_n={class:"form-item-body",style:{"padding-top":"5px"}},un={__name:"model-settings",setup(u){const d=["azure","ollama","xinference","openaiAgent"],y=["azure"],h=Q({sm:24,md:24,lg:12,xl:8,xxl:8}),a=$([]),l=$(!1),{robotInfo:o,updateRobotInfo:q}=Y("robotInfo"),n=Q({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),k=$(""),c=$(""),x=$(""),r=(m,b)=>{const g=b.current_obj;n.use_model=d.indexOf(g.model_define)>-1&&g.deployment_name?g.deployment_name:g.name,k.value=g.model_define,n.model_config_id=g.id||b.model_config_id},_=()=>{x.value=n.use_model,y.indexOf(k.value)>-1&&(n.use_model="默认"),q({...Z(n)}),l.value=!1},w=m=>{m||(k.value=c.value),d.indexOf(k.value)>-1?n.use_model=x.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,n.think_switch=Number(o.think_switch),l.value=m};function S(m,b,g){const p=new Set(m.map(M=>M.model_define));return b.filter(M=>{let L=M[g];p.has(L)&&m.filter(V=>{if(V.model_define==L)return V.children=mt(V.children,M.children),!1})}),m}return(()=>{Pe({model_type:"LLM"}).then(m=>{x.value=o.use_model;let b=m.data||[],g=[];a.value=b.map(p=>{g=[];for(let M=0;M<p.model_info.llm_model_list.length;M++){const L=p.model_info.llm_model_list[M];d.indexOf(p.model_info.model_define)>-1&&o.model_config_id==p.model_config.id&&(x.value=p.model_config.deployment_name,k.value=p.model_info.model_define,c.value=p.model_info.model_define),g.push({name:L,deployment_name:p.model_config.deployment_name,id:p.model_config.id,model_define:p.model_info.model_define})}return{id:p.model_config.id,name:p.model_info.model_name,model_define:p.model_info.model_define,icon:p.model_info.model_icon_url,children:g,deployment_name:p.model_config.deployment_name}}),a.value=S(pt(a.value,"model_define"),a.value,"model_define")})})(),(m,b)=>{const g=se,p=ye,M=Le,L=Te,V=Be,z=Qe,v=$t,G=de,E=Fe,K=Re,N=re,P=xt;return i(),j(te,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":b[10]||(b[10]=A=>l.value=A)},{extra:s(()=>[e("div",Ls,[l.value?(i(),j(p,{key:0,gap:8},{default:s(()=>[t(g,{onClick:_,size:"small",type:"primary"},{default:s(()=>[O("保存")]),_:1}),t(g,{onClick:b[0]||(b[0]=A=>w(!1)),size:"small"},{default:s(()=>[O("取消")]),_:1})]),_:1})):(i(),f(T,{key:1},[e("span",Es,I(x.value),1),t(M,{type:"vertical"}),t(g,{onClick:b[1]||(b[1]=A=>w(!0)),size:"small"},{default:s(()=>[O("修改")]),_:1})],64))])]),default:s(()=>[l.value?(i(),f("div",Us,[t(P,{gutter:[32,16]},{default:s(()=>[t(v,fe(be(h)),{default:s(()=>[e("div",Os,[As,e("div",Ms,[t(z,{value:n.use_model,"onUpdate:value":b[2]||(b[2]=A=>n.use_model=A),placeholder:"请选择LLM模型",onChange:r,style:{width:"100%"}},{default:s(()=>[(i(!0),f(T,null,J(a.value,A=>(i(),j(V,{key:A.id},{label:s(()=>[t(p,{align:"center",gap:6},{default:s(()=>[e("img",{class:"model-icon",src:A.icon,alt:""},null,8,zs),O(I(A.name),1)]),_:2},1024)]),default:s(()=>[(i(!0),f(T,null,J(A.children,F=>(i(),j(L,{value:d.indexOf(A.model_define)>-1&&F.deployment_name?F.deployment_name:F.name+F.id,model_config_id:A.id,current_obj:F,key:F.name+F.id},{default:s(()=>[d.indexOf(A.model_define)>-1&&F.deployment_name?(i(),f("span",js,I(F.deployment_name),1)):(i(),f("span",Ds,I(F.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",Ns,[e("div",Vs,[Ps,t(G,null,{title:s(()=>[O("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",Ts,[e("div",Bs,[e("div",Qs,[t(E,{class:"custom-slider",value:n.temperature,"onUpdate:value":b[3]||(b[3]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])]),e("div",Fs,[t(K,{value:n.temperature,"onUpdate:value":b[4]||(b[4]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",Js,[e("div",Ks,[Gs,t(G,null,{title:s(()=>[O("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",Hs,[e("div",Ws,[e("div",Zs,[t(E,{class:"custom-slider",value:n.max_token,"onUpdate:value":b[5]||(b[5]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])]),e("div",Ys,[t(K,{value:n.max_token,"onUpdate:value":b[6]||(b[6]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",Xs,[e("div",en,[tn,t(G,null,{title:s(()=>[O("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",on,[e("div",sn,[e("div",nn,[t(E,{class:"custom-slider",value:n.context_pair,"onUpdate:value":b[7]||(b[7]=A=>n.context_pair=A),min:0,max:10},null,8,["value"])]),e("div",an,[t(K,{value:n.context_pair,"onUpdate:value":b[8]||(b[8]=A=>n.context_pair=A),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(v,fe(be(h)),{default:s(()=>[e("div",ln,[e("div",cn,[rn,t(G,null,{title:s(()=>[dn]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",_n,[t(N,{checked:n.think_switch,"onUpdate:checked":b[9]||(b[9]=A=>n.think_switch=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])])]),_:1},16)]),_:1})])):D("",!0)]),_:1},8,["isEdit"])}}},pn=B(un,[["__scopeId","data-v-7139584f"]]),mn={class:"library-checkbox-box"},vn={class:"list-tools"},hn={class:"list-box",ref:"scrollContainer"},fn={class:"library-name"},bn={class:"library-desc"},yn={__name:"library-select-alert",emits:["change"],setup(u,{expose:d,emit:y}){const h=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=$(!1),o=R=>{r(),a.checkedList=R,l.value=!0},q=()=>{l.value=!1,x()},n=$(""),k=()=>{r()},c=$([]),x=()=>{h("change",[...a.checkedList])},r=async()=>{const R=await Je({library_name:n.value,type:""});if(R){let m=R.data||[];c.value=m}},_=$(!1),w=async()=>{_.value=!0,await r(),_.value=!1,ee.success("刷新完成")},S=()=>{window.open("/#/library/list")};return d({open:o}),(R,m)=>{const b=He,g=pe,p=se,M=Ke,L=Ge,V=Ce,z=oe;return i(),j(z,{width:"746px",open:l.value,"onUpdate:open":m[2]||(m[2]=v=>l.value=v),title:"关联知识库",onOk:q},{default:s(()=>[e("div",mn,[t(b,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",vn,[e("div",null,[t(g,{style:{width:"282px"},value:n.value,"onUpdate:value":m[0]||(m[0]=v=>n.value=v),placeholder:"请输入知识库名称搜索",onChange:k},{suffix:s(()=>[t(C(wt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(p,{style:{"margin-right":"8px"},onClick:w},{default:s(()=>[t(C(St)),O(" 刷新 ")]),_:1}),t(p,{type:"primary",ghost:"",onClick:S},{default:s(()=>[O("新建知识库")]),_:1})])]),t(V,{spinning:_.value,delay:100},{default:s(()=>[t(L,{value:a.checkedList,"onUpdate:value":m[1]||(m[1]=v=>a.checkedList=v),style:{width:"100%"}},{default:s(()=>[e("div",hn,[(i(!0),f(T,null,J(c.value,v=>(i(),f("div",{class:"list-item-wraapper",key:v.id},[t(M,{class:"list-item",value:v.id},{default:s(()=>[e("div",fn,I(v.library_name),1),e("div",bn,I(v.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},kn=B(yn,[["__scopeId","data-v-bafb3126"]]),qe=u=>(H("data-v-4bfd6507"),u=u(),W(),u),gn={class:"recall-settings-box"},$n={class:"form-box"},xn={class:"form-item is-required"},wn=qe(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Sn={class:"form-item-body"},qn={class:"retrieval-mode-items"},Cn=["onClick"],In={class:"retrieval-mode-title"},Rn={class:"title-text"},Ln={key:0,style:{width:"32px"},src:qt,alt:""},En={class:"retrieval-mode-desc"},Un={class:"form-item"},On={class:"form-item-label"},An=qe(()=>e("span",null,"Top K ",-1)),Mn={class:"form-item-body"},zn={class:"number-box"},jn={class:"number-slider-box"},Dn={class:"number-input-box"},Nn={key:0,class:"form-item"},Vn={class:"form-item-label"},Pn=qe(()=>e("span",null,"相似度阈值 ",-1)),Tn={class:"form-item-body"},Bn={class:"number-box"},Qn={class:"number-slider-box"},Fn={class:"number-input-box"},Jn={class:"form-item"},Kn={class:"form-item-label"},Gn=qe(()=>e("span",null,"Rerank模型",-1)),Hn={key:0,class:"form-item-body"},Wn=["src"],Zn={__name:"recall-settings-alert",emits:["change"],setup(u,{expose:d,emit:y}){const h=y,a=$([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),l=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),o=$(!1),q=R=>{S(),l.rerank_status=R.rerank_status||0,l.rerank_use_model=R.rerank_use_model||void 0,l.rerank_model_config_id=R.rerank_model_config_id>0?R.rerank_model_config_id:"",l.top_k=R.top_k,l.similarity=R.similarity,l.search_type=R.search_type,o.value=!0},n=(R,m)=>{if(!R||!m){l.rerank_model_config_id="";return}l.rerank_model_config_id=m.rerank_model_config_id},k=R=>{R==0&&(l.rerank_model_config_id="",l.rerank_use_model="")},c=R=>{l.search_type=R},x=()=>l.rerank_status==1&&!l.rerank_model_config_id,r=()=>{if(x())return ee.error("请选择Rerank模型");o.value=!1,_()},_=()=>{h("change",Z(l))},w=$([]),S=()=>{Pe({model_type:"RERANK"}).then(R=>{let m=R.data||[];w.value=m.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})};return d({open:q}),(R,m)=>{const b=ce,g=de,p=Fe,M=Re,L=re,V=Te,z=Be,v=Qe,G=oe;return i(),j(G,{width:"746px",open:o.value,"onUpdate:open":m[6]||(m[6]=E=>o.value=E),title:"召回设置",onOk:r},{default:s(()=>[e("div",gn,[e("div",$n,[e("div",xn,[wn,e("div",Sn,[e("div",qn,[(i(!0),f(T,null,J(a.value,E=>(i(),f("div",{class:xe(["retrieval-mode-item",{active:l.search_type==E.value}]),key:E.value,onClick:K=>c(E.value)},[l.search_type==E.value?(i(),j(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):D("",!0),e("div",In,[t(b,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",Rn,I(E.title),1),E.isRecommendation?(i(),f("img",Ln)):D("",!0)]),e("div",En,I(E.desc),1)],10,Cn))),128))])])]),e("div",Un,[e("div",On,[An,t(g,null,{title:s(()=>[O("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",Mn,[e("div",zn,[e("div",jn,[t(p,{class:"custom-slider",value:l.top_k,"onUpdate:value":m[0]||(m[0]=E=>l.top_k=E),min:1,max:10},null,8,["value"])]),e("div",Dn,[t(M,{value:l.top_k,"onUpdate:value":m[1]||(m[1]=E=>l.top_k=E),min:1,max:10},null,8,["value"])])])])]),l.search_type<=2?(i(),f("div",Nn,[e("div",Vn,[Pn,t(g,null,{title:s(()=>[O("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:s(()=>[t(C(X),{class:"question-icon"})]),_:1})]),e("div",Tn,[e("div",Bn,[e("div",Qn,[t(p,{class:"custom-slider",value:l.similarity,"onUpdate:value":m[2]||(m[2]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",Fn,[t(M,{value:l.similarity,"onUpdate:value":m[3]||(m[3]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])])):D("",!0),e("div",Jn,[e("div",Kn,[Gn,O("   "),t(L,{checkedValue:1,unCheckedValue:0,checked:l.rerank_status,"onUpdate:checked":m[4]||(m[4]=E=>l.rerank_status=E),onChange:k},null,8,["checked"])]),l.rerank_status==1?(i(),f("div",Hn,[t(v,{allowClear:"",value:l.rerank_use_model,"onUpdate:value":m[5]||(m[5]=E=>l.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:n,style:{width:"60%"}},{default:s(()=>[(i(!0),f(T,null,J(w.value,E=>(i(),j(z,{key:E.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,Wn)])]),default:s(()=>[(i(!0),f(T,null,J(E.children,K=>(i(),j(V,{value:K,rerank_model_config_id:E.id,key:K},{default:s(()=>[e("span",null,I(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):D("",!0)])])])]),_:1},8,["open"])}}},Yn=B(Zn,[["__scopeId","data-v-4bfd6507"]]),Xn=u=>(H("data-v-0ebe0aeb"),u=u(),W(),u),ei={class:"list-box"},ti=["onClick"],oi={class:"avater-box"},si=["src"],ni={class:"content-box"},ii={class:"title-block"},ai=Xn(()=>e("div",{class:"tag-icon"},"Graph",-1)),li={class:"title-text"},ci={class:"desc-box"},ri={class:"right-icon"},di={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(u,{expose:d,emit:y}){const h=y,a=u,l=$(!1);ue(()=>a.list,()=>{a.list.length==0&&(l.value=!1)},{});const o=()=>{l.value=!0},q=()=>{document.visibilityState==="visible"&&h("refreshList")};we(()=>{document.addEventListener("visibilitychange",q)}),it(()=>{document.removeEventListener("visibilitychange",q)});const n=k=>{window.open(`/#/library/details/knowledge-config?id=${k.id}`)};return d({show:o}),(k,c)=>{const x=He,r=De,_=oe;return i(),f("div",null,[t(_,{open:l.value,"onUpdate:open":c[0]||(c[0]=w=>l.value=w),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:s(()=>[t(x,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(r,{scrollbar:!1,style:{height:"400px"}},{default:s(()=>[e("div",ei,[(i(!0),f(T,null,J(a.list,w=>(i(),f("div",{class:"list-item",onClick:S=>n(w),key:w.id},[e("div",oi,[e("img",{src:w.avatar,alt:""},null,8,si)]),e("div",ni,[e("div",ii,[ai,e("div",li,I(w.library_name),1)]),e("div",ci,I(w.library_intro),1)]),e("div",ri,[t(C(Ct))])],8,ti))),128))])]),_:1})]),_:1},8,["open"])])}}},_i=B(di,[["__scopeId","data-v-0ebe0aeb"]]),ui={class:"actions-box"},pi={key:0,class:"library-list"},mi=["onClick"],vi=["onClick"],hi={class:"library-name"},fi={class:"library-name-text"},bi={class:"library-intro"},yi={__name:"index",setup(u){const{getStorage:d,removeStorage:y}=vt("localStorage"),h=$(!1),{robotInfo:a,updateRobotInfo:l}=Y("robotInfo"),o=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),q=$([]),n=$(null),k=ge(()=>q.value.filter(L=>o.library_ids.includes(L.id))),c=ge(()=>k.value.filter(L=>L.graph_switch==0)),x=L=>{let V=o.library_ids.indexOf(L.id);o.library_ids.splice(V,1),b()},r=L=>{o.library_ids=[...L],b()},_=()=>{n.value.open([...o.library_ids])},w=$(null),S=()=>{w.value.open(Z(o))},R=$(null),m=L=>{o.rerank_status=L.rerank_status,o.rerank_use_model=L.rerank_use_model,o.rerank_model_config_id=L.rerank_model_config_id,o.top_k=L.top_k,o.similarity=L.similarity,o.search_type=L.search_type,(L.search_type==1||L.search_type==4)&&c.value.length>0&&R.value.show(),b()},b=()=>{let L={...Z(o)};L.library_ids=L.library_ids.join(","),l({...L})},g=async()=>{const L=await Je({type:""});L&&(q.value=L.data||[])},p=()=>{oe.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){_()}})};o.rerank_use_model=a.rerank_use_model||void 0,je(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type});const M=L=>{window.open(`#/library/details/knowledge-document?id=${L.id}`)};return we(()=>{g(),d("showNoLibraryTip")&&(p(),y("showNoLibraryTip"))}),(L,V)=>{const z=se,v=ye,G=de;return i(),j(te,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:h.value,"onUpdate:isEdit":V[0]||(V[0]=E=>h.value=E),bodyStyle:{padding:0}},{extra:s(()=>[e("div",ui,[t(v,{gap:8},{default:s(()=>[t(z,{size:"small",onClick:S},{default:s(()=>[O("召回设置")]),_:1}),t(z,{size:"small",onClick:_},{default:s(()=>[O("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[k.value.length>0?(i(),f("div",pi,[(i(!0),f(T,null,J(k.value,E=>(i(),f("div",{class:"library-item",key:E.id,onClick:K=>M(E)},[e("span",{class:"close-btn",onClick:at(K=>x(E),["stop"])},[t(C(ve))],8,vi),e("div",hi,[t(G,null,{title:s(()=>[O(I(E.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:s(()=>[e("div",{class:xe(["graph-tag",{active:E.graph_switch==1}])},"Graph",2)]),_:2},1024),e("div",fi,I(E.library_name),1)]),e("div",bi,I(E.library_intro),1)],8,mi))),128))])):D("",!0),t(kn,{ref_key:"librarySelectAlertRef",ref:n,onChange:r},null,512),t(Yn,{ref_key:"recallSettingsAlertRef",ref:w,onChange:m},null,512),t(_i,{list:c.value,onRefreshList:g,ref_key:"noOpenGraphModalRef",ref:R},null,8,["list"])]),_:1},8,["isEdit"])}}},ki=B(yi,[["__scopeId","data-v-95d7d809"]]),gi=u=>(H("data-v-890ab853"),u=u(),W(),u),$i={class:"library-checkbox-box"},xi={class:"list-box",ref:"scrollContainer"},wi={class:"library-name"},Si={class:"library-desc"},qi={key:0,class:"empty-box"},Ci=gi(()=>e("img",{src:It,alt:""},null,-1)),Ii={__name:"library-select-alert",emits:["change"],setup(u,{expose:d,emit:y}){const h=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=$(!1),o=_=>{c(),a.checkedList=_,l.value=!0},q=()=>{l.value=!1,k()};$("");const n=$([]),k=()=>{h("change",[...a.checkedList])},c=async()=>{const _=await We();if(_){let w=_.data||[];n.value=w}},x=$(!1),r=()=>{window.open("/#/database/list")};return d({open:o}),(_,w)=>{const S=Ke,R=Ge,m=Ce,b=oe;return i(),j(b,{width:"746px",open:l.value,"onUpdate:open":w[1]||(w[1]=g=>l.value=g),title:"关联数据表",onOk:q},{default:s(()=>[e("div",$i,[t(m,{spinning:x.value,delay:100},{default:s(()=>[t(R,{value:a.checkedList,"onUpdate:value":w[0]||(w[0]=g=>a.checkedList=g),style:{width:"100%"}},{default:s(()=>[e("div",xi,[(i(!0),f(T,null,J(n.value,g=>(i(),f("div",{class:"list-item-wraapper",key:g.id},[t(S,{class:"list-item",value:g.id},{default:s(()=>[e("div",wi,I(g.name),1),e("div",Si,I(g.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!x.value&&!n.value.length?(i(),f("div",qi,[Ci,e("div",null,[O(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:r}," 去添加")])])):D("",!0)])]),_:1},8,["open"])}}},Ri=B(Ii,[["__scopeId","data-v-890ab853"]]),Li=u=>(H("data-v-6977bc22"),u=u(),W(),u),Ei=Li(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),Ui={class:"actions-box"},Oi={key:0,class:"library-list"},Ai=["onClick"],Mi={class:"library-name"},zi={class:"library-intro"},ji={__name:"index",setup(u){const d=$(!1),{robotInfo:y,updateRobotInfo:h}=Y("robotInfo"),a=Q({form_ids:[]}),l=$([]),o=$(null),q=ge(()=>l.value.filter(_=>a.form_ids.includes(_.id))),n=_=>{let w=a.form_ids.indexOf(_.id);a.form_ids.splice(w,1),x()},k=_=>{a.form_ids=[..._],x()},c=()=>{o.value.open([...a.form_ids])},x=()=>{let _={...Z(a)};_.form_ids=_.form_ids.join(","),h({..._})};return(async()=>{const _=await We();_&&(l.value=_.data||[])})(),je(()=>{a.form_ids=y.form_ids.split(",")}),(_,w)=>{const S=de,R=se,m=ye;return i(),j(te,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:d.value,"onUpdate:isEdit":w[0]||(w[0]=b=>d.value=b),bodyStyle:{padding:0}},{tip:s(()=>[t(S,{placement:"top"},{title:s(()=>[Ei]),default:s(()=>[t(C(X))]),_:1})]),extra:s(()=>[e("div",Ui,[t(m,{gap:8},{default:s(()=>[t(R,{size:"small",onClick:c},{default:s(()=>[O("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[q.value.length>0?(i(),f("div",Oi,[(i(!0),f(T,null,J(q.value,b=>(i(),f("div",{class:"library-item",key:b.id},[e("span",{class:"close-btn",onClick:g=>n(b)},[t(C(ve))],8,Ai),e("div",Mi,I(b.name),1),e("div",zi,I(b.description),1)]))),128))])):D("",!0),t(Ri,{ref_key:"librarySelectAlertRef",ref:o,onChange:k},null,512)]),_:1},8,["isEdit"])}}},Di=B(ji,[["__scopeId","data-v-6977bc22"]]),Ni={class:"form-box"},Vi={class:"question-title"},Pi={class:"question-options"},Ti={class:"question-option"},Bi={class:"drag-btn"},Qi={class:"action-box"},Fi={class:"robot-info-box"},Ji={class:"robot-welcome-content"},Ki={class:"robot-welcome-question"},Gi={__name:"welcome-words",setup(u){const d=$(!1),y=$(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:l}=Y("robotInfo"),o=Q({welcomes:{content:"",question:[]}}),q=()=>{let r=!1;if(o.welcomes.question.length>0){for(let _=0;_<o.welcomes.question.length;_++)if(!o.welcomes.question[_].content){r=_+1;break}}return r},n=()=>{o.welcomes.question.push({content:"",id:$e(8)})},k=r=>{o.welcomes.question.splice(r,1)},c=()=>{if(!o.welcomes.content)return ee.error("请输入欢迎语");if(q())return ee.error("引导问题内容不能为空");a({...Z(o)}),d.value=!1},x=()=>{let r={...h.welcomes},_=[];r.question.forEach(({content:w,id:S})=>{let R={id:S,content:w};R.id||(R.id=$e(6)),_.push(R)}),o.welcomes.content=r.content,o.welcomes.question=_};return(r,_)=>{const w=Se,S=ce,R=pe;return i(),j(te,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:d.value,"onUpdate:isEdit":_[4]||(_[4]=m=>d.value=m),onSave:c,onEdit:x},{default:s(()=>[ae(e("div",Ni,[e("div",Vi,[t(w,{value:o.welcomes.content,"onUpdate:value":_[0]||(_[0]=m=>o.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",Pi,[t(C(Ee),{modelValue:o.welcomes.question,"onUpdate:modelValue":_[1]||(_[1]=m=>o.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:_[2]||(_[2]=m=>y.value=!0),onEnd:_[3]||(_[3]=m=>y.value=!1)},{item:s(({element:m,index:b})=>[e("div",Ti,[e("span",Bi,[t(S,{name:"drag"})]),t(R,{class:"question-option-content",value:m.content,"onUpdate:value":g=>m.content=g,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Qi,[t(C(ve),{class:"del-btn",onClick:g=>k(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:n},[t(C(Ie),{class:"add-btn-icon"}),O("添加引导问题 ")])])],512),[[le,d.value]]),ae(e("div",Fi,[e("div",Ji,I(C(h).welcomes.content),1),e("div",Ki,[(i(!0),f(T,null,J(C(h).welcomes.question,(m,b)=>(i(),f("div",{class:"question-item",key:b},I(m.content),1))),128))])],512),[[le,!d.value]])]),_:1},8,["isEdit"])}}},Hi=B(Gi,[["__scopeId","data-v-9b840ded"]]),Wi=u=>(H("data-v-aca01d0e"),u=u(),W(),u),Zi=Wi(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Yi={class:"form-box"},Xi={class:"question-title"},ea={class:"question-options"},ta={class:"question-option"},oa={class:"drag-btn"},sa={class:"action-box"},na={class:"robot-info-box"},ia={class:"robot-unknown-content"},aa={class:"robot-unknown-question"},la={__name:"unknown-problem-prompt",setup(u){const d=$(!1),y=$(!1),{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:l}=Y("robotInfo"),o=Q({unknown_question_prompt:{content:"",question:[]}}),q=()=>{o.unknown_question_prompt.question.push({content:"",id:$e(8)}),lt(()=>{l()})},n=x=>{o.unknown_question_prompt.question.splice(x,1)},k=()=>{a({...Z(o)}),d.value=!1},c=()=>{let x={...h.unknown_question_prompt},r=[];x.question&&x.question.forEach(({content:_,id:w})=>{let S={id:w,content:_};S.id||(S.id=$e(6)),r.push(S)}),x.content&&(o.unknown_question_prompt.content=x.content),r&&(o.unknown_question_prompt.question=r)};return we(()=>{}),(x,r)=>{const _=de,w=Se,S=ce,R=pe;return i(),j(te,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:d.value,"onUpdate:isEdit":r[4]||(r[4]=m=>d.value=m),onSave:k,onEdit:c},{tip:s(()=>[t(_,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Zi]),default:s(()=>[t(C(X))]),_:1})]),default:s(()=>[ae(e("div",Yi,[e("div",Xi,[t(w,{value:o.unknown_question_prompt.content,"onUpdate:value":r[0]||(r[0]=m=>o.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",ea,[t(C(Ee),{modelValue:o.unknown_question_prompt.question,"onUpdate:modelValue":r[1]||(r[1]=m=>o.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:r[2]||(r[2]=m=>y.value=!0),onEnd:r[3]||(r[3]=m=>y.value=!1)},{item:s(({element:m,index:b})=>[e("div",ta,[e("span",oa,[t(S,{name:"drag"})]),t(R,{class:"question-option-content",value:m.content,"onUpdate:value":g=>m.content=g,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",sa,[t(C(ve),{class:"del-btn",onClick:g=>n(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:q},[t(C(Ie),{class:"add-btn-icon"}),O("添加引导问题 ")])])],512),[[le,d.value]]),ae(e("div",na,[e("div",ia,I(C(h).unknown_question_prompt.content),1),e("div",aa,[(i(!0),f(T,null,J(C(h).unknown_question_prompt.question,(m,b)=>(i(),f("div",{class:"question-item",key:b},I(m.content),1))),128))])],512),[[le,!d.value]])]),_:1},8,["isEdit"])}}},ca=B(la,[["__scopeId","data-v-aca01d0e"]]),Xe=u=>(H("data-v-8d50dfeb"),u=u(),W(),u),ra=Xe(()=>e("span",null,null,-1)),da=Xe(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),_a={__name:"problem-optimization",setup(u){$(!1);const{robotInfo:d,updateRobotInfo:y}=Y("robotInfo");Q({prompt:""});const h=a=>{y({})};return(a,l)=>{const o=re;return i(),j(te,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[ra]),default:s(()=>[da,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(d).enable_question_optimize,"onUpdate:checked":l[0]||(l[0]=q=>C(d).enable_question_optimize=q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ua=B(_a,[["__scopeId","data-v-8d50dfeb"]]),et=u=>(H("data-v-e2bb2e45"),u=u(),W(),u),pa=et(()=>e("span",null,null,-1)),ma=et(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),va={__name:"suggested-issues",setup(u){$(!1);const{robotInfo:d,updateRobotInfo:y}=Y("robotInfo"),h=a=>{y({})};return(a,l)=>{const o=re;return i(),j(te,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[pa]),default:s(()=>[ma,t(o,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(d).enable_question_guide,"onUpdate:checked":l[0]||(l[0]=q=>C(d).enable_question_guide=q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ha=B(va,[["__scopeId","data-v-e2bb2e45"]]),Ue=u=>(H("data-v-fc008010"),u=u(),W(),u),fa={class:"direct-title"},ba={class:"direct-desc"},ya={class:"qa"},ka={class:"prompt-form-item-label"},ga=Ue(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),$a={class:"direct-switch"},xa={class:"similarity"},wa=Ue(()=>e("span",null,"相似度超过",-1)),Sa={class:"number-input-box"},qa=Ue(()=>e("span",null,"时直接回复答案",-1)),Ca={__name:"chat-edit-alert",emits:["save"],setup(u,{expose:d,emit:y}){const h=y,a=$(1),l=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],o=Q(l()),q=$(!1),n=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),k=()=>{n.chat_type=a.value.toString(),o.forEach(r=>{r.chat_type==a.value&&(n.chat_type=="3"?(n.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch==1?"true":"false",n.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score.toString()):n.chat_type=="1"&&(n.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch==1?"true":"false",n.library_qa_direct_reply_score=r.library_qa_direct_reply_score.toString()))}),c(),Object.assign(o,l()),q.value=!1},c=()=>{h("save",Z(n))};we(()=>{});const x=r=>{a.value=parseInt(r.chat_type),n.chat_type=r.chat_type,n.library_qa_direct_reply_score=r.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch,o.forEach(_=>{_.chat_type=="3"?(_.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,_.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch=="true"?1:0):_.chat_type=="1"&&(_.library_qa_direct_reply_score=r.library_qa_direct_reply_score,_.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch=="true"?1:0)}),q.value=!0};return ue(()=>q.value,r=>{r===!1&&Object.assign(o,l())},{immediate:!0}),d({open:x}),(r,_)=>{const w=de,S=re,R=Re,m=Rt,b=Lt,g=oe;return i(),j(g,{width:"746px",open:q.value,"onUpdate:open":_[1]||(_[1]=p=>q.value=p),title:"聊天模式设置",onOk:k},{default:s(()=>[t(b,{class:"direct-box",value:a.value,"onUpdate:value":_[0]||(_[0]=p=>a.value=p)},{default:s(()=>[(i(!0),f(T,null,J(o,p=>(i(),j(m,{class:xe(["direct-item",{active:a.value==p.direct_id}]),value:p.direct_id,key:p.direct_id},{default:s(()=>[e("div",fa,I(p.direct_title),1),e("div",ba,I(p.direct_desc),1),ae(e("div",ya,[e("div",ka,[ga,t(w,null,ct({default:s(()=>[t(C(X),{class:"question-icon"})]),_:2},[p.chat_type=="1"?{name:"title",fn:s(()=>[O("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:p.chat_type=="3"?{name:"title",fn:s(()=>[O("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",$a,[p.chat_type=="1"?(i(),j(S,{key:0,checkedValue:1,unCheckedValue:0,checked:p.library_qa_direct_reply_switch,"onUpdate:checked":M=>p.library_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):p.chat_type=="3"?(i(),j(S,{key:1,checkedValue:1,unCheckedValue:0,checked:p.mixture_qa_direct_reply_switch,"onUpdate:checked":M=>p.mixture_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):D("",!0)])])],512),[[le,p.isQaDirectReply&&a.value==p.direct_id]]),ae(e("div",xa,[wa,e("div",Sa,[p.chat_type=="1"?(i(),j(R,{key:0,value:p.library_qa_direct_reply_score,"onUpdate:value":M=>p.library_qa_direct_reply_score=M,disabled:!p.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):p.chat_type=="3"?(i(),j(R,{key:1,value:p.mixture_qa_direct_reply_score,"onUpdate:value":M=>p.mixture_qa_direct_reply_score=M,disabled:!p.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):D("",!0)]),qa],512),[[le,p.isQaDirectReply&&a.value==p.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Ia=B(Ca,[["__scopeId","data-v-fc008010"]]),Oe=u=>(H("data-v-2120501a"),u=u(),W(),u),Ra=Oe(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),La=Oe(()=>e("br",null,null,-1)),Ea=Oe(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),Ua={class:"actions-box"},Oa={class:"model-name"},Aa={class:"form-box"},Ma={__name:"index",setup(u){const d=$(!1),y=$(null),{robotInfo:h,updateRobotInfo:a}=Y("robotInfo"),l=Q({chat_type:h.chat_type,library_qa_direct_reply_score:h.library_qa_direct_reply_score,library_qa_direct_reply_switch:h.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:h.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:h.mixture_qa_direct_reply_switch}),o=k=>{l.chat_type=k.chat_type,l.library_qa_direct_reply_score=k.library_qa_direct_reply_score,l.library_qa_direct_reply_switch=k.library_qa_direct_reply_switch,l.mixture_qa_direct_reply_score=k.mixture_qa_direct_reply_score,l.mixture_qa_direct_reply_switch=k.mixture_qa_direct_reply_switch,q()},q=()=>{a({...Z(l)}),d.value=!1},n=()=>{y.value.open(Z(l)),d.value=!0};return(k,c)=>{const x=de,r=Le,_=se;return i(),j(te,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:d.value,"onUpdate:isEdit":c[1]||(c[1]=w=>d.value=w),bodyStyle:{padding:0}},{tip:s(()=>[t(x,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Ra,La,Ea]),default:s(()=>[t(C(X))]),_:1})]),extra:s(()=>[e("div",Ua,[e("span",Oa,I(C(h).chat_type=="1"?"仅知识库":C(h).chat_type=="2"?"直连模式":"混合模式"),1),t(r,{type:"vertical"}),t(_,{size:"small",onClick:c[0]||(c[0]=w=>n(!0))},{default:s(()=>[O("修改")]),_:1})])]),default:s(()=>[e("div",Aa,[t(Ia,{ref_key:"ChatEditAlertRef",ref:y,onSave:o},null,512)])]),_:1},8,["isEdit"])}}},za=B(Ma,[["__scopeId","data-v-2120501a"]]),ja=u=>(H("data-v-0548f52d"),u=u(),W(),u),Da={class:"switch-box"},Na={class:"switch-box-body"},Va={class:"switch-box-header"},Pa={class:"left-box"},Ta={class:"switch-box-title"},Ba={key:0,class:"title-tip"},Qa={class:"right-box"},Fa={class:"extra-box"},Ja=ja(()=>e("div",{class:"extra-box"},null,-1)),Ka={class:"switch-desc"},Ga={class:"switch-box-right"},Ha={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(u,{emit:d}){const y=d,h=u,a=$(h.value),l=o=>{y("update:value",o),y("change",o)};return(o,q)=>{const n=ce,k=re;return i(),f("div",Da,[e("div",Na,[e("div",Va,[e("div",Pa,[t(n,{class:"switch-box-icon",name:h.iconName},null,8,["name"]),e("span",Ta,I(h.title),1),o.$slots.tip?(i(),f("span",Ba,[_e(o.$slots,"tip",{},void 0,!0)])):D("",!0)]),e("div",Qa,[e("div",Fa,[_e(o.$slots,"extra",{},()=>[Ja],!0)])])]),e("div",Ka,[_e(o.$slots,"default",{},void 0,!0)])]),e("div",Ga,[t(k,{checked:a.value,"onUpdate:checked":q[0]||(q[0]=c=>a.value=c),onChange:l,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Wa=B(Ha,[["__scopeId","data-v-0548f52d"]]),Za="/assets/img/empty-Bx9z1cwf.png",Ya="/assets/img/phone-head-CDwwPhYa.png",Xa="/assets/img/phone-body-CbEf8GZP.png",el="/assets/img/phone-footer-ClQtNpln.png",me=u=>(H("data-v-dce83f0d"),u=u(),W(),u),tl={class:"common-problem-box"},ol={class:"left-content-box"},sl={key:0,class:"empty-box"},nl=me(()=>e("img",{src:Za,alt:""},null,-1)),il=me(()=>e("div",{class:"title"},"暂无数据",-1)),al=me(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),ll={key:1,class:"lists-box"},cl={class:"drag-btn"},rl={class:"title"},dl={class:"opration-box"},_l={class:"preview-box"},ul=me(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ya,alt:""})],-1)),pl={class:"phone-body"},ml=me(()=>e("div",null,[e("img",{class:"body-img",src:Xa,alt:""})],-1)),vl={key:0,class:"question-box"},hl=me(()=>e("div",{class:"name"},"常见问题",-1)),fl=me(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:el,alt:""})],-1)),bl={__name:"common-problem",setup(u){$(!1);const{robotInfo:d,updateRobotInfo:y}=Y("robotInfo"),h=ge(()=>d.common_question_list?JSON.parse(d.common_question_list):[]),a=$([]);a.value=h.value,ue(h,()=>{a.value=h.value});const l=ze.useForm,o=$(!1),q=$("添加问题"),n=Q({question:"",index:-1}),k=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:c,validate:x,validateInfos:r}=l(n,k),_=()=>{if(h.value.length>=10)return ee.error("最多设置10条常用问题");o.value=!0,c(),n.question="",n.index=-1},w=(g,p)=>{o.value=!0,c(),n.question=g,n.index=p},S=g=>{let p=[];p=h.value.filter((M,L)=>g!=L),oe.confirm({title:"提醒",icon:t(ht),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){y({common_question_list:JSON.stringify(p)})},onCancel(){}})},R=()=>{x().then(()=>{let g=[];n.index>=0?g=h.value.map((p,M)=>M===n.index?n.question:p):g=[n.question,...h.value],y({common_question_list:JSON.stringify(g)}),o.value=!1})},m=g=>{y({})},b=g=>{y({common_question_list:JSON.stringify(a.value)})};return(g,p)=>{const M=de,L=re,V=Le,z=se,v=ce,G=pe,E=Et,K=ze,N=oe;return i(),f("div",tl,[e("div",ol,[t(te,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(M,null,{title:s(()=>[O("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(C(X),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(L,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(d).enable_common_question,"onUpdate:checked":p[0]||(p[0]=P=>C(d).enable_common_question=P),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(V,{type:"vertical"}),t(z,{type:"primary",size:"small",onClick:_},{default:s(()=>[O("添加")]),_:1})]),default:s(()=>[h.value.length==0?(i(),f("div",sl,[nl,il,al,t(z,{onClick:_,type:"primary"},{default:s(()=>[O("立即添加")]),_:1})])):(i(),f("div",ll,[t(C(Ee),{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=P=>a.value=P),handle:".drag-btn","item-key":"index",onEnd:b},{item:s(({element:P,index:A})=>[(i(),f("div",{class:"list-item",key:A},[e("span",cl,[t(v,{name:"drag"})]),e("div",rl,I(P),1),e("div",dl,[t(C(bt),{onClick:F=>w(P,A)},null,8,["onClick"]),t(C(ve),{onClick:F=>S(A)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",_l,[ul,e("div",pl,[ml,h.value.length&&C(d).enable_common_question=="true"?(i(),f("div",vl,[hl,(i(!0),f(T,null,J(h.value,P=>(i(),f("div",{class:"list-item",key:P},I(P),1))),128))])):D("",!0)]),fl]),t(N,{open:o.value,"onUpdate:open":p[3]||(p[3]=P=>o.value=P),title:q.value,onOk:R,width:"476px"},{default:s(()=>[t(K,{class:"form-box",layout:"vertical"},{default:s(()=>[t(E,rt({label:"问题名称"},C(r).question),{default:s(()=>[t(G,{maxLength:100,value:n.question,"onUpdate:value":p[2]||(p[2]=P=>n.question=P),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},yl=B(bl,[["__scopeId","data-v-dce83f0d"]]),kl=e("span",null,null,-1),gl=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),$l={__name:"display-aitations",setup(u){const{robotInfo:d,updateRobotInfo:y}=Y("robotInfo"),h=$(!1);ue(()=>d.answer_source_switch,l=>{h.value=l=="true"},{immediate:!0});const a=()=>{y({answer_source_switch:h.value?"true":"false"})};return(l,o)=>(i(),j(Wa,{title:"显示引文","icon-name":"jibenpeizhi",value:h.value,"onUpdate:value":o[0]||(o[0]=q=>h.value=q),onChange:a},{extra:s(()=>[kl]),default:s(()=>[gl]),_:1},8,["value"]))}},xl={key:0,class:"robot-config-page"},wl={class:"setting-box"},Sl={class:"setting-box"},ql={class:"setting-box"},Cl={class:"setting-box"},Il={class:"setting-box"},Rl={class:"setting-box"},Ll={class:"setting-box"},El={class:"setting-box"},Ul={class:"setting-box"},Ol={class:"setting-box"},Al={class:"setting-box"},Ml={key:1,class:"robot-config-page"},zl={__name:"index",setup(u){const d=Ut(),y=$(null),{robotInfo:h}=dt(d),{getRobot:a}=d,l=()=>{y.value.scrollTop=y.value.scrollHeight},o=$(1),q=$(!1),n=Q(h.value);_t("robotInfo",{robotInfo:n,updateRobotInfo:x=>{let r=JSON.parse(JSON.stringify(x));x.robot_avatar&&(r.robot_avatar=new File([x.robot_avatar],x.robot_avatar.name)),Object.assign(n,r),c()},scrollBoxToBottom:l});const c=()=>{let x;n.robot_avatar&&(x=new File([n.robot_avatar],n.robot_avatar.name));let r=JSON.parse(JSON.stringify(Z(n)));x&&(r.robot_avatar=x);let _=r.welcomes;_.question=_.question.map(S=>S.content),r.welcomes=JSON.stringify(_),r.prompt_struct=JSON.stringify(r.prompt_struct);let w=r.unknown_question_prompt;w.question=w.question.map(S=>S.content),r.unknown_question_prompt=JSON.stringify(w),delete r.robot_avatar_url,q.value=!0,kt(r).then(S=>{if(S.res!=0)return ee.error(S.msg);q.value=!1,ee.success("保存成功"),a(n.id)}).catch(()=>{q.value=!1})};return(x,r)=>{const _=Ne,w=Ve;return i(),f(T,null,[t(w,{activeKey:o.value,"onUpdate:activeKey":r[0]||(r[0]=S=>o.value=S)},{default:s(()=>[(i(),j(_,{key:1,tab:"基础配置"})),(i(),j(_,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),o.value==1?(i(),f("div",xl,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:y},[e("div",wl,[t(no)]),e("div",Sl,[t(ki)]),e("div",ql,[t(Rs)]),e("div",Cl,[t(pn)]),e("div",Il,[t(Di)]),e("div",Rl,[t(Hi)]),e("div",Ll,[t(za)]),e("div",El,[t(ca)]),e("div",Ul,[t(ua)]),e("div",Ol,[t(ha)]),e("div",Al,[t($l)])],512)])):(i(),f("div",Ml,[t(yl)]))],64)}}},Jc=B(zl,[["__scopeId","data-v-94158e26"]]);export{Jc as default};
