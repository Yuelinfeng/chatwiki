import{L as t,M as o,V as e,a5 as K,a6 as f,F as q,_ as A,Y as g,b as ue,r as T,ah as _e,j as a,Q as _,P as Q,u as k,X as x,E as J,G as Te,y as se,a9 as te,a0 as X,a1 as Z,w as de,A as Le,a3 as Me,a4 as ce,a8 as Ie,v as Ee,B as Ae,a7 as Be}from"./vue-chunks-Be7x44a8.js";import{_ as re,u as Re}from"./useIM-pgdlM0Av.js";import{u as pe}from"./chat-apYpYN14.js";import{b as H,L as Oe,bk as De,d as oe,b4 as me,f as He,bl as Pe,k as Fe,B as je}from"../../index-DrRzkLrM.js";import{S as ge}from"./index-CpDQkIaf.js";import{Q as O}from"./QuestionCircleOutlined-C1VUeDko.js";import{_ as ve}from"./index-oRdc9kyy.js";import{C as Ne}from"./cu-scroll-ChKD2tbP.js";import{_ as Ue}from"./TextArea-CnprCuXF.js";import{_ as he}from"./index-C-In0Yoq.js";import{a as Qe}from"./index-CTxSUaSW.js";import{o as ze}from"./index-DoA-1VYy.js";import{u as Ve}from"./robot-Vrmn2jwC.js";import{B as Ke,_ as Ge}from"./index-BPG7X7Q8.js";import{P as Ye}from"./PlusOutlined-BjJbDYD_.js";import"./index-B3BARGoX.js";import"./axios-Cm0UX6qg.js";import"./qs-DBZYvUeR.js";import"./crypto-js-5KTNdlTg.js";import"./dayjs-B2GD4xRt.js";import"./Trigger-QcvDPnyC.js";import"./colors-CGmsXzSB.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./FormItemContext-DlzjcwaL.js";import"./statusUtils-BM8Tk6m7.js";import"./index-BFFBEz-T.js";import"./inputProps-D4I2pN7C.js";import"./index-DtPUy1JV.js";import"./dropdown-PWgKI0m8.js";import"./Dropdown-y3DQiBjQ.js";import"./RightOutlined-DqgahkKm.js";import"./move-D51iXHK1.js";import"./slide-C3j77thT.js";import"./index-KF-GLyjX.js";import"./shallowequal-COOgl3QP.js";import"./collapseMotion-D9n-d2nt.js";import"./DownOutlined-Cp0vVtPD.js";const We={class:"guess-you-want"},Je={class:"message-tabs"},Xe={key:1,class:"v-line"},Ze={key:0,class:"message-menus"},et=["onClick"],tt={key:1,class:"message-menus"},st=["onClick"],ot={__name:"guess-you-want",props:{item:{type:Object,default:()=>{}},common_question_list:{type:Object,default:()=>[]},enable_common_question:{type:Boolean,default:!1}},emits:["clickMeun"],setup(u,{emit:L}){const y=L,s=u,v=(b,c)=>{b.question_tabkey=c},$=b=>{y("clickMeun",b)};return(b,c)=>(t(),o("div",We,[e("div",Je,[s.item.guess_you_want?(t(),o("div",{key:0,onClick:c[0]||(c[0]=i=>v(s.item,1)),class:K(["tab-item",{active:s.item.question_tabkey==1}])}," 猜你想问 ",2)):f("",!0),s.item.guess_you_want&&s.common_question_list&&s.enable_common_question?(t(),o("div",Xe)):f("",!0),s.common_question_list&&s.enable_common_question?(t(),o("div",{key:2,onClick:c[1]||(c[1]=i=>v(s.item,2)),class:K(["tab-item",{active:s.item.question_tabkey==2}])}," 常见问题 ",2)):f("",!0)]),s.item.question_tabkey==1?(t(),o("div",Ze,[(t(!0),o(q,null,A(s.item.guess_you_want,(i,n)=>(t(),o("div",{onClick:r=>$(i),class:"menu-item",key:n},g(i),9,et))),128))])):(t(),o("div",tt,[(t(!0),o(q,null,A(u.common_question_list,(i,n)=>(t(),o("div",{onClick:r=>$(i),class:"menu-item",key:n},g(i),9,st))),128))]))]))}},nt=H(ot,[["__scopeId","data-v-253226a8"]]),fe=u=>(X("data-v-d5c173ae"),u=u(),Z(),u),lt={class:"message-list-wrapper"},at={class:"message-list"},it=["id"],ct={class:"itme-left"},rt=["src"],ut={class:"itme-right"},_t={class:"item-body"},dt={class:"message-content"},pt=["id"],mt={class:"itme-left"},gt=["src"],vt={class:"itme-right"},ht=["onClick"],ft={class:"label-text"},yt={class:"item-body"},bt={key:0,class:"thinking-content"},kt={class:"message-content"},$t={class:"message-menus"},wt=["onClick"],qt=["innerHTML"],St={class:"message-menus"},Ct=["onClick"],xt={key:3,class:"message-content"},Tt=["src"],Lt={key:4,class:"message-action-wrap"},Mt={class:"message-action"},It={key:0,class:"action-btn"},Et=fe(()=>e("span",null,"答案来源 ",-1)),At=fe(()=>e("span",null,"您可以修改相应文档并重新上传，以调整机器人的回答效果。答案来源仅后台测试时可见。",-1)),Bt={key:1,class:"action-btn"},Rt=["onClick"],Ot={key:0,class:"file-items"},Dt=["onClick"],Ht={class:"file-name"},Pt={__name:"message-list",props:{messages:{type:Array,default:()=>[]},robotInfo:{type:Object,default:()=>{}}},emits:["clickMsgMeun","scroll","scrollStart","scrollEnd","openPromptLog","openLibrary"],setup(u,{expose:L,emit:y}){const s=y,v=u,$=d=>{d.show_reasoning=!d.show_reasoning},b=ue(()=>v.robotInfo.common_question_list.length?JSON.parse(v.robotInfo.common_question_list):[]),c=d=>{s("clickMsgMeun",d)},i=T(null),n={scrollTop:0,scrollHeight:0,clientHeight:0,scrollStartDiff:60,scrollEndDiff:60,scrollDirection:""};let r=null,m=!1;function B(d){m||(r&&(clearTimeout(r),r=null),r=setTimeout(()=>{n.scrollTop-d.target.scrollTop>0&&(n.scrollDirection="up"),n.scrollTop-d.target.scrollTop<0&&(n.scrollDirection="down"),n.scrollTop=d.target.scrollTop,n.scrollHeight=d.target.scrollHeight,n.clientHeight=d.target.clientHeight,s("scroll",{...n}),Math.abs(n.scrollTop)<=n.scrollStartDiff&&n.scrollDirection==="up"&&F(),Math.abs(n.scrollHeight-n.scrollTop-n.clientHeight)<=n.scrollEndDiff&&n.scrollDirection==="down"&&j()},50))}function F(){v.messages.length!=0&&s("scrollStart",{msg:v.messages[0]})}function j(){v.messages.length!=0&&s("scrollEnd",{msg:v.messages[v.messages.length-1]})}const S=()=>{i.value&&se(()=>{m=!0,i.value.scrollTop=i.value.scrollHeight+1,setTimeout(()=>{n.scrollTop=i.value.scrollTop,m=!1},50)})};function M(d,w){se(()=>{m=!0,w||(w="top");let I=i.value,E=document.querySelector("#msg-"+d);w=="top"?I.scrollTop=E.offsetTop:I.scrollTop=E.offsetTop-I.clientHeight+E.clientHeight,setTimeout(()=>{n.scrollTop=i.value.scrollTop,m=!1},50)})}function G(){n.scrollTop=0,n.scrollDirection=""}function z(d){return!!(d.quote_file&&d.quote_file.length>0||d.debug&&d.debug.length>0)}function D(d){s("openPromptLog",te(d))}function h(d,w,I){let E=te(d);E.forEach(N=>{N.message_id=I}),s("openLibrary",E,te(w))}return L({scrollToBottom:S,scrollToMessage:M,resetScroll:G}),(d,w)=>{const I=ge,E=oe,N=ve,Y=_e("viewer");return t(),o("div",lt,[e("div",{class:"scroll-box",ref_key:"scrollBoxRef",ref:i,onScroll:B},[e("div",at,[(t(!0),o(q,null,A(v.messages,l=>(t(),o(q,{key:l.uid},[l.is_customer==1?(t(),o("div",{key:0,class:"message-item user-message",id:"msg-"+l.uid},[e("div",ct,[e("img",{class:"user-avatar",src:l.avatar},null,8,rt)]),e("div",ut,[e("div",_t,[e("div",dt,g(l.content),1)])])],8,it)):(t(),o("div",{key:1,class:"message-item robot-message",id:"msg-"+l.uid},[e("div",mt,[a(I,{size:"small",spinning:l.loading},{default:_(()=>[e("img",{class:"robot-avatar",src:l.robot_avatar},null,8,gt)]),_:2},1032,["spinning"])]),e("div",vt,[l.reasoning_content?(t(),o("div",{key:0,class:K(["thinking-label-wrapper",{reasoning_open:l.show_reasoning}])},[e("div",{class:"thinking-label",onClick:C=>$(l)},[l.reasoning_status?(t(),Q(k(Oe),{key:0,class:"loading"})):(t(),Q(E,{key:1,class:"think-icon",name:"think"})),e("span",ft,g(l.reasoning_status?"深度思考中...":"已完成深度思考"),1),l.reasoning_status?f("",!0):(t(),Q(E,{key:2,name:"arrow-down",class:"arrow-down"}))],8,ht),a(N,null,{title:_(()=>[x("在应用设置中关闭推理过程开关，将不再显示推理过程")]),default:_(()=>[a(k(De),{class:"tip"})]),_:1})],2)):f("",!0),e("div",yt,[l.show_reasoning?(t(),o("div",bt,[a(re,{content:l.reasoning_content},null,8,["content"])])):f("",!0),l.msg_type==1?(t(),o(q,{key:1},[J((t(),o("div",kt,[a(re,{content:l.content},null,8,["content"])])),[[Y]]),e("div",$t,[(t(!0),o(q,null,A(l.question,(C,U)=>(t(),o("div",{class:"menu-item",onClick:W=>c(C),key:U},g(C),9,wt))),128))])],64)):f("",!0),l.msg_type==2?(t(),o(q,{key:2},[e("div",{class:"message-content",innerHTML:l.menu_json.content},null,8,qt),e("div",St,[(t(!0),o(q,null,A(l.menu_json.question,(C,U)=>(t(),o("div",{class:"menu-item",onClick:W=>c(C),key:U},g(C),9,Ct))),128))])],64)):f("",!0),l.msg_type==3?(t(),o("div",xt,[J(e("img",{class:"msg-img",src:l.content,alt:""},null,8,Tt),[[Y]])])):f("",!0),z(l)?J((t(),o("div",Lt,[e("div",Mt,[l.quote_file&&l.quote_file.length>0?(t(),o("div",It,[Et,a(N,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:_(()=>[At]),default:_(()=>[a(k(O))]),_:1})])):f("",!0),l.debug&&l.debug.length>0?(t(),o("div",Bt,[e("span",null,[e("a",{onClick:C=>D(l)},"Prompt 日志",8,Rt)])])):f("",!0)]),l.quote_file&&l.quote_file.length>0?(t(),o("div",Ot,[(t(!0),o(q,null,A(l.quote_file,C=>(t(),o("div",{class:"file-item",key:C.id,onClick:U=>h(l.quote_file,C,l.id)},[e("a",Ht,g(C.file_name),1)],8,Dt))),128))])):f("",!0)],512)),[[Te,!l.question]]):f("",!0)]),(l.guess_you_want&&l.guess_you_want.length||b.value.length&&v.robotInfo.enable_common_question=="true")&&l.question_tabkey>0?(t(),Q(nt,{key:1,item:l,enable_common_question:v.robotInfo.enable_common_question=="true",common_question_list:b.value,onClickMeun:c},null,8,["item","enable_common_question","common_question_list"])):f("",!0)])],8,pt))],64))),128))])],544)])}}},Ft=H(Pt,[["__scopeId","data-v-d5c173ae"]]),jt={class:"chat-list-box"},Nt=["onClick"],Ut={class:"chat-item-title"},Qt={__name:"chat-list",props:{list:{type:Array,default:()=>[]},active:{type:[String,Number],default:""}},emits:["openChat","onScrollEnd"],setup(u,{emit:L}){const y=L,s=u,v=T(null),$=c=>{y("openChat",c)},b=()=>{y("onScrollEnd")};return de(()=>s.list,()=>{se(()=>{v.value.refresh()})}),(c,i)=>{const n=oe;return t(),o("div",jt,[a(Ne,{ref_key:"scroller",ref:v,onOnScrollEnd:b},{default:_(()=>[e("div",null,[(t(!0),o(q,null,A(s.list,r=>(t(),o("div",{class:K(["chat-list-item",{active:r.id==s.active}]),onClick:m=>$(r),key:r.id},[a(n,{class:"chat-item-icon",name:"message"}),e("span",Ut,g(r.subject||r.last_chat_message),1)],10,Nt))),128))])]),_:1},512)])}}},zt=H(Qt,[["__scopeId","data-v-4b3af25b"]]),Vt=u=>(X("data-v-a6f824ba"),u=u(),Z(),u),Kt={class:"message-input-wrapper"},Gt={class:"message-action"},Yt={class:"loading-action"},Wt=["disabled"],Jt=Vt(()=>e("span",null,"发送",-1)),Xt=[Jt],Zt={__name:"message-input",props:{value:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["send","update:value"],setup(u,{emit:L}){const y=L,s=u,v=ue(()=>s.loading||s.value.trim().length===0),$=i=>{y("update:value",i.target.value.trim())},b=i=>{if(i.key==="Enter"&&!i.shiftKey){if(!i.target.value.trim())return;i.preventDefault(),c()}else i.key==="Enter"&&i.shiftKey&&(i.preventDefault(),y("update:value",s.value+`
`))},c=()=>{y("send",s.value.trim())};return(i,n)=>{const r=Ue,m=ge;return t(),o("div",Kt,[a(r,{value:u.value,"auto-size":{minRows:5,maxRows:5},placeholder:"在此输入您想了解的内容，Shift+Enter换行",onChange:$,onKeydown:b},null,8,["value"]),e("div",Gt,[e("span",Yt,[a(m,{spinning:u.loading},null,8,["spinning"])]),u.loading?f("",!0):(t(),o("button",{key:0,class:"send-msg-btn",disabled:v.value,onClick:c},Xt,8,Wt))])])}}},es=H(Zt,[["__scopeId","data-v-a6f824ba"]]),P=u=>(X("data-v-78d9c8b9"),u=u(),Z(),u),ts={class:"prompt-log-content"},ss={class:"prompt-log-items"},os={class:"prompt-log-label"},ns=P(()=>e("span",null,"SYSTEM ",-1)),ls={class:"prompt-log-item"},as={class:"prompt-log-items"},is={class:"prompt-log-label"},cs=P(()=>e("span",null,"上下文 ",-1)),rs={class:"prompt-log-items"},us={class:"prompt-log-label"},_s=P(()=>e("span",null,"USER ",-1)),ds={class:"prompt-log-item"},ps={class:"prompt-log-items"},ms={class:"prompt-log-label"},gs=P(()=>e("span",null,"ASSISTANT ",-1)),vs={class:"prompt-log-item"},hs={key:0,class:"prompt-log-items"},fs={class:"prompt-log-label"},ys=P(()=>e("span",null,"Recall time ",-1)),bs={class:"prompt-log-item"},ks={key:1,class:"prompt-log-items"},$s={class:"prompt-log-label"},ws=P(()=>e("span",null,"Request time ",-1)),qs={class:"prompt-log-item"},Ss={class:"prompt-log-items"},Cs={class:"prompt-log-label"},xs=P(()=>e("span",null,"Error ",-1)),Ts={class:"prompt-log-item"},Ls={__name:"prompt-log-alert",setup(u,{expose:L}){const y=T(!1),s=Le({prompt:"",library:[],context_qa:[],cur_question:"",cur_answer:"",error:""}),v=()=>{y.value=!1},$=()=>{s.prompt="",s.library=[],s.context_qa=[],s.cur_question="",s.cur_answer="",s.error="",s.recall_time="",s.request_time=""};return L({open:c=>{$(),s.error=c.error,s.recall_time=c.recall_time?(c.recall_time/1e3).toFixed(2):"",s.request_time=c.request_time?(c.request_time/1e3).toFixed(2):"";let i=c.debug||[];for(let n=0;n<i.length;n++){let r=i[n];r.type=="library"?s.library.push(r.content):r.type=="context_qa"?s.context_qa.push(r):s[r.type]=r.content}y.value=!0}}),(c,i)=>{const n=ve,r=he;return t(),Q(r,{class:"prompt-log-alert",open:y.value,"onUpdate:open":i[0]||(i[0]=m=>y.value=m),title:"Prompt 日志",placement:"right",width:"746px",closable:!1},{extra:_(()=>[e("span",{class:"close-btn",onClick:v},[a(k(me))])]),default:_(()=>[e("div",ts,[e("div",ss,[e("div",os,[ns,a(n,null,{title:_(()=>[x("系统提示词和文档分段。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",ls,[e("p",null,g(s.prompt),1)]),(t(!0),o(q,null,A(s.library,(m,B)=>(t(),o("div",{class:"prompt-log-item",key:B},[e("p",null,g(m),1)]))),128))]),e("div",as,[e("div",is,[cs,a(n,null,{title:_(()=>[x("传递的历史提问消息")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),(t(!0),o(q,null,A(s.context_qa,(m,B)=>(t(),o("div",{class:"prompt-log-item",key:B},[e("p",null,"Q："+g(m.question),1),e("p",null,"A："+g(m.answer),1)]))),128))]),e("div",rs,[e("div",us,[_s,a(n,null,{title:_(()=>[x("本次用户的提问")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",ds,[e("p",null,g(s.cur_question),1)])]),e("div",ps,[e("div",ms,[gs,a(n,null,{title:_(()=>[x("语言模型输出的答案")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",vs,[e("p",null,g(s.cur_answer),1)])]),s.recall_time>0?(t(),o("div",hs,[e("div",fs,[ys,a(n,null,{title:_(()=>[x("从知识库中检索到有效分段所需要的时间，包括对分段进行排序时间。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",bs,[e("p",null,g(s.recall_time)+"s",1)])])):f("",!0),s.request_time>0?(t(),o("div",ks,[e("div",$s,[ws,a(n,null,{title:_(()=>[x("从发送问题和上下文信息给大模型到大模型开始返回答案的时间。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",qs,[e("p",null,g(s.request_time)+"s",1)])])):f("",!0),e("div",Ss,[e("div",Cs,[xs,a(n,null,{title:_(()=>[x("报错信息，调用聊天接口报错时会显示。")]),default:_(()=>[a(k(O),{class:"question-icon"})]),_:1})]),e("div",Ts,[e("p",null,g(s.error),1)])])])]),_:1},8,["open"])}}},Ms=H(Ls,[["__scopeId","data-v-78d9c8b9"]]),Is={class:"library-info-content"},Es={class:"file-list"},As=["onClick"],Bs={class:"document-items"},Rs={class:"document-item-header"},Os={class:"left-box"},Ds={class:"document-title"},Hs={key:0,class:"document-title"},Ps={class:"document-size"},Fs={class:"document-item-body"},js={class:"document-similarity"},Ns={key:0,class:"document-content"},Us={key:1,class:"document-content"},Qs={class:"document-content"},zs={class:"fragment-img"},Vs=["src"],Ks={__name:"library-info-alert",setup(u,{expose:L}){const y=pe(),{robot:s}=y,v=Me(),$=T(!1),b=T([]),c=T(null),i=()=>{b.value=[],c.value=null},n=(S,M)=>{i(),b.value=S,c.value=M.id,$.value=!0,B(M)},r=S=>{S.id!=c.value&&(c.value=S.id,B(S))},m=T([]),B=S=>{Qe({message_id:S.message_id,file_id:S.id,robot_key:s.robot_key,openid:s.openid}).then(M=>{m.value=M.data||[]})},F=()=>{v.push("/library/preview?id="+c.value)},j=()=>{$.value=!1};return L({open:n}),(S,M)=>{const G=oe,z=he,D=_e("viewer");return t(),Q(z,{class:"library-info-alert",open:$.value,"onUpdate:open":M[0]||(M[0]=h=>$.value=h),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:_(()=>[e("span",{class:"close-btn",onClick:j},[a(k(me))])]),default:_(()=>[e("div",Is,[e("div",Es,[(t(!0),o(q,null,A(b.value,h=>(t(),o("div",{class:K(["file-item",{active:c.value==h.id}]),key:h.id,onClick:d=>r(h)},g(h.file_name),11,As))),128))]),e("div",Bs,[(t(!0),o(q,null,A(m.value,h=>(t(),o("div",{class:"document-item",key:h.id},[e("div",Rs,[e("div",Os,[e("span",Ds,"id："+g(h.id),1),h.title?(t(),o("span",Hs,g(h.title),1)):f("",!0),e("span",Ps," 共"+g(h.word_total)+"个字符 ",1)]),e("div",{class:"right-box"},[e("a",{onClick:F},"查看源文档>")])]),e("div",Fs,[e("div",js,[x(" 相似度： "),a(G,{name:"similarity",style:{"font-size":"16px"}}),x(g(h.similarity),1)]),h.question?(t(),o("div",Ns,"Q："+g(h.question),1)):f("",!0),h.answer?(t(),o("div",Us,"A："+g(h.answer),1)):f("",!0),e("div",Qs,g(h.content),1),J((t(),o("div",zs,[(t(!0),o(q,null,A(h.images,(d,w)=>(t(),o("img",{key:w,src:d,alt:""},null,8,Vs))),128))])),[[D]])])]))),128))])])]),_:1},8,["open"])}}},Gs=H(Ks,[["__scopeId","data-v-7015d501"]]),Ys=u=>(X("data-v-7ccbdb5f"),u=u(),Z(),u),Ws={class:"chat-page-wrapper"},Js={class:"chat-page-header"},Xs={class:"breadcrumb-box"},Zs={class:"chat-page"},eo={class:"page-left"},to={class:"page-left-top"},so={class:"page-left-body"},oo=Ys(()=>e("div",{class:"page-left-footer"},null,-1)),no={class:"page-body"},lo={class:"chat-box-body"},ao={style:{"margin-top":"30px"},class:"chat-box-footer"},io={__name:"index",setup(u){const y=ce().query,s=Ve(),{getRobot:v,robotInfo:$}=s,b=Re(),c=pe(),i=He();let n=!0;const r=T(""),m=T(null),{createChat:B,sendMessage:F,getMyChatList:j,openChat:S,onGetChatMessage:M,changeRobotPrompt:G,$reset:z}=c,{messageList:D,sendLock:h,myChatList:d,robot:w,dialogue_id:I}=Ie(c);w.value;const E=ce(),N=T(!1),Y=async()=>{if(!r.value)return Pe("请输入消息内容");let p=await ze({robot_key:w.value.robot_key,openid:w.value.openid,question:r.value,form_ids:w.value.form_ids,dialogue_id:I.value});if(p.data&&p.data.words)return Fe.error(`提交的内容包含敏感词：[${p.data.words.join(";")}] 请修改后再提交`);n=!0,F({message:r.value}),r.value=""},l=async()=>{n=!0,r.value="";let p=E.query||{},R=i.user_id,V={robot_key:p.robot_key,avatar:p.avatar,name:p.name,nickname:p.nickname,is_background:1,openid:R,dialogue_id:0};le(),await B(V)},C=async p=>{if(I.value==p.dialogue_id)return;n=!0;let V={robot_key:(E.query||{}).robot_key,avatar:p.avatar,name:p.name,nickname:p.nickname,is_background:p.is_background,openid:p.openid,dialogue_id:p.id};le(),await S(V),await M()&&ne()},U=p=>{n=!0,F({message:p})};T(!1);const W=()=>{ne()},ye=async()=>{n=!1;let p=D.value[0].uid;await M()&&ke(p)},be=()=>{},ne=()=>{m.value&&n&&m.value.scrollToBottom()},ke=p=>{m.value&&m.value.scrollToMessage(p)},le=()=>{m.value&&m.value.resetScroll()},$e=()=>{j()},ae=T(null),we=p=>{ae.value.open(p)},ie=T(null),qe=(p,R)=>{ie.value.open(p,R)};return de(()=>D.value,()=>{}),Ee(async()=>{l(),j(),await v(y.id),N.value=!0,b.on("updateAiMessage",W)}),Ae(()=>{z(),b.off("updateAiMessage",W)}),(p,R)=>{const V=Be("router-link"),ee=Ge,Se=Ke,Ce=je;return t(),o("div",Ws,[e("div",Js,[e("div",Xs,[a(Se,null,{default:_(()=>[a(ee,null,{default:_(()=>[a(V,{to:"/robot/list"},{default:_(()=>[x("机器人管理")]),_:1})]),_:1}),a(ee,null,{default:_(()=>[x(g(k(w).robot_name),1)]),_:1})]),_:1})])]),e("div",Zs,[e("div",eo,[e("div",to,[a(Ce,{type:"primary",block:"",ghost:"",onClick:l},{default:_(()=>[a(k(Ye)),x(" 新建对话")]),_:1})]),e("div",so,[a(zt,{list:k(d),active:k(I),onOpenChat:C,onOnScrollEnd:$e},null,8,["list","active"])]),oo]),e("div",no,[e("div",lo,[a(Ft,{ref_key:"messageListRef",ref:m,messages:k(D),robotInfo:k($),onClickMsgMeun:U,onScrollStart:ye,onScrollEnd:be,onOpenPromptLog:we,onOpenLibrary:qe},null,8,["messages","robotInfo"])]),e("div",ao,[a(es,{value:r.value,"onUpdate:value":R[0]||(R[0]=xe=>r.value=xe),onSend:Y,loading:k(h)},null,8,["value","loading"])])]),e("div",null,[f("",!0)])]),a(Ms,{ref_key:"promptLogAlertRef",ref:ae},null,512),a(Gs,{ref_key:"libraryInfoAlertRef",ref:ie},null,512)])}}},Ko=H(io,[["__scopeId","data-v-7ccbdb5f"]]);export{Ko as default};
