import{A as K,b as D,k as T,B as X,d as E}from"../../index-CAb1tT-W.js";import{C as ee}from"./cu-scroll-DUEEhpqe.js";import{_ as te}from"./empty-DkpCLaix.js";import{k as i,a5 as F,e as k,B as se,b as oe,M as n,N as c,W as e,S as u,Y as f,Q as x,u as L,F as S,$ as R,a6 as ne,a7 as y,Z as v,a1 as Q,a2 as H,a4 as ie}from"./vue-chunks-DWnFCQSz.js";import{n as ae}from"./index-CYunvooy.js";import{_ as le}from"./recommendation-AQ4_FPQ9.js";import{c as re}from"./index-FFGVkxQ5.js";import{D as ce}from"./DownOutlined-DeYc9KSb.js";import{U as _e}from"./UpOutlined-BgTfLOYX.js";import{Q as A}from"./QuestionCircleOutlined-OoMpIVY2.js";import{_ as de}from"./TextArea-CYqPccpO.js";import{_ as ue}from"./index-DgLE2dBi.js";import{_ as me}from"./index-DA4wOIbE.js";import{_ as pe}from"./index-Crh3gx22.js";import{_ as ve}from"./index-BSYjd5qd.js";import{S as fe,a as he,_ as ke}from"./index-dibcP1Tn.js";import{S as ye}from"./index-BgOt2FQs.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-DzhuYAPB.js";import"./FormItemContext-8D78_qVD.js";import"./statusUtils-DZGhn0Kh.js";import"./index-B3zCNJkU.js";import"./Trigger-JKklW7kX.js";import"./inputProps-C93oOyRv.js";import"./index-CviHPZsF.js";import"./colors-DIkUhcQM.js";import"./slide-DfWuJDbJ.js";import"./CheckOutlined-BDgNr5ZU.js";import"./SearchOutlined-ARjgS9_W.js";import"./move-nlQWRDsj.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const be=ge;function j(a){for(var _=1;_<arguments.length;_++){var l=arguments[_]!=null?Object(arguments[_]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable}))),d.forEach(function(m){xe(a,m,l[m])})}return a}function xe(a,_,l){return _ in a?Object.defineProperty(a,_,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[_]=l,a}var U=function(_,l){var d=j({},_,l.attrs);return i(K,j({},d,{icon:be}),null)};U.displayName="LinkOutlined";U.inheritAttrs=!1;const $e=U,C=a=>(Q("data-v-8710a4c5"),a=a(),H(),a),Le={class:"recall-settings-box"},Oe=C(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),we={class:"form-box"},Se={class:"form-item"},Re={class:"form-item-body"},Ce={class:"form-item"},ze={class:"form-item"},qe={class:"form-item-label"},Me={class:"form-item-body"},Ne={class:"retrieval-mode-items"},Te=["onClick"],Ue={class:"retrieval-mode-title"},Be={class:"title-text"},Ie={key:0,style:{width:"32px"},src:le,alt:""},Pe={class:"retrieval-mode-desc"},Ve={class:"form-item"},Ae={class:"form-item-label"},je=C(()=>e("span",null,"Top K ",-1)),De={class:"form-item-body"},Ee={class:"number-box"},Fe={class:"number-slider-box"},Qe={class:"number-input-box"},He={key:0,class:"form-item"},Ge={class:"form-item-label"},We=C(()=>e("span",null,"相似度阈值 ",-1)),Ye={class:"form-item-body"},Ze={class:"number-box"},Je={class:"number-slider-box"},Ke={class:"number-input-box"},Xe={class:"form-item"},et={class:"form-item-label"},tt=C(()=>e("span",null,"Rerank模型",-1)),st={class:"form-item-body"},ot=["src"],nt={__name:"recall-testing-form",emits:["save","load"],setup(a,{expose:_,emit:l}){const d=F(),m=k(!1),$=l,g=k(!0),h=k([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=se({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:d.query.id}),O=oe(()=>g.value?h.value.filter(p=>p.value==t.search_type):h.value),q=(p,o)=>{t.rerank_model_config_id=o.rerank_model_config_id},M=p=>{t.search_type=p},r=()=>{if(!t.similarity)return T.error("请输入相似度");if(!t.size)return T.error("请输入分段数");if(!t.question)return T.error("请输入测试问题");let p={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(p.rerank_model_config_id=t.rerank_model_config_id),m.value=!0,$("load"),ae(p).then(o=>{$("save",o.data)}).catch(()=>{$("save",[])}).finally(()=>{m.value=!1})},N=k([]);return(()=>{re({model_type:"RERANK"}).then(p=>{let o=p.data||[];N.value=o.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})})(),_({open}),(p,o)=>{const b=de,G=X,B=E,I=ue,P=me,V=pe,W=ve,Y=fe,Z=he,J=ke;return n(),c("div",Le,[Oe,e("div",we,[e("div",Se,[e("div",Re,[i(b,{style:{height:"76px"},value:t.question,"onUpdate:value":o[0]||(o[0]=s=>t.question=s),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Ce,[i(G,{loading:m.value,onClick:r,type:"primary",block:""},{default:u(()=>[f("测试")]),_:1},8,["loading"])]),e("div",ze,[e("div",qe,[e("div",{class:"hover-label",onClick:o[1]||(o[1]=s=>g.value=!g.value)},[f(" 检索模式 "),g.value?(n(),x(L(ce),{key:0})):(n(),x(L(_e),{key:1}))])]),e("div",Me,[e("div",Ne,[(n(!0),c(S,null,R(O.value,s=>(n(),c("div",{class:ne(["retrieval-mode-item",{active:t.search_type==s.value}]),key:s.value,onClick:w=>M(s.value)},[t.search_type==s.value?(n(),x(B,{key:0,class:"check-arrow",name:"check-arrow-filled"})):y("",!0),e("div",Ue,[i(B,{name:s.iconName,class:"title-icon"},null,8,["name"]),e("span",Be,v(s.title),1),s.isRecommendation?(n(),c("img",Ie)):y("",!0)]),e("div",Pe,v(s.desc),1)],10,Te))),128))])])]),e("div",Ve,[e("div",Ae,[je,i(I,null,{title:u(()=>[f("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[i(L(A),{class:"question-icon"})]),_:1})]),e("div",De,[e("div",Ee,[e("div",Fe,[i(P,{class:"custom-slider",value:t.size,"onUpdate:value":o[2]||(o[2]=s=>t.size=s),min:1,max:10},null,8,["value"])]),e("div",Qe,[i(V,{value:t.size,"onUpdate:value":o[3]||(o[3]=s=>t.size=s),min:1,max:10},null,8,["value"])])])])]),t.search_type<=2?(n(),c("div",He,[e("div",Ge,[We,i(I,null,{title:u(()=>[f("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:u(()=>[i(L(A),{class:"question-icon"})]),_:1})]),e("div",Ye,[e("div",Ze,[e("div",Je,[i(P,{class:"custom-slider",value:t.similarity,"onUpdate:value":o[4]||(o[4]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ke,[i(V,{value:t.similarity,"onUpdate:value":o[5]||(o[5]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])])])])])):y("",!0),e("div",Xe,[e("div",et,[tt,f("   "),i(W,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":o[6]||(o[6]=s=>t.rerank_status=s)},null,8,["checked"])]),e("div",st,[i(J,{value:t.rerank_use_model,"onUpdate:value":o[7]||(o[7]=s=>t.rerank_use_model=s),placeholder:"请选择Rerank模型",onChange:q,style:{width:"320px"}},{default:u(()=>[(n(!0),c(S,null,R(N.value,s=>(n(),x(Z,{key:s.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:s.icon,alt:""},null,8,ot)])]),default:u(()=>[(n(!0),c(S,null,R(s.children,w=>(n(),x(Y,{value:w,rerank_model_config_id:s.id,key:w},{default:u(()=>[e("span",null,v(w),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},it=D(nt,[["__scopeId","data-v-8710a4c5"]]),z=a=>(Q("data-v-3baa66ae"),a=a(),H(),a),at={class:"recall-testing-box"},lt={class:"recall-from-box"},rt={class:"content-list-box"},ct={key:0,class:"empty-box"},_t=z(()=>e("img",{src:te,alt:""},null,-1)),dt=z(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),ut=[_t,dt],mt={class:"top-block"},pt={class:"title"},vt={key:0,class:"ml4"},ft={class:"info-block"},ht=z(()=>e("span",{class:"gray-text"},"来自：",-1)),kt=["onClick"],yt=z(()=>e("span",{class:"v-line"},null,-1)),gt={class:"gray-text"},bt={key:0,class:"content-box"},xt={key:1,class:"content-box"},$t=["innerHTML"],Lt={key:2,class:"loading-box"},Ot={__name:"recall-testing",setup(a){F(),ie();const _=k(!1),l=k(!1),d=k([]),m=h=>{l.value=!1,d.value=h||[]},$=()=>{l.value=!0},g=h=>{window.open(`/#/library/preview?id=${h.file_id}`)};return(h,t)=>{const O=ee,q=E,M=ye;return n(),c("div",at,[e("div",lt,[i(O,null,{default:u(()=>[i(it,{onLoad:$,onSave:m})]),_:1})]),e("div",rt,[_.value||d.value.length===0?(n(),c("div",ct,ut)):(n(),x(O,{key:1},{default:u(()=>[(n(!0),c(S,null,R(d.value,r=>(n(),c("div",{class:"list-item",key:r.id},[e("div",mt,[e("div",pt,[f(" id："+v(r.id)+" ",1),r.title?(n(),c("div",vt,v(r.title),1)):y("",!0),e("span",null,"共"+v(r.word_total)+"个字符",1)])]),e("div",ft,[ht,e("div",{class:"link-text",onClick:N=>g(r)},[i(L($e)),f(" "+v(r.file_name),1)],8,kt),yt,e("span",gt,[f("相似度： "),i(q,{name:"similarity",style:{"font-size":"16px"}}),f(" "+v(r.similarity),1)])]),r.question?(n(),c("div",bt,"Q："+v(r.question),1)):y("",!0),r.answer?(n(),c("div",xt,"A："+v(r.answer),1)):y("",!0),e("div",{class:"content-box",innerHTML:r.content},null,8,$t)]))),128))]),_:1})),l.value?(n(),c("div",Lt,[i(M)])):y("",!0)])])}}},rs=D(Ot,[["__scopeId","data-v-3baa66ae"]]);export{rs as default};
