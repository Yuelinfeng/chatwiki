import{_ as W,cH as q,e as c,B as A,c as E,H as K}from"../../index-CstSXCdU.js";import{u as Q}from"./index-CI7hNFT9.js";import{k as X,h as Y}from"./index-Bnyi_NyK.js";import{a0 as G,b as I,r as f,A as J,L as n,M as u,V as p,j as s,Q as o,u as y,X as _,P as v,F as Z,a1 as ee,Y as ae,a8 as d,a9 as te,a3 as oe,a4 as re}from"./vue-chunks-CX0PHdkT.js";import"./index-C4FMmkgb.js";import{R as se,_ as le}from"./RadioButton-DFertNr3.js";import{_ as ne}from"./index-mgtqK7H6.js";import{I as ie}from"./Input-CCZkwFQT.js";import{_ as ce,F as ue}from"./index-L1GceNF2.js";import{S as _e,_ as de}from"./index-DTk_Cj8_.js";const pe=r=>(oe("data-v-d643dddd"),r=r(),re(),r),me={class:"share-form-body"},fe={class:"share-url-box",style:{width:"100",overflow:"hidden"}},ye={key:0,target:"_blank",href:"/#/user/domain"},ve={key:0,class:"form-box-bottom"},he=pe(()=>p("span",null,"复制链接",-1)),be={__name:"share-form",props:{baseUrl:{type:String,default:"/open/doc"},hideCopy:{type:Boolean,default:!1},layout:{type:String,default:"horizontal"},labelCol:{type:Object,default:()=>{}},wrapperCol:{type:Object,default:()=>{}},libraryId:{type:[Number,String],default:""},libraryKey:{type:String,default:""}},emits:["success"],setup(r,{expose:L,emit:B}){const R=B,{operate_rights:m}=q(),F=r,{toClipboard:N}=Q(),U=G(),V=I(()=>U.query.library_id),h=f(""),b=f(null),a=J({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""}),g=I(()=>F.baseUrl+"/"+h.value),j=async()=>{try{const e=await Y({id:V.value});Object.assign(a,e.data)}catch(e){c.error("获取数据失败"),console.error("获取知识库信息失败:",e)}},i=f([]),D=()=>{K().then(e=>{i.value=e.data||[],a.share_url||(i.value.length>0?a.share_url=i.value[0].url:a.share_url=window.location.origin)})},k=async()=>{a.share_url||c.error("请选择自定义域名");let e=a.share_url+g.value;try{await N(e),c.success("复制成功")}catch{c.error("复制失败")}},w=async()=>{let e={...te(a)};delete e.library_key,e.avatar_file?(e.avatar=e.avatar_file,delete e.avatar_file):(delete e.avatar,delete e.avatar_file);try{let t=await X(e);R("success",t)}catch{}};return L({init:async e=>{try{h.value=e.doc_key,await j(),D()}catch{}}}),(e,t)=>{const C=se,O=le,S=ce,P=_e,$=de,z=ie,H=ne,x=A,M=ue,T=E;return n(),u("div",{class:"share-form",ref_key:"formWrapRef",ref:b},[p("div",me,[s(M,{model:a,layout:r.layout,"label-col":r.labelCol,"wrapper-col":r.wrapperCol,autocomplete:"off"},{default:o(()=>[s(S,{label:"访问权限"},{default:o(()=>[s(O,{value:a.access_rights,"onUpdate:value":t[0]||(t[0]=l=>a.access_rights=l),onChange:w,disabled:y(m)==2},{default:o(()=>[s(C,{value:"0"},{default:o(()=>[_("私有，仅能与应用关联，作为应用知识库")]),_:1}),s(C,{value:"1"},{default:o(()=>[_("公开，发布到互联网，所有人可访问")]),_:1})]),_:1},8,["value","disabled"])]),_:1}),a.access_rights==1?(n(),v(S,{key:0,label:"分享链接"},{default:o(()=>[p("div",fe,[s(H,{compact:""},{default:o(()=>[s($,{style:{width:"50%"},value:a.share_url,"onUpdate:value":t[1]||(t[1]=l=>a.share_url=l),placeholder:"请选择自定义域名",getPopupContainer:()=>b.value,onChange:w,disabled:y(m)==2},{default:o(()=>[(n(!0),u(Z,null,ee(i.value,l=>(n(),v(P,{value:l.url,key:l.id},{default:o(()=>[_(ae(l.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","getPopupContainer","disabled"]),s(z,{disabled:!0,value:g.value,style:{width:"50%"}},null,8,["value"])]),_:1}),r.hideCopy?d("",!0):(n(),v(x,{key:0,class:"copy-btn",onClick:t[2]||(t[2]=l=>k())},{default:o(()=>[_("复制")]),_:1}))]),p("div",null,[y(m)==4?(n(),u("a",ye,"添加自定义域名")):d("",!0)])]),_:1})):d("",!0)]),_:1},8,["model","layout","label-col","wrapper-col"])]),r.hideCopy?(n(),u("div",ve,[s(x,{type:"primary",ghost:"",onClick:t[3]||(t[3]=l=>k())},{default:o(()=>[s(T,{name:"link-left",style:{"font-size":"16px",color:"#2475fc","margin-right":"4px"}}),he]),_:1})])):d("",!0)],512)}}},Ne=W(be,[["__scopeId","data-v-d643dddd"]]);export{Ne as S};
