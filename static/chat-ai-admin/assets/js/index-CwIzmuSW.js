import{L as k,M as L,V as a,j as o,u as w,F as Q,a1 as K,Y as x,a7 as A,Q as c,a3 as S,a4 as B,$ as T,r as C,b as W,A as q,v as X,P as Z,U as F}from"./vue-chunks-C0QQWOCx.js";import{_ as $,e as I,bs as E,bv as O,M as R,cH as ee,bu as te,E as ae}from"../../index-0jhxEUZS.js";import{_ as oe,M as re}from"./index-E5vI2LlI.js";import"./index-D1sUEdFa.js";import{D as se}from"./dropdown-CSJoU83q.js";import{P as ne}from"./PlusCircleOutlined-CmawT0Ht.js";import{M as ie}from"./MoreOutlined-PxSKOnuq.js";import{c as le,g as de,d as _e}from"./index-CPg8-A7z.js";import{t as ce}from"./validate-8MtiUsxW.js";import{A as pe}from"./avatar-input-BqULmLuO.js";import{F as M,_ as me}from"./index-CRVpDJ1f.js";import"./index-DLXS2gFD.js";import{I as ue}from"./Input-C2joc_0K.js";import{_ as fe}from"./TextArea-4ibeqG6S.js";import"./axios-Cm0UX6qg.js";import"./qs-CnxcMLjH.js";import"./crypto-js-C2SrYqGA.js";import"./dayjs-CsGPDCY7.js";import"./shallowequal-Fk1l6xhN.js";import"./colors-mU-75_cq.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-BOXZQl9Y.js";import"./slide-Dj1hvy3q.js";import"./index-Di6HYDsH.js";import"./index-DMH-zawU.js";import"./Dropdown-C9U2MQYn.js";import"./RightOutlined-kK29_F6f.js";import"./move-Cr4SzyVA.js";import"./PlusOutlined-CgwfTcid.js";import"./index-CzVWingc.js";import"./partition-Cp0_1Ufx.js";import"./Password-D0V1lqaH.js";import"./inputProps-DKMe6fry.js";import"./CheckOutlined-DjzOOMrf.js";import"./useRefs-DDwzsqEq.js";import"./FormItemContext-BtHm9ijx.js";import"./isPlainObject-DgCxKo0N.js";import"./responsiveObserve-Cvd8WiWW.js";import"./QuestionCircleOutlined-BDfA4Qtk.js";import"./index-CIBVllRY.js";import"./Search-IP_DCQEs.js";import"./SearchOutlined-BPrf0z-8.js";import"./statusUtils-BN1jNO5O.js";const U=l=>(S("data-v-6b03284a"),l=l(),B(),l),ye={class:"list-box"},ve={class:"list-item-wrapper"},be=U(()=>a("span",{class:"add-library-text"},"新增对外知识库",-1)),he=["onClick"],ge={class:"item-header"},ke=["src"],xe={class:"library-title"},Ae=["onClick"],Le=["onClick"],we={class:"item-body"},Ce=U(()=>a("div",{class:"library-type"},[a("span",{class:"type-tag"},"对外知识库")],-1)),De={class:"library-desc"},Ie={class:"library-size"},$e={class:"file-size"},qe={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup(l,{emit:h}){const u=h,p=l,m=d=>{u("edit",d)},f=d=>{u("add",d)},v=d=>{u("delete",d)};return(d,_)=>{const r=oe,e=re,i=se;return k(),L("div",ye,[a("div",ve,[a("div",{class:"list-item add-library",onClick:f},[o(w(ne),{class:"add-library-icon"}),be])]),(k(!0),L(Q,null,K(p.list,s=>(k(),L("div",{class:"list-item-wrapper",key:s.id},[a("div",{class:"list-item",onClick:A(g=>m(s),["stop"])},[a("div",ge,[a("img",{class:"library-icon",src:s.avatar,alt:""},null,8,ke),a("div",xe,x(s.library_name),1),a("span",{class:"item-action",onClick:_[1]||(_[1]=A(()=>{},["stop"]))},[o(i,null,{overlay:c(()=>[o(e,null,{default:c(()=>[o(r,null,{default:c(()=>[a("a",{href:"javascript:;",onClick:A(g=>m(s),["stop"])},"管 理",8,Ae)]),_:2},1024),o(r,null,{default:c(()=>[a("a",{class:"delete-text-color",href:"javascript:;",onClick:g=>v(s)},"删 除",8,Le)]),_:2},1024)]),_:2},1024)]),default:c(()=>[a("span",{class:"menu-btn",onClick:_[0]||(_[0]=A(()=>{},["prevent"]))},[o(w(ie))])]),_:2},1024)])]),a("div",we,[Ce,a("div",De,x(s.library_intro),1)]),a("div",Ie,[a("span",null,"文档数："+x(s.file_total),1),a("span",$e,"文档大小："+x(s.file_size_str),1)])],8,he)]))),128))])}}},Fe=$(qe,[["__scopeId","data-v-6b03284a"]]),Me=l=>(S("data-v-9111c66d"),l=l(),B(),l),Se={class:"form-box"},Be=Me(()=>a("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1)),Te={__name:"add-library-model",setup(l,{expose:h}){I.config({duration:2});const u=T(),p=C(!1),m=W(()=>1);let f="",v="";const d=M.useForm,_=C(!1),r=m.value==0?E:O,e=q({type:m.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:r,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:m.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),i=q({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:s,validateInfos:g}=d(e,i),N=t=>{e.avatar=t.imageUrl,e.avatar_file=t.file},P=()=>{p.value=!1},z=()=>{s().then(()=>{V()}).catch(t=>{})},V=()=>{let t=new FormData,n=JSON.parse(JSON.stringify(e));t.append("type",e.type),t.append("access_rights",e.access_rights),t.append("library_name",e.library_name),t.append("library_intro",e.library_intro),t.append("use_model",n.use_model),t.append("model_config_id",e.model_config_id),t.append("avatar",e.avatar_file?e.avatar_file:""),t.append("is_offline",e.is_offline),t.append("urls",JSON.stringify(ce(e.urls))),t.append("doc_type",e.doc_type),t.append("file_name",e.file_name),t.append("is_qa_doc",e.is_qa_doc),t.append("qa_index_type",e.qa_index_type),t.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),_.value=!0,le(t).then(b=>{I.success("创建成功"),v=b.data.id,f=b.data.library_key,J(b.data.id)}).catch(()=>{_.value=!1})},j=async()=>await ee({library_key:f,doc_id:"",doc_type:"4",pid:0,title:"无标题文档",content:"# 无标题文档",sort:0}),J=()=>{j().then(t=>{let n=t.data.doc_id;u.replace({path:"/public-library/editor",query:{library_id:v,library_key:f,doc_id:n}})})};return h({show:()=>{p.value=!0}}),X(()=>{}),(t,n)=>{const b=ue,D=me,Y=fe,H=M,G=R;return k(),Z(G,{open:p.value,"onUpdate:open":n[3]||(n[3]=y=>p.value=y),title:"添加知识库",onOk:z,confirmLoading:_.value,onCancel:P,width:"640px"},{default:c(()=>[a("div",Se,[o(H,{"label-col":{span:5}},{default:c(()=>[o(D,F({ref:"name",label:"知识库名称"},w(g).library_name),{default:c(()=>[o(b,{value:e.library_name,"onUpdate:value":n[0]||(n[0]=y=>e.library_name=y),type:"text",placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),o(D,{label:"知识库简介"},{default:c(()=>[o(Y,{maxlength:1e3,value:e.library_intro,"onUpdate:value":n[1]||(n[1]=y=>e.library_intro=y),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),o(D,F({ref:"name",label:"知识库封面"},w(g).avatar),{default:c(()=>[o(pe,{value:e.avatar,"onUpdate:value":n[2]||(n[2]=y=>e.avatar=y),onChange:N},null,8,["value"]),Be]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Ee=$(Te,[["__scopeId","data-v-9111c66d"]]),Oe={"bg-color":"#f5f9ff",class:"library-page"},Re={class:"library-page-body"},Ue={__name:"index",setup(l){const h=T(),u=C(null),p=C([]),m=()=>{de({type:1}).then(r=>{let e=r.data||[];e.forEach(i=>{i.file_size_str=te(i.file_size),i.avatar||(i.avatar=i.type==0?E:O)}),p.value=e})};m();const f=()=>{u.value.show()},v=r=>{h.push({path:"/public-library/home",query:{library_id:r.id,library_key:r.library_key}})},d=r=>{let e=3,i=R.confirm({title:`删除${r.library_name}`,icon:o(ae),content:"您确定要删除此知识库吗？",okText:e+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){_(r)},onCancel(){}}),s=setInterval(()=>{e==1?(i.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(s),s=void 0):(e-=1,i.update({okText:e+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},_=({id:r})=>{_e({id:r}).then(()=>{I.success("删除成功"),m()})};return(r,e)=>(k(),L("div",Oe,[a("div",Re,[a("div",null,[o(Fe,{list:p.value,onAdd:f,onEdit:v,onDelete:d},null,8,["list"])])]),o(Ee,{ref_key:"addLibraryModelRef",ref:u},null,512)]))}},qt=$(Ue,[["__scopeId","data-v-ff9f7fd5"]]);export{qt as default};
