import{M as a,N as m,W as o,k as e,S as n,u as H,a1 as ve,a2 as me,ai as Ae,Y as w,Z as R,F as V,$ as G,Q as F,a7 as D,a0 as Le,G as Ue,a5 as ze,e as f,b as K,B as Be,x as Ve,z as fe,X as yt,a4 as bt,a8 as kt}from"./vue-chunks-DWnFCQSz.js";import{V as Me}from"./vue-pdf-embed-CTnPXFvH.js";import{a as xt,_ as St,T as wt}from"./empty-CqLsGxfj.js";import{b as J,B as He,L as $t,E as pe,M as se,k as U,d as qt,f as Pt}from"../../index-CAb1tT-W.js";import{P as je}from"./PlusOutlined-lz80p0a0.js";import{q as Qe,t as Et,o as It,u as Re,b as Ot,v as Ct,w as Lt}from"./index-CYunvooy.js";import{_ as Ne,M as Ke}from"./index-Zgzt-QK_.js";import"./index-DtmDjxy7.js";import{D as Ge}from"./dropdown-ClFVyE-h.js";import{S as Mt}from"./SyncOutlined-bGlLIyzb.js";import{M as Rt}from"./MoreOutlined-CKjdxT_M.js";import{_ as he}from"./index-DgLE2dBi.js";import{C as oe}from"./cu-scroll-DUEEhpqe.js";import{U as Ft}from"./index-COYYh7hS.js";import"./index-ZqzVpCxK.js";import{I as Dt}from"./Input-DuH7dn02.js";import{_ as Tt}from"./TextArea-CYqPccpO.js";import{_ as At,F as Ut}from"./index-BwLqZyOz.js";import{S as We,_ as Je}from"./index-dibcP1Tn.js";import{R as zt}from"./rename-modal-DVySX-Ss.js";import{S as Ze}from"./index-BgOt2FQs.js";import{B as Bt,_ as Vt}from"./index-DGOYM_c-.js";import{_ as Ht}from"./index-yx9HMCrG.js";import{_ as jt,a as Qt}from"./RadioButton-DeoXmEag.js";import{L as Nt}from"./LeftOutlined-EAYnSsOS.js";import{D as Kt}from"./DownOutlined-DeYc9KSb.js";import{_ as Gt}from"./index-_2Ia2fBW.js";import"./Dropdown-DKZymAyI.js";import"./Trigger-JKklW7kX.js";import"./index-B3zCNJkU.js";import"./useRefs-CH9tJ50T.js";import"./pick-DXKUorQm.js";import"./CheckOutlined-BDgNr5ZU.js";import"./slide-DfWuJDbJ.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-DzhuYAPB.js";import"./shallowequal-C0Ji8tJB.js";import"./collapseMotion-DNnsVK8G.js";import"./RightOutlined-BUprEUSn.js";import"./move-nlQWRDsj.js";import"./colors-DIkUhcQM.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-913wQHBS.js";import"./Password-CS7ye1e2.js";import"./inputProps-C93oOyRv.js";import"./index-DZQM5j1J.js";import"./partition-DzvwyHlm.js";import"./FormItemContext-8D78_qVD.js";import"./index-CviHPZsF.js";import"./Search-DXRfWhTX.js";import"./SearchOutlined-ARjgS9_W.js";import"./isPlainObject-BZk97rKt.js";import"./statusUtils-DZGhn0Kh.js";import"./responsiveObserve-9b93vBMn.js";import"./QuestionCircleOutlined-OoMpIVY2.js";import"./Checkbox-CQjSeTte.js";const ge=t=>(ve("data-v-8eb7d862"),t=t(),me(),t),Wt={class:"empty-box"},Jt=ge(()=>o("img",{src:xt,alt:""},null,-1)),Zt=ge(()=>o("div",{class:"title"},"知识库文档为空，请添加分段",-1)),Xt=ge(()=>o("span",null,"添加分段",-1)),Yt={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(t,{emit:u}){const i=u,b=()=>{i("openEditSubscription",{})};return(p,q)=>{const r=He;return a(),m("div",Wt,[Jt,Zt,o("div",null,[e(r,{type:"primary",onClick:b},{icon:n(()=>[e(H(je))]),default:n(()=>[Xt]),_:1})])])}}},Fe=J(Yt,[["__scopeId","data-v-8eb7d862"]]),en={class:"subsection-box"},tn={class:"subsection-box-title"},nn=["onClick"],on={class:"top-block"},sn={class:"title"},ln={class:"title-block"},an={class:"cfb363f"},rn={class:"cfb363f"},un={class:"right-opration"},cn=["onClick"],dn=["onClick"],_n={key:0,class:"content-box"},pn={key:1,class:"content-box"},fn=["innerHTML"],vn={class:"fragment-img"},mn=["src"],hn={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert"],setup(t,{expose:u,emit:i}){const b=i,p=t,q=(S,y)=>{let{id:k,title:c,content:I,question:E,answer:T,images:s}=S;se.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${y+1}】吗?`,onOk(){return new Promise((g,v)=>{Qe({id:k,title:c,content:I,question:E,answer:T,images:s}).then(P=>{b("handleConvert",S),g()}).catch(()=>{g()})})},onCancel(){}})},r=S=>{b("openEditSubscription",S)},O=S=>{se.confirm({title:"提示",icon:e(pe),content:"确认是否删除该分段?",onOk(){return new Promise((y,k)=>{Et({id:S}).then(c=>{U.success("删除成功"),b("handleDelParagraph",S),y()}).catch(()=>{y()})})},onCancel(){}})},C=(S,y)=>{b("handleScrollTargetPage",{page_num:S.page_num,index:y})};return u({handleOpenEditModal:r}),(S,y)=>{const k=he,c=Ne,I=Ke,E=Ge,T=Ae("viewer");return a(),m("div",en,[o("div",tn,[w(" 分段预览 "),o("span",null,"共"+R(p.total)+"个分段",1)]),(a(!0),m(V,null,G(p.paragraphLists,(s,g)=>(a(),m("div",{class:"list-item",key:s.id,onClick:v=>C(s,g)},[o("div",on,[o("div",sn,[w(" 分段"+R(g+1)+" ",1),o("div",ln,R(s.title),1),o("span",null,"共"+R(s.word_total)+"个字符",1),o("span",null,[w(" 嵌入状态："+R(s.status_text),1),s.status==3?(a(),F(H($t),{key:0})):D("",!0),s.status==2&&s.errmsg?(a(),F(k,{key:1,title:s.errmsg},{default:n(()=>[o("strong",an,[w("原因"),e(H(pe),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):D("",!0)]),o("span",null,[w(" 知识图谱状态："+R(s.graph_status_text)+" ",1),s.graph_status==3&&s.graph_err_msg?(a(),F(k,{key:0,title:s.graph_err_msg},{default:n(()=>[o("strong",rn,[w("原因"),e(H(pe),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):D("",!0)])]),o("div",un,[e(k,null,{title:n(()=>[w("重新转换")]),default:n(()=>[e(H(Mt),{onClick:v=>q(s,g)},null,8,["onClick"])]),_:2},1024),e(E,{placement:"bottomRight"},{overlay:n(()=>[e(I,null,{default:n(()=>[e(c,null,{default:n(()=>[o("div",{onClick:Le(v=>r(s),["stop"])},"编辑",8,cn)]),_:2},1024),e(c,null,{default:n(()=>[o("div",{onClick:Le(v=>O(s.id),["stop"])},"删除",8,dn)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e(H(Rt))]),_:2},1024)])]),s.question?(a(),m("div",_n,"Q："+R(s.question),1)):D("",!0),s.answer?(a(),m("div",pn,"A："+R(s.answer),1)):D("",!0),o("div",{class:"content-box",innerHTML:s.content},null,8,fn),Ue((a(),m("div",vn,[(a(!0),m(V,null,G(s.images,(v,P)=>(a(),m("img",{key:P,src:v,alt:""},null,8,mn))),128))])),[[T]])],8,nn))),128))])}}},De=J(hn,[["__scopeId","data-v-94b07ae8"]]);var $={},ye;Object.defineProperty($,"__esModule",{value:!0});$.controlDefaultValue=$.capitalize=$.camelize=$.cacheStringFunction=void 0;$.getDataAndAriaProps=Pn;$.isSymbol=$.isString=$.isOn=$.isObject=$.isFunction=ye=$.isArray=$.hyphenate=void 0;$.renderHelper=In;$.resolvePropValue=qn;$.toPx=En;$.wrapPromiseFn=On;const Xe=t=>typeof t=="function";$.isFunction=Xe;$.controlDefaultValue=Symbol("controlDefaultValue");ye=$.isArray=Array.isArray;const gn=t=>typeof t=="string";$.isString=gn;const yn=t=>typeof t=="symbol";$.isSymbol=yn;const bn=t=>t!==null&&typeof t=="object";$.isObject=bn;const kn=/^on[^a-z]/,xn=t=>kn.test(t);$.isOn=xn;const le=t=>{const u=Object.create(null);return i=>u[i]||(u[i]=t(i))};$.cacheStringFunction=le;const Sn=/-(\w)/g;$.camelize=le(t=>t.replace(Sn,(u,i)=>i?i.toUpperCase():""));const wn=/\B([A-Z])/g;$.hyphenate=le(t=>t.replace(wn,"-$1").toLowerCase());$.capitalize=le(t=>t.charAt(0).toUpperCase()+t.slice(1));const $n=Object.prototype.hasOwnProperty,Te=(t,u)=>$n.call(t,u);function qn(t,u,i,b){const p=t[i];if(p!=null){const q=Te(p,"default");if(q&&b===void 0){const r=p.default;b=p.type!==Function&&Xe(r)?r():r}p.type===Boolean&&(!Te(u,i)&&!q?b=!1:b===""&&(b=!0))}return b}function Pn(t){return Object.keys(t).reduce((u,i)=>((i.startsWith("data-")||i.startsWith("aria-"))&&(u[i]=t[i]),u),{})}function En(t){return typeof t=="number"?`${t}px`:t}function In(t){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return typeof t=="function"?t(u):t??i}function On(t){let u;const i=new Promise(p=>{u=t(()=>{p(!0)})}),b=()=>{u==null||u()};return b.then=(p,q)=>i.then(p,q),b.promise=i,b}const Y=t=>(ve("data-v-8657487d"),t=t(),me(),t),Cn={class:"form-box-wrapper"},Ln={class:"form-item"},Mn=Y(()=>o("div",{class:"form-label"},"分段标题：",-1)),Rn={class:"form-content"},Fn={class:"form-item"},Dn=Y(()=>o("div",{class:"form-label required"},"分段问题：",-1)),Tn={class:"form-content"},An={class:"form-item"},Un=Y(()=>o("div",{class:"form-label required"},"分段答案：",-1)),zn={class:"form-content"},Bn={key:0,class:"error-tip"},Vn={key:1,class:"form-item"},Hn=Y(()=>o("div",{class:"form-label required"},"分段内容：",-1)),jn={class:"form-content"},Qn={key:0,class:"error-tip"},Nn={class:"form-item"},Kn=Y(()=>o("div",{class:"form-label"},"附件",-1)),Gn={class:"form-content"},Wn={class:"upload-box-wrapper"},Jn={key:0},Zn={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(t,{expose:u,emit:i}){const b=ze(),p=t,q=i,r=f("1"),O=f(!1),C=f(""),S=f(""),y=f(""),k=f(""),c=f([]),I=f(""),E=f(!1),T=g=>{C.value=g.title||"",S.value=g.content||"",I.value=g.id||"",y.value=g.answer||"",c.value=g.images||[],k.value=g.question||"",E.value=p.detailsInfo.is_qa_doc=="1",O.value=!0},s=()=>{if(!S.value&&!E.value)return U.error("请输入分段内容");if(!k.value&&E.value)return U.error("请输入分段问题");if(!y.value&&E.value)return U.error("请输入分段答案");if(E.value&&y.value.length>1e4||!E.value&&S.value.length>1e4)return;let g={title:C.value,content:S.value,question:k.value,answer:y.value,images:c.value};I.value?g.id=I.value:g.file_id=b.query.id;let v=new FormData;for(let P in g)ye(g[P])?g[P].forEach(B=>{v.append(P,B)}):v.append(P,g[P]);Qe(v).then(P=>{U.success(g.id?"修改成功":"添加成功"),O.value=!1,q("handleEdit",{...g})})};return u({showModal:T}),(g,v)=>{const P=Dt,B=Tt,Z=qt,ke=St,Q=wt,ae=se;return a(),m("div",null,[e(ae,{open:O.value,"onUpdate:open":v[6]||(v[6]=d=>O.value=d),title:"编辑分段",onOk:s,width:"746px"},{default:n(()=>[o("div",Cn,[o("div",Ln,[Mn,o("div",Rn,[e(P,{maxLength:25,value:C.value,"onUpdate:value":v[0]||(v[0]=d=>C.value=d),placeholder:"请输入分段标题"},null,8,["value"])])]),E.value?(a(),m(V,{key:0},[o("div",Fn,[Dn,o("div",Tn,[e(B,{placeholder:"请输入分段问题",value:k.value,"onUpdate:value":v[1]||(v[1]=d=>k.value=d),style:{height:"100px"}},null,8,["value"])])]),o("div",An,[Un,o("div",zn,[e(B,{placeholder:"请输入分段答案",value:y.value,"onUpdate:value":v[2]||(v[2]=d=>y.value=d),style:{height:"150px"}},null,8,["value"]),y.value.length>1e4?(a(),m("div",Bn,"分段答案最多支持10000个字符")):D("",!0)])])],64)):(a(),m("div",Vn,[Hn,o("div",jn,[e(B,{style:{height:"150px"},value:S.value,"onUpdate:value":v[3]||(v[3]=d=>S.value=d),placeholder:"请输入分段内容"},null,8,["value"]),S.value.length>1e4?(a(),m("div",Qn,"分段内容最多支持10000个字符")):D("",!0)])])),o("div",Nn,[Kn,o("div",Gn,[o("div",Wn,[e(Q,{activeKey:r.value,"onUpdate:activeKey":v[4]||(v[4]=d=>r.value=d),size:"small"},{default:n(()=>[e(ke,{key:"1"},{tab:n(()=>[o("span",null,[e(Z,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),w(" 图片 "),c.value.length?(a(),m("span",Jn,"("+R(c.value.length)+")",1)):D("",!0)])]),_:1})]),_:1},8,["activeKey"]),e(Ft,{value:c.value,"onUpdate:value":v[5]||(v[5]=d=>c.value=d)},null,8,["value"])])])])])]),_:1},8,["open"])])}}},Xn=J(Zn,[["__scopeId","data-v-8657487d"]]),Yn={class:"mode-box"},eo=["innerHTML"],to={class:"tag-item"},no={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(t){const u=t,i=f(""),b=K(()=>{const{is_table_file:p,is_qa_doc:q,is_diy_split:r,question_lable:O,answer_lable:C,separators:S,chunk_size:y,chunk_overlap:k,question_column:c,answer_column:I,qa_index_type:E,doc_type:T}=u.detailsInfo;if(p!=1&&q!=1&&r!=1)return T==3?(i.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(i.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(p!=1&&q==1)return T==3?(i.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(i.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${O}"
答案开始标识符："${C}"`,"智能分段：QA文档");if(p!=1&&q!=1&&r==1)return i.value=`分段模式：自定义分段
文档标识符：${S}
分段最大长度：${y}字符
文段重叠长度：${k}字符`,"自定义分段";if(p==1&&q!=1)return i.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(p==1&&q==1){let s=E==1?"问题与答案一起生成索引":"仅对问题生成索引";return i.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${c}"
答案所在列："${I}"
索引方式：${s}`,"智能分段：QA文档"}});return(p,q)=>{const r=he;return a(),m("div",Yn,[e(r,null,{title:n(()=>[o("div",{class:"tooltip-text-box",innerHTML:i.value},null,8,eo)]),default:n(()=>[o("div",to,R(b.value),1)]),_:1})])}}},oo=J(no,[["__scopeId","data-v-e8649c10"]]),so={__name:"update-frequency",emits:["ok"],setup(t,{expose:u,emit:i}){const b=i,p=f(!1),q=f(!1),r=Be({doc_auto_renew_frequency:1,id:""}),O=S=>{let{doc_auto_renew_frequency:y,id:k}=S;r.doc_auto_renew_frequency=+y,r.id=k,p.value=!0},C=()=>{q.value=!0,It({...r}).then(S=>{b("ok",r.doc_auto_renew_frequency),p.value=!1,U.success("设置成功")}).finally(()=>{q.value=!1})};return u({open:O}),(S,y)=>{const k=We,c=Je,I=At,E=Ut,T=se;return a(),m("div",null,[e(T,{open:p.value,"onUpdate:open":y[1]||(y[1]=s=>p.value=s),"confirm-loading":q.value,maskClosable:!1,title:"设置更新频率",onOk:C},{default:n(()=>[e(E,{style:{margin:"32px 0"},layout:"vertical",model:r},{default:n(()=>[e(I,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:n(()=>[e(c,{value:r.doc_auto_renew_frequency,"onUpdate:value":y[0]||(y[0]=s=>r.doc_auto_renew_frequency=s),style:{width:"100%"}},{default:n(()=>[e(k,{value:1},{default:n(()=>[w("不自动更新")]),_:1}),e(k,{value:2},{default:n(()=>[w("每天")]),_:1}),e(k,{value:3},{default:n(()=>[w("每3天")]),_:1}),e(k,{value:4},{default:n(()=>[w("每7天")]),_:1}),e(k,{value:5},{default:n(()=>[w("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},lo={class:"loading"},ao={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered"],setup(t,{expose:u,emit:i}){const b=t,p=i,q=f(null),r=f([]),O=f(0),C=f(!1),S=K(()=>C.value?null:{"border-bottom":"2px solid #d9d9d9"}),y=f({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});Ve(async()=>{const s=await Me.getDocument(b.source).promise;O.value=s.numPages,k()});const k=(s=null)=>{const g=r.value.length;if(g>=O.value||C.value)return;C.value=!0;const v=[];for(let P=1;P<=b.pageSize&&g+P<=O.value;P++)v.push(g+P);r.value.push(...v),fe(()=>{typeof s=="function"&&s()})},c=s=>{k(),p("onScrollEnd",s)},I=s=>{fe(()=>{s===r.value[r.value.length-1]&&(C.value=!1,p("rendered",s,O.value))})},E=s=>{p("select",s)};return u({loadMore:k,getScrollInstance:()=>q.value}),(s,g)=>{const v=Ze;return a(),F(oe,{scrollbar:y.value,ref_key:"scrollRef",ref:q,onOnScrollEnd:c},{default:n(()=>[(a(!0),m(V,null,G(r.value,P=>(a(),F(H(Me),{onClick:B=>E(P),key:P,source:t.source,page:P,onRendered:()=>I(P),style:yt(S.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),o("div",lo,[C.value?(a(),F(v,{key:0})):D("",!0)])]),_:1},8,["scrollbar"])}}},ro=J(ao,[["__scopeId","data-v-8337235e"]]),be=t=>(ve("data-v-0b3ad808"),t=t(),me(),t),io={class:"library-preview-page"},uo={class:"breadcrumb-block"},co={class:"document-title-block"},_o={class:"title"},po=be(()=>o("span",null,"嵌入状态：",-1)),fo=be(()=>o("span",null,"知识图谱状态：",-1)),vo=be(()=>o("span",null,"添加分段",-1)),mo={key:0,class:"page-loading-box"},ho={class:"content-block"},go={key:1,class:"pdf-view-box"},yo={class:"view-content-wrap"},bo={key:0,class:"pdf-mode-switch"},ko={class:"view-content-box",style:{"padding-top":"60px"}},xo=["onClick"],So={key:0,class:"content-box"},wo={key:1,class:"content-box"},$o=["innerHTML"],qo={class:"fragment-img"},Po=["src"],Eo={class:"right-contnt-box"},Io={class:"content-block"},Oo={__name:"library-preview",setup(t){const u=f(null),i=f(0),b=f(0),p={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},q=f({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),r=ze(),O=bt(),C=Pt(),S=K(()=>c.value.is_table_file=="1"),y=K(()=>c.value.doc_type),k=K(()=>{let l=c.value.status;return!(l=="1"||l=="2")||d.value.length==0});K(()=>c.value.status);const c=f({}),I=Be({status:-1,graph_status:-1}),E=f(1),T=K(()=>"/manage/getLibRawFile?id="+r.query.id+"&token="+C.getToken);Ve(()=>{r.query.graph_status&&(I.graph_status=r.query.graph_status,ue())});const s=()=>{O.back()},g=f(null),v=f(null);let P=-1;const B=(l,_=1)=>{let h,x;_==1?(h=".subsection-box .list-item",x=v.value):(h=".view-content-box .list-item",x=g.value);const A=document.querySelectorAll(h)[l];A.classList.add("flash-border"),P>=0&&document.querySelectorAll(h)[P].classList.remove("flash-border"),setTimeout(()=>{P=-1,A.classList.remove("flash-border")},2500),P=l,x.scrollToElement({el:A,time:1e3})},Z=f(!0);(async()=>{Ot({id:r.query.id}).then(l=>{c.value=l.data;let _=l.data.status;_==1||_==2?te():Z.value=!1})})();const Q=f({page:1,size:10}),ae=f({}),d=f([]),N=f(0),re={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."};let ie=!0;const ue=()=>{Q.value.page=1,N.value=0,d.value=[],te()},ee=(l=null)=>{Q.value.page++,te(l)},te=(l=null)=>{ie=!0,Re({file_id:r.query.id,...Q.value,...I}).then(_=>{var z,L;Z.value=!1,ie=!1;let h=_.data,x=h.list||[],A=((z=h.info)==null?void 0:z.is_qa_doc)=="1"&&((L=h.info)==null?void 0:L.is_table_file)=="1";x.forEach(j=>{j.status_text=re[j.status],j.graph_status_text=p[j.graph_status],j.isExcelQa=A}),ae.value=h.info,Q.value.page==1&&(d.value=[]),d.value=[...d.value,...x],N.value=h.total,typeof l=="function"&&l()})},ce=()=>{ie||d.value.length>=N.value||(ee(),u.value&&u.value.loadMore())},xe=()=>{Se()};let de=null;function Ye(){clearInterval(de),d.value.filter(_=>_.status==3).length?de=setInterval(()=>{Se()},5e3):clearInterval(de)}const Se=()=>{Re({file_id:r.query.id,page:1,size:d.value.length,...I}).then(l=>{var A,z;let _=l.data,h=_.list||[],x=((A=_.info)==null?void 0:A.is_qa_doc)=="1"&&((z=_.info)==null?void 0:z.is_table_file)=="1";h.forEach(L=>{L.status_text=re[L.status],L.graph_status_text=p[L.graph_status],L.isExcelQa=x}),d.value=h,Ye()})},et=l=>{if(!l.id){Q.value.page=1,te();return}let _=d.value,h=_.findIndex(x=>x.id==l.id);if(h>-1){let x=_[h];x.title=l.title,x.content=l.content,x.question=l.question,x.answer=l.answer,x.answer=l.answer,x.images=l.images,x.word_total=l.question.length+l.answer.length+l.content.length,_.splice(h,1,x),d.value=_}},we=l=>{let _=d.value,h=_.findIndex(x=>x.id==l);h>-1&&(_.splice(h,1),d.value=_,N.value=N.value--)};f(!0);const $e=f(null),X=l=>{$e.value.showModal(JSON.parse(JSON.stringify(l)))},qe=f(null),tt=()=>{Ct({id:r.query.id}).then(()=>U.success("操作完成"))},nt=()=>{Lt({id:r.query.id}).then(()=>U.success("操作完成"))},Pe=f(null),ot=()=>{Pe.value.show(c.value)},st=()=>{O.push("/library/document-segmentation?document_id="+r.query.id+"&source=preview")},lt=()=>{qe.value.open({id:r.query.id,doc_auto_renew_frequency:c.value.doc_auto_renew_frequency})},at=l=>{c.value.doc_auto_renew_frequency=l},rt=l=>{c.value.file_name=l},it=l=>{const _=()=>{for(let h in d.value)if(d.value[h].page_num==l){B(h);return}};if(l>d.value[d.value.length-1].page_num){U.warning("分段数据正在加载，请稍后...");const h=()=>{l<=d.value[d.value.length-1].page_num?(U.success("加载完成"),fe(()=>{_()})):ee(h)};ee(h)}else _()},ut=(l,_)=>{b.value=_,i.value=l,d.value[d.value.length-1].page_num<l&&ee()},ct=l=>{var _;if(((_=c.value)==null?void 0:_.file_ext)=="pdf"&&E.value==1){const h=l.page_num-1,x=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[h],A=()=>{const L=x();L.classList.add("flash-border"),setTimeout(()=>L.classList.remove("flash-border"),2500),u.value.getScrollInstance().scrollToElement({el:L,time:1e3})};if(x())A();else{U.warning("PDF正在加载，请稍后...");const L=()=>{x()?(U.success("加载完成"),A()):u.value&&u.value.loadMore()};u.value&&u.value.loadMore(L)}}else B(l.index,2)};return(l,_)=>{var Ie,Oe;const h=kt("router-link"),x=Vt,A=Bt,z=We,L=Je,j=Gt,ne=Ne,dt=Ke,_e=He,_t=Ge,pt=Ht,ft=Ze,vt=he,Ee=Qt,mt=jt,ht=Ae("viewer");return a(),m("div",io,[o("div",uo,[e(A,null,{default:n(()=>[e(x,null,{default:n(()=>[e(h,{to:"/library/list"},{default:n(()=>[w(" 知识库管理 ")]),_:1})]),_:1}),e(x,null,{default:n(()=>[e(h,{to:{path:"/library/details/knowledge-document",query:{id:c.value.library_id}}},{default:n(()=>[w(R(c.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),e(x,null,{default:n(()=>[w("知识库详情")]),_:1})]),_:1})]),o("div",co,[e(H(Nt),{onClick:s}),o("span",_o,R(c.value.file_name),1),e(oo,{detailsInfo:c.value},null,8,["detailsInfo"]),e(pt,{style:{"margin-left":"auto"}},{default:n(()=>[e(j,{align:"center",class:"custom-select-box"},{default:n(()=>[po,e(L,{value:I.status,"onUpdate:value":_[0]||(_[0]=M=>I.status=M),placeholder:"请选择",style:{width:"120px"},onChange:ue},{default:n(()=>[e(z,{value:-1},{default:n(()=>[w("全部")]),_:1}),(a(),m(V,null,G(re,(M,W)=>e(z,{value:W},{default:n(()=>[w(R(M),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),e(j,{align:"center",class:"custom-select-box"},{default:n(()=>[fo,e(L,{value:I.graph_status,"onUpdate:value":_[1]||(_[1]=M=>I.graph_status=M),placeholder:"请选择",onChange:ue,style:{width:"120px"}},{default:n(()=>[e(z,{value:-1},{default:n(()=>[w("全部")]),_:1}),(a(),m(V,null,G(p,(M,W)=>e(z,{value:W},{default:n(()=>[w(R(M),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),e(_t,null,{overlay:n(()=>[e(dt,null,{default:n(()=>[e(ne,{onClick:tt},{default:n(()=>[w("重新嵌入向量")]),_:1}),e(ne,{onClick:nt},{default:n(()=>[w("重新抽取知识图谱")]),_:1}),e(ne,{onClick:ot},{default:n(()=>[w("重命名")]),_:1}),y.value==2?(a(),F(ne,{key:0,onClick:lt},{default:n(()=>[w("设置更新频率")]),_:1})):D("",!0)]),_:1})]),default:n(()=>[e(_e,null,{default:n(()=>[w("其他操作 "),e(H(Kt))]),_:1})]),_:1}),y.value!=3?(a(),F(_e,{key:0,onClick:st},{default:n(()=>[w("重新分段")]),_:1})):D("",!0),e(_e,{onClick:_[2]||(_[2]=M=>X({})),type:"primary"},{icon:n(()=>[e(H(je))]),default:n(()=>[vo]),_:1})]),_:1})]),Z.value?(a(),m("div",mo,[e(ft)])):(a(),m(V,{key:1},[S.value||y.value==3?(a(),m(V,{key:0},[k.value?(a(),F(Fe,{key:0,onOpenEditSubscription:X})):(a(),F(oe,{key:1,scrollbar:{minSize:0},onOnScrollEnd:ce},{default:n(()=>[o("div",ho,[e(De,{ref:"subsectionBoxRef",total:N.value,paragraphLists:d.value,detailsInfo:c.value,onOpenEditSubscription:X,onHandleDelParagraph:we,onHandleConvert:xe},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(a(),m("div",go,[o("div",yo,[((Ie=c.value)==null?void 0:Ie.file_ext)=="pdf"?(a(),m("div",bo,[e(mt,{value:E.value,"onUpdate:value":_[3]||(_[3]=M=>E.value=M)},{default:n(()=>[e(Ee,{value:1},{default:n(()=>[e(vt,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:n(()=>[w(" 原文预览 ")]),_:1})]),_:1}),e(Ee,{value:2},{default:n(()=>[w("纯文本预览")]),_:1})]),_:1},8,["value"])])):D("",!0),((Oe=c.value)==null?void 0:Oe.file_ext)=="pdf"&&E.value==1?(a(),F(ro,{key:1,ref_key:"pdfRef",ref:u,class:"scroll-box pdf-render-box",source:T.value,onSelect:it,onRendered:ut},null,8,["source"])):(a(),F(oe,{key:2,scrollbar:q.value,ref_key:"leftScrollRef",ref:g,class:"scroll-box",onOnScrollEnd:ce},{default:n(()=>[o("div",ko,[(a(!0),m(V,null,G(d.value,(M,W)=>(a(),m("div",{class:"list-item",onClick:Ce=>B(W),key:W},[M.question?(a(),m("div",So,R(M.question),1)):D("",!0),M.answer?(a(),m("div",wo,R(M.answer),1)):D("",!0),o("div",{class:"content-box",innerHTML:M.content},null,8,$o),Ue((a(),m("div",qo,[(a(!0),m(V,null,G(M.images,(Ce,gt)=>(a(),m("img",{key:gt,src:Ce,alt:""},null,8,Po))),128))])),[[ht]])],8,xo))),128))])]),_:1},8,["scrollbar"]))]),o("div",Eo,[k.value?(a(),F(Fe,{key:0,onOpenEditSubscription:X})):(a(),F(oe,{key:1,scrollbar:q.value,ref_key:"rightScrollRef",ref:v,onOnScrollEnd:ce},{default:n(()=>[o("div",Io,[e(De,{ref:"subsectionBoxRef",total:N.value,detailsInfo:c.value,paragraphLists:d.value,onOpenEditSubscription:X,onHandleDelParagraph:we,onHandleConvert:xe,onHandleScrollTargetPage:ct},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64)),e(Xn,{detailsInfo:c.value,onHandleEdit:et,ref_key:"editSubscriptionRef",ref:$e},null,8,["detailsInfo"]),e(so,{onOk:at,ref_key:"updateFrequencyRef",ref:qe},null,512),e(zt,{onOk:rt,ref_key:"renameModalRef",ref:Pe},null,512)])}}},Ts=J(Oo,[["__scopeId","data-v-0b3ad808"]]);export{Ts as default};
