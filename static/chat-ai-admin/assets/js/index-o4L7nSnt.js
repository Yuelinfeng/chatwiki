import{L as i,M as f,V as e,j as t,X as O,Y as I,S as _e,a6 as V,P as j,Q as s,W as st,a2 as xe,r as x,d as Z,A as Q,E as le,G as ce,u as C,a9 as Y,a3 as G,a4 as W,a0 as nt,F as B,a1 as J,w as ue,k as it,ac as fe,ae as be,v as we,B as at,b as ge,h as je,a8 as lt,y as ct,ab as rt,U as dt,a7 as _t,p as ut}from"./vue-chunks-Bxyh5WP6.js";import{_ as D,c as re,B as ne,V as pt,W as Me,e as te,M as se,X as ve,Y as mt,Z as vt,U as ht,$ as $e,E as ft}from"../../index-CWYf_R7c.js";import{_ as ye}from"./index-DxeJG8dU.js";import{C as bt,E as yt}from"./cu-upload-B8TAFNOe.js";import"./index-mQw8zXXP.js";import{I as pe}from"./Input-BW-N7Cx9.js";import{_ as Se}from"./TextArea-C1_B5Wm2.js";import{C as Ve}from"./cu-scroll-C2rhBLXP.js";import{f as kt,c as gt}from"./index-xJ7lndAQ.js";import{_ as $t}from"./index-apt4DTpf.js";import{S as Ce}from"./index-SLPzh8Tt.js";import{_ as De,T as Ne}from"./index-CLcBLQ2O.js";import{P as Ie}from"./PlusOutlined-Cu0dwBBw.js";import{_ as oe}from"./index-qoVpjV_n.js";import{c as Pe}from"./index-DFKCqvOx.js";import{S as Te,a as Be,_ as Qe}from"./index-BLHGs8uC.js";import{_ as Fe}from"./index-W3Zrf5Zg.js";import{_ as Re}from"./index-DBcoYeqy.js";import{Q as ee}from"./QuestionCircleOutlined-BggeZNYy.js";import{_ as Le}from"./index-BEK29AQE.js";import{_ as xt,a as wt}from"./index-Bz7YUCyS.js";import{_ as de}from"./index-C1M6HpEG.js";import{g as Je}from"./index-Do3gHCO_.js";import{S as St}from"./SearchOutlined-gkqcN_Zr.js";import{S as qt}from"./SyncOutlined-D0ATV5S6.js";import{C as Ke,_ as Ge}from"./index-Dg6a-pZR.js";import{_ as We}from"./index-BkDjPG1x.js";import{_ as Ct}from"./recommendation-AQ4_FPQ9.js";import{R as It}from"./RightOutlined-BOQt46xG.js";import{g as He}from"./index-OsN_4CPb.js";import{_ as Rt}from"./empty-CzGZrENG.js";import{d as Ee}from"./vuedraggable.umd-mtgFIdHF.js";import"./index-Dsf1d2yx.js";import{R as Lt,_ as Et}from"./RadioButton-B3MvGE55.js";import{F as ze,_ as Ut}from"./index-Cm_NtOSH.js";import{u as Ot}from"./robot-CGO23iFg.js";import"./axios-Cm0UX6qg.js";import"./qs-CEiBKtbM.js";import"./crypto-js-C0fK7Mgg.js";import"./dayjs-BgtA0fgD.js";import"./FormItemContext-CY3sS3S3.js";import"./index-BYiIgJN3.js";import"./Search-C52Nu70G.js";import"./isPlainObject-Q-ndSLdg.js";import"./inputProps-CuDRpClH.js";import"./Password-BrrLsfMb.js";import"./statusUtils-D2ojHtZY.js";import"./index-C_rHdEod.js";import"./Trigger-DXFMCREP.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-CmI3I2v0.js";import"./index-Cyz9zV9F.js";import"./shallowequal-Do1xa-L4.js";import"./collapseMotion-DDsixTll.js";import"./slide-BHEoaamw.js";import"./Dropdown-BiMe9RPS.js";import"./useRefs-DgEUwJAf.js";import"./pick-D5pnwb9s.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-DAabT47N.js";import"./DownOutlined-BawL_eGx.js";import"./move-DtLl1qq4.js";import"./UpOutlined-BsYeG87t.js";import"./index-_6sIWoCk.js";import"./responsiveObserve-BtDP6tEg.js";const At={class:"edit-box-header"},Mt={class:"left-box"},zt={class:"edit-box-title"},jt={key:0},Vt={key:0,class:"title-tip"},Dt={class:"right-box"},Nt={class:"extra-box"},Pt={class:"actions-box"},Tt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(_,{emit:c}){const y=c,v=_,a=o=>{y("edit"),y("update:isEdit",o)},l=()=>{y("save")};return(o,$)=>{const n=re,k=ne,r=ye;return i(),f("div",{class:xe(["edit-box",{"is-edit":_.isEdit}])},[e("div",At,[e("div",Mt,[t(n,{class:"edit-box-icon",name:v.iconName},null,8,["name"]),e("span",zt,[O(I(v.title)+" ",1),o.$slots.icon?(i(),f("span",jt,[_e(o.$slots,"icon",{},void 0,!0)])):V("",!0)]),o.$slots.tip?(i(),f("span",Vt,[_e(o.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Dt,[e("div",Nt,[_e(o.$slots,"extra",{},()=>[e("div",Pt,[v.isEdit?(i(),j(r,{key:0,gap:8},{default:s(()=>[t(k,{onClick:l,size:"small",type:"primary"},{default:s(()=>[O("保存")]),_:1}),t(k,{onClick:$[0]||($[0]=w=>a(!1)),size:"small"},{default:s(()=>[O("取消")]),_:1})]),_:1})):(i(),j(k,{key:1,onClick:$[1]||($[1]=w=>a(!0)),size:"small"},{default:s(()=>[O("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:st({..._.bodyStyle})},[_e(o.$slots,"default",{},void 0,!0)],4)],2)}}},X=D(Tt,[["__scopeId","data-v-1b63f826"]]),Ze=_=>(G("data-v-c384f413"),_=_(),W(),_),Bt={class:"robot-form-box"},Qt={class:"form-item"},Ft=Ze(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Jt={class:"form-item-body robot-name-item"},Kt={class:"robot-avetar-upload"},Gt=["src"],Wt={class:"robot-name-box"},Ht={class:"form-item"},Zt=Ze(()=>e("div",{class:"form-item-label"},"简介",-1)),Yt={class:"form-item-body"},Xt={class:"robot-info-box"},eo={class:"robot-name-box"},to=["src"],oo={class:"robot-name"},so={class:"robot-intro"},no={__name:"basic-config",setup(_){const c=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo"),a=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),l=()=>{v({...Y(a)}),c.value=!1},o=n=>{let k=n[0];return a.robot_avatar=k,pt(k).then(r=>{a.robot_avatar_url=r}),!1},$=()=>{a.robot_name=y.robot_name,a.robot_intro=y.robot_intro,a.robot_avatar=y.robot_avatar,a.robot_avatar_url=y.robot_avatar_url};return(n,k)=>{const r=pe,w=Se;return i(),j(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":k[2]||(k[2]=d=>c.value=d),onSave:l,onEdit:$},{default:s(()=>[le(e("div",Bt,[e("div",Qt,[Ft,e("div",Jt,[t(bt,{accept:"image/*",onChange:o},{default:s(()=>[e("div",Kt,[a.robot_avatar_url?(i(),f("img",{key:0,class:"robot-avetar",src:a.robot_avatar_url},null,8,Gt)):V("",!0)])]),_:1}),e("div",Wt,[t(r,{value:a.robot_name,"onUpdate:value":k[0]||(k[0]=d=>a.robot_name=d),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Ht,[Zt,e("div",Yt,[t(w,{rows:3,value:a.robot_intro,"onUpdate:value":k[1]||(k[1]=d=>a.robot_intro=d),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ce,c.value]]),le(e("div",Xt,[e("div",eo,[e("img",{class:"robot-avatar",src:C(y).robot_avatar_url,alt:""},null,8,to),e("span",oo,I(C(y).robot_name),1)]),e("div",so,I(C(y).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ce,!c.value]])]),_:1},8,["isEdit"])}}},io=D(no,[["__scopeId","data-v-c384f413"]]),Ye=_=>(G("data-v-87ba79c2"),_=_(),W(),_),ao={class:"ai-create-box"},lo={class:"input-box"},co=Ye(()=>e("span",null,"生成",-1)),ro={class:"quick-tags-box"},_o=Ye(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),uo={class:"ai-list-box"},po={key:0,class:"loading-box"},mo={key:0,class:"prompt-list-box"},vo={class:"prompt-list"},ho={class:"prompt-header"},fo={class:"prompt-title"},bo={class:"prompt-content"},yo={class:"prompt-list"},ko={class:"prompt-header"},go={class:"prompt-title"},$o={class:"prompt-content"},xo={class:"prompt-list"},wo={class:"prompt-header"},So={class:"prompt-title"},qo={class:"prompt-content"},Co={class:"prompt-list"},Io={class:"prompt-header"},Ro={class:"prompt-title"},Lo={class:"prompt-content"},Eo={class:"prompt-list"},Uo={class:"prompt-header"},Oo={class:"prompt-title"},Ao={class:"prompt-content"},Mo={class:"prompt-header"},zo={class:"prompt-title"},jo={class:"prompt-content"},Vo={key:1,class:"empty-box"},Do={__name:"ai-create-prompt",emits:["handleAiSave"],setup(_,{expose:c,emit:y}){const v=Me.PRESENTED_IMAGE_SIMPLE,a=x(!1),l=x(!1),o=nt().query,$=y,n=x(""),k=x(!1),r=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],w=x("在上方输入框输入要求，点击生成提示词"),d=()=>{u.value=!1,q.promptStruct=S,n.value="",w.value="在上方输入框输入要求，点击生成提示词",a.value=!0},u=x(!1),S={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},q=Q({promptStruct:S}),R=g=>{n.value=g},m=()=>{if(!n.value)return te.error("请输入AI 生成提示词");if(k.value)return te.error("正在生成中...");k.value=!0,kt({id:o.id,demand:n.value}).then(g=>{q.promptStruct=JSON.parse(g.data.promptStruct),u.value=!0}).finally(()=>{k.value=!1}).catch(g=>{u.value=!1,w.value=g.msg})},b=()=>{if(!u.value)return te.error("请先生成提示词");$("handleAiSave",q.promptStruct),a.value=!1};return c({show:d}),(g,p)=>{const M=ne,L=pe,P=re,z=$t,h=Ce,H=Me,E=Ve,K=se;return i(),f("div",null,[t(K,{open:a.value,"onUpdate:open":p[1]||(p[1]=N=>a.value=N),title:"AI 生成提示词",width:746},{footer:s(()=>[t(M,{type:"primary",loading:l.value,onClick:b},{default:s(()=>[O("使用该提示")]),_:1},8,["loading"])]),default:s(()=>[e("div",ao,[e("div",lo,[t(L,{style:{width:"100%"},value:n.value,"onUpdate:value":p[0]||(p[0]=N=>n.value=N),size:"large",onPressEnter:m,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:m},[t(P,{name:"ai-mark"}),co])]),e("div",ro,[_o,(i(),f(B,null,J(r,N=>t(z,{key:N.title,onClick:T=>R(N.title),color:"blue"},{default:s(()=>[O(I(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",uo,[t(E,{style:{height:"100%"}},{default:s(()=>[k.value?(i(),f("div",po,[t(h,{tip:"正在生成中..."})])):(i(),f(B,{key:1},[u.value?(i(),f("div",mo,[e("div",vo,[e("div",ho,[e("div",fo,I(q.promptStruct.role.subject),1)]),e("div",bo,I(q.promptStruct.role.describe),1)]),e("div",yo,[e("div",ko,[e("div",go,I(q.promptStruct.task.subject),1)]),e("div",$o,I(q.promptStruct.task.describe),1)]),e("div",xo,[e("div",wo,[e("div",So,I(q.promptStruct.constraints.subject),1)]),e("div",qo,I(q.promptStruct.constraints.describe),1)]),e("div",Co,[e("div",Io,[e("div",Ro,I(q.promptStruct.output.subject),1)]),e("div",Lo,I(q.promptStruct.output.describe),1)]),e("div",Eo,[e("div",Uo,[e("div",Oo,I(q.promptStruct.tone.subject),1)]),e("div",Ao,I(q.promptStruct.tone.describe),1)]),(i(!0),f(B,null,J(q.promptStruct.custom,(N,T)=>(i(),f("div",{class:"prompt-list",key:T+N.key?N.key:""},[e("div",Mo,[e("div",zo,I(N.subject),1)]),e("div",jo,I(N.describe),1)]))),128))])):(i(),f("div",Vo,[t(H,{image:C(v),description:w.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},No=D(Do,[["__scopeId","data-v-87ba79c2"]]),Po={class:"prompt-box"},To={class:"tab-header"},Bo={key:0,class:"opt-block"},Qo={key:1,class:"opt-block"},Fo={key:0,class:"prompt-list-box"},Jo={class:"prompt-list"},Ko={class:"prompt-header"},Go={class:"prompt-title"},Wo={key:0,class:"btn-wrapper-box"},Ho={class:"prompt-content"},Zo={class:"prompt-list"},Yo={class:"prompt-header"},Xo={class:"prompt-title"},es={key:0,class:"btn-wrapper-box"},ts={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={key:0,class:"btn-wrapper-box"},as={class:"prompt-content"},ls={class:"prompt-list"},cs={class:"prompt-header"},rs={class:"prompt-title"},ds={key:0,class:"btn-wrapper-box"},_s={class:"swich-item"},us={class:"swich-item"},ps={class:"prompt-content"},ms={class:"prompt-list"},vs={class:"prompt-header"},hs={class:"prompt-title"},fs={key:0,class:"btn-wrapper-box"},bs={class:"prompt-content"},ys={class:"prompt-header"},ks={class:"prompt-title",style:{flex:"1"}},gs={key:0,class:"btn-wrapper-box"},$s=["onClick"],xs={class:"prompt-content"},ws={key:0,class:"add-theme-block"},Ss={key:1,class:"diy-prompt-box"},qs={key:0,class:"diy-switch-box"},Cs={class:"swich-item"},Is={class:"swich-item"},ie="- 请使用markdown格式回答问题。",ae="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Rs={__name:"system-prompt-words",setup(_){const c=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo");let a={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const l=x({}),o=x(!1),$=x(!1),n=x(!1),k=x(!1),r=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),w=(z,h)=>z.includes(h),d=x(y.prompt_type);ue(()=>y,()=>{r.prompt=y.prompt,r.prompt_struct=y.prompt_struct,l.value=y.prompt_struct_default},{immediate:!0,deep:!0}),ue(()=>r.prompt_struct.output.describe,z=>{o.value=w(z,ie),$.value=w(z,ae)},{immediate:!0,deep:!0}),ue(()=>r.prompt,z=>{n.value=w(z,ie),k.value=w(z,ae)},{immediate:!0,deep:!0});const u=(z,h)=>{z?(h=="outSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ie:r.prompt_struct.output.describe+=ie),h=="imgSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+ae:r.prompt_struct.output.describe+=ae)):(h=="outSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),h=="imgSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(ae,"g"),"")),r.prompt_struct.output.describe=r.prompt_struct.output.describe.trim())},S=(z,h)=>{z?(h=="outDiySwitch"&&(r.prompt?r.prompt+=`
`+ie:r.prompt+=ie),h=="imgDiySwitch"&&(r.prompt?r.prompt+=`
`+ae:r.prompt+=ae)):(h=="outDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ie,"g"),"")),h=="imgDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(ae,"g"),"")),r.prompt=r.prompt.trim())},q=z=>{r.prompt_struct[z].describe=l.value[z].describe},R=()=>{r.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),d.value=1},m=z=>{r.prompt_struct.custom.splice(z,1)},b=()=>{v({...Y(r),prompt_type:d.value}),c.value=!1},g=z=>{d.value=1,v({prompt_type:d.value,prompt:r.prompt,prompt_struct:z}),c.value=!1},p=()=>{c.value=!0},M=()=>{c.value=!1},L=x(null),P=()=>{L.value.show()};return(z,h)=>{const H=De,E=Ne,K=re,N=ne,T=ye,A=Se,F=oe,ot=pe;return i(),f("div",Po,[e("div",To,[t(E,{activeKey:d.value,"onUpdate:activeKey":h[0]||(h[0]=U=>d.value=U)},{default:s(()=>[(i(),j(H,{key:1,tab:"结构化提示词"})),(i(),j(H,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),c.value?(i(),f("div",Bo,[e("div",{class:"ai-mark-box",onClick:P},[t(K,{name:"ai-mark"}),O(" AI自动生成 ")]),t(T,{gap:8},{default:s(()=>[t(N,{size:"small",type:"primary",onClick:b},{default:s(()=>[O("保存")]),_:1}),t(N,{size:"small",onClick:M},{default:s(()=>[O("取消")]),_:1})]),_:1})])):(i(),f("div",Qo,[t(N,{size:"small",onClick:p},{default:s(()=>[O("修改")]),_:1})]))]),d.value==1?(i(),f("div",Fo,[e("div",Jo,[e("div",Ko,[e("div",Go,I(r.prompt_struct.role.subject),1),c.value?(i(),f("div",Wo,[e("a",{onClick:h[1]||(h[1]=U=>q("role"))},"恢复默认")])):V("",!0)]),e("div",Ho,[t(A,{bordered:!1,disabled:!c.value,value:r.prompt_struct.role.describe,"onUpdate:value":h[2]||(h[2]=U=>r.prompt_struct.role.describe=U),placeholder:C(a).role,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",Zo,[e("div",Yo,[e("div",Xo,I(r.prompt_struct.task.subject),1),c.value?(i(),f("div",es,[e("a",{onClick:h[3]||(h[3]=U=>q("task"))},"恢复默认")])):V("",!0)]),e("div",ts,[t(A,{bordered:!1,disabled:!c.value,value:r.prompt_struct.task.describe,"onUpdate:value":h[4]||(h[4]=U=>r.prompt_struct.task.describe=U),placeholder:C(a).task,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",os,[e("div",ss,[e("div",ns,I(r.prompt_struct.constraints.subject),1),c.value?(i(),f("div",is,[e("a",{onClick:h[5]||(h[5]=U=>q("constraints"))},"恢复默认")])):V("",!0)]),e("div",as,[t(A,{bordered:!1,disabled:!c.value,value:r.prompt_struct.constraints.describe,"onUpdate:value":h[6]||(h[6]=U=>r.prompt_struct.constraints.describe=U),placeholder:C(a).constraints,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",ls,[e("div",cs,[e("div",rs,I(r.prompt_struct.output.subject),1),c.value?(i(),f("div",ds,[e("div",_s,[O(" 输出markdown： "),t(F,{onChange:h[7]||(h[7]=U=>u(U,"outSwitch")),checked:o.value,"onUpdate:checked":h[8]||(h[8]=U=>o.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",us,[O(" 回复图片： "),t(F,{onChange:h[9]||(h[9]=U=>u(U,"imgSwitch")),checked:$.value,"onUpdate:checked":h[10]||(h[10]=U=>$.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:h[11]||(h[11]=U=>q("output"))},"恢复默认")])):V("",!0)]),e("div",ps,[t(A,{bordered:!1,disabled:!c.value,value:r.prompt_struct.output.describe,"onUpdate:value":h[12]||(h[12]=U=>r.prompt_struct.output.describe=U),placeholder:C(a).output,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",ms,[e("div",vs,[e("div",hs,I(r.prompt_struct.tone.subject),1),c.value?(i(),f("div",fs,[e("a",{onClick:h[13]||(h[13]=U=>q("tone"))},"恢复默认")])):V("",!0)]),e("div",bs,[t(A,{bordered:!1,disabled:!c.value,value:r.prompt_struct.tone.describe,"onUpdate:value":h[14]||(h[14]=U=>r.prompt_struct.tone.describe=U),placeholder:C(a).tone,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),(i(!0),f(B,null,J(r.prompt_struct.custom,(U,Ae)=>(i(),f("div",{class:"prompt-list",key:Ae+U.key?U.key:""},[e("div",ys,[e("div",ks,[t(ot,{bordered:!1,disabled:!c.value,style:{width:"100%"},value:U.subject,"onUpdate:value":ke=>U.subject=ke,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),c.value?(i(),f("div",gs,[e("div",{class:"hover-btn-box",onClick:ke=>m(Ae)},[t(C(ve))],8,$s)])):V("",!0)]),e("div",xs,[t(A,{bordered:!1,disabled:!c.value,value:U.describe,"onUpdate:value":ke=>U.describe=ke,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","onUpdate:value"])])]))),128)),c.value?(i(),f("div",ws,[t(N,{onClick:R,block:"",icon:it(C(Ie))},{default:s(()=>[O("添加主题")]),_:1},8,["icon"])])):V("",!0)])):(i(),f("div",Ss,[c.value?(i(),f("div",qs,[e("div",Cs,[O(" 输出markdown： "),t(F,{size:"small",onChange:h[15]||(h[15]=U=>S(U,"outDiySwitch")),checked:n.value,"onUpdate:checked":h[16]||(h[16]=U=>n.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Is,[O(" 回复图片： "),t(F,{size:"small",onChange:h[17]||(h[17]=U=>S(U,"imgDiySwitch")),checked:k.value,"onUpdate:checked":h[18]||(h[18]=U=>k.value=U),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):V("",!0),t(A,{bordered:c.value,value:r.prompt,"onUpdate:value":h[19]||(h[19]=U=>r.prompt=U),disabled:!c.value,placeholder:"请输入","auto-size":{minRows:5,maxRows:15}},null,8,["bordered","value","disabled"])])),t(No,{onHandleAiSave:g,ref_key:"aiCreatePromptRef",ref:L},null,512)])}}},Ls=D(Rs,[["__scopeId","data-v-d7a4087c"]]),he=_=>(G("data-v-7139584f"),_=_(),W(),_),Es={class:"actions-box"},Us={class:"model-name"},Os={key:0,class:"form-box"},As={class:"form-item"},Ms=he(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),zs={class:"form-item-body"},js=["src"],Vs={key:0},Ds={key:1},Ns={class:"form-item"},Ps={class:"form-item-label"},Ts=he(()=>e("span",null,"温度 ",-1)),Bs={class:"form-item-body"},Qs={class:"number-box"},Fs={class:"number-slider-box"},Js={class:"number-input-box"},Ks={class:"form-item"},Gs={class:"form-item-label"},Ws=he(()=>e("span",null,"最大token ",-1)),Hs={class:"form-item-body"},Zs={class:"number-box"},Ys={class:"number-slider-box"},Xs={class:"number-input-box"},en={class:"form-item"},tn={class:"form-item-label"},on=he(()=>e("span",null,"上下文数量 ",-1)),sn={class:"form-item-body"},nn={class:"number-box"},an={class:"number-slider-box"},ln={class:"number-input-box"},cn={class:"form-item"},rn={class:"form-item-label"},dn=he(()=>e("span",null,"显示推理过程 ",-1)),_n=he(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),un={class:"form-item-body",style:{"padding-top":"5px"}},pn={__name:"model-settings",setup(_){const c=["azure","ollama","xinference","openaiAgent"],y=["azure"],v=Q({sm:24,md:24,lg:12,xl:8,xxl:8}),a=x([]),l=x(!1),{robotInfo:o,updateRobotInfo:$}=Z("robotInfo"),n=Q({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),k=x(""),r=x(""),w=x(""),d=(m,b)=>{const g=b.current_obj;n.use_model=c.indexOf(g.model_define)>-1&&g.deployment_name?g.deployment_name:g.name,k.value=g.model_define,n.model_config_id=g.id||b.model_config_id},u=()=>{w.value=n.use_model,y.indexOf(k.value)>-1&&(n.use_model="默认"),$({...Y(n)}),l.value=!1},S=m=>{m||(k.value=r.value),c.indexOf(k.value)>-1?n.use_model=w.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,n.think_switch=Number(o.think_switch),l.value=m};function q(m,b,g){const p=new Set(m.map(M=>M.model_define));return b.filter(M=>{let L=M[g];p.has(L)&&m.filter(P=>{if(P.model_define==L)return P.children=vt(P.children,M.children),!1})}),m}return(()=>{Pe({model_type:"LLM"}).then(m=>{w.value=o.use_model;let b=m.data||[],g=[];a.value=b.map(p=>{g=[];for(let M=0;M<p.model_info.llm_model_list.length;M++){const L=p.model_info.llm_model_list[M];c.indexOf(p.model_info.model_define)>-1&&o.model_config_id==p.model_config.id&&(w.value=p.model_config.deployment_name,k.value=p.model_info.model_define,r.value=p.model_info.model_define),g.push({name:L,deployment_name:p.model_config.deployment_name,id:p.model_config.id,model_define:p.model_info.model_define})}return{id:p.model_config.id,name:p.model_info.model_name,model_define:p.model_info.model_define,icon:p.model_info.model_icon_url,children:g,deployment_name:p.model_config.deployment_name}}),a.value=q(mt(a.value,"model_define"),a.value,"model_define")})})(),(m,b)=>{const g=ne,p=ye,M=Le,L=Te,P=Be,z=Qe,h=xt,H=de,E=Fe,K=Re,N=oe,T=wt;return i(),j(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":b[10]||(b[10]=A=>l.value=A)},{extra:s(()=>[e("div",Es,[l.value?(i(),j(p,{key:0,gap:8},{default:s(()=>[t(g,{onClick:u,size:"small",type:"primary"},{default:s(()=>[O("保存")]),_:1}),t(g,{onClick:b[0]||(b[0]=A=>S(!1)),size:"small"},{default:s(()=>[O("取消")]),_:1})]),_:1})):(i(),f(B,{key:1},[e("span",Us,I(w.value),1),t(M,{type:"vertical"}),t(g,{onClick:b[1]||(b[1]=A=>S(!0)),size:"small"},{default:s(()=>[O("修改")]),_:1})],64))])]),default:s(()=>[l.value?(i(),f("div",Os,[t(T,{gutter:[32,16]},{default:s(()=>[t(h,fe(be(v)),{default:s(()=>[e("div",As,[Ms,e("div",zs,[t(z,{value:n.use_model,"onUpdate:value":b[2]||(b[2]=A=>n.use_model=A),placeholder:"请选择LLM模型",onChange:d,style:{width:"100%"}},{default:s(()=>[(i(!0),f(B,null,J(a.value,A=>(i(),j(P,{key:A.id},{label:s(()=>[t(p,{align:"center",gap:6},{default:s(()=>[e("img",{class:"model-icon",src:A.icon,alt:""},null,8,js),O(I(A.name),1)]),_:2},1024)]),default:s(()=>[(i(!0),f(B,null,J(A.children,F=>(i(),j(L,{value:c.indexOf(A.model_define)>-1&&F.deployment_name?F.deployment_name:F.name+F.id,model_config_id:A.id,current_obj:F,key:F.name+F.id},{default:s(()=>[c.indexOf(A.model_define)>-1&&F.deployment_name?(i(),f("span",Vs,I(F.deployment_name),1)):(i(),f("span",Ds,I(F.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(h,fe(be(v)),{default:s(()=>[e("div",Ns,[e("div",Ps,[Ts,t(H,null,{title:s(()=>[O("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",Bs,[e("div",Qs,[e("div",Fs,[t(E,{class:"custom-slider",value:n.temperature,"onUpdate:value":b[3]||(b[3]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])]),e("div",Js,[t(K,{value:n.temperature,"onUpdate:value":b[4]||(b[4]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(h,fe(be(v)),{default:s(()=>[e("div",Ks,[e("div",Gs,[Ws,t(H,null,{title:s(()=>[O("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",Hs,[e("div",Zs,[e("div",Ys,[t(E,{class:"custom-slider",value:n.max_token,"onUpdate:value":b[5]||(b[5]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])]),e("div",Xs,[t(K,{value:n.max_token,"onUpdate:value":b[6]||(b[6]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(h,fe(be(v)),{default:s(()=>[e("div",en,[e("div",tn,[on,t(H,null,{title:s(()=>[O("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",sn,[e("div",nn,[e("div",an,[t(E,{class:"custom-slider",value:n.context_pair,"onUpdate:value":b[7]||(b[7]=A=>n.context_pair=A),min:0,max:10},null,8,["value"])]),e("div",ln,[t(K,{value:n.context_pair,"onUpdate:value":b[8]||(b[8]=A=>n.context_pair=A),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(h,fe(be(v)),{default:s(()=>[e("div",cn,[e("div",rn,[dn,t(H,null,{title:s(()=>[_n]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",un,[t(N,{checked:n.think_switch,"onUpdate:checked":b[9]||(b[9]=A=>n.think_switch=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])])]),_:1},16)]),_:1})])):V("",!0)]),_:1},8,["isEdit"])}}},mn=D(pn,[["__scopeId","data-v-7139584f"]]),vn={class:"library-checkbox-box"},hn={class:"list-tools"},fn={class:"list-box",ref:"scrollContainer"},bn={class:"library-name"},yn={class:"library-desc"},kn={__name:"library-select-alert",emits:["change"],setup(_,{expose:c,emit:y}){const v=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=x(!1),o=R=>{d(),a.checkedList=R,l.value=!0},$=()=>{l.value=!1,w()},n=x(""),k=()=>{d()},r=x([]),w=()=>{v("change",[...a.checkedList])},d=async()=>{const R=await Je({library_name:n.value,type:""});if(R){let m=R.data||[];r.value=m}},u=x(!1),S=async()=>{u.value=!0,await d(),u.value=!1,te.success("刷新完成")},q=()=>{window.open("/#/library/list")};return c({open:o}),(R,m)=>{const b=We,g=pe,p=ne,M=Ke,L=Ge,P=Ce,z=se;return i(),j(z,{width:"746px",open:l.value,"onUpdate:open":m[2]||(m[2]=h=>l.value=h),title:"关联知识库",onOk:$},{default:s(()=>[e("div",vn,[t(b,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",hn,[e("div",null,[t(g,{style:{width:"282px"},value:n.value,"onUpdate:value":m[0]||(m[0]=h=>n.value=h),placeholder:"请输入知识库名称搜索",onChange:k},{suffix:s(()=>[t(C(St),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(p,{style:{"margin-right":"8px"},onClick:S},{default:s(()=>[t(C(qt)),O(" 刷新 ")]),_:1}),t(p,{type:"primary",ghost:"",onClick:q},{default:s(()=>[O("新建知识库")]),_:1})])]),t(P,{spinning:u.value,delay:100},{default:s(()=>[t(L,{value:a.checkedList,"onUpdate:value":m[1]||(m[1]=h=>a.checkedList=h),style:{width:"100%"}},{default:s(()=>[e("div",fn,[(i(!0),f(B,null,J(r.value,h=>(i(),f("div",{class:"list-item-wraapper",key:h.id},[t(M,{class:"list-item",value:h.id},{default:s(()=>[e("div",bn,I(h.library_name),1),e("div",yn,I(h.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},gn=D(kn,[["__scopeId","data-v-bafb3126"]]),qe=_=>(G("data-v-4bfd6507"),_=_(),W(),_),$n={class:"recall-settings-box"},xn={class:"form-box"},wn={class:"form-item is-required"},Sn=qe(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),qn={class:"form-item-body"},Cn={class:"retrieval-mode-items"},In=["onClick"],Rn={class:"retrieval-mode-title"},Ln={class:"title-text"},En={key:0,style:{width:"32px"},src:Ct,alt:""},Un={class:"retrieval-mode-desc"},On={class:"form-item"},An={class:"form-item-label"},Mn=qe(()=>e("span",null,"Top K ",-1)),zn={class:"form-item-body"},jn={class:"number-box"},Vn={class:"number-slider-box"},Dn={class:"number-input-box"},Nn={key:0,class:"form-item"},Pn={class:"form-item-label"},Tn=qe(()=>e("span",null,"相似度阈值 ",-1)),Bn={class:"form-item-body"},Qn={class:"number-box"},Fn={class:"number-slider-box"},Jn={class:"number-input-box"},Kn={class:"form-item"},Gn={class:"form-item-label"},Wn=qe(()=>e("span",null,"Rerank模型",-1)),Hn={key:0,class:"form-item-body"},Zn=["src"],Yn={__name:"recall-settings-alert",emits:["change"],setup(_,{expose:c,emit:y}){const v=y,a=x([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),l=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),o=x(!1),$=R=>{q(),l.rerank_status=R.rerank_status||0,l.rerank_use_model=R.rerank_use_model||void 0,l.rerank_model_config_id=R.rerank_model_config_id>0?R.rerank_model_config_id:"",l.top_k=R.top_k,l.similarity=R.similarity,l.search_type=R.search_type,o.value=!0},n=(R,m)=>{if(!R||!m){l.rerank_model_config_id="";return}l.rerank_model_config_id=m.rerank_model_config_id},k=R=>{R==0&&(l.rerank_model_config_id="",l.rerank_use_model="")},r=R=>{l.search_type=R},w=()=>l.rerank_status==1&&!l.rerank_model_config_id,d=()=>{if(w())return te.error("请选择Rerank模型");o.value=!1,u()},u=()=>{v("change",Y(l))},S=x([]),q=()=>{Pe({model_type:"RERANK"}).then(R=>{let m=R.data||[];S.value=m.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})};return c({open:$}),(R,m)=>{const b=re,g=de,p=Fe,M=Re,L=oe,P=Te,z=Be,h=Qe,H=se;return i(),j(H,{width:"746px",open:o.value,"onUpdate:open":m[6]||(m[6]=E=>o.value=E),title:"召回设置",onOk:d},{default:s(()=>[e("div",$n,[e("div",xn,[e("div",wn,[Sn,e("div",qn,[e("div",Cn,[(i(!0),f(B,null,J(a.value,E=>(i(),f("div",{class:xe(["retrieval-mode-item",{active:l.search_type==E.value}]),key:E.value,onClick:K=>r(E.value)},[l.search_type==E.value?(i(),j(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):V("",!0),e("div",Rn,[t(b,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",Ln,I(E.title),1),E.isRecommendation?(i(),f("img",En)):V("",!0)]),e("div",Un,I(E.desc),1)],10,In))),128))])])]),e("div",On,[e("div",An,[Mn,t(g,null,{title:s(()=>[O("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",zn,[e("div",jn,[e("div",Vn,[t(p,{class:"custom-slider",value:l.top_k,"onUpdate:value":m[0]||(m[0]=E=>l.top_k=E),min:1,max:10},null,8,["value"])]),e("div",Dn,[t(M,{value:l.top_k,"onUpdate:value":m[1]||(m[1]=E=>l.top_k=E),min:1,max:10},null,8,["value"])])])])]),l.search_type<=2?(i(),f("div",Nn,[e("div",Pn,[Tn,t(g,null,{title:s(()=>[O("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:s(()=>[t(C(ee),{class:"question-icon"})]),_:1})]),e("div",Bn,[e("div",Qn,[e("div",Fn,[t(p,{class:"custom-slider",value:l.similarity,"onUpdate:value":m[2]||(m[2]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",Jn,[t(M,{value:l.similarity,"onUpdate:value":m[3]||(m[3]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])])):V("",!0),e("div",Kn,[e("div",Gn,[Wn,O("   "),t(L,{checkedValue:1,unCheckedValue:0,checked:l.rerank_status,"onUpdate:checked":m[4]||(m[4]=E=>l.rerank_status=E),onChange:k},null,8,["checked"])]),l.rerank_status==1?(i(),f("div",Hn,[t(h,{allowClear:"",value:l.rerank_use_model,"onUpdate:value":m[5]||(m[5]=E=>l.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:n,style:{width:"60%"}},{default:s(()=>[(i(!0),f(B,null,J(S.value,E=>(i(),j(z,{key:E.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,Zn)])]),default:s(()=>[(i(!0),f(B,null,J(E.children,K=>(i(),j(P,{value:K,rerank_model_config_id:E.id,key:K},{default:s(()=>[e("span",null,I(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):V("",!0)])])])]),_:1},8,["open"])}}},Xn=D(Yn,[["__scopeId","data-v-4bfd6507"]]),ei=_=>(G("data-v-0ebe0aeb"),_=_(),W(),_),ti={class:"list-box"},oi=["onClick"],si={class:"avater-box"},ni=["src"],ii={class:"content-box"},ai={class:"title-block"},li=ei(()=>e("div",{class:"tag-icon"},"Graph",-1)),ci={class:"title-text"},ri={class:"desc-box"},di={class:"right-icon"},_i={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(_,{expose:c,emit:y}){const v=y,a=_,l=x(!1);ue(()=>a.list,()=>{a.list.length==0&&(l.value=!1)},{});const o=()=>{l.value=!0},$=()=>{document.visibilityState==="visible"&&v("refreshList")};we(()=>{document.addEventListener("visibilitychange",$)}),at(()=>{document.removeEventListener("visibilitychange",$)});const n=k=>{window.open(`/#/library/details/knowledge-config?id=${k.id}`)};return c({show:o}),(k,r)=>{const w=We,d=Ve,u=se;return i(),f("div",null,[t(u,{open:l.value,"onUpdate:open":r[0]||(r[0]=S=>l.value=S),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:s(()=>[t(w,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(d,{scrollbar:!1,style:{height:"400px"}},{default:s(()=>[e("div",ti,[(i(!0),f(B,null,J(a.list,S=>(i(),f("div",{class:"list-item",onClick:q=>n(S),key:S.id},[e("div",si,[e("img",{src:S.avatar,alt:""},null,8,ni)]),e("div",ii,[e("div",ai,[li,e("div",ci,I(S.library_name),1)]),e("div",ri,I(S.library_intro),1)]),e("div",di,[t(C(It))])],8,oi))),128))])]),_:1})]),_:1},8,["open"])])}}},ui=D(_i,[["__scopeId","data-v-0ebe0aeb"]]),pi={class:"actions-box"},mi={key:0,class:"library-list"},vi=["onClick"],hi=["onClick"],fi={class:"library-name"},bi={class:"library-name-text"},yi={class:"library-intro"},ki={__name:"index",setup(_){const{getStorage:c,removeStorage:y}=ht("localStorage"),v=x(!1),{robotInfo:a,updateRobotInfo:l}=Z("robotInfo"),o=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),$=x([]),n=x(null),k=ge(()=>$.value.filter(L=>o.library_ids.includes(L.id))),r=ge(()=>k.value.filter(L=>L.graph_switch==0)),w=L=>{let P=o.library_ids.indexOf(L.id);o.library_ids.splice(P,1),b()},d=L=>{o.library_ids=[...L],b()},u=()=>{n.value.open([...o.library_ids])},S=x(null),q=()=>{S.value.open(Y(o))},R=x(null),m=L=>{o.rerank_status=L.rerank_status,o.rerank_use_model=L.rerank_use_model,o.rerank_model_config_id=L.rerank_model_config_id,o.top_k=L.top_k,o.similarity=L.similarity,o.search_type=L.search_type,(L.search_type==1||L.search_type==4)&&r.value.length>0&&R.value.show(),b()},b=()=>{let L={...Y(o)};L.library_ids=L.library_ids.join(","),l({...L})},g=async()=>{const L=await Je({type:""});L&&($.value=L.data||[])},p=()=>{se.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){u()}})};o.rerank_use_model=a.rerank_use_model||void 0,je(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type});const M=L=>{window.open(`#/library/details/knowledge-document?id=${L.id}`)};return we(()=>{g(),c("showNoLibraryTip")&&(p(),y("showNoLibraryTip"))}),(L,P)=>{const z=ne,h=ye,H=de;return i(),j(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:v.value,"onUpdate:isEdit":P[0]||(P[0]=E=>v.value=E),bodyStyle:{padding:0}},{extra:s(()=>[e("div",pi,[t(h,{gap:8},{default:s(()=>[t(z,{size:"small",onClick:q},{default:s(()=>[O("召回设置")]),_:1}),t(z,{size:"small",onClick:u},{default:s(()=>[O("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[k.value.length>0?(i(),f("div",mi,[(i(!0),f(B,null,J(k.value,E=>(i(),f("div",{class:"library-item",key:E.id,onClick:K=>M(E)},[e("span",{class:"close-btn",onClick:lt(K=>w(E),["stop"])},[t(C(ve))],8,hi),e("div",fi,[t(H,null,{title:s(()=>[O(I(E.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:s(()=>[e("div",{class:xe(["graph-tag",{active:E.graph_switch==1}])},"Graph",2)]),_:2},1024),e("div",bi,I(E.library_name),1)]),e("div",yi,I(E.library_intro),1)],8,vi))),128))])):V("",!0),t(gn,{ref_key:"librarySelectAlertRef",ref:n,onChange:d},null,512),t(Xn,{ref_key:"recallSettingsAlertRef",ref:S,onChange:m},null,512),t(ui,{list:r.value,onRefreshList:g,ref_key:"noOpenGraphModalRef",ref:R},null,8,["list"])]),_:1},8,["isEdit"])}}},gi=D(ki,[["__scopeId","data-v-95d7d809"]]),$i=_=>(G("data-v-890ab853"),_=_(),W(),_),xi={class:"library-checkbox-box"},wi={class:"list-box",ref:"scrollContainer"},Si={class:"library-name"},qi={class:"library-desc"},Ci={key:0,class:"empty-box"},Ii=$i(()=>e("img",{src:Rt,alt:""},null,-1)),Ri={__name:"library-select-alert",emits:["change"],setup(_,{expose:c,emit:y}){const v=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=x(!1),o=u=>{r(),a.checkedList=u,l.value=!0},$=()=>{l.value=!1,k()};x("");const n=x([]),k=()=>{v("change",[...a.checkedList])},r=async()=>{const u=await He();if(u){let S=u.data||[];n.value=S}},w=x(!1),d=()=>{window.open("/#/database/list")};return c({open:o}),(u,S)=>{const q=Ke,R=Ge,m=Ce,b=se;return i(),j(b,{width:"746px",open:l.value,"onUpdate:open":S[1]||(S[1]=g=>l.value=g),title:"关联数据表",onOk:$},{default:s(()=>[e("div",xi,[t(m,{spinning:w.value,delay:100},{default:s(()=>[t(R,{value:a.checkedList,"onUpdate:value":S[0]||(S[0]=g=>a.checkedList=g),style:{width:"100%"}},{default:s(()=>[e("div",wi,[(i(!0),f(B,null,J(n.value,g=>(i(),f("div",{class:"list-item-wraapper",key:g.id},[t(q,{class:"list-item",value:g.id},{default:s(()=>[e("div",Si,I(g.name),1),e("div",qi,I(g.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!w.value&&!n.value.length?(i(),f("div",Ci,[Ii,e("div",null,[O(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:d}," 去添加")])])):V("",!0)])]),_:1},8,["open"])}}},Li=D(Ri,[["__scopeId","data-v-890ab853"]]),Ei=_=>(G("data-v-6977bc22"),_=_(),W(),_),Ui=Ei(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),Oi={class:"actions-box"},Ai={key:0,class:"library-list"},Mi=["onClick"],zi={class:"library-name"},ji={class:"library-intro"},Vi={__name:"index",setup(_){const c=x(!1),{robotInfo:y,updateRobotInfo:v}=Z("robotInfo"),a=Q({form_ids:[]}),l=x([]),o=x(null),$=ge(()=>l.value.filter(u=>a.form_ids.includes(u.id))),n=u=>{let S=a.form_ids.indexOf(u.id);a.form_ids.splice(S,1),w()},k=u=>{a.form_ids=[...u],w()},r=()=>{o.value.open([...a.form_ids])},w=()=>{let u={...Y(a)};u.form_ids=u.form_ids.join(","),v({...u})};return(async()=>{const u=await He();u&&(l.value=u.data||[])})(),je(()=>{a.form_ids=y.form_ids.split(",")}),(u,S)=>{const q=de,R=ne,m=ye;return i(),j(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":S[0]||(S[0]=b=>c.value=b),bodyStyle:{padding:0}},{tip:s(()=>[t(q,{placement:"top"},{title:s(()=>[Ui]),default:s(()=>[t(C(ee))]),_:1})]),extra:s(()=>[e("div",Oi,[t(m,{gap:8},{default:s(()=>[t(R,{size:"small",onClick:r},{default:s(()=>[O("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[$.value.length>0?(i(),f("div",Ai,[(i(!0),f(B,null,J($.value,b=>(i(),f("div",{class:"library-item",key:b.id},[e("span",{class:"close-btn",onClick:g=>n(b)},[t(C(ve))],8,Mi),e("div",zi,I(b.name),1),e("div",ji,I(b.description),1)]))),128))])):V("",!0),t(Li,{ref_key:"librarySelectAlertRef",ref:o,onChange:k},null,512)]),_:1},8,["isEdit"])}}},Di=D(Vi,[["__scopeId","data-v-6977bc22"]]),Ni={class:"form-box"},Pi={class:"question-title"},Ti={class:"question-options"},Bi={class:"question-option"},Qi={class:"drag-btn"},Fi={class:"action-box"},Ji={class:"robot-info-box"},Ki={class:"robot-welcome-content"},Gi={class:"robot-welcome-question"},Wi={__name:"welcome-words",setup(_){const c=x(!1),y=x(!1),{robotInfo:v,updateRobotInfo:a,scrollBoxToBottom:l}=Z("robotInfo"),o=Q({welcomes:{content:"",question:[]}}),$=()=>{let d=!1;if(o.welcomes.question.length>0){for(let u=0;u<o.welcomes.question.length;u++)if(!o.welcomes.question[u].content){d=u+1;break}}return d},n=()=>{o.welcomes.question.push({content:"",id:$e(8)})},k=d=>{o.welcomes.question.splice(d,1)},r=()=>{if(!o.welcomes.content)return te.error("请输入欢迎语");if($())return te.error("引导问题内容不能为空");a({...Y(o)}),c.value=!1},w=()=>{let d={...v.welcomes},u=[];d.question.forEach(({content:S,id:q})=>{let R={id:q,content:S};R.id||(R.id=$e(6)),u.push(R)}),o.welcomes.content=d.content,o.welcomes.question=u};return(d,u)=>{const S=Se,q=re,R=pe;return i(),j(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":u[4]||(u[4]=m=>c.value=m),onSave:r,onEdit:w},{default:s(()=>[le(e("div",Ni,[e("div",Pi,[t(S,{value:o.welcomes.content,"onUpdate:value":u[0]||(u[0]=m=>o.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",Ti,[t(C(Ee),{modelValue:o.welcomes.question,"onUpdate:modelValue":u[1]||(u[1]=m=>o.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=m=>y.value=!0),onEnd:u[3]||(u[3]=m=>y.value=!1)},{item:s(({element:m,index:b})=>[e("div",Bi,[e("span",Qi,[t(q,{name:"drag"})]),t(R,{class:"question-option-content",value:m.content,"onUpdate:value":g=>m.content=g,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Fi,[t(C(ve),{class:"del-btn",onClick:g=>k(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:n},[t(C(Ie),{class:"add-btn-icon"}),O("添加引导问题 ")])])],512),[[ce,c.value]]),le(e("div",Ji,[e("div",Ki,I(C(v).welcomes.content),1),e("div",Gi,[(i(!0),f(B,null,J(C(v).welcomes.question,(m,b)=>(i(),f("div",{class:"question-item",key:b},I(m.content),1))),128))])],512),[[ce,!c.value]])]),_:1},8,["isEdit"])}}},Hi=D(Wi,[["__scopeId","data-v-9b840ded"]]),Zi=_=>(G("data-v-aca01d0e"),_=_(),W(),_),Yi=Zi(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Xi={class:"form-box"},ea={class:"question-title"},ta={class:"question-options"},oa={class:"question-option"},sa={class:"drag-btn"},na={class:"action-box"},ia={class:"robot-info-box"},aa={class:"robot-unknown-content"},la={class:"robot-unknown-question"},ca={__name:"unknown-problem-prompt",setup(_){const c=x(!1),y=x(!1),{robotInfo:v,updateRobotInfo:a,scrollBoxToBottom:l}=Z("robotInfo"),o=Q({unknown_question_prompt:{content:"",question:[]}}),$=()=>{o.unknown_question_prompt.question.push({content:"",id:$e(8)}),ct(()=>{l()})},n=w=>{o.unknown_question_prompt.question.splice(w,1)},k=()=>{a({...Y(o)}),c.value=!1},r=()=>{let w={...v.unknown_question_prompt},d=[];w.question&&w.question.forEach(({content:u,id:S})=>{let q={id:S,content:u};q.id||(q.id=$e(6)),d.push(q)}),w.content&&(o.unknown_question_prompt.content=w.content),d&&(o.unknown_question_prompt.question=d)};return we(()=>{}),(w,d)=>{const u=de,S=Se,q=re,R=pe;return i(),j(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":d[4]||(d[4]=m=>c.value=m),onSave:k,onEdit:r},{tip:s(()=>[t(u,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Yi]),default:s(()=>[t(C(ee))]),_:1})]),default:s(()=>[le(e("div",Xi,[e("div",ea,[t(S,{value:o.unknown_question_prompt.content,"onUpdate:value":d[0]||(d[0]=m=>o.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",ta,[t(C(Ee),{modelValue:o.unknown_question_prompt.question,"onUpdate:modelValue":d[1]||(d[1]=m=>o.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=m=>y.value=!0),onEnd:d[3]||(d[3]=m=>y.value=!1)},{item:s(({element:m,index:b})=>[e("div",oa,[e("span",sa,[t(q,{name:"drag"})]),t(R,{class:"question-option-content",value:m.content,"onUpdate:value":g=>m.content=g,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",na,[t(C(ve),{class:"del-btn",onClick:g=>n(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:$},[t(C(Ie),{class:"add-btn-icon"}),O("添加引导问题 ")])])],512),[[ce,c.value]]),le(e("div",ia,[e("div",aa,I(C(v).unknown_question_prompt.content),1),e("div",la,[(i(!0),f(B,null,J(C(v).unknown_question_prompt.question,(m,b)=>(i(),f("div",{class:"question-item",key:b},I(m.content),1))),128))])],512),[[ce,!c.value]])]),_:1},8,["isEdit"])}}},ra=D(ca,[["__scopeId","data-v-aca01d0e"]]),Xe=_=>(G("data-v-8d50dfeb"),_=_(),W(),_),da=Xe(()=>e("span",null,null,-1)),_a=Xe(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),ua={__name:"problem-optimization",setup(_){x(!1);const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const v=a=>{y({})};return(a,l)=>{const o=oe;return i(),j(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[da]),default:s(()=>[_a,t(o,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(c).enable_question_optimize,"onUpdate:checked":l[0]||(l[0]=$=>C(c).enable_question_optimize=$),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},pa=D(ua,[["__scopeId","data-v-8d50dfeb"]]),et=_=>(G("data-v-e2bb2e45"),_=_(),W(),_),ma=et(()=>e("span",null,null,-1)),va=et(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),ha={__name:"suggested-issues",setup(_){x(!1);const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo"),v=a=>{y({})};return(a,l)=>{const o=oe;return i(),j(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[ma]),default:s(()=>[va,t(o,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(c).enable_question_guide,"onUpdate:checked":l[0]||(l[0]=$=>C(c).enable_question_guide=$),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},fa=D(ha,[["__scopeId","data-v-e2bb2e45"]]),ba=_=>(G("data-v-f1e5ad50"),_=_(),W(),_),ya=ba(()=>e("span",null,null,-1)),ka={__name:"sensitive-words",setup(_){x(!1);const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const v=()=>{window.open("/#/user/sensitive-words")},a=l=>{y({})};return(l,o)=>{const $=oe;return i(),j(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:s(()=>[ya]),default:s(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[O(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:v,style:{cursor:"pointer"}},"设置敏词 >")])]),t($,{onChange:a,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(c).sensitive_words_switch,"onUpdate:checked":o[0]||(o[0]=n=>C(c).sensitive_words_switch=n),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ga=D(ka,[["__scopeId","data-v-f1e5ad50"]]),Ue=_=>(G("data-v-fc008010"),_=_(),W(),_),$a={class:"direct-title"},xa={class:"direct-desc"},wa={class:"qa"},Sa={class:"prompt-form-item-label"},qa=Ue(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Ca={class:"direct-switch"},Ia={class:"similarity"},Ra=Ue(()=>e("span",null,"相似度超过",-1)),La={class:"number-input-box"},Ea=Ue(()=>e("span",null,"时直接回复答案",-1)),Ua={__name:"chat-edit-alert",emits:["save"],setup(_,{expose:c,emit:y}){const v=y,a=x(1),l=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],o=Q(l()),$=x(!1),n=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),k=()=>{n.chat_type=a.value.toString(),o.forEach(d=>{d.chat_type==a.value&&(n.chat_type=="3"?(n.mixture_qa_direct_reply_switch=d.mixture_qa_direct_reply_switch==1?"true":"false",n.mixture_qa_direct_reply_score=d.mixture_qa_direct_reply_score.toString()):n.chat_type=="1"&&(n.library_qa_direct_reply_switch=d.library_qa_direct_reply_switch==1?"true":"false",n.library_qa_direct_reply_score=d.library_qa_direct_reply_score.toString()))}),r(),Object.assign(o,l()),$.value=!1},r=()=>{v("save",Y(n))};we(()=>{});const w=d=>{a.value=parseInt(d.chat_type),n.chat_type=d.chat_type,n.library_qa_direct_reply_score=d.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=d.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=d.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=d.mixture_qa_direct_reply_switch,o.forEach(u=>{u.chat_type=="3"?(u.mixture_qa_direct_reply_score=d.mixture_qa_direct_reply_score,u.mixture_qa_direct_reply_switch=d.mixture_qa_direct_reply_switch=="true"?1:0):u.chat_type=="1"&&(u.library_qa_direct_reply_score=d.library_qa_direct_reply_score,u.library_qa_direct_reply_switch=d.library_qa_direct_reply_switch=="true"?1:0)}),$.value=!0};return ue(()=>$.value,d=>{d===!1&&Object.assign(o,l())},{immediate:!0}),c({open:w}),(d,u)=>{const S=de,q=oe,R=Re,m=Lt,b=Et,g=se;return i(),j(g,{width:"746px",open:$.value,"onUpdate:open":u[1]||(u[1]=p=>$.value=p),title:"聊天模式设置",onOk:k},{default:s(()=>[t(b,{class:"direct-box",value:a.value,"onUpdate:value":u[0]||(u[0]=p=>a.value=p)},{default:s(()=>[(i(!0),f(B,null,J(o,p=>(i(),j(m,{class:xe(["direct-item",{active:a.value==p.direct_id}]),value:p.direct_id,key:p.direct_id},{default:s(()=>[e("div",$a,I(p.direct_title),1),e("div",xa,I(p.direct_desc),1),le(e("div",wa,[e("div",Sa,[qa,t(S,null,rt({default:s(()=>[t(C(ee),{class:"question-icon"})]),_:2},[p.chat_type=="1"?{name:"title",fn:s(()=>[O("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:p.chat_type=="3"?{name:"title",fn:s(()=>[O("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Ca,[p.chat_type=="1"?(i(),j(q,{key:0,checkedValue:1,unCheckedValue:0,checked:p.library_qa_direct_reply_switch,"onUpdate:checked":M=>p.library_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):p.chat_type=="3"?(i(),j(q,{key:1,checkedValue:1,unCheckedValue:0,checked:p.mixture_qa_direct_reply_switch,"onUpdate:checked":M=>p.mixture_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):V("",!0)])])],512),[[ce,p.isQaDirectReply&&a.value==p.direct_id]]),le(e("div",Ia,[Ra,e("div",La,[p.chat_type=="1"?(i(),j(R,{key:0,value:p.library_qa_direct_reply_score,"onUpdate:value":M=>p.library_qa_direct_reply_score=M,disabled:!p.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):p.chat_type=="3"?(i(),j(R,{key:1,value:p.mixture_qa_direct_reply_score,"onUpdate:value":M=>p.mixture_qa_direct_reply_score=M,disabled:!p.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):V("",!0)]),Ea],512),[[ce,p.isQaDirectReply&&a.value==p.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Oa=D(Ua,[["__scopeId","data-v-fc008010"]]),Oe=_=>(G("data-v-2120501a"),_=_(),W(),_),Aa=Oe(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),Ma=Oe(()=>e("br",null,null,-1)),za=Oe(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),ja={class:"actions-box"},Va={class:"model-name"},Da={class:"form-box"},Na={__name:"index",setup(_){const c=x(!1),y=x(null),{robotInfo:v,updateRobotInfo:a}=Z("robotInfo"),l=Q({chat_type:v.chat_type,library_qa_direct_reply_score:v.library_qa_direct_reply_score,library_qa_direct_reply_switch:v.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:v.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:v.mixture_qa_direct_reply_switch}),o=k=>{l.chat_type=k.chat_type,l.library_qa_direct_reply_score=k.library_qa_direct_reply_score,l.library_qa_direct_reply_switch=k.library_qa_direct_reply_switch,l.mixture_qa_direct_reply_score=k.mixture_qa_direct_reply_score,l.mixture_qa_direct_reply_switch=k.mixture_qa_direct_reply_switch,$()},$=()=>{a({...Y(l)}),c.value=!1},n=()=>{y.value.open(Y(l)),c.value=!0};return(k,r)=>{const w=de,d=Le,u=ne;return i(),j(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":r[1]||(r[1]=S=>c.value=S),bodyStyle:{padding:0}},{tip:s(()=>[t(w,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Aa,Ma,za]),default:s(()=>[t(C(ee))]),_:1})]),extra:s(()=>[e("div",ja,[e("span",Va,I(C(v).chat_type=="1"?"仅知识库":C(v).chat_type=="2"?"直连模式":"混合模式"),1),t(d,{type:"vertical"}),t(u,{size:"small",onClick:r[0]||(r[0]=S=>n(!0))},{default:s(()=>[O("修改")]),_:1})])]),default:s(()=>[e("div",Da,[t(Oa,{ref_key:"ChatEditAlertRef",ref:y,onSave:o},null,512)])]),_:1},8,["isEdit"])}}},Pa=D(Na,[["__scopeId","data-v-2120501a"]]),Ta=_=>(G("data-v-0548f52d"),_=_(),W(),_),Ba={class:"switch-box"},Qa={class:"switch-box-body"},Fa={class:"switch-box-header"},Ja={class:"left-box"},Ka={class:"switch-box-title"},Ga={key:0,class:"title-tip"},Wa={class:"right-box"},Ha={class:"extra-box"},Za=Ta(()=>e("div",{class:"extra-box"},null,-1)),Ya={class:"switch-desc"},Xa={class:"switch-box-right"},el={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(_,{emit:c}){const y=c,v=_,a=x(v.value),l=o=>{y("update:value",o),y("change",o)};return(o,$)=>{const n=re,k=oe;return i(),f("div",Ba,[e("div",Qa,[e("div",Fa,[e("div",Ja,[t(n,{class:"switch-box-icon",name:v.iconName},null,8,["name"]),e("span",Ka,I(v.title),1),o.$slots.tip?(i(),f("span",Ga,[_e(o.$slots,"tip",{},void 0,!0)])):V("",!0)]),e("div",Wa,[e("div",Ha,[_e(o.$slots,"extra",{},()=>[Za],!0)])])]),e("div",Ya,[_e(o.$slots,"default",{},void 0,!0)])]),e("div",Xa,[t(k,{checked:a.value,"onUpdate:checked":$[0]||($[0]=r=>a.value=r),onChange:l,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},tl=D(el,[["__scopeId","data-v-0548f52d"]]),ol="/assets/img/empty-Bx9z1cwf.png",sl="/assets/img/phone-head-CDwwPhYa.png",nl="/assets/img/phone-body-CbEf8GZP.png",il="/assets/img/phone-footer-ClQtNpln.png",me=_=>(G("data-v-dce83f0d"),_=_(),W(),_),al={class:"common-problem-box"},ll={class:"left-content-box"},cl={key:0,class:"empty-box"},rl=me(()=>e("img",{src:ol,alt:""},null,-1)),dl=me(()=>e("div",{class:"title"},"暂无数据",-1)),_l=me(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),ul={key:1,class:"lists-box"},pl={class:"drag-btn"},ml={class:"title"},vl={class:"opration-box"},hl={class:"preview-box"},fl=me(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:sl,alt:""})],-1)),bl={class:"phone-body"},yl=me(()=>e("div",null,[e("img",{class:"body-img",src:nl,alt:""})],-1)),kl={key:0,class:"question-box"},gl=me(()=>e("div",{class:"name"},"常见问题",-1)),$l=me(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:il,alt:""})],-1)),xl={__name:"common-problem",setup(_){x(!1);const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo"),v=ge(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),a=x([]);a.value=v.value,ue(v,()=>{a.value=v.value});const l=ze.useForm,o=x(!1),$=x("添加问题"),n=Q({question:"",index:-1}),k=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:r,validate:w,validateInfos:d}=l(n,k),u=()=>{if(v.value.length>=10)return te.error("最多设置10条常用问题");o.value=!0,r(),n.question="",n.index=-1},S=(g,p)=>{o.value=!0,r(),n.question=g,n.index=p},q=g=>{let p=[];p=v.value.filter((M,L)=>g!=L),se.confirm({title:"提醒",icon:t(ft),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){y({common_question_list:JSON.stringify(p)})},onCancel(){}})},R=()=>{w().then(()=>{let g=[];n.index>=0?g=v.value.map((p,M)=>M===n.index?n.question:p):g=[n.question,...v.value],y({common_question_list:JSON.stringify(g)}),o.value=!1})},m=g=>{y({})},b=g=>{y({common_question_list:JSON.stringify(a.value)})};return(g,p)=>{const M=de,L=oe,P=Le,z=ne,h=re,H=pe,E=Ut,K=ze,N=se;return i(),f("div",al,[e("div",ll,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(M,null,{title:s(()=>[O("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(C(ee),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(L,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(c).enable_common_question,"onUpdate:checked":p[0]||(p[0]=T=>C(c).enable_common_question=T),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(P,{type:"vertical"}),t(z,{type:"primary",size:"small",onClick:u},{default:s(()=>[O("添加")]),_:1})]),default:s(()=>[v.value.length==0?(i(),f("div",cl,[rl,dl,_l,t(z,{onClick:u,type:"primary"},{default:s(()=>[O("立即添加")]),_:1})])):(i(),f("div",ul,[t(C(Ee),{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=T=>a.value=T),handle:".drag-btn","item-key":"index",onEnd:b},{item:s(({element:T,index:A})=>[(i(),f("div",{class:"list-item",key:A},[e("span",pl,[t(h,{name:"drag"})]),e("div",ml,I(T),1),e("div",vl,[t(C(yt),{onClick:F=>S(T,A)},null,8,["onClick"]),t(C(ve),{onClick:F=>q(A)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",hl,[fl,e("div",bl,[yl,v.value.length&&C(c).enable_common_question=="true"?(i(),f("div",kl,[gl,(i(!0),f(B,null,J(v.value,T=>(i(),f("div",{class:"list-item",key:T},I(T),1))),128))])):V("",!0)]),$l]),t(N,{open:o.value,"onUpdate:open":p[3]||(p[3]=T=>o.value=T),title:$.value,onOk:R,width:"476px"},{default:s(()=>[t(K,{class:"form-box",layout:"vertical"},{default:s(()=>[t(E,dt({label:"问题名称"},C(d).question),{default:s(()=>[t(H,{maxLength:100,value:n.question,"onUpdate:value":p[2]||(p[2]=T=>n.question=T),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},wl=D(xl,[["__scopeId","data-v-dce83f0d"]]),Sl=e("span",null,null,-1),ql=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),Cl={__name:"display-aitations",setup(_){const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo"),v=x(!1);ue(()=>c.answer_source_switch,l=>{v.value=l=="true"},{immediate:!0});const a=()=>{y({answer_source_switch:v.value?"true":"false"})};return(l,o)=>(i(),j(tl,{title:"显示引文","icon-name":"jibenpeizhi",value:v.value,"onUpdate:value":o[0]||(o[0]=$=>v.value=$),onChange:a},{extra:s(()=>[Sl]),default:s(()=>[ql]),_:1},8,["value"]))}},tt=_=>(G("data-v-73894b10"),_=_(),W(),_),Il=tt(()=>e("span",null,null,-1)),Rl=tt(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),Ll={__name:"show-like",setup(_){const{robotInfo:c,updateRobotInfo:y}=Z("robotInfo"),v=a=>{y({})};return(a,l)=>{const o=oe;return i(),j(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:s(()=>[Il]),default:s(()=>[Rl,t(o,{onChange:v,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(c).feedback_switch,"onUpdate:checked":l[0]||(l[0]=$=>C(c).feedback_switch=$),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},El=D(Ll,[["__scopeId","data-v-73894b10"]]),Ul={key:0,class:"robot-config-page"},Ol={class:"setting-box"},Al={class:"setting-box"},Ml={class:"setting-box"},zl={class:"setting-box"},jl={class:"setting-box"},Vl={class:"setting-box"},Dl={class:"setting-box"},Nl={class:"setting-box"},Pl={class:"setting-box"},Tl={class:"setting-box"},Bl={class:"setting-box"},Ql={class:"setting-box"},Fl={class:"setting-box"},Jl={key:1,class:"robot-config-page"},Kl={__name:"index",setup(_){const c=Ot(),y=x(null),{robotInfo:v}=_t(c),{getRobot:a}=c,l=()=>{y.value.scrollTop=y.value.scrollHeight},o=x(1),$=x(!1),n=Q(v.value);ut("robotInfo",{robotInfo:n,updateRobotInfo:w=>{let d=JSON.parse(JSON.stringify(w));w.robot_avatar&&(d.robot_avatar=new File([w.robot_avatar],w.robot_avatar.name)),Object.assign(n,d),r()},scrollBoxToBottom:l});const r=()=>{let w;n.robot_avatar&&(w=new File([n.robot_avatar],n.robot_avatar.name));let d=JSON.parse(JSON.stringify(Y(n)));w&&(d.robot_avatar=w);let u=d.welcomes;u.question=u.question.map(q=>q.content),d.welcomes=JSON.stringify(u),d.prompt_struct=JSON.stringify(d.prompt_struct);let S=d.unknown_question_prompt;S.question=S.question.map(q=>q.content),d.unknown_question_prompt=JSON.stringify(S),delete d.robot_avatar_url,$.value=!0,gt(d).then(q=>{if(q.res!=0)return te.error(q.msg);$.value=!1,te.success("保存成功"),a(n.id)}).catch(()=>{$.value=!1})};return(w,d)=>{const u=De,S=Ne;return i(),f(B,null,[t(S,{activeKey:o.value,"onUpdate:activeKey":d[0]||(d[0]=q=>o.value=q)},{default:s(()=>[(i(),j(u,{key:1,tab:"基础配置"})),(i(),j(u,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),o.value==1?(i(),f("div",Ul,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:y},[e("div",Ol,[t(io)]),e("div",Al,[t(gi)]),e("div",Ml,[t(Ls)]),e("div",zl,[t(mn)]),e("div",jl,[t(Di)]),e("div",Vl,[t(Hi)]),e("div",Dl,[t(Pa)]),e("div",Nl,[t(ra)]),e("div",Pl,[t(ga)]),e("div",Tl,[t(pa)]),e("div",Bl,[t(fa)]),e("div",Ql,[t(Cl)]),e("div",Fl,[t(El)])],512)])):(i(),f("div",Jl,[t(wl)]))],64)}}},ar=D(Kl,[["__scopeId","data-v-776aee8c"]]);export{ar as default};
