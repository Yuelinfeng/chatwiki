import{$ as B,r as w,A as $,v as V,L as b,P as z,Q as l,V as o,j as t,U as A,u as v,a3 as P,a4 as T,b as j,M as k,a8 as J,F as Y,a1 as G,a7 as x,Y as C}from"./vue-chunks-CwaUyaYI.js";import{c as Q,g as H,d as K}from"./index-CnXWAABj.js";import{_ as U,e as D,bn as F,M as N,d as W,bo as X,E as Z}from"../../index-CyiwD4fB.js";import{A as ee}from"./avatar-input-CJgW6Rj5.js";import{t as ae}from"./validate-8MtiUsxW.js";import{F as O,_ as oe}from"./index-BfwAi9te.js";import"./index-D8wyBl4m.js";import{I as te}from"./Input-Da8aOOO7.js";import{_ as re}from"./TextArea-CBrdn4Xi.js";import{_ as se,M as ne}from"./index-CJQbsUHv.js";import"./index-CSJ_nh2m.js";import{D as ie}from"./dropdown-DVS-KA0T.js";import{P as le}from"./PlusCircleOutlined-5v0pOBZJ.js";import{M as de}from"./MoreOutlined-CGTyGwVY.js";import"./dayjs-9pTjq58W.js";import"./axios-Cm0UX6qg.js";import"./qs-DFTLuGGg.js";import"./crypto-js-Dhiry31a.js";import"./PlusOutlined-C0mU79gr.js";import"./index-CmFdMhoo.js";import"./partition-D90jzHoI.js";import"./colors-DcCY69fx.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-DAieTXDw.js";import"./inputProps-CBCbV3dR.js";import"./index-D97187b8.js";import"./CheckOutlined-s6Wk7FwS.js";import"./useRefs-kFALIf8n.js";import"./collapseMotion-1cFzdZPo.js";import"./FormItemContext-P-hc85qB.js";import"./responsiveObserve-DlRq3u3d.js";import"./QuestionCircleOutlined-CGJPYPeU.js";import"./index-B-VUp88E.js";import"./Search-DC1Sahrq.js";import"./SearchOutlined-eG2BTg8a.js";import"./index-gIgkZ2l6.js";import"./shallowequal-Cp-ZNK9a.js";import"./slide-kUXvfLu3.js";import"./Dropdown-McYrymK_.js";import"./RightOutlined-BdOii4h-.js";import"./move-7FTT7O3Y.js";const _e=d=>(P("data-v-a99444a6"),d=d(),T(),d),pe={class:"form-box"},ce=_e(()=>o("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1)),me={__name:"add-library-model",setup(d,{expose:L}){D.config({duration:2});const I=B(),p=w(!1),S=O.useForm,c=w(!1),e=$({library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:F,robot_avatar_url:F,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1}),y=$({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:h,validateInfos:u}=S(e,y),q=a=>{e.avatar=a.file},M=()=>{p.value=!1},n=()=>{h().then(()=>{i()}).catch(a=>{})},i=()=>{let a=new FormData,s=JSON.parse(JSON.stringify(e));a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",s.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar||F),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(ae(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),c.value=!0,Q(a).then(r=>{D.success("创建成功"),p.value=!1;let _="/library/details/knowledge-document",g={id:r.data.id};e.doc_type==3&&(_="/library/preview",g={id:r.data.file_ids[0]}),I.push({path:_,query:g}),c.value=!1,p.value=!1}).catch(()=>{c.value=!1})};return L({show:()=>{p.value=!0}}),V(()=>{}),(a,s)=>{const r=te,_=oe,g=re,R=O,E=N;return b(),z(E,{open:p.value,"onUpdate:open":s[3]||(s[3]=m=>p.value=m),title:"添加知识库",onOk:n,confirmLoading:c.value,onCancel:M,width:"640px"},{default:l(()=>[o("div",pe,[t(R,{"label-col":{span:5}},{default:l(()=>[t(_,A({ref:"name",label:"知识库名称"},v(u).library_name),{default:l(()=>[t(r,{value:e.library_name,"onUpdate:value":s[0]||(s[0]=m=>e.library_name=m),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),t(_,A({label:"知识库简介"},v(u).library_intro),{default:l(()=>[t(g,{value:e.library_intro,"onUpdate:value":s[1]||(s[1]=m=>e.library_intro=m),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1},16),t(_,A({ref:"name",label:"知识库封面"},v(u).robot_avatar_url),{default:l(()=>[t(ee,{value:e.robot_avatar_url,"onUpdate:value":s[2]||(s[2]=m=>e.robot_avatar_url=m),onChange:q},null,8,["value"]),ce]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},ue=U(me,[["__scopeId","data-v-a99444a6"]]),fe=d=>(P("data-v-c2ae1d50"),d=d(),T(),d),ve={"bg-color":"#f5f9ff",class:"library-page"},be={class:"library-page-body"},ye={class:"list-box"},he={key:0,class:"list-item-wrapper"},ge=fe(()=>o("span",{class:"add-library-text"},"新增知识库",-1)),ke=["onClick"],xe={class:"item-header"},Ce={class:"library-title"},we=["onClick"],Le=["onClick"],Ie={class:"library-desc"},Se={class:"library-size"},qe={class:"file-size"},Me={__name:"library-list",setup(d){const L=W();let{role_permission:I}=L;const p=j(()=>I.includes("LibraryCreate")),S=B(),c=w(null),e=()=>{c.value.show()},y=w([]),h=()=>{H({}).then(n=>{y.value=n.data||[]})};h();const u=n=>{S.push({name:"libraryDetails",query:{id:n.id}})},q=n=>{let i=3,f=N.confirm({title:`删除${n.library_name}`,icon:t(Z),content:"您确定要删除此知识库吗？",okText:i+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){M(n)},onCancel(){}}),a=setInterval(()=>{i==1?(f.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(a),a=void 0):(i-=1,f.update({okText:i+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},M=({id:n})=>{K({id:n}).then(()=>{D.success("删除成功"),h()})};return(n,i)=>{const f=se,a=ne,s=ie;return b(),k("div",ve,[o("div",be,[o("div",ye,[p.value?(b(),k("div",he,[o("div",{class:"list-item add-library",onClick:e},[t(v(le),{class:"add-library-icon"}),ge])])):J("",!0),(b(!0),k(Y,null,G(y.value,r=>(b(),k("div",{class:"list-item-wrapper",key:r.id},[o("div",{class:"list-item",onClick:x(_=>u(r),["stop"])},[o("div",xe,[o("div",Ce,C(r.library_name),1),o("span",{class:"item-action",onClick:i[1]||(i[1]=x(()=>{},["stop"]))},[t(s,null,{overlay:l(()=>[t(a,null,{default:l(()=>[t(f,null,{default:l(()=>[o("a",{href:"javascript:;",onClick:x(_=>u(r),["stop"])},"管 理",8,we)]),_:2},1024),t(f,null,{default:l(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:_=>q(r)},"删 除",8,Le)]),_:2},1024)]),_:2},1024)]),default:l(()=>[o("span",{class:"menu-btn",onClick:i[0]||(i[0]=x(()=>{},["prevent"]))},[t(v(de))])]),_:2},1024)])]),o("div",Ie,C(r.library_intro),1),o("div",Se,[o("span",null,"文档数："+C(r.file_total),1),o("span",qe,"文档大小："+C(v(X)(r.file_size)),1)])],8,ke)]))),128))])]),t(ue,{ref_key:"addLibraryModelRef",ref:c},null,512)])}}},ba=U(Me,[["__scopeId","data-v-c2ae1d50"]]);export{ba as default};
