import{M as s,N as v,W as e,k as t,Y as I,Z as S,U as ue,a7 as A,Q as j,S as i,X as nt,a6 as Se,e as $,d as Z,B as Q,G as le,H as ce,u as k,aa as Y,a1 as K,a2 as G,a5 as it,F as V,$ as J,w as pe,l as at,j as Re,ad as be,af as ye,x as qe,D as lt,b as xe,a0 as ct,z as rt,ac as _t,V as dt,a9 as ut,p as pt}from"./vue-chunks-DWnFCQSz.js";import{b as N,d as re,B as ne,X as mt,Y as ze,k as te,M as oe,Z as he,$ as vt,a0 as ht,W as ft,a1 as we,E as bt}from"../../index-CAb1tT-W.js";import{_ as ke}from"./index-_2Ia2fBW.js";import{C as yt,E as kt}from"./cu-upload-tO8XfiJt.js";import"./index-ZqzVpCxK.js";import{I as me}from"./Input-DuH7dn02.js";import{_ as Ce}from"./TextArea-CYqPccpO.js";import{C as Ve}from"./cu-scroll-DUEEhpqe.js";import{f as gt,c as $t}from"./index-DcJ9RuG3.js";import{_ as xt}from"./index-DYh2GD9s.js";import{S as Le}from"./index-BgOt2FQs.js";import{D as wt}from"./DownOutlined-DeYc9KSb.js";import{U as St}from"./UpOutlined-BgTfLOYX.js";import{_ as Ne,T as Pe,a as qt}from"./empty-CqLsGxfj.js";import{P as Ue}from"./PlusOutlined-lz80p0a0.js";import{_ as se}from"./index-BSYjd5qd.js";import{c as Te}from"./index-FFGVkxQ5.js";import{S as Be,a as Qe,_ as Fe}from"./index-dibcP1Tn.js";import{_ as Je}from"./index-DA4wOIbE.js";import{_ as Ee}from"./index-Crh3gx22.js";import{Q as ee}from"./QuestionCircleOutlined-OoMpIVY2.js";import{_ as Ct,a as It}from"./index-9E1AKCNN.js";import{_ as _e}from"./index-DgLE2dBi.js";import{g as Ke}from"./index-CYunvooy.js";import{S as Rt}from"./SearchOutlined-ARjgS9_W.js";import{S as Lt}from"./SyncOutlined-bGlLIyzb.js";import{C as Ge,_ as He}from"./index-B5I2IoyU.js";import{_ as We}from"./index-DVdSWyGZ.js";import{_ as Ut}from"./recommendation-AQ4_FPQ9.js";import{R as Et}from"./RightOutlined-BUprEUSn.js";import{g as Ze}from"./index-SFtmeSFR.js";import{d as Oe}from"./vuedraggable.umd-DPgBjE-X.js";import"./index-jBVis6Wo.js";import{R as Ot,_ as At}from"./RadioButton-DeoXmEag.js";import{F as De,_ as Mt}from"./index-BwLqZyOz.js";import{_ as jt}from"./index-mg07icBV.js";import{u as zt}from"./robot-CZSPC1oC.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./FormItemContext-8D78_qVD.js";import"./index-CviHPZsF.js";import"./Search-DXRfWhTX.js";import"./isPlainObject-BZk97rKt.js";import"./inputProps-C93oOyRv.js";import"./Password-CS7ye1e2.js";import"./statusUtils-DZGhn0Kh.js";import"./index-B3zCNJkU.js";import"./Trigger-JKklW7kX.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-DIkUhcQM.js";import"./index-Zgzt-QK_.js";import"./shallowequal-C0Ji8tJB.js";import"./collapseMotion-DNnsVK8G.js";import"./slide-DfWuJDbJ.js";import"./Dropdown-DKZymAyI.js";import"./useRefs-CH9tJ50T.js";import"./pick-DXKUorQm.js";import"./CheckOutlined-BDgNr5ZU.js";import"./move-nlQWRDsj.js";import"./index-DzhuYAPB.js";import"./Checkbox-CQjSeTte.js";import"./index-BsPiffqt.js";import"./responsiveObserve-9b93vBMn.js";const Dt={class:"edit-box-header"},Vt={class:"left-box"},Nt={class:"edit-box-title"},Pt={key:0},Tt={key:0,class:"title-tip"},Bt={class:"right-box"},Qt={class:"extra-box"},Ft={class:"actions-box"},Jt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(d,{emit:r}){const y=r,m=d,a=o=>{y("edit"),y("update:isEdit",o)},l=()=>{y("save")};return(o,x)=>{const n=re,g=ne,_=ke;return s(),v("div",{class:Se(["edit-box",{"is-edit":d.isEdit}])},[e("div",Dt,[e("div",Vt,[t(n,{class:"edit-box-icon",name:m.iconName},null,8,["name"]),e("span",Nt,[I(S(m.title)+" ",1),o.$slots.icon?(s(),v("span",Pt,[ue(o.$slots,"icon",{},void 0,!0)])):A("",!0)]),o.$slots.tip?(s(),v("span",Tt,[ue(o.$slots,"tip",{},void 0,!0)])):A("",!0)]),e("div",Bt,[e("div",Qt,[ue(o.$slots,"extra",{},()=>[e("div",Ft,[m.isEdit?(s(),j(_,{key:0,gap:8},{default:i(()=>[t(g,{onClick:l,size:"small",type:"primary"},{default:i(()=>[I("保存")]),_:1}),t(g,{onClick:x[0]||(x[0]=q=>a(!1)),size:"small"},{default:i(()=>[I("取消")]),_:1})]),_:1})):(s(),j(g,{key:1,onClick:x[1]||(x[1]=q=>a(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:nt({...d.bodyStyle})},[ue(o.$slots,"default",{},void 0,!0)],4)],2)}}},X=N(Jt,[["__scopeId","data-v-dbe09743"]]),Ye=d=>(K("data-v-899bcb03"),d=d(),G(),d),Kt={class:"robot-form-box"},Gt={class:"form-item"},Ht=Ye(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Wt={class:"form-item-body robot-name-item"},Zt={class:"robot-avetar-upload"},Yt=["src"],Xt={class:"robot-name-box"},eo={class:"form-item"},to=Ye(()=>e("div",{class:"form-item-label"},"简介",-1)),oo={class:"form-item-body"},so={class:"robot-info-box"},no={class:"robot-name-box"},io=["src"],ao={class:"robot-name"},lo={class:"robot-intro"},co={__name:"basic-config",setup(d){const r=$(!1),{robotInfo:y,updateRobotInfo:m}=Z("robotInfo"),a=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),l=()=>{m({...Y(a)}),r.value=!1},o=n=>{let g=n[0];return a.robot_avatar=g,mt(g).then(_=>{a.robot_avatar_url=_}),!1},x=()=>{a.robot_name=y.robot_name,a.robot_intro=y.robot_intro,a.robot_avatar=y.robot_avatar,a.robot_avatar_url=y.robot_avatar_url};return(n,g)=>{const _=me,q=Ce;return s(),j(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:r.value,"onUpdate:isEdit":g[2]||(g[2]=p=>r.value=p),onSave:l,onEdit:x},{default:i(()=>[le(e("div",Kt,[e("div",Gt,[Ht,e("div",Wt,[t(yt,{accept:"image/*",onChange:o},{default:i(()=>[e("div",Zt,[a.robot_avatar_url?(s(),v("img",{key:0,class:"robot-avetar",src:a.robot_avatar_url},null,8,Yt)):A("",!0)])]),_:1}),e("div",Xt,[t(_,{value:a.robot_name,"onUpdate:value":g[0]||(g[0]=p=>a.robot_name=p),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",eo,[to,e("div",oo,[t(q,{rows:3,value:a.robot_intro,"onUpdate:value":g[1]||(g[1]=p=>a.robot_intro=p),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ce,r.value]]),le(e("div",so,[e("div",no,[e("img",{class:"robot-avatar",src:k(y).robot_avatar_url,alt:""},null,8,io),e("span",ao,S(k(y).robot_name),1)]),e("div",lo,S(k(y).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ce,!r.value]])]),_:1},8,["isEdit"])}}},ro=N(co,[["__scopeId","data-v-899bcb03"]]),Xe=d=>(K("data-v-896a48d0"),d=d(),G(),d),_o={class:"ai-create-box"},uo={class:"input-box"},po=Xe(()=>e("span",null,"生成",-1)),mo={class:"quick-tags-box"},vo=Xe(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),ho={class:"ai-list-box"},fo={key:0,class:"loading-box"},bo={key:0,class:"prompt-list-box"},yo={class:"prompt-list"},ko={class:"prompt-header"},go={class:"prompt-title"},$o={class:"prompt-content"},xo={class:"prompt-list"},wo={class:"prompt-header"},So={class:"prompt-title"},qo={class:"prompt-content"},Co={class:"prompt-list"},Io={class:"prompt-header"},Ro={class:"prompt-title"},Lo={class:"prompt-content"},Uo={class:"prompt-list"},Eo={class:"prompt-header"},Oo={class:"prompt-title"},Ao={class:"prompt-content"},Mo={class:"prompt-list"},jo={class:"prompt-header"},zo={class:"prompt-title"},Do={class:"prompt-content"},Vo={class:"prompt-header"},No={class:"prompt-title"},Po={class:"prompt-content"},To={key:1,class:"empty-box"},Bo={__name:"ai-create-prompt",emits:["handleAiSave"],setup(d,{expose:r,emit:y}){const m=ze.PRESENTED_IMAGE_SIMPLE,a=$(!1),l=$(!1),o=it().query,x=y,n=$(""),g=$(!1),_=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],q=$("在上方输入框输入要求，点击生成提示词"),p=()=>{u.value=!1,R.promptStruct=C,n.value="",q.value="在上方输入框输入要求，点击生成提示词",a.value=!0},u=$(!1),C={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},R=Q({promptStruct:C}),L=w=>{n.value=w},h=()=>{if(!n.value)return te.error("请输入AI 生成提示词");if(g.value)return te.error("正在生成中...");g.value=!0,gt({id:o.id,demand:n.value}).then(w=>{R.promptStruct=JSON.parse(w.data.promptStruct),u.value=!0}).finally(()=>{g.value=!1}).catch(w=>{u.value=!1,q.value=w.msg})},b=()=>{if(!u.value)return te.error("请先生成提示词");x("handleAiSave",R.promptStruct),a.value=!1};return r({show:p}),(w,f)=>{const M=ne,U=me,P=re,T=xt,D=Le,z=ze,c=Ve,H=oe;return s(),v("div",null,[t(H,{open:a.value,"onUpdate:open":f[1]||(f[1]=F=>a.value=F),title:"AI 生成提示词",width:746},{footer:i(()=>[t(M,{type:"primary",loading:l.value,onClick:b},{default:i(()=>[I("使用该提示")]),_:1},8,["loading"])]),default:i(()=>[e("div",_o,[e("div",uo,[t(U,{style:{width:"100%"},value:n.value,"onUpdate:value":f[0]||(f[0]=F=>n.value=F),size:"large",onPressEnter:h,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:h},[t(P,{name:"ai-mark"}),po])]),e("div",mo,[vo,(s(),v(V,null,J(_,F=>t(T,{key:F.title,onClick:B=>L(F.title),color:"blue"},{default:i(()=>[I(S(F.title),1)]),_:2},1032,["onClick"])),64))]),e("div",ho,[t(c,{style:{height:"100%"}},{default:i(()=>[g.value?(s(),v("div",fo,[t(D,{tip:"正在生成中..."})])):(s(),v(V,{key:1},[u.value?(s(),v("div",bo,[e("div",yo,[e("div",ko,[e("div",go,S(R.promptStruct.role.subject),1)]),e("div",$o,S(R.promptStruct.role.describe),1)]),e("div",xo,[e("div",wo,[e("div",So,S(R.promptStruct.task.subject),1)]),e("div",qo,S(R.promptStruct.task.describe),1)]),e("div",Co,[e("div",Io,[e("div",Ro,S(R.promptStruct.constraints.subject),1)]),e("div",Lo,S(R.promptStruct.constraints.describe),1)]),e("div",Uo,[e("div",Eo,[e("div",Oo,S(R.promptStruct.output.subject),1)]),e("div",Ao,S(R.promptStruct.output.describe),1)]),e("div",Mo,[e("div",jo,[e("div",zo,S(R.promptStruct.tone.subject),1)]),e("div",Do,S(R.promptStruct.tone.describe),1)]),(s(!0),v(V,null,J(R.promptStruct.custom,(F,B)=>(s(),v("div",{class:"prompt-list",key:B+F.key?F.key:""},[e("div",Vo,[e("div",No,S(F.subject),1)]),e("div",Po,S(F.describe),1)]))),128))])):(s(),v("div",To,[t(z,{image:k(m),description:q.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Qo=N(Bo,[["__scopeId","data-v-896a48d0"]]),Fo={class:"prompt-box"},Jo={class:"tab-header"},Ko={key:0,class:"opt-block"},Go={key:1,class:"opt-block"},Ho={class:"tip-text"},Wo={key:0,class:"prompt-list-box"},Zo={class:"prompt-list"},Yo={class:"prompt-header"},Xo={class:"prompt-title"},es={key:0,class:"btn-wrapper-box"},ts={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={key:0,class:"btn-wrapper-box"},as={class:"prompt-content"},ls={class:"prompt-list"},cs={class:"prompt-header"},rs={class:"prompt-title"},_s={key:0,class:"btn-wrapper-box"},ds={class:"prompt-content"},us={class:"prompt-list"},ps={class:"prompt-header"},ms={class:"prompt-title"},vs={key:0,class:"btn-wrapper-box"},hs={class:"swich-item"},fs={class:"swich-item"},bs={class:"prompt-content"},ys={class:"prompt-list"},ks={class:"prompt-header"},gs={class:"prompt-title"},$s={key:0,class:"btn-wrapper-box"},xs={class:"prompt-content"},ws={class:"prompt-header"},Ss={class:"prompt-title",style:{flex:"1"}},qs={key:0,class:"btn-wrapper-box"},Cs=["onClick"],Is={class:"prompt-content"},Rs={key:0,class:"add-theme-block"},Ls={class:"show-more-block"},Us={key:1,class:"diy-prompt-box"},Es={key:0,class:"diy-switch-box"},Os={class:"swich-item"},As={class:"swich-item"},ie="- 请使用markdown格式回答问题。",ae="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Ms={__name:"system-prompt-words",setup(d){const r=$(!1),{robotInfo:y,updateRobotInfo:m}=Z("robotInfo");let a={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”"};const l=$({}),o=$(!1),x=$(!1),n=$(!1),g=$(!1),_=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),q=$(localStorage.getItem("system_prompt_words_ishide")=="1"),p=()=>{q.value=!q.value,localStorage.setItem("system_prompt_words_ishide",q.value?1:0)},u=(z,c)=>z.includes(c),C=$(y.prompt_type);pe(()=>y,()=>{_.prompt=y.prompt,_.prompt_struct=y.prompt_struct,l.value=y.prompt_struct_default},{immediate:!0,deep:!0}),pe(()=>_.prompt_struct.output.describe,z=>{o.value=u(z,ie),x.value=u(z,ae)},{immediate:!0,deep:!0}),pe(()=>_.prompt,z=>{n.value=u(z,ie),g.value=u(z,ae)},{immediate:!0,deep:!0});const R=(z,c)=>{z?(c=="outSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+ie:_.prompt_struct.output.describe+=ie),c=="imgSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+ae:_.prompt_struct.output.describe+=ae)):(c=="outSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),c=="imgSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(ae,"g"),"")),_.prompt_struct.output.describe=_.prompt_struct.output.describe.trim())},L=(z,c)=>{z?(c=="outDiySwitch"&&(_.prompt?_.prompt+=`
`+ie:_.prompt+=ie),c=="imgDiySwitch"&&(_.prompt?_.prompt+=`
`+ae:_.prompt+=ae)):(c=="outDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(ie,"g"),"")),c=="imgDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(ae,"g"),"")),_.prompt=_.prompt.trim())},h=z=>{_.prompt_struct[z].describe=l.value[z].describe},b=()=>{_.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),C.value=1},w=z=>{_.prompt_struct.custom.splice(z,1)},f=()=>{m({...Y(_),prompt_type:C.value}),r.value=!1},M=z=>{C.value=1,m({prompt_type:C.value,prompt:_.prompt,prompt_struct:z}),r.value=!1},U=()=>{r.value=!0},P=()=>{r.value=!1},T=$(null),D=()=>{T.value.show()};return(z,c)=>{const H=Ne,F=Pe,B=re,O=ne,W=ke,de=Ce,ge=se,st=me;return s(),v("div",Fo,[e("div",Jo,[t(F,{activeKey:C.value,"onUpdate:activeKey":c[0]||(c[0]=E=>C.value=E)},{default:i(()=>[(s(),j(H,{key:1,tab:"结构化提示词"})),(s(),j(H,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),r.value?(s(),v("div",Ko,[e("div",{class:"ai-mark-box",onClick:D},[t(B,{name:"ai-mark"}),I(" AI自动生成 ")]),t(W,{gap:8},{default:i(()=>[t(O,{size:"small",type:"primary",onClick:f},{default:i(()=>[I("保存")]),_:1}),t(O,{size:"small",onClick:P},{default:i(()=>[I("取消")]),_:1})]),_:1})])):(s(),v("div",Go,[e("span",Ho,"当前类型："+S(C.value==1?"结构化提示词":"自定义提示词"),1),t(O,{size:"small",onClick:U},{default:i(()=>[I("修改")]),_:1})]))]),C.value==1?(s(),v("div",Wo,[e("div",Zo,[e("div",Yo,[e("div",Xo,S(_.prompt_struct.role.subject),1),r.value?(s(),v("div",es,[e("a",{onClick:c[1]||(c[1]=E=>h("role"))},"恢复默认")])):A("",!0)]),e("div",ts,[t(de,{bordered:!1,disabled:!r.value,value:_.prompt_struct.role.describe,"onUpdate:value":c[2]||(c[2]=E=>_.prompt_struct.role.describe=E),placeholder:k(a).role,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",os,[e("div",ss,[e("div",ns,S(_.prompt_struct.task.subject),1),r.value?(s(),v("div",is,[e("a",{onClick:c[3]||(c[3]=E=>h("task"))},"恢复默认")])):A("",!0)]),e("div",as,[t(de,{bordered:!1,disabled:!r.value,value:_.prompt_struct.task.describe,"onUpdate:value":c[4]||(c[4]=E=>_.prompt_struct.task.describe=E),placeholder:k(a).task,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),q.value?(s(),v(V,{key:0},[e("div",ls,[e("div",cs,[e("div",rs,S(_.prompt_struct.constraints.subject),1),r.value?(s(),v("div",_s,[e("a",{onClick:c[5]||(c[5]=E=>h("constraints"))},"恢复默认")])):A("",!0)]),e("div",ds,[t(de,{bordered:!1,disabled:!r.value,value:_.prompt_struct.constraints.describe,"onUpdate:value":c[6]||(c[6]=E=>_.prompt_struct.constraints.describe=E),placeholder:k(a).constraints,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",us,[e("div",ps,[e("div",ms,S(_.prompt_struct.output.subject),1),r.value?(s(),v("div",vs,[e("div",hs,[I(" 输出markdown： "),t(ge,{onChange:c[7]||(c[7]=E=>R(E,"outSwitch")),checked:o.value,"onUpdate:checked":c[8]||(c[8]=E=>o.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",fs,[I(" 回复图片： "),t(ge,{onChange:c[9]||(c[9]=E=>R(E,"imgSwitch")),checked:x.value,"onUpdate:checked":c[10]||(c[10]=E=>x.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:c[11]||(c[11]=E=>h("output"))},"恢复默认")])):A("",!0)]),e("div",bs,[t(de,{bordered:!1,disabled:!r.value,value:_.prompt_struct.output.describe,"onUpdate:value":c[12]||(c[12]=E=>_.prompt_struct.output.describe=E),placeholder:k(a).output,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),e("div",ys,[e("div",ks,[e("div",gs,S(_.prompt_struct.tone.subject),1),r.value?(s(),v("div",$s,[e("a",{onClick:c[13]||(c[13]=E=>h("tone"))},"恢复默认")])):A("",!0)]),e("div",xs,[t(de,{bordered:!1,disabled:!r.value,value:_.prompt_struct.tone.describe,"onUpdate:value":c[14]||(c[14]=E=>_.prompt_struct.tone.describe=E),placeholder:k(a).tone,"auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","placeholder"])])]),(s(!0),v(V,null,J(_.prompt_struct.custom,(E,je)=>(s(),v("div",{class:"prompt-list",key:je+E.key?E.key:""},[e("div",ws,[e("div",Ss,[t(st,{bordered:!1,disabled:!r.value,style:{width:"100%"},value:E.subject,"onUpdate:value":$e=>E.subject=$e,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),r.value?(s(),v("div",qs,[e("div",{class:"hover-btn-box",onClick:$e=>w(je)},[t(k(he))],8,Cs)])):A("",!0)]),e("div",Is,[t(de,{bordered:!1,disabled:!r.value,value:E.describe,"onUpdate:value":$e=>E.describe=$e,placeholder:"请输入","auto-size":{minRows:1,maxRows:5}},null,8,["disabled","value","onUpdate:value"])])]))),128)),r.value?(s(),v("div",Rs,[t(O,{onClick:b,block:"",icon:at(k(Ue))},{default:i(()=>[I("添加主题")]),_:1},8,["icon"])])):A("",!0)],64)):A("",!0),e("div",Ls,[e("div",{class:"btn-item",onClick:p},[q.value?(s(),v(V,{key:1},[I("收起"),t(k(St))],64)):(s(),v(V,{key:0},[I("展开"),t(k(wt))],64))])])])):(s(),v("div",Us,[r.value?(s(),v("div",Es,[e("div",Os,[I(" 输出markdown： "),t(ge,{size:"small",onChange:c[15]||(c[15]=E=>L(E,"outDiySwitch")),checked:n.value,"onUpdate:checked":c[16]||(c[16]=E=>n.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",As,[I(" 回复图片： "),t(ge,{size:"small",onChange:c[17]||(c[17]=E=>L(E,"imgDiySwitch")),checked:g.value,"onUpdate:checked":c[18]||(c[18]=E=>g.value=E),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):A("",!0),t(de,{bordered:r.value,value:_.prompt,"onUpdate:value":c[19]||(c[19]=E=>_.prompt=E),disabled:!r.value,placeholder:"请输入","auto-size":{minRows:5,maxRows:15}},null,8,["bordered","value","disabled"])])),t(Qo,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:T},null,512)])}}},js=N(Ms,[["__scopeId","data-v-029fbd64"]]),fe=d=>(K("data-v-45e42f1f"),d=d(),G(),d),zs={class:"actions-box"},Ds={class:"setting-info-block"},Vs={class:"set-item w-100"},Ns={class:"set-item"},Ps={class:"set-item"},Ts={class:"set-item"},Bs={class:"set-item"},Qs={class:"form-box"},Fs={class:"form-item"},Js=fe(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),Ks={class:"form-item-body"},Gs=["src"],Hs={key:0},Ws={key:1},Zs={class:"form-item"},Ys={class:"form-item-label"},Xs=fe(()=>e("span",null,"温度 ",-1)),en={class:"form-item-body"},tn={class:"number-box"},on={class:"number-slider-box"},sn={class:"number-input-box"},nn={class:"form-item"},an={class:"form-item-label"},ln=fe(()=>e("span",null,"最大token ",-1)),cn={class:"form-item-body"},rn={class:"number-box"},_n={class:"number-slider-box"},dn={class:"number-input-box"},un={class:"form-item"},pn={class:"form-item-label"},mn=fe(()=>e("span",null,"上下文数量 ",-1)),vn={class:"form-item-body"},hn={class:"number-box"},fn={class:"number-slider-box"},bn={class:"number-input-box"},yn={class:"form-item justify-between"},kn={class:"form-item-label"},gn=fe(()=>e("span",null,"显示推理过程 ",-1)),$n=fe(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),xn={__name:"model-settings",setup(d){const r=["azure","ollama","xinference","openaiAgent"],y=["azure"],m=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),a=$([]),l=$(!1),{robotInfo:o,updateRobotInfo:x}=Z("robotInfo"),n=Q({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),g=$(""),_=$(""),q=$(""),p=(h,b)=>{const w=b.current_obj;n.use_model=r.indexOf(w.model_define)>-1&&w.deployment_name?w.deployment_name:w.name,g.value=w.model_define,n.model_config_id=w.id||b.model_config_id},u=()=>{q.value=n.use_model,y.indexOf(g.value)>-1&&(n.use_model="默认"),x({...Y(n)}),l.value=!1},C=h=>{h||(g.value=_.value),r.indexOf(g.value)>-1?n.use_model=q.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,n.think_switch=Number(o.think_switch),l.value=h};Re(()=>{r.indexOf(g.value)>-1?n.use_model=q.value:n.use_model=o.use_model,n.model_config_id=o.model_config_id,n.temperature=o.temperature,n.max_token=o.max_token,n.context_pair=o.context_pair,n.think_switch=Number(o.think_switch)});function R(h,b,w){const f=new Set(h.map(M=>M.model_define));return b.filter(M=>{let U=M[w];f.has(U)&&h.filter(P=>{if(P.model_define==U)return P.children=ht(P.children,M.children),!1})}),h}return(()=>{Te({model_type:"LLM"}).then(h=>{q.value=o.use_model;let b=h.data||[],w=[];a.value=b.map(f=>{w=[];for(let M=0;M<f.model_info.llm_model_list.length;M++){const U=f.model_info.llm_model_list[M];r.indexOf(f.model_info.model_define)>-1&&o.model_config_id==f.model_config.id&&(q.value=f.model_config.deployment_name,g.value=f.model_info.model_define,_.value=f.model_info.model_define),w.push({name:U,deployment_name:f.model_config.deployment_name,id:f.model_config.id,model_define:f.model_info.model_define})}return{id:f.model_config.id,name:f.model_info.model_name,model_define:f.model_info.model_define,icon:f.model_info.model_icon_url,children:w,deployment_name:f.model_config.deployment_name}}),a.value=R(vt(a.value,"model_define"),a.value,"model_define")})})(),(h,b)=>{const w=ne,f=ke,M=Be,U=Qe,P=Fe,T=Ct,D=_e,z=Je,c=Ee,H=se,F=It,B=oe;return s(),j(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":b[10]||(b[10]=O=>l.value=O)},{extra:i(()=>[e("div",zs,[t(w,{onClick:b[0]||(b[0]=O=>C(!0)),size:"small"},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",Ds,[e("div",Vs,[I(" LLM模型： "),e("span",null,S(n.use_model),1)]),e("div",Ns,[I(" 温度： "),e("span",null,S(n.temperature),1)]),e("div",Ps,[I(" 最大token： "),e("span",null,S(n.max_token),1)]),e("div",Ts,[I(" 上下文数量： "),e("span",null,S(n.context_pair),1)]),e("div",Bs,[I(" 显示推理过程： "),e("span",null,S(n.think_switch==1?"开":"关"),1)])]),t(B,{open:l.value,"onUpdate:open":b[9]||(b[9]=O=>l.value=O),width:672,title:"模型设置",onOk:u},{default:i(()=>[e("div",Qs,[t(F,{gutter:[32,24]},{default:i(()=>[t(T,be(ye(m)),{default:i(()=>[e("div",Fs,[Js,e("div",Ks,[t(P,{value:n.use_model,"onUpdate:value":b[1]||(b[1]=O=>n.use_model=O),placeholder:"请选择LLM模型",onChange:p,style:{width:"100%"}},{default:i(()=>[(s(!0),v(V,null,J(a.value,O=>(s(),j(U,{key:O.id},{label:i(()=>[t(f,{align:"center",gap:6},{default:i(()=>[e("img",{class:"model-icon",src:O.icon,alt:""},null,8,Gs),I(S(O.name),1)]),_:2},1024)]),default:i(()=>[(s(!0),v(V,null,J(O.children,W=>(s(),j(M,{value:r.indexOf(O.model_define)>-1&&W.deployment_name?W.deployment_name:W.name+W.id,model_config_id:O.id,current_obj:W,key:W.name+W.id},{default:i(()=>[r.indexOf(O.model_define)>-1&&W.deployment_name?(s(),v("span",Hs,S(W.deployment_name),1)):(s(),v("span",Ws,S(W.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(T,be(ye(m)),{default:i(()=>[e("div",Zs,[e("div",Ys,[Xs,t(D,null,{title:i(()=>[I("温度越低，回答越严谨。温度越高，回答越发散。")]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",en,[e("div",tn,[e("div",on,[t(z,{class:"custom-slider",value:n.temperature,"onUpdate:value":b[2]||(b[2]=O=>n.temperature=O),min:0,max:2,step:.1},null,8,["value"])]),e("div",sn,[t(c,{value:n.temperature,"onUpdate:value":b[3]||(b[3]=O=>n.temperature=O),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(T,be(ye(m)),{default:i(()=>[e("div",nn,[e("div",an,[ln,t(D,null,{title:i(()=>[I("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",cn,[e("div",rn,[e("div",_n,[t(z,{class:"custom-slider",value:n.max_token,"onUpdate:value":b[4]||(b[4]=O=>n.max_token=O),min:0,max:100*1024},null,8,["value"])]),e("div",dn,[t(c,{value:n.max_token,"onUpdate:value":b[5]||(b[5]=O=>n.max_token=O),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(T,be(ye(m)),{default:i(()=>[e("div",un,[e("div",pn,[mn,t(D,null,{title:i(()=>[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",vn,[e("div",hn,[e("div",fn,[t(z,{class:"custom-slider",value:n.context_pair,"onUpdate:value":b[6]||(b[6]=O=>n.context_pair=O),min:0,max:10},null,8,["value"])]),e("div",bn,[t(c,{value:n.context_pair,"onUpdate:value":b[7]||(b[7]=O=>n.context_pair=O),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(T,be(ye(m)),{default:i(()=>[e("div",yn,[e("div",kn,[gn,t(D,null,{title:i(()=>[$n]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),t(H,{checked:n.think_switch,"onUpdate:checked":b[8]||(b[8]=O=>n.think_switch=O),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},wn=N(xn,[["__scopeId","data-v-45e42f1f"]]),Sn={class:"library-checkbox-box"},qn={class:"list-tools"},Cn={class:"list-box",ref:"scrollContainer"},In={class:"library-name"},Rn={class:"library-desc"},Ln={__name:"library-select-alert",emits:["change"],setup(d,{expose:r,emit:y}){const m=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=$(!1),o=L=>{p(),a.checkedList=L,l.value=!0},x=()=>{l.value=!1,q()},n=$(""),g=()=>{p()},_=$([]),q=()=>{m("change",[...a.checkedList])},p=async()=>{const L=await Ke({library_name:n.value,type:""});if(L){let h=L.data||[];_.value=h}},u=$(!1),C=async()=>{u.value=!0,await p(),u.value=!1,te.success("刷新完成")},R=()=>{window.open("/#/library/list")};return r({open:o}),(L,h)=>{const b=We,w=me,f=ne,M=Ge,U=He,P=Le,T=oe;return s(),j(T,{width:"746px",open:l.value,"onUpdate:open":h[2]||(h[2]=D=>l.value=D),title:"关联知识库",onOk:x},{default:i(()=>[e("div",Sn,[t(b,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",qn,[e("div",null,[t(w,{style:{width:"282px"},value:n.value,"onUpdate:value":h[0]||(h[0]=D=>n.value=D),placeholder:"请输入知识库名称搜索",onChange:g},{suffix:i(()=>[t(k(Rt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(f,{style:{"margin-right":"8px"},onClick:C},{default:i(()=>[t(k(Lt)),I(" 刷新 ")]),_:1}),t(f,{type:"primary",ghost:"",onClick:R},{default:i(()=>[I("新建知识库")]),_:1})])]),t(P,{spinning:u.value,delay:100},{default:i(()=>[t(U,{value:a.checkedList,"onUpdate:value":h[1]||(h[1]=D=>a.checkedList=D),style:{width:"100%"}},{default:i(()=>[e("div",Cn,[(s(!0),v(V,null,J(_.value,D=>(s(),v("div",{class:"list-item-wraapper",key:D.id},[t(M,{class:"list-item",value:D.id},{default:i(()=>[e("div",In,S(D.library_name),1),e("div",Rn,S(D.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Un=N(Ln,[["__scopeId","data-v-75c5cc9c"]]),Ie=d=>(K("data-v-df593c01"),d=d(),G(),d),En={class:"recall-settings-box"},On={class:"form-box"},An={class:"form-item is-required"},Mn=Ie(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),jn={class:"form-item-body"},zn={class:"retrieval-mode-items"},Dn=["onClick"],Vn={class:"retrieval-mode-title"},Nn={class:"title-text"},Pn={key:0,style:{width:"32px"},src:Ut,alt:""},Tn={class:"retrieval-mode-desc"},Bn={class:"form-item"},Qn={class:"form-item-label"},Fn=Ie(()=>e("span",null,"Top K ",-1)),Jn={class:"form-item-body"},Kn={class:"number-box"},Gn={class:"number-slider-box"},Hn={class:"number-input-box"},Wn={key:0,class:"form-item"},Zn={class:"form-item-label"},Yn=Ie(()=>e("span",null,"相似度阈值 ",-1)),Xn={class:"form-item-body"},ei={class:"number-box"},ti={class:"number-slider-box"},oi={class:"number-input-box"},si={class:"form-item"},ni={class:"form-item-label"},ii=Ie(()=>e("span",null,"Rerank模型",-1)),ai={key:0,class:"form-item-body"},li=["src"],ci={__name:"recall-settings-alert",emits:["change"],setup(d,{expose:r,emit:y}){const m=y,a=$([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),l=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),o=$(!1),x=L=>{R(),l.rerank_status=L.rerank_status||0,l.rerank_use_model=L.rerank_use_model||void 0,l.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",l.top_k=L.top_k,l.similarity=L.similarity,l.search_type=L.search_type,o.value=!0},n=(L,h)=>{if(!L||!h){l.rerank_model_config_id="";return}l.rerank_model_config_id=h.rerank_model_config_id},g=L=>{L==0&&(l.rerank_model_config_id="",l.rerank_use_model="")},_=L=>{l.search_type=L},q=()=>l.rerank_status==1&&!l.rerank_model_config_id,p=()=>{if(q())return te.error("请选择Rerank模型");o.value=!1,u()},u=()=>{m("change",Y(l))},C=$([]),R=()=>{Te({model_type:"RERANK"}).then(L=>{let h=L.data||[];C.value=h.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.rerank_model_list}))})};return r({open:x}),(L,h)=>{const b=re,w=_e,f=Je,M=Ee,U=se,P=Be,T=Qe,D=Fe,z=oe;return s(),j(z,{width:"746px",open:o.value,"onUpdate:open":h[6]||(h[6]=c=>o.value=c),title:"召回设置",onOk:p},{default:i(()=>[e("div",En,[e("div",On,[e("div",An,[Mn,e("div",jn,[e("div",zn,[(s(!0),v(V,null,J(a.value,c=>(s(),v("div",{class:Se(["retrieval-mode-item",{active:l.search_type==c.value}]),key:c.value,onClick:H=>_(c.value)},[l.search_type==c.value?(s(),j(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):A("",!0),e("div",Vn,[t(b,{name:c.iconName,class:"title-icon"},null,8,["name"]),e("span",Nn,S(c.title),1),c.isRecommendation?(s(),v("img",Pn)):A("",!0)]),e("div",Tn,S(c.desc),1)],10,Dn))),128))])])]),e("div",Bn,[e("div",Qn,[Fn,t(w,null,{title:i(()=>[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",Jn,[e("div",Kn,[e("div",Gn,[t(f,{class:"custom-slider",value:l.top_k,"onUpdate:value":h[0]||(h[0]=c=>l.top_k=c),min:1,max:10},null,8,["value"])]),e("div",Hn,[t(M,{value:l.top_k,"onUpdate:value":h[1]||(h[1]=c=>l.top_k=c),min:1,max:10},null,8,["value"])])])])]),l.search_type<=2?(s(),v("div",Wn,[e("div",Zn,[Yn,t(w,null,{title:i(()=>[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:i(()=>[t(k(ee),{class:"question-icon"})]),_:1})]),e("div",Xn,[e("div",ei,[e("div",ti,[t(f,{class:"custom-slider",value:l.similarity,"onUpdate:value":h[2]||(h[2]=c=>l.similarity=c),min:0,max:1,step:.01},null,8,["value"])]),e("div",oi,[t(M,{value:l.similarity,"onUpdate:value":h[3]||(h[3]=c=>l.similarity=c),min:0,max:1,step:.01},null,8,["value"])])])])])):A("",!0),e("div",si,[e("div",ni,[ii,I("   "),t(U,{checkedValue:1,unCheckedValue:0,checked:l.rerank_status,"onUpdate:checked":h[4]||(h[4]=c=>l.rerank_status=c),onChange:g},null,8,["checked"])]),l.rerank_status==1?(s(),v("div",ai,[t(D,{allowClear:"",value:l.rerank_use_model,"onUpdate:value":h[5]||(h[5]=c=>l.rerank_use_model=c),placeholder:"请选择Rerank模型",onChange:n,style:{width:"60%"}},{default:i(()=>[(s(!0),v(V,null,J(C.value,c=>(s(),j(T,{key:c.id},{label:i(()=>[e("span",null,[e("img",{class:"model-icon",src:c.icon,alt:""},null,8,li)])]),default:i(()=>[(s(!0),v(V,null,J(c.children,H=>(s(),j(P,{value:H,rerank_model_config_id:c.id,key:H},{default:i(()=>[e("span",null,S(H),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):A("",!0)])])])]),_:1},8,["open"])}}},ri=N(ci,[["__scopeId","data-v-df593c01"]]),_i=d=>(K("data-v-a87bd0fa"),d=d(),G(),d),di={class:"list-box"},ui=["onClick"],pi={class:"avater-box"},mi=["src"],vi={class:"content-box"},hi={class:"title-block"},fi=_i(()=>e("div",{class:"tag-icon"},"Graph",-1)),bi={class:"title-text"},yi={class:"desc-box"},ki={class:"right-icon"},gi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(d,{expose:r,emit:y}){const m=y,a=d,l=$(!1);pe(()=>a.list,()=>{a.list.length==0&&(l.value=!1)},{});const o=()=>{l.value=!0},x=()=>{document.visibilityState==="visible"&&m("refreshList")};qe(()=>{document.addEventListener("visibilitychange",x)}),lt(()=>{document.removeEventListener("visibilitychange",x)});const n=g=>{window.open(`/#/library/details/knowledge-config?id=${g.id}`)};return r({show:o}),(g,_)=>{const q=We,p=Ve,u=oe;return s(),v("div",null,[t(u,{open:l.value,"onUpdate:open":_[0]||(_[0]=C=>l.value=C),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[t(q,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(p,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",di,[(s(!0),v(V,null,J(a.list,C=>(s(),v("div",{class:"list-item",onClick:R=>n(C),key:C.id},[e("div",pi,[e("img",{src:C.avatar,alt:""},null,8,mi)]),e("div",vi,[e("div",hi,[fi,e("div",bi,S(C.library_name),1)]),e("div",yi,S(C.library_intro),1)]),e("div",ki,[t(k(Et))])],8,ui))),128))])]),_:1})]),_:1},8,["open"])])}}},$i=N(gi,[["__scopeId","data-v-a87bd0fa"]]),xi={class:"actions-box"},wi={key:0,class:"library-list"},Si=["onClick"],qi=["onClick"],Ci={class:"library-name"},Ii={class:"library-name-text"},Ri={class:"library-intro"},Li={class:"setting-info-block"},Ui={class:"set-item"},Ei={key:0},Oi={key:1},Ai={key:2},Mi={key:3},ji={class:"set-item"},zi={key:0,class:"set-item"},Di={class:"set-item"},Vi={key:0},Ni={key:1},Pi={__name:"index",setup(d){const{getStorage:r,removeStorage:y}=ft("localStorage"),m=$(!1),{robotInfo:a,updateRobotInfo:l}=Z("robotInfo"),o=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),x=$([]),n=$(null),g=xe(()=>x.value.filter(U=>o.library_ids.includes(U.id))),_=xe(()=>g.value.filter(U=>U.graph_switch==0)),q=U=>{let P=o.library_ids.indexOf(U.id);o.library_ids.splice(P,1),b()},p=U=>{o.library_ids=[...U],b()},u=()=>{n.value.open([...o.library_ids])},C=$(null),R=()=>{C.value.open(Y(o))},L=$(null),h=U=>{o.rerank_status=U.rerank_status,o.rerank_use_model=U.rerank_use_model,o.rerank_model_config_id=U.rerank_model_config_id,o.top_k=U.top_k,o.similarity=U.similarity,o.search_type=U.search_type,(U.search_type==1||U.search_type==4)&&_.value.length>0&&L.value.show(),b()},b=()=>{let U={...Y(o)};U.library_ids=U.library_ids.join(","),l({...U})},w=async()=>{const U=await Ke({type:""});U&&(x.value=U.data||[])},f=()=>{oe.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){u()}})};o.rerank_use_model=a.rerank_use_model||void 0,Re(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type});const M=U=>{window.open(`#/library/details/knowledge-document?id=${U.id}`)};return qe(()=>{w(),r("showNoLibraryTip")&&(f(),y("showNoLibraryTip"))}),(U,P)=>{const T=ne,D=ke,z=_e;return s(),j(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:m.value,"onUpdate:isEdit":P[0]||(P[0]=c=>m.value=c),bodyStyle:{padding:0}},{extra:i(()=>[e("div",xi,[t(D,{gap:8},{default:i(()=>[t(T,{size:"small",onClick:R},{default:i(()=>[I("召回设置")]),_:1}),t(T,{size:"small",onClick:u},{default:i(()=>[I("关联知识库")]),_:1})]),_:1})])]),default:i(()=>[g.value.length>0?(s(),v("div",wi,[(s(!0),v(V,null,J(g.value,c=>(s(),v("div",{class:"library-item",key:c.id,onClick:H=>M(c)},[e("span",{class:"close-btn",onClick:ct(H=>q(c),["stop"])},[t(k(he))],8,qi),e("div",Ci,[t(z,null,{title:i(()=>[I(S(c.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:Se(["graph-tag",{active:c.graph_switch==1}])},"Graph",2)]),_:2},1024),e("div",Ii,S(c.library_name),1)]),e("div",Ri,S(c.library_intro),1)],8,Si))),128))])):A("",!0),e("div",Li,[e("div",Ui,[I(" 检索模式： "),o.search_type==1?(s(),v("span",Ei,"混合检索")):A("",!0),o.search_type==2?(s(),v("span",Oi,"向量检索")):A("",!0),o.search_type==3?(s(),v("span",Ai,"全文检索")):A("",!0),o.search_type==4?(s(),v("span",Mi,"知识图谱检索")):A("",!0)]),e("div",ji,[I(" Top K： "),e("span",null,S(o.top_k),1)]),o.search_type<=2?(s(),v("div",zi,[I(" 相似度阈值： "),e("span",null,S(o.similarity),1)])):A("",!0),e("div",Di,[I(" Rerank模型： "),o.rerank_status==0?(s(),v("span",Vi,"关")):(s(),v("span",Ni,S(o.rerank_use_model),1))])]),t(Un,{ref_key:"librarySelectAlertRef",ref:n,onChange:p},null,512),t(ri,{ref_key:"recallSettingsAlertRef",ref:C,onChange:h},null,512),t($i,{list:_.value,onRefreshList:w,ref_key:"noOpenGraphModalRef",ref:L},null,8,["list"])]),_:1},8,["isEdit"])}}},Ti=N(Pi,[["__scopeId","data-v-e1be292a"]]),Bi=d=>(K("data-v-b559dd08"),d=d(),G(),d),Qi={class:"library-checkbox-box"},Fi={class:"list-box",ref:"scrollContainer"},Ji={class:"library-name"},Ki={class:"library-desc"},Gi={key:0,class:"empty-box"},Hi=Bi(()=>e("img",{src:qt,alt:""},null,-1)),Wi={__name:"library-select-alert",emits:["change"],setup(d,{expose:r,emit:y}){const m=y,a=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),l=$(!1),o=u=>{_(),a.checkedList=u,l.value=!0},x=()=>{l.value=!1,g()};$("");const n=$([]),g=()=>{m("change",[...a.checkedList])},_=async()=>{const u=await Ze();if(u){let C=u.data||[];n.value=C}},q=$(!1),p=()=>{window.open("/#/database/list")};return r({open:o}),(u,C)=>{const R=Ge,L=He,h=Le,b=oe;return s(),j(b,{width:"746px",open:l.value,"onUpdate:open":C[1]||(C[1]=w=>l.value=w),title:"关联数据表",onOk:x},{default:i(()=>[e("div",Qi,[t(h,{spinning:q.value,delay:100},{default:i(()=>[t(L,{value:a.checkedList,"onUpdate:value":C[0]||(C[0]=w=>a.checkedList=w),style:{width:"100%"}},{default:i(()=>[e("div",Fi,[(s(!0),v(V,null,J(n.value,w=>(s(),v("div",{class:"list-item-wraapper",key:w.id},[t(R,{class:"list-item",value:w.id},{default:i(()=>[e("div",Ji,S(w.name),1),e("div",Ki,S(w.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!q.value&&!n.value.length?(s(),v("div",Gi,[Hi,e("div",null,[I(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:p}," 去添加")])])):A("",!0)])]),_:1},8,["open"])}}},Zi=N(Wi,[["__scopeId","data-v-b559dd08"]]),Yi=d=>(K("data-v-de8ee53c"),d=d(),G(),d),Xi=Yi(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),ea={class:"actions-box"},ta={key:0,class:"library-list"},oa=["onClick"],sa={class:"library-name"},na={class:"library-intro"},ia={__name:"index",setup(d){const r=$(!1),{robotInfo:y,updateRobotInfo:m}=Z("robotInfo"),a=Q({form_ids:[]}),l=$([]),o=$(null),x=xe(()=>l.value.filter(u=>a.form_ids.includes(u.id))),n=u=>{let C=a.form_ids.indexOf(u.id);a.form_ids.splice(C,1),q()},g=u=>{a.form_ids=[...u],q()},_=()=>{o.value.open([...a.form_ids])},q=()=>{let u={...Y(a)};u.form_ids=u.form_ids.join(","),m({...u})};return(async()=>{const u=await Ze();u&&(l.value=u.data||[])})(),Re(()=>{a.form_ids=y.form_ids.split(",")}),(u,C)=>{const R=_e,L=ne,h=ke;return s(),j(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:r.value,"onUpdate:isEdit":C[0]||(C[0]=b=>r.value=b),bodyStyle:{padding:0}},{tip:i(()=>[t(R,{placement:"top"},{title:i(()=>[Xi]),default:i(()=>[t(k(ee))]),_:1})]),extra:i(()=>[e("div",ea,[t(h,{gap:8},{default:i(()=>[t(L,{size:"small",onClick:_},{default:i(()=>[I("关联数据表")]),_:1})]),_:1})])]),default:i(()=>[x.value.length>0?(s(),v("div",ta,[(s(!0),v(V,null,J(x.value,b=>(s(),v("div",{class:"library-item",key:b.id},[e("span",{class:"close-btn",onClick:w=>n(b)},[t(k(he))],8,oa),e("div",sa,S(b.name),1),e("div",na,S(b.description),1)]))),128))])):A("",!0),t(Zi,{ref_key:"librarySelectAlertRef",ref:o,onChange:g},null,512)]),_:1},8,["isEdit"])}}},aa=N(ia,[["__scopeId","data-v-de8ee53c"]]),la={class:"form-box"},ca={class:"question-title"},ra={class:"question-options"},_a={class:"question-option"},da={class:"drag-btn"},ua={class:"action-box"},pa={class:"robot-info-box"},ma={class:"robot-welcome-content"},va={class:"robot-welcome-question"},ha={__name:"welcome-words",setup(d){const r=$(!1),y=$(!1),{robotInfo:m,updateRobotInfo:a,scrollBoxToBottom:l}=Z("robotInfo"),o=Q({welcomes:{content:"",question:[]}}),x=()=>{let p=!1;if(o.welcomes.question.length>0){for(let u=0;u<o.welcomes.question.length;u++)if(!o.welcomes.question[u].content){p=u+1;break}}return p},n=()=>{o.welcomes.question.push({content:"",id:we(8)})},g=p=>{o.welcomes.question.splice(p,1)},_=()=>{if(!o.welcomes.content)return te.error("请输入欢迎语");if(x())return te.error("引导问题内容不能为空");a({...Y(o)}),r.value=!1},q=()=>{let p={...m.welcomes},u=[];p.question.forEach(({content:C,id:R})=>{let L={id:R,content:C};L.id||(L.id=we(6)),u.push(L)}),o.welcomes.content=p.content,o.welcomes.question=u};return(p,u)=>{const C=Ce,R=re,L=me;return s(),j(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:r.value,"onUpdate:isEdit":u[4]||(u[4]=h=>r.value=h),onSave:_,onEdit:q},{default:i(()=>[le(e("div",la,[e("div",ca,[t(C,{value:o.welcomes.content,"onUpdate:value":u[0]||(u[0]=h=>o.welcomes.content=h),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",ra,[t(k(Oe),{modelValue:o.welcomes.question,"onUpdate:modelValue":u[1]||(u[1]=h=>o.welcomes.question=h),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=h=>y.value=!0),onEnd:u[3]||(u[3]=h=>y.value=!1)},{item:i(({element:h,index:b})=>[e("div",_a,[e("span",da,[t(R,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":w=>h.content=w,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ua,[t(k(he),{class:"del-btn",onClick:w=>g(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:n},[t(k(Ue),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[ce,r.value]]),le(e("div",pa,[e("div",ma,S(k(m).welcomes.content),1),e("div",va,[(s(!0),v(V,null,J(k(m).welcomes.question,(h,b)=>(s(),v("div",{class:"question-item",key:b},S(h.content),1))),128))])],512),[[ce,!r.value]])]),_:1},8,["isEdit"])}}},fa=N(ha,[["__scopeId","data-v-ea227a87"]]),ba=d=>(K("data-v-bc797bf6"),d=d(),G(),d),ya=ba(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),ka={class:"form-box"},ga={class:"question-title"},$a={class:"question-options"},xa={class:"question-option"},wa={class:"drag-btn"},Sa={class:"action-box"},qa={class:"robot-info-box"},Ca={class:"robot-unknown-content"},Ia={class:"robot-unknown-question"},Ra={__name:"unknown-problem-prompt",setup(d){const r=$(!1),y=$(!1),{robotInfo:m,updateRobotInfo:a,scrollBoxToBottom:l}=Z("robotInfo"),o=Q({unknown_question_prompt:{content:"",question:[]}}),x=()=>{o.unknown_question_prompt.question.push({content:"",id:we(8)}),rt(()=>{l()})},n=q=>{o.unknown_question_prompt.question.splice(q,1)},g=()=>{a({...Y(o)}),r.value=!1},_=()=>{let q={...m.unknown_question_prompt},p=[];q.question&&q.question.forEach(({content:u,id:C})=>{let R={id:C,content:u};R.id||(R.id=we(6)),p.push(R)}),q.content&&(o.unknown_question_prompt.content=q.content),p&&(o.unknown_question_prompt.question=p)};return qe(()=>{}),(q,p)=>{const u=_e,C=Ce,R=re,L=me;return s(),j(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:r.value,"onUpdate:isEdit":p[4]||(p[4]=h=>r.value=h),onSave:g,onEdit:_},{tip:i(()=>[t(u,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[ya]),default:i(()=>[t(k(ee))]),_:1})]),default:i(()=>[le(e("div",ka,[e("div",ga,[t(C,{value:o.unknown_question_prompt.content,"onUpdate:value":p[0]||(p[0]=h=>o.unknown_question_prompt.content=h),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",$a,[t(k(Oe),{modelValue:o.unknown_question_prompt.question,"onUpdate:modelValue":p[1]||(p[1]=h=>o.unknown_question_prompt.question=h),"item-key":"id",handle:".drag-btn",onStart:p[2]||(p[2]=h=>y.value=!0),onEnd:p[3]||(p[3]=h=>y.value=!1)},{item:i(({element:h,index:b})=>[e("div",xa,[e("span",wa,[t(R,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":w=>h.content=w,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Sa,[t(k(he),{class:"del-btn",onClick:w=>n(b)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:x},[t(k(Ue),{class:"add-btn-icon"}),I("添加引导问题 ")])])],512),[[ce,r.value]]),le(e("div",qa,[e("div",Ca,S(k(m).unknown_question_prompt.content),1),e("div",Ia,[(s(!0),v(V,null,J(k(m).unknown_question_prompt.question,(h,b)=>(s(),v("div",{class:"question-item",key:b},S(h.content),1))),128))])],512),[[ce,!r.value]])]),_:1},8,["isEdit"])}}},La=N(Ra,[["__scopeId","data-v-bc797bf6"]]),et=d=>(K("data-v-c60b8d8e"),d=d(),G(),d),Ua=et(()=>e("span",null,null,-1)),Ea=et(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Oa={__name:"problem-optimization",setup(d){$(!1);const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const m=a=>{y({})};return(a,l)=>{const o=se;return s(),j(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>[Ua]),default:i(()=>[Ea,t(o,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(r).enable_question_optimize,"onUpdate:checked":l[0]||(l[0]=x=>k(r).enable_question_optimize=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Aa=N(Oa,[["__scopeId","data-v-c60b8d8e"]]),tt=d=>(K("data-v-34918831"),d=d(),G(),d),Ma=tt(()=>e("span",null,null,-1)),ja=tt(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),za={__name:"suggested-issues",setup(d){$(!1);const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo"),m=a=>{y({})};return(a,l)=>{const o=se;return s(),j(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>[Ma]),default:i(()=>[ja,t(o,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(r).enable_question_guide,"onUpdate:checked":l[0]||(l[0]=x=>k(r).enable_question_guide=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Da=N(za,[["__scopeId","data-v-34918831"]]),Va=d=>(K("data-v-56c388e6"),d=d(),G(),d),Na=Va(()=>e("span",null,null,-1)),Pa={__name:"sensitive-words",setup(d){$(!1);const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo");Q({prompt:""});const m=()=>{window.open("/#/user/sensitive-words")},a=l=>{y({})};return(l,o)=>{const x=se;return s(),j(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>[Na]),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:m,style:{cursor:"pointer"}},"设置敏词 >")])]),t(x,{onChange:a,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(r).sensitive_words_switch,"onUpdate:checked":o[0]||(o[0]=n=>k(r).sensitive_words_switch=n),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ta=N(Pa,[["__scopeId","data-v-56c388e6"]]),Ae=d=>(K("data-v-a0ec9e93"),d=d(),G(),d),Ba={class:"direct-title"},Qa={class:"direct-desc"},Fa={class:"qa"},Ja={class:"prompt-form-item-label"},Ka=Ae(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Ga={class:"direct-switch"},Ha={class:"similarity"},Wa=Ae(()=>e("span",null,"相似度超过",-1)),Za={class:"number-input-box"},Ya=Ae(()=>e("span",null,"时直接回复答案",-1)),Xa={__name:"chat-edit-alert",emits:["save"],setup(d,{expose:r,emit:y}){const m=y,a=$(1),l=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],o=Q(l()),x=$(!1),n=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),g=()=>{n.chat_type=a.value.toString(),o.forEach(p=>{p.chat_type==a.value&&(n.chat_type=="3"?(n.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch==1?"true":"false",n.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score.toString()):n.chat_type=="1"&&(n.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch==1?"true":"false",n.library_qa_direct_reply_score=p.library_qa_direct_reply_score.toString()))}),_(),Object.assign(o,l()),x.value=!1},_=()=>{m("save",Y(n))};qe(()=>{});const q=p=>{a.value=parseInt(p.chat_type),n.chat_type=p.chat_type,n.library_qa_direct_reply_score=p.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch,o.forEach(u=>{u.chat_type=="3"?(u.mixture_qa_direct_reply_score=p.mixture_qa_direct_reply_score,u.mixture_qa_direct_reply_switch=p.mixture_qa_direct_reply_switch=="true"?1:0):u.chat_type=="1"&&(u.library_qa_direct_reply_score=p.library_qa_direct_reply_score,u.library_qa_direct_reply_switch=p.library_qa_direct_reply_switch=="true"?1:0)}),x.value=!0};return pe(()=>x.value,p=>{p===!1&&Object.assign(o,l())},{immediate:!0}),r({open:q}),(p,u)=>{const C=_e,R=se,L=Ee,h=Ot,b=At,w=oe;return s(),j(w,{width:"746px",open:x.value,"onUpdate:open":u[1]||(u[1]=f=>x.value=f),title:"聊天模式设置",onOk:g},{default:i(()=>[t(b,{class:"direct-box",value:a.value,"onUpdate:value":u[0]||(u[0]=f=>a.value=f)},{default:i(()=>[(s(!0),v(V,null,J(o,f=>(s(),j(h,{class:Se(["direct-item",{active:a.value==f.direct_id}]),value:f.direct_id,key:f.direct_id},{default:i(()=>[e("div",Ba,S(f.direct_title),1),e("div",Qa,S(f.direct_desc),1),le(e("div",Fa,[e("div",Ja,[Ka,t(C,null,_t({default:i(()=>[t(k(ee),{class:"question-icon"})]),_:2},[f.chat_type=="1"?{name:"title",fn:i(()=>[I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:f.chat_type=="3"?{name:"title",fn:i(()=>[I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Ga,[f.chat_type=="1"?(s(),j(R,{key:0,checkedValue:1,unCheckedValue:0,checked:f.library_qa_direct_reply_switch,"onUpdate:checked":M=>f.library_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):f.chat_type=="3"?(s(),j(R,{key:1,checkedValue:1,unCheckedValue:0,checked:f.mixture_qa_direct_reply_switch,"onUpdate:checked":M=>f.mixture_qa_direct_reply_switch=M},null,8,["checked","onUpdate:checked"])):A("",!0)])])],512),[[ce,f.isQaDirectReply&&a.value==f.direct_id]]),le(e("div",Ha,[Wa,e("div",Za,[f.chat_type=="1"?(s(),j(L,{key:0,value:f.library_qa_direct_reply_score,"onUpdate:value":M=>f.library_qa_direct_reply_score=M,disabled:!f.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):f.chat_type=="3"?(s(),j(L,{key:1,value:f.mixture_qa_direct_reply_score,"onUpdate:value":M=>f.mixture_qa_direct_reply_score=M,disabled:!f.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):A("",!0)]),Ya],512),[[ce,f.isQaDirectReply&&a.value==f.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},el=N(Xa,[["__scopeId","data-v-a0ec9e93"]]),Me=d=>(K("data-v-5b59ec9b"),d=d(),G(),d),tl=Me(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),ol=Me(()=>e("br",null,null,-1)),sl=Me(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),nl={class:"actions-box"},il={class:"setting-info-block"},al={class:"set-item"},ll={key:0},cl={key:1},rl={key:2},_l={class:"set-item"},dl={key:0,class:"set-item"},ul={class:"set-item"},pl={key:0,class:"set-item"},ml={class:"form-box"},vl={__name:"index",setup(d){const r=$(!1),y=$(null),{robotInfo:m,updateRobotInfo:a}=Z("robotInfo"),l=Q({chat_type:m.chat_type,library_qa_direct_reply_score:m.library_qa_direct_reply_score,library_qa_direct_reply_switch:m.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:m.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:m.mixture_qa_direct_reply_switch}),o=g=>{l.chat_type=g.chat_type,l.library_qa_direct_reply_score=g.library_qa_direct_reply_score,l.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch,l.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,l.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch,x()},x=()=>{a({...Y(l)}),r.value=!1},n=()=>{y.value.open(Y(l)),r.value=!0};return(g,_)=>{const q=_e,p=ne;return s(),j(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:r.value,"onUpdate:isEdit":_[1]||(_[1]=u=>r.value=u),bodyStyle:{padding:0}},{tip:i(()=>[t(q,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>[tl,ol,sl]),default:i(()=>[t(k(ee))]),_:1})]),extra:i(()=>[e("div",nl,[t(p,{size:"small",onClick:_[0]||(_[0]=u=>n(!0))},{default:i(()=>[I("修改")]),_:1})])]),default:i(()=>[e("div",il,[e("div",al,[I(" 聊天模式： "),k(m).chat_type=="1"?(s(),v("span",ll,"仅知识库")):A("",!0),k(m).chat_type=="2"?(s(),v("span",cl,"直连模式")):A("",!0),k(m).chat_type=="3"?(s(),v("span",rl,"混合模式")):A("",!0)]),k(m).chat_type=="1"?(s(),v(V,{key:0},[e("div",_l,[I(" QA文档直接回复答案： "),e("span",null,S(k(m).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(m).library_qa_direct_reply_switch=="true"?(s(),v("div",dl,[I(" 相似度值： "),e("span",null,S(k(m).library_qa_direct_reply_score),1)])):A("",!0)],64)):A("",!0),k(m).chat_type=="3"?(s(),v(V,{key:1},[e("div",ul,[I(" QA文档直接回复答案： "),e("span",null,S(k(m).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(m).mixture_qa_direct_reply_switch=="true"?(s(),v("div",pl,[I(" 相似度值： "),e("span",null,S(k(m).mixture_qa_direct_reply_score),1)])):A("",!0)],64)):A("",!0)]),e("div",ml,[t(el,{ref_key:"ChatEditAlertRef",ref:y,onSave:o},null,512)])]),_:1},8,["isEdit"])}}},hl=N(vl,[["__scopeId","data-v-5b59ec9b"]]),fl=d=>(K("data-v-8d185d5f"),d=d(),G(),d),bl={class:"switch-box"},yl={class:"switch-box-body"},kl={class:"switch-box-header"},gl={class:"left-box"},$l={class:"switch-box-title"},xl={key:0,class:"title-tip"},wl={class:"right-box"},Sl={class:"extra-box"},ql=fl(()=>e("div",{class:"extra-box"},null,-1)),Cl={class:"switch-desc"},Il={class:"switch-box-right"},Rl={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(d,{emit:r}){const y=r,m=d,a=$(m.value),l=o=>{y("update:value",o),y("change",o)};return(o,x)=>{const n=re,g=se;return s(),v("div",bl,[e("div",yl,[e("div",kl,[e("div",gl,[t(n,{class:"switch-box-icon",name:m.iconName},null,8,["name"]),e("span",$l,S(m.title),1),o.$slots.tip?(s(),v("span",xl,[ue(o.$slots,"tip",{},void 0,!0)])):A("",!0)]),e("div",wl,[e("div",Sl,[ue(o.$slots,"extra",{},()=>[ql],!0)])])]),e("div",Cl,[ue(o.$slots,"default",{},void 0,!0)])]),e("div",Il,[t(g,{checked:a.value,"onUpdate:checked":x[0]||(x[0]=_=>a.value=_),onChange:l,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ll=N(Rl,[["__scopeId","data-v-8d185d5f"]]),Ul="/assets/img/empty-Bx9z1cwf.png",El="/assets/img/phone-head-CDwwPhYa.png",Ol="/assets/img/phone-body-CbEf8GZP.png",Al="/assets/img/phone-footer-ClQtNpln.png",ve=d=>(K("data-v-5125783f"),d=d(),G(),d),Ml={class:"common-problem-box"},jl={class:"left-content-box"},zl={key:0,class:"empty-box"},Dl=ve(()=>e("img",{src:Ul,alt:""},null,-1)),Vl=ve(()=>e("div",{class:"title"},"暂无数据",-1)),Nl=ve(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Pl={key:1,class:"lists-box"},Tl={class:"drag-btn"},Bl={class:"title"},Ql={class:"opration-box"},Fl={class:"preview-box"},Jl=ve(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:El,alt:""})],-1)),Kl={class:"phone-body"},Gl=ve(()=>e("div",null,[e("img",{class:"body-img",src:Ol,alt:""})],-1)),Hl={key:0,class:"question-box"},Wl=ve(()=>e("div",{class:"name"},"常见问题",-1)),Zl=ve(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Al,alt:""})],-1)),Yl={__name:"common-problem",setup(d){$(!1);const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo"),m=xe(()=>r.common_question_list?JSON.parse(r.common_question_list):[]),a=$([]);a.value=m.value,pe(m,()=>{a.value=m.value});const l=De.useForm,o=$(!1),x=$("添加问题"),n=Q({question:"",index:-1}),g=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:_,validate:q,validateInfos:p}=l(n,g),u=()=>{if(m.value.length>=10)return te.error("最多设置10条常用问题");o.value=!0,_(),n.question="",n.index=-1},C=(w,f)=>{o.value=!0,_(),n.question=w,n.index=f},R=w=>{let f=[];f=m.value.filter((M,U)=>w!=U),oe.confirm({title:"提醒",icon:t(bt),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){y({common_question_list:JSON.stringify(f)})},onCancel(){}})},L=()=>{q().then(()=>{let w=[];n.index>=0?w=m.value.map((f,M)=>M===n.index?n.question:f):w=[n.question,...m.value],y({common_question_list:JSON.stringify(w)}),o.value=!1})},h=w=>{y({})},b=w=>{y({common_question_list:JSON.stringify(a.value)})};return(w,f)=>{const M=_e,U=se,P=jt,T=ne,D=re,z=me,c=Mt,H=De,F=oe;return s(),v("div",Ml,[e("div",jl,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[t(M,null,{title:i(()=>[I("最多10条。开启后，常见问题会显示在每条问答后面")]),default:i(()=>[t(k(ee),{class:"quess-icon"})]),_:1})]),extra:i(()=>[t(U,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(r).enable_common_question,"onUpdate:checked":f[0]||(f[0]=B=>k(r).enable_common_question=B),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(P,{type:"vertical"}),t(T,{type:"primary",size:"small",onClick:u},{default:i(()=>[I("添加")]),_:1})]),default:i(()=>[m.value.length==0?(s(),v("div",zl,[Dl,Vl,Nl,t(T,{onClick:u,type:"primary"},{default:i(()=>[I("立即添加")]),_:1})])):(s(),v("div",Pl,[t(k(Oe),{modelValue:a.value,"onUpdate:modelValue":f[1]||(f[1]=B=>a.value=B),handle:".drag-btn","item-key":"index",onEnd:b},{item:i(({element:B,index:O})=>[(s(),v("div",{class:"list-item",key:O},[e("span",Tl,[t(D,{name:"drag"})]),e("div",Bl,S(B),1),e("div",Ql,[t(k(kt),{onClick:W=>C(B,O)},null,8,["onClick"]),t(k(he),{onClick:W=>R(O)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Fl,[Jl,e("div",Kl,[Gl,m.value.length&&k(r).enable_common_question=="true"?(s(),v("div",Hl,[Wl,(s(!0),v(V,null,J(m.value,B=>(s(),v("div",{class:"list-item",key:B},S(B),1))),128))])):A("",!0)]),Zl]),t(F,{open:o.value,"onUpdate:open":f[3]||(f[3]=B=>o.value=B),title:x.value,onOk:L,width:"476px"},{default:i(()=>[t(H,{class:"form-box",layout:"vertical"},{default:i(()=>[t(c,dt({label:"问题名称"},k(p).question),{default:i(()=>[t(z,{maxLength:100,value:n.question,"onUpdate:value":f[2]||(f[2]=B=>n.question=B),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Xl=N(Yl,[["__scopeId","data-v-5125783f"]]),ec=e("span",null,null,-1),tc=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),oc={__name:"display-aitations",setup(d){const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo"),m=$(!1);pe(()=>r.answer_source_switch,l=>{m.value=l=="true"},{immediate:!0});const a=()=>{y({answer_source_switch:m.value?"true":"false"})};return(l,o)=>(s(),j(Ll,{title:"显示引文","icon-name":"jibenpeizhi",value:m.value,"onUpdate:value":o[0]||(o[0]=x=>m.value=x),onChange:a},{extra:i(()=>[ec]),default:i(()=>[tc]),_:1},8,["value"]))}},ot=d=>(K("data-v-4948feb9"),d=d(),G(),d),sc=ot(()=>e("span",null,null,-1)),nc=ot(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),ic={__name:"show-like",setup(d){const{robotInfo:r,updateRobotInfo:y}=Z("robotInfo"),m=a=>{y({})};return(a,l)=>{const o=se;return s(),j(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>[sc]),default:i(()=>[nc,t(o,{onChange:m,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(r).feedback_switch,"onUpdate:checked":l[0]||(l[0]=x=>k(r).feedback_switch=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ac=N(ic,[["__scopeId","data-v-4948feb9"]]),lc={key:0,class:"robot-config-page"},cc={class:"setting-box"},rc={class:"setting-box"},_c={class:"setting-box"},dc={class:"setting-box"},uc={class:"setting-box"},pc={class:"setting-box"},mc={class:"setting-box"},vc={class:"setting-box"},hc={class:"setting-box"},fc={class:"setting-box"},bc={class:"setting-box"},yc={class:"setting-box"},kc={class:"setting-box"},gc={key:1,class:"robot-config-page"},$c={__name:"index",setup(d){const r=zt(),y=$(null),{robotInfo:m}=ut(r),{getRobot:a}=r,l=()=>{y.value.scrollTop=y.value.scrollHeight},o=$(1),x=$(!1),n=Q(m.value);pt("robotInfo",{robotInfo:n,updateRobotInfo:q=>{let p=JSON.parse(JSON.stringify(q));q.robot_avatar&&(p.robot_avatar=new File([q.robot_avatar],q.robot_avatar.name)),Object.assign(n,p),_()},scrollBoxToBottom:l});const _=()=>{let q;n.robot_avatar&&(q=new File([n.robot_avatar],n.robot_avatar.name));let p=JSON.parse(JSON.stringify(Y(n)));q&&(p.robot_avatar=q);let u=p.welcomes;u.question=u.question.map(R=>R.content),p.welcomes=JSON.stringify(u),p.prompt_struct=JSON.stringify(p.prompt_struct);let C=p.unknown_question_prompt;C.question=C.question.map(R=>R.content),p.unknown_question_prompt=JSON.stringify(C),delete p.robot_avatar_url,x.value=!0,$t(p).then(R=>{if(R.res!=0)return te.error(R.msg);x.value=!1,te.success("保存成功"),a(n.id)}).catch(()=>{x.value=!1})};return(q,p)=>{const u=Ne,C=Pe;return s(),v(V,null,[t(C,{class:"tab-wrapper",activeKey:o.value,"onUpdate:activeKey":p[0]||(p[0]=R=>o.value=R)},{default:i(()=>[(s(),j(u,{key:1,tab:"基础配置"})),(s(),j(u,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),o.value==1?(s(),v("div",lc,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:y},[e("div",cc,[t(ro)]),e("div",rc,[t(Ti)]),e("div",_c,[t(wn)]),e("div",dc,[t(hl)]),e("div",uc,[t(js)]),e("div",pc,[t(aa)]),e("div",mc,[t(fa)]),e("div",vc,[t(La)]),e("div",hc,[t(Ta)]),e("div",fc,[t(Aa)]),e("div",bc,[t(Da)]),e("div",yc,[t(oc)]),e("div",kc,[t(ac)])],512)])):(s(),v("div",gc,[t(Xl)]))],64)}}},Mr=N($c,[["__scopeId","data-v-387189e7"]]);export{Mr as default};
