import{_ as $,X as j,bh as I,Y as H,M as K,e as W,B as Z}from"../../index-CstSXCdU.js";import{c as T}from"./index-BYlluNLD.js";import{h as ee,k as oe}from"./index-Bnyi_NyK.js";import{a0 as ne,b as le,r as y,A as te,v as de,L as s,M as c,j as i,V as x,Q as t,X as f,u as q,P as g,F as O,a1 as M,Y as h,a8 as A,a9 as ae}from"./vue-chunks-CX0PHdkT.js";import{C as _e}from"./config-page-menu-BlFtIYxF.js";import{F as me,_ as ie}from"./index-L1GceNF2.js";import{_ as se}from"./index-bwfsT3yL.js";import{_ as re}from"./index-D9e-I9bu.js";import{_ as ce}from"./index-gmAqmiUj.js";import{S as ue,a as fe,_ as pe}from"./index-DTk_Cj8_.js";import"./axios-Cm0UX6qg.js";import"./qs-D52wVmk8.js";import"./crypto-js-ZYyBUTQg.js";import"./dayjs-DItM2b4N.js";import"./index-CPSClIuB.js";import"./shallowequal-BtoafKsn.js";import"./colors-C2VfdtVY.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-7Vnsd4b5.js";import"./slide-C2DT8m2K.js";import"./index-v-hTEyV7.js";import"./isPlainObject-DadmzF58.js";import"./responsiveObserve-S5D8rlR7.js";import"./QuestionCircleOutlined-DWuvpisG.js";import"./FormItemContext-BHAiblOr.js";import"./statusUtils-DAHCu8QH.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-VXIK4oM4.js";import"./DownOutlined-DGhSUoaY.js";import"./SearchOutlined-CTCDQEDm.js";import"./move-7f3qAgDa.js";const ye={class:"ai-config-page"},ge={class:"page-container"},he={class:"ai-config-form"},ke=["src"],ve={key:0},be={key:1},xe=["src"],Oe={key:0},Me={key:1},Ce={__name:"index",setup(we){function w(a,e,n){const m=new Set(a.map(o=>o.model_define));return e.filter(o=>{let r=o[n];m.has(r)&&a.filter(u=>{if(u.model_define==r)return u.children=H(u.children,o.children),!1})}),a}const E=ne(),F=le(()=>E.query.library_id),S=y(),b=y(!1);let C={};const _=te({library_name:"",library_intro:"",ai_summary:"",ai_summary_model:"",access_rights:"",model_config_id:"",use_model:"",use_model_switch:"",statistics_set:"",summary_model_config_id:""}),k=y([]),v=y([]),p=["azure","ollama","xinference","openaiAgent"],L=["azure"],V=y(""),J=(a,e)=>{const n=e.current_obj;_.use_model=p.indexOf(n.model_define)>-1&&n.deployment_name?n.deployment_name:n.name,V.value=n.model_define,_.model_config_id=n.id||e.model_config_id},D=y(""),U=(a,e)=>{const n=e.current_obj;_.ai_summary_model=p.indexOf(n.model_define)>-1&&n.deployment_name?n.deployment_name:n.name,D.value=n.model_define,_.summary_model_config_id=n.id||e.model_config_id},X=async()=>{try{await S.value.validate(),C.use_model!=_.use_model?K.confirm({title:"确定切换模型为"+_.use_model+"吗？",content:"切换模型后，文档会重新向量化，会消耗token",okText:"确定",cancelText:"取消",onOk(){N()}}):N()}catch(a){console.error("表单验证失败:",a)}},N=()=>{let a={...ae(_)};L.indexOf(V.value)>-1&&(a.use_model="默认"),L.indexOf(D.value)>-1&&(a.ai_summary_model="默认"),b.value=!0,oe(a).then(()=>{W.success("保存成功"),b.value=!1,C=JSON.parse(JSON.stringify(a))}).catch(()=>{b.value=!1})},z=()=>{ee({id:F.value}).then(a=>{let e=a.data||{};e.use_model=e.use_model||void 0,e.ai_summary_model=e.ai_summary_model||void 0,C=JSON.parse(JSON.stringify(e)),Object.assign(_,e)})},G=a=>{T({model_type:"TEXT EMBEDDING",is_offline:a}).then(e=>{let n=e.data||[],m=[];k.value=n.map(o=>{m=[];for(let r=0;r<o.model_info.vector_model_list.length;r++){const u=o.model_info.vector_model_list[r];m.push({name:u,deployment_name:o.model_config.deployment_name,id:o.model_config.id,model_define:o.model_info.model_define})}return{id:o.model_config.id,name:o.model_info.model_name,model_define:o.model_info.model_define,icon:o.model_info.model_icon_url,children:m,deployment_name:o.model_config.deployment_name}}),k.value=w(j(k.value,"model_define"),k.value,"model_define")})},P=()=>{T({model_type:"LLM"}).then(a=>{let e=a.data||[],n=[];v.value=e.map(m=>{n=[];for(let o=0;o<m.model_info.llm_model_list.length;o++){const r=m.model_info.llm_model_list[o];n.push({name:r,deployment_name:m.model_config.deployment_name,id:m.model_config.id,model_define:m.model_info.model_define})}return{id:m.model_config.id,name:m.model_info.model_name,model_define:m.model_info.model_define,icon:m.model_info.model_icon_url,children:n,deployment_name:m.model_config.deployment_name}}),v.value=w(j(v.value,"model_define"),v.value,"model_define")})};return de(()=>{z(),G(),P()}),(a,e)=>{const n=se,m=re,o=ie,r=ce,u=ue,B=fe,R=pe,Y=Z,Q=me;return s(),c("div",ye,[i(_e),x("div",ge,[x("div",he,[i(Q,{ref_key:"formRef",ref:S,model:_,"label-col":{span:2},"wrapper-col":{span:8}},{default:t(()=>[i(o,null,{label:t(()=>[f(" 嵌入  "),i(n,null,{title:t(()=>[f("开启嵌入功能后，才能在机器人中关联本知识库。")]),default:t(()=>[i(q(I))]),_:1})]),default:t(()=>[i(m,{checked:_.use_model_switch,"onUpdate:checked":e[0]||(e[0]=l=>_.use_model_switch=l),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),_.use_model_switch==1?(s(),g(o,{key:0,label:"嵌入模型",name:"use_model",rules:[{required:!0,message:"请选择嵌入模型"}]},{default:t(()=>[i(R,{onChange:J,value:_.use_model,"onUpdate:value":e[1]||(e[1]=l=>_.use_model=l),placeholder:"请选择嵌入模型"},{default:t(()=>[(s(!0),c(O,null,M(k.value,l=>(s(),g(B,{key:l.id},{label:t(()=>[i(r,{align:"center",gap:6},{default:t(()=>[x("img",{class:"model-icon",src:l.icon,alt:""},null,8,ke),f(h(l.name),1)]),_:2},1024)]),default:t(()=>[(s(!0),c(O,null,M(l.children,d=>(s(),g(u,{value:p.indexOf(l.model_define)>-1&&d.deployment_name?d.deployment_name:d.name+d.id,model_config_id:l.id,current_obj:d,key:d.name+d.id},{default:t(()=>[p.indexOf(l.model_define)>-1&&d.deployment_name?(s(),c("span",ve,h(d.deployment_name),1)):(s(),c("span",be,h(d.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1})):A("",!0),i(o,null,{label:t(()=>[f(" AI智能总结  "),i(n,null,{title:t(()=>[f("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果")]),default:t(()=>[i(q(I))]),_:1})]),default:t(()=>[i(m,{checked:_.ai_summary,"onUpdate:checked":e[2]||(e[2]=l=>_.ai_summary=l),unCheckedValue:"0",checkedValue:"1"},null,8,["checked"])]),_:1}),_.ai_summary==1?(s(),g(o,{key:1,label:"总结模型",name:"ai_summary_model",rules:[{required:!0,message:"请选择总结模型"}]},{default:t(()=>[i(R,{value:_.ai_summary_model,"onUpdate:value":e[3]||(e[3]=l=>_.ai_summary_model=l),placeholder:"请选择总结模型",onChange:U,style:{width:"100%"}},{default:t(()=>[(s(!0),c(O,null,M(v.value,l=>(s(),g(B,{key:l.id},{label:t(()=>[i(r,{align:"center",gap:6},{default:t(()=>[x("img",{class:"model-icon",src:l.icon,alt:""},null,8,xe),f(h(l.name),1)]),_:2},1024)]),default:t(()=>[(s(!0),c(O,null,M(l.children,d=>(s(),g(u,{value:p.indexOf(l.model_define)>-1&&d.deployment_name?d.deployment_name:d.name+d.id,model_config_id:l.id,current_obj:d,key:d.name+d.id},{default:t(()=>[p.indexOf(l.model_define)>-1&&d.deployment_name?(s(),c("span",Oe,h(d.deployment_name),1)):(s(),c("span",Me,h(d.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1})):A("",!0),i(o,{"wrapper-col":{offset:2,span:8}},{default:t(()=>[i(Y,{type:"primary",loading:b.value,onClick:X},{default:t(()=>[f("保存")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},to=$(Ce,[["__scopeId","data-v-c37ee36b"]]);export{to as default};
