import{_ as $,S as j,bB as Q,T as H,e as S,c as J}from"../../index-CyiwD4fB.js";import{a0 as K,A as N,r as f,L as d,M as p,V as x,j as _,Q as s,U as h,u as k,a8 as W,F as V,a1 as M,P as D,X as Z,Y as B,a3 as ee,a4 as oe}from"./vue-chunks-CwaUyaYI.js";import{h as ae,k as te}from"./index-CnXWAABj.js";import{c as ne}from"./index-BWAwk653.js";import{A as le}from"./avatar-input-CJgW6Rj5.js";import{F as E,_ as ie}from"./index-BfwAi9te.js";import"./index-D8wyBl4m.js";import{I as re}from"./Input-Da8aOOO7.js";import{_ as _e}from"./TextArea-CBrdn4Xi.js";import{_ as se}from"./index-BttTL6gl.js";import{S as de,a as me,_ as ce}from"./index-BfzgEQpv.js";import"./dayjs-9pTjq58W.js";import"./axios-Cm0UX6qg.js";import"./qs-DFTLuGGg.js";import"./crypto-js-Dhiry31a.js";import"./PlusOutlined-C0mU79gr.js";import"./index-CmFdMhoo.js";import"./partition-D90jzHoI.js";import"./colors-DcCY69fx.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-DAieTXDw.js";import"./inputProps-CBCbV3dR.js";import"./index-D97187b8.js";import"./CheckOutlined-s6Wk7FwS.js";import"./useRefs-kFALIf8n.js";import"./collapseMotion-1cFzdZPo.js";import"./FormItemContext-P-hc85qB.js";import"./responsiveObserve-DlRq3u3d.js";import"./QuestionCircleOutlined-CGJPYPeU.js";import"./index-B-VUp88E.js";import"./Search-DC1Sahrq.js";import"./SearchOutlined-eG2BTg8a.js";import"./index-gIgkZ2l6.js";import"./slide-kUXvfLu3.js";import"./isMobile-D_4OiXLP.js";import"./DownOutlined-D6oDy9l0.js";import"./move-7FTT7O3Y.js";const ue=v=>(ee("data-v-ece4c0ea"),v=v(),oe(),v),fe={class:"add-library-page"},pe={class:"form-box"},ve=ue(()=>x("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const ge=["src"],ye={key:0},be={key:1},he={__name:"knowledge-config",setup(v){const A=K(),F=A.query,L=Q,e=N({library_name:"",library_intro:"",use_model:"",is_offline:"",model_config_id:"",avatar:L,avatar_file:""}),C=f(""),w=f(0),I=f({});(()=>{ae({id:F.id}).then(o=>{I.value=o.data,w.value=I.value.is_offline?2:1,e.library_name=o.data.library_name,e.library_intro=o.data.library_intro,e.use_model=o.data.use_model,e.is_offline=o.data.is_offline,e.model_config_id=o.data.model_config_id,e.avatar=o.data.avatar?o.data.avatar:L,e.avatar_file=o.data.avatar_file?o.data.avatar_file:""})})();const Be=f([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),O=E.useForm,U=N({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:y}=O(e,U),q=(o,t)=>{const l=t.current_obj;e.use_model=b.indexOf(l.model_define)>-1&&l.deployment_name?l.deployment_name:l.name,C.value=l.model_define,e.model_config_id=l.id||t.model_config_id,g()},z=o=>{e.avatar=o.imageUrl,e.avatar_file=o.file,g()},xe=()=>!1,m=f([]),b=["azure","ollama","xinference","openaiAgent"],R=["azure"];function T(o,t,l){const a=new Set(o.map(r=>r.model_define));return t.filter(r=>{let c=r[l];a.has(c)&&o.filter(u=>{if(u.model_define==c)return u.children=H(u.children,r.children),!1})}),o}(()=>{ne({model_type:"TEXT EMBEDDING",is_offline:!1}).then(o=>{let t=o.data||[],l=[];m.value=t.map(a=>{l=[];for(let r=0;r<a.model_info.vector_model_list.length;r++){const c=a.model_info.vector_model_list[r];l.push({name:c,deployment_name:a.model_config.deployment_name,id:a.model_config.id,model_define:a.model_info.model_define})}return{id:a.model_config.id,name:a.model_info.model_name,model_define:a.model_info.model_define,icon:a.model_info.model_icon_url,children:l,deployment_name:a.model_config.deployment_name}}),m.value=T(j(m.value,"model_define"),m.value,"model_define")})})();const g=()=>{if(!e.library_name)return S.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,id:A.query.id};R.indexOf(C.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),te(o).then(t=>{S.success("修改成功")})};return(o,t)=>{const l=re,a=ie,r=_e,c=J,u=se,G=de,P=me,X=ce,Y=E;return d(),p("div",fe,[x("div",pe,[_(Y,{"label-col":{span:4}},{default:s(()=>[_(a,h({ref:"name",label:"知识库名称"},k(y).library_name),{default:s(()=>[_(l,{onBlur:g,value:e.library_name,"onUpdate:value":t[0]||(t[0]=n=>e.library_name=n),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),_(a,{label:"知识库简介"},{default:s(()=>[_(r,{onBlur:g,value:e.library_intro,"onUpdate:value":t[1]||(t[1]=n=>e.library_intro=n),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),_(a,h({ref:"name",label:"知识库封面"},k(y).avatar),{default:s(()=>[_(le,{value:e.avatar,"onUpdate:value":t[2]||(t[2]=n=>e.avatar=n),onChange:z},null,8,["value"]),ve]),_:1},16),_(a,h({label:"嵌入模型"},k(y).use_model),{default:s(()=>[W("",!0),_(X,{onChange:q,value:e.use_model,"onUpdate:value":t[3]||(t[3]=n=>e.use_model=n),placeholder:"请选择嵌入模型"},{default:s(()=>[(d(!0),p(V,null,M(m.value,n=>(d(),D(P,{key:n.id},{label:s(()=>[_(u,{align:"center",gap:6},{default:s(()=>[x("img",{class:"model-icon",src:n.icon,alt:""},null,8,ge),Z(B(n.name),1)]),_:2},1024)]),default:s(()=>[(d(!0),p(V,null,M(n.children,i=>(d(),D(G,{value:b.indexOf(n.model_define)>-1&&i.deployment_name?i.deployment_name:i.name+i.id,model_config_id:n.id,current_obj:i,key:i.name+i.id},{default:s(()=>[b.indexOf(n.model_define)>-1&&i.deployment_name?(d(),p("span",ye,B(i.deployment_name),1)):(d(),p("span",be,B(i.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16)]),_:1})])])}}},so=$(he,[["__scopeId","data-v-ece4c0ea"]]);export{so as default};
