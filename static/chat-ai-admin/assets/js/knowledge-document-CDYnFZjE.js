import{C as at}from"./cu-scroll-DUEEhpqe.js";import{A as ot,b as ce,k as A,d as Le,M as te,bg as st,n as lt,b3 as _e,T as se,B as nt}from"../../index-CAb1tT-W.js";import{k as e,a4 as pe,a5 as me,e as y,B as Q,M as s,N as i,S as o,W as t,V as it,u as x,a7 as p,Q as I,F as N,$ as le,a6 as Oe,Z as F,aa as ue,Y as c,a1 as Ie,a2 as Me,b as _t,x as dt,D as ut,G as rt,a0 as ct,H as pt}from"./vue-chunks-DWnFCQSz.js";import{i as ne,r as mt,j as ft,k as vt,l as ht,m as gt}from"./index-CYunvooy.js";import{U as Ue}from"./upload-input-prNChbhA.js";import{t as Se}from"./validate-8MtiUsxW.js";import{F as re,_ as De}from"./index-BwLqZyOz.js";import"./index-ZqzVpCxK.js";import{I as fe}from"./Input-DuH7dn02.js";import"./index-jBVis6Wo.js";import{R as yt,_ as kt}from"./RadioButton-DeoXmEag.js";import{M as bt}from"./model-select-M64UlKaF.js";import{O as wt}from"./open-grapg-modal-VZxeulzI.js";import{D as xt}from"./DownOutlined-DeYc9KSb.js";import{U as Ct}from"./UpOutlined-BgTfLOYX.js";import{_ as $t}from"./index-DVdSWyGZ.js";import{S as Re,_ as Ne}from"./index-dibcP1Tn.js";import{R as qt}from"./rename-modal-DVySX-Ss.js";import{M as St}from"./MoreOutlined-CKjdxT_M.js";import{_ as Ft,M as Lt}from"./index-Zgzt-QK_.js";import"./index-DtmDjxy7.js";import{D as Ot}from"./dropdown-ClFVyE-h.js";import{S as It}from"./index-BgOt2FQs.js";import{_ as Mt}from"./index-JrAvaglQ.js";import{P as Ut}from"./PlusOutlined-lz80p0a0.js";import{S as Dt}from"./SearchOutlined-ARjgS9_W.js";import{C as de}from"./ClockCircleFilled-9pDtrrir.js";import{S as Rt}from"./SyncOutlined-bGlLIyzb.js";import{_ as Nt}from"./index-_2Ia2fBW.js";import{_ as Tt}from"./index-BSYjd5qd.js";import{_ as zt}from"./index-DgLE2dBi.js";import{a as Pt}from"./index-DzZqaz_s.js";import{_ as Et}from"./TextArea-CYqPccpO.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./index-DzhuYAPB.js";import"./InboxOutlined-Dg8PN8n6.js";import"./index-DZQM5j1J.js";import"./partition-DzvwyHlm.js";import"./Trigger-JKklW7kX.js";import"./Password-CS7ye1e2.js";import"./inputProps-C93oOyRv.js";import"./CheckOutlined-BDgNr5ZU.js";import"./useRefs-CH9tJ50T.js";import"./collapseMotion-DNnsVK8G.js";import"./FormItemContext-8D78_qVD.js";import"./isPlainObject-BZk97rKt.js";import"./responsiveObserve-9b93vBMn.js";import"./QuestionCircleOutlined-OoMpIVY2.js";import"./index-CviHPZsF.js";import"./Search-DXRfWhTX.js";import"./statusUtils-DZGhn0Kh.js";import"./Checkbox-CQjSeTte.js";import"./index-FFGVkxQ5.js";import"./slide-DfWuJDbJ.js";import"./index-B3zCNJkU.js";import"./move-nlQWRDsj.js";import"./shallowequal-C0Ji8tJB.js";import"./Dropdown-DKZymAyI.js";import"./RightOutlined-BUprEUSn.js";import"./colors-DIkUhcQM.js";import"./index-DWpgAfSZ.js";import"./index-DeuYLm-n.js";import"./useMaxLevel-BHMAJsmP.js";import"./index-BsPiffqt.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-EAYnSsOS.js";import"./index-B5I2IoyU.js";import"./CaretDownOutlined-DuiqmcE9.js";var Vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M742 318V184h86c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h86v134c0 81.5 42.4 153.2 106.4 194-64 40.8-106.4 112.5-106.4 194v134h-86c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h632c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-86V706c0-81.5-42.4-153.2-106.4-194 64-40.8 106.4-112.5 106.4-194z"}}]},name:"hourglass",theme:"filled"};const At=Vt;function Fe(k){for(var $=1;$<arguments.length;$++){var M=arguments[$]!=null?Object(arguments[$]):{},L=Object.keys(M);typeof Object.getOwnPropertySymbols=="function"&&(L=L.concat(Object.getOwnPropertySymbols(M).filter(function(P){return Object.getOwnPropertyDescriptor(M,P).enumerable}))),L.forEach(function(P){Bt(k,P,M[P])})}return k}function Bt(k,$,M){return $ in k?Object.defineProperty(k,$,{value:M,enumerable:!0,configurable:!0,writable:!0}):k[$]=M,k}var ve=function($,M){var L=Fe({},$,M.attrs);return e(ot,Fe({},L,{icon:At}),null)};ve.displayName="HourglassFilled";ve.inheritAttrs=!1;const Ht=ve,Gt={class:"form-box"},Qt={class:"upload-document-type-box"},jt=["onClick"],Yt={class:"right-block"},Jt={class:"title-block"},Xt={class:"title-text"},Wt={class:"desc"},Zt={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(k,{expose:$,emit:M}){const L=pe(),P=me(),Y=re.useForm,q=y(!1),m=y("添加自定义文档"),r=k,w=Q({library_id:P.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),T=y([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),f=u=>{w.qa_index_type=u},H=Q({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:J,validate:G,validateInfos:C}=Y(w,H),j=()=>{q.value=!0,J(),w.file_name="",w.is_qa_doc=0,w.qa_index_type=1,r.libraryInfo.type==2&&(w.is_qa_doc=1)},z=y(!1),Z=()=>{G().then(()=>{let u={...ue(w)};z.value=!0,ne(u).then(d=>{A.success(`${m.value}成功`),q.value=!1,L.push("/library/preview?id="+d.data.file_ids[0])}).finally(()=>{z.value=!1})})};return $({add:j}),(u,d)=>{const U=fe,D=De,R=yt,E=kt,X=Le,h=re,ie=te;return s(),i("div",null,[e(ie,{open:q.value,"onUpdate:open":d[2]||(d[2]=_=>q.value=_),title:m.value,onOk:Z,width:"472px",confirmLoading:z.value},{default:o(()=>[t("div",Gt,[e(h,{layout:"vertical"},{default:o(()=>[e(D,it({label:"文档名称"},x(C).file_name),{default:o(()=>[e(U,{type:"text",placeholder:"请输入文档名称",value:w.file_name,"onUpdate:value":d[0]||(d[0]=_=>w.file_name=_)},null,8,["value"])]),_:1},16),p("",!0),w.is_qa_doc==1?(s(),I(D,{key:1,label:"索引方式",required:""},{default:o(()=>[t("div",Qt,[(s(!0),i(N,null,le(T.value,_=>(s(),i("div",{class:Oe(["type-item",{active:w.qa_index_type==_.value}]),key:_.value,onClick:he=>f(_.value)},[t("div",Yt,[t("div",Jt,[e(X,{name:w.qa_index_type==_.value?_.iconNameActive:_.iconName},null,8,["name"]),t("div",Xt,F(_.title),1)]),t("div",Wt,F(_.desc),1)]),w.qa_index_type==_.value?(s(),I(X,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):p("",!0)],10,jt))),128))])]),_:1})):p("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},Kt=ce(Zt,[["__scopeId","data-v-0fbc9294"]]),W=k=>(Ie("data-v-4f6c96b9"),k=k(),Me(),k),ea={class:"alert-box"},ta=W(()=>t("div",null,[c(" 通过word或者EXce形式导入问答对，建议您参考"),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/FAQ导入模板.docx"},"word导入模板"),c("  "),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/FAQ 导入模板.xlsx"},"Excel导入模板"),c("创建导入文档 ")],-1)),aa=W(()=>t("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1)),oa={class:"upload-file-box"},sa={key:0,class:"hight-set"},la={key:0,class:"set-box"},na={class:"form-item"},ia=W(()=>t("div",{class:"form-item-label"},"问题所在列：",-1)),_a={class:"form-item-body"},da={class:"form-item"},ua=W(()=>t("div",{class:"form-item-label"},"答案所在列：",-1)),ra={class:"form-item-body"},ca={key:1,class:"set-box"},pa={class:"form-item"},ma=W(()=>t("div",{class:"form-item-label"},"问题开始标识符：",-1)),fa={class:"form-item-body"},va={class:"form-item"},ha=W(()=>t("div",{class:"form-item-label"},"答案开始标识符：",-1)),ga={class:"form-item-body"},ya={__name:"qa-upload-modal",emits:["ok"],setup(k,{expose:$,emit:M}){const L=pe(),Y=me().query,q=y(!1),m=y(!1),r=y([]),w=M,T=y([]),f=Q({question_column:void 0,answer_column:void 0,question_lable:"问题：",answer_lable:"答案："}),H=y(!0),J=()=>{q.value=!0},G=()=>{let u=new FormData;r.value.forEach(d=>{u.append("library_files",d)}),mt(u).then(d=>{let U=[];for(let D in d.data)U.push({lable:d.data[D],value:D});T.value=U})},C=()=>{if(r.value.length==0){A.error("请选择文件");return}m.value=!0;let u=new FormData;u.append("library_id",Y.id);let d=!1;r.value.forEach(U=>{(U.name.includes(".xlsx")||U.name.includes(".csv"))&&(d=!0),u.append("library_files",U)}),d?(u.append("question_column",f.question_column),u.append("answer_column",f.answer_column)):(u.append("question_lable",f.question_lable),u.append("answer_lable",f.answer_lable)),u.append("is_qa_doc",1),ne(u).then(U=>{w("ok"),q.value=!1,r.value=[],m.value=!1,d&&L.push("/library/document-segmentation?document_id="+U.data.file_ids[0])}).catch(()=>{m.value=!1})},j=()=>{r.value=[]},z=y(1),Z=u=>{f.question_column=void 0,f.answer_column=void 0,f.question_lable="问题：",f.answer_lable="答案：",r.value=u,u&&u.length>0&&(u[0].type.includes(".document")?z.value=2:(z.value=1,G()))};return $({show:J}),(u,d)=>{const U=$t,D=Re,R=Ne,E=fe,X=te;return s(),i("div",null,[e(X,{width:680,open:q.value,"onUpdate:open":d[6]||(d[6]=h=>q.value=h),"confirm-loading":m.value,maskClosable:!1,title:"上传文档",onOk:C,onCancel:j},{default:o(()=>[t("div",ea,[e(U,{"show-icon":""},{message:o(()=>[ta,aa]),_:1})]),t("div",oa,[e(Ue,{type:2,value:r.value,"onUpdate:value":d[0]||(d[0]=h=>r.value=h),onChange:Z},null,8,["value"])]),r.value.length>0?(s(),i("div",sa,[t("a",{onClick:d[1]||(d[1]=h=>H.value=!H.value)},[c("高级设置： "),H.value?(s(),I(x(Ct),{key:1})):(s(),I(x(xt),{key:0}))]),H.value?(s(),i(N,{key:0},[z.value==1?(s(),i("div",la,[t("div",na,[ia,t("div",_a,[e(R,{value:f.question_column,"onUpdate:value":d[2]||(d[2]=h=>f.question_column=h),placeholder:"请选择列名",style:{width:"100%"}},{default:o(()=>[(s(!0),i(N,null,le(T.value,h=>(s(),I(D,{value:h.value,key:h.value},{default:o(()=>[c(F(h.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",da,[ua,t("div",ra,[e(R,{value:f.answer_column,"onUpdate:value":d[3]||(d[3]=h=>f.answer_column=h),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:o(()=>[(s(!0),i(N,null,le(T.value,h=>(s(),I(D,{value:h.value,key:h.value},{default:o(()=>[c(F(h.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):p("",!0),z.value==2?(s(),i("div",ca,[t("div",pa,[ma,t("div",fa,[e(E,{placeholder:"请输入标识符",value:f.question_lable,"onUpdate:value":d[4]||(d[4]=h=>f.question_lable=h)},null,8,["value"])])]),t("div",va,[ha,t("div",ga,[e(E,{placeholder:"请输入标识符",value:f.answer_lable,"onUpdate:value":d[5]||(d[5]=h=>f.answer_lable=h)},null,8,["value"])])])])):p("",!0)],64)):p("",!0)])):p("",!0)]),_:1},8,["open","confirm-loading"])])}}},ka=ce(ya,[["__scopeId","data-v-4f6c96b9"]]),B=k=>(Ie("data-v-a3b579d4"),k=k(),Me(),k),ba={class:"details-library-page"},wa={class:"list-tools"},xa={class:"tools-items"},Ca={class:"tool-item"},$a={class:"dropdown-btn-menu"},qa=B(()=>t("div",{class:"title"},"本地文档",-1)),Sa={key:0,class:"desc"},Fa={key:1,class:"desc"},La={class:"dropdown-btn-menu"},Oa=B(()=>t("div",{class:"title"},"在线数据",-1)),Ia=B(()=>t("div",{class:"desc"},"获取在线网页内容",-1)),Ma={class:"dropdown-btn-menu"},Ua=B(()=>t("div",{class:"title"},"自定义文档",-1)),Da=B(()=>t("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1)),Ra=B(()=>t("span",null,"添加内容",-1)),Na=B(()=>t("span",null,"嵌入模型：",-1)),Ta=B(()=>t("span",null,"生成知识图谱：",-1)),za={class:"tool-item"},Pa={class:"list-content"},Ea={key:0,class:"doc-name-td"},Va=["onClick"],Aa={key:0},Ba={key:1},Ha={key:0,class:"url-remark"},Ga={key:0,class:"status-tag running"},Qa={key:1,class:"status-tag running"},ja={key:2,class:"status-tag complete"},Ya={class:"status-tag status-error"},Ja=["onClick"],Xa={class:"status-tag status-error"},Wa={class:"status-tag"},Za=["onClick"],Ka={key:6,class:"status-tag"},eo={key:7,class:"status-tag running"},to={class:"status-tag error"},ao={class:"status-tag"},oo=["onClick"],so={key:1,class:"status-tag running"},lo={key:2,class:"status-tag complete"},no={class:"status-tag error"},io=["onClick"],_o={class:"zm-line1 reason-text"},uo={key:4,class:"status-tag running"},ro={class:"status-tag warning"},co={class:"reason-text"},po=["onClick"],mo={key:0},fo={key:1},vo={key:0},ho={key:1},go=["onClick"],yo=["onClick"],ko=B(()=>t("span",null,"删除",-1)),bo={class:"upload-file-box"},wo={class:"select-card-box"},xo=["onClick"],Co={class:"card-title"},$o={class:"card-desc"},qo={__name:"knowledge-document",setup(k){const $=[{key:2,title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"}],M=me(),L=pe(),P=M.query,Y=y(null),q=y(!1),m=y({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});Q({selectedRowKeys:[]});const r=Q({use_model:"",model_config_id:""}),w=(a,n)=>{let g=n.modelName,S=n.modelId;G.value.length>0?te.confirm({title:`确定切换模型为${g}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){r.use_model=g,r.model_config_id=S,T()},onCancel(){}}):(r.use_model=g,r.model_config_id=S,T())},T=(a=!0,n=null)=>{vt({...ue(m.value),use_model:r.use_model,model_config_id:r.model_config_id}).then(()=>{m.value.use_model=r.use_model,m.value.model_config_id=r.model_config_id,typeof n=="function"&&n(),a&&A.success("保存成功")})},f=y([]),H=a=>{f.value=a,J()},J=()=>{if(!m.value.id){setTimeout(()=>{J()},100);return}if(f.value.length>0&&!m.value.use_model){let a=null,n=null;for(let g of f.value)if(g.model_define==="chatwiki"){a=g;for(let S of a.children)if(S.name==="text-embedding-v2"){n=S;break}break}a||(a=f.value[0],n=a.children[0]),a&&(r.use_model=n.name,r.model_config_id=n.model_config_id,T(!1))}},G=y([]),C=Q({library_id:P.id,file_name:void 0,page:1,size:10,total:0}),j=y([]),z=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:450},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:180},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",width:100}],Z=a=>{C.page=a.current,C.size=a.pageSize,R()},u=()=>{C.page=1,R()};let d=!1;const U=({id:a})=>{G.value.length==1&&(d=!0),ht({id:a}).then(()=>{d&&C.page>1&&C.page--,R(),A.success("删除成功")})},D=(a,n={})=>{if(a.status=="4")return L.push({path:"/library/document-segmentation",query:{document_id:a.id}});if(a.status=="3"&&m.value.type!=2)return A.error("学习失败,不可预览");if(a.status=="0")return A.error("转换中,稍候可预览");if(a.status=="6")return A.error("获取中,不可预览");if(a.status=="7")return A.error("获取失败,不可预览");L.push({name:"libraryPreview",query:{id:a.id,...n}})},R=()=>{ft(ue(C)).then(a=>{let n=a.data.info;!r.use_model&&r.use_model!=n.use_model&&(r.use_model=n.use_model,r.model_config_id=n.model_config_id),m.value={...n},q.value=n.graph_switch==1,n.graph_switch=="0"?j.value=z.filter(O=>!["graph_status","graph_entity_count"].includes(O.key)):j.value=z;let g=a.data.list||[];C.total=a.data.total;let S=!1;G.value=g.map(O=>(["1","6","0","5","4"].includes(O.status)&&(S=!0),O.file_size_str=st(O.file_size),O.update_time=lt(O.update_time*1e3).format("YYYY-MM-DD HH:mm"),O)),S&&X(),!S&&clearInterval(E.value)})},E=y(null),X=()=>{clearInterval(E.value),E.value=setInterval(()=>{R()},1e3*5)},h=y(null),ie=a=>{if(f.value.length==0){te.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){L.push({path:"/user/model"})}});return}let{key:n}=a;n==1&&Pe(),n==2&&he(),n==3&&h.value.add()},_=Q({open:!1,urls:"",library_id:P.id,doc_auto_renew_frequency:1,confirmLoading:!1,rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(a,n)=>Se(n)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),he=()=>{_.open=!0,_.confirmLoading=!1,_.urls="",_.doc_auto_renew_frequency=1},ge=y(null),Te=()=>{ge.value.validate().then(()=>{_.confirmLoading=!0,ne({library_id:_.library_id,urls:JSON.stringify(Se(_.urls)),doc_auto_renew_frequency:_.doc_auto_renew_frequency,doc_type:2}).then(()=>{_.open=!1,_.confirmLoading=!1,u()})}).catch(()=>{_.confirmLoading=!1})},ze=()=>{_.open=!1},b=Q({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ye=_t(()=>b.fileList.filter(a=>a.type==="application/pdf").length>0),ke=y(null),Pe=()=>{if(m.value.type==2){ke.value.show();return}b.fileList=[],b.open=!0},Ee=()=>{b.fileList=[]},Ve=a=>{b.fileList=a},Ae=()=>{if(b.fileList.length==0){A.error("请选择文件");return}b.confirmLoading=!0;let a=new FormData;a.append("library_id",C.library_id);let n=!1;b.fileList.forEach(g=>{(g.name.includes(".xlsx")||g.name.includes(".csv"))&&(n=!0),a.append("library_files",g)}),ye.value&&a.append("pdf_parse_type",b.pdf_parse_type),ne(a).then(g=>{R(),b.open=!1,b.fileList=[],b.confirmLoading=!1,n&&g.data.file_ids.length==1&&L.push("/library/document-segmentation?document_id="+g.data.file_ids[0])}).catch(()=>{b.confirmLoading=!1})},be=y(null),Be=a=>{be.value.show(a)},He=a=>{L.push({path:"/library/document-segmentation",query:{document_id:a.id}})},we=a=>{gt({id:a.id}).then(()=>{R()})},Ge=()=>{if(q.value){q.value=!1;let a={graph_model_config_id:m.value.graph_model_config_id,graph_use_model:m.value.graph_use_model};if((!a.graph_model_config_id||!a.graph_use_model)&&f.value.length>0){let g=f.value[0].children[0];a.graph_use_model=g.name,a.graph_model_config_id=g.model_config_id}Y.value.show(a)}else m.value.graph_switch=0,T(!1,()=>{R()})},Qe=a=>{q.value=!0,m.value.graph_switch=1,m.value.graph_model_config_id=a.graph_model_config_id,m.value.graph_use_model=a.graph_use_model,T(!1,()=>{R()})},je=a=>{b.pdf_parse_type=a.key};return dt(()=>{R()}),ut(()=>{E.value&&clearInterval(E.value)}),(a,n)=>{const g=Le,S=Nt,O=Ft,xe=Lt,Ye=nt,Ce=Ot,Je=Tt,Xe=fe,ae=It,K=zt,We=Mt,Ze=Pt,Ke=at,oe=De,$e=re,qe=te,et=Et,ee=Re,tt=Ne;return s(),i("div",ba,[e(Ke,{scrollbar:!1},{default:o(()=>[t("div",wa,[t("div",xa,[t("div",Ca,[e(Ce,{trigger:["click","hover"],overlayClassName:"add-dropdown-btn"},{overlay:o(()=>[e(xe,{onClick:ie},{default:o(()=>[(s(),I(O,{key:1},{default:o(()=>[t("div",$a,[e(S,{class:"title-block",gap:4},{default:o(()=>[e(g,{name:"doc-icon"}),qa]),_:1}),m.value.type==2?(s(),i("div",Sa," 上传本地 docx/csv/xlsx 等格式文件 ")):(s(),i("div",Fa," 上传本地 pdf/docx/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),m.value.type!=2?(s(),I(O,{key:2},{default:o(()=>[t("div",La,[e(S,{class:"title-block",gap:4},{default:o(()=>[e(g,{name:"link-icon"}),Oa]),_:1}),Ia])]),_:1})):p("",!0),(s(),I(O,{key:3},{default:o(()=>[t("div",Ma,[e(S,{class:"title-block",gap:4},{default:o(()=>[e(g,{name:"cu-doc-icon"}),Ua]),_:1}),Da])]),_:1}))]),_:1})]),default:o(()=>[e(Ye,{type:"primary"},{icon:o(()=>[e(x(Ut))]),default:o(()=>[Ra]),_:1})]),_:1})]),rt(e(S,{align:"center",class:"tool-item custom-select-box"},{default:o(()=>[Na,e(bt,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:r.use_model,modeId:r.model_config_id,style:{width:"240px"},onChange:w,onLoaded:H},null,8,["modeName","modeId"])]),_:1},512),[[pt,!1]]),e(S,{align:"center",class:"tool-item custom-select-box pd-5-8"},{default:o(()=>[Ta,e(Je,{checked:q.value,"onUpdate:checked":n[0]||(n[0]=v=>q.value=v),onChange:Ge,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),t("div",null,[t("div",za,[e(Xe,{style:{width:"282px"},value:C.file_name,"onUpdate:value":n[1]||(n[1]=v=>C.file_name=v),placeholder:"请输入文档名称搜索",onChange:u},{suffix:o(()=>[e(x(Dt),{onClick:u,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])])])]),t("div",Pa,[e(Ze,{columns:j.value,"data-source":G.value,"row-key":"id",pagination:{current:C.page,total:C.total,pageSize:C.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:Z},{bodyCell:o(({column:v,record:l})=>[v.key==="file_name"?(s(),i("div",Ea,[t("a",{onClick:V=>D(l)},[["5","6","7"].includes(l.status)?(s(),i("span",Aa,F(l.doc_url),1)):(s(),i("span",Ba,F(l.file_name),1))],8,Va),l.doc_type==2&&l.remark?(s(),i("div",Ha," 备注："+F(l.remark),1)):p("",!0)])):p("",!0),v.key==="status"?(s(),i(N,{key:1},[l.status==0?(s(),i("span",Ga,[e(ae,{size:"small"}),c(" 转换中")])):p("",!0),l.status==1?(s(),i("span",Qa,[e(ae,{size:"small"}),c(" 学习中")])):p("",!0),l.status==2?(s(),i("span",ja,[e(x(_e)),c(" 学习完成")])):p("",!0),l.status==3?(s(),I(K,{key:3,placement:"top"},{title:o(()=>[t("span",null,F(l.errmsg),1)]),default:o(()=>[t("span",null,[t("span",Ya,[e(x(se)),c(" 转换失败")]),m.value.type==2?(s(),i("a",{key:0,class:"ml8",onClick:V=>D(l)},"学习",8,Ja)):p("",!0)])]),_:2},1024)):p("",!0),l.status==8?(s(),I(K,{key:4,placement:"top"},{title:o(()=>[t("span",null,F(l.errmsg),1)]),default:o(()=>[t("span",null,[t("span",Xa,[e(x(se)),c(" 转化异常")])])]),_:2},1024)):p("",!0),l.status==4?(s(),i(N,{key:5},[t("span",Wa,[e(x(de)),c(" 待学习")]),t("a",{class:"ml8",onClick:V=>D(l)},"学习",8,Za)],64)):p("",!0),l.status==5?(s(),i("span",Ka,[e(x(de)),c(" 待获取")])):p("",!0),l.status==6?(s(),i("span",eo,[e(ae,{size:"small"}),c(" 获取中")])):p("",!0),l.status==7?(s(),I(K,{key:8,placement:"top"},{title:o(()=>[t("span",null,F(l.errmsg),1)]),default:o(()=>[t("span",to,[e(x(se)),c(" 获取失败")])]),_:2},1024)):p("",!0)],64)):p("",!0),v.key==="graph_status"?(s(),i(N,{key:2},[l.graph_status==0?(s(),i(N,{key:0},[t("span",ao,[e(x(de)),c(" 待生成")]),t("a",{class:"ml8",onClick:V=>we(l)},"生成",8,oo)],64)):l.graph_status==1?(s(),i("span",so,[e(x(Ht)),c(" 排队中")])):l.graph_status==2?(s(),i("span",lo,[e(x(_e)),c(" 生成完成")])):l.graph_status==3?(s(),i(N,{key:3},[t("span",no,[e(x(se)),c(" 生成失败")]),t("a",{class:"ml8",onClick:V=>we(l)},"生成",8,io),l.graph_err_msg?(s(),I(K,{key:0,title:l.graph_err_msg},{default:o(()=>[t("div",_o,"原因："+F(l.graph_err_msg),1)]),_:2},1032,["title"])):p("",!0)],64)):l.graph_status==4?(s(),i("span",uo,[e(ae,{size:"small"}),c(" 生成中")])):l.graph_status==5?(s(),i(N,{key:5},[t("span",ro,[e(x(_e)),c(" 部分成功")]),t("div",co,[c(" 失败数："+F(l.graph_err_count||0)+" ",1),t("a",{class:"ml8",onClick:V=>D(l,{graph_status:3})},"详情",8,po)])],64)):p("",!0)],64)):p("",!0),v.key==="file_size"?(s(),i(N,{key:3},[l.doc_type==3?(s(),i("span",mo,"-")):(s(),i("span",fo,F(l.file_size_str),1))],64)):p("",!0),v.key==="paragraph_count"?(s(),i(N,{key:4},[l.status==0||l.status==1?(s(),i("span",vo,"-")):(s(),i("span",ho,F(l.paragraph_count),1))],64)):p("",!0),v.key==="action"?(s(),I(S,{key:5,gap:8},{default:o(()=>[e(K,null,{title:o(()=>[c("重新分段")]),default:o(()=>[e(x(Rt),{onClick:V=>He(l)},null,8,["onClick"])]),_:2},1024),e(Ce,null,{overlay:o(()=>[e(xe,null,{default:o(()=>[e(O,{disabled:l.status==6||l.status==7||l.status==0},{default:o(()=>[t("div",{onClick:V=>D(l)},"预览",8,go)]),_:2},1032,["disabled"]),e(O,null,{default:o(()=>[t("div",{onClick:V=>Be(l)},"重命名",8,yo)]),_:2},1024),e(O,null,{default:o(()=>[e(We,{title:"确定要删除吗?",onConfirm:V=>U(l)},{default:o(()=>[ko]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[t("div",{class:"table-btn",onClick:n[2]||(n[2]=ct(()=>{},["prevent"]))},[e(x(St))])]),_:2},1024)]),_:2},1024)):p("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1}),e(qe,{open:b.open,"onUpdate:open":n[4]||(n[4]=v=>b.open=v),"confirm-loading":b.confirmLoading,maskClosable:!1,title:"上传文档",onOk:Ae,onCancel:Ee,width:"740px"},{default:o(()=>[e($e,{class:"mt24","label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[e(oe,{required:"",label:"上传文档"},{default:o(()=>[t("div",bo,[e(Ue,{type:m.value.type,maxCount:20,value:b.fileList,"onUpdate:value":n[3]||(n[3]=v=>b.fileList=v),onChange:Ve},null,8,["type","value"])])]),_:1}),ye.value?(s(),I(oe,{key:0,required:"",label:"PDF解析模式"},{default:o(()=>[t("div",wo,[(s(),i(N,null,le($,v=>t("div",{key:v.key,class:Oe(["select-card-item",{active:b.pdf_parse_type==v.key}]),onClick:l=>je(v)},[e(g,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Co,F(v.title),1),t("div",$o,F(v.desc),1)],10,xo)),64))])]),_:1})):p("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),e(ka,{onOk:R,ref_key:"qaUploadModalRef",ref:ke},null,512),e(qe,{open:_.open,"onUpdate:open":n[7]||(n[7]=v=>_.open=v),"confirm-loading":_.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:Te,onCancel:ze},{default:o(()=>[e($e,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:ge,model:_,rules:_.rules},{default:o(()=>[e(oe,{name:"urls",label:"网页链接"},{default:o(()=>[e(et,{style:{height:"120px"},value:_.urls,"onUpdate:value":n[5]||(n[5]=v=>_.urls=v),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),e(oe,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:o(()=>[e(tt,{value:_.doc_auto_renew_frequency,"onUpdate:value":n[6]||(n[6]=v=>_.doc_auto_renew_frequency=v),style:{width:"100%"}},{default:o(()=>[e(ee,{value:1},{default:o(()=>[c("不自动更新")]),_:1}),e(ee,{value:2},{default:o(()=>[c("每天")]),_:1}),e(ee,{value:3},{default:o(()=>[c("每3天")]),_:1}),e(ee,{value:4},{default:o(()=>[c("每7天")]),_:1}),e(ee,{value:5},{default:o(()=>[c("每30天")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),e(Kt,{libraryInfo:m.value,onOk:u,ref_key:"addCustomDocumentRef",ref:h},null,8,["libraryInfo"]),e(qt,{onOk:u,ref_key:"renameModalRef",ref:be},null,512),e(wt,{onOk:Qe,ref_key:"openGrapgModalRef",ref:Y},null,512)])}}},js=ce(qo,[["__scopeId","data-v-a3b579d4"]]);export{js as default};
