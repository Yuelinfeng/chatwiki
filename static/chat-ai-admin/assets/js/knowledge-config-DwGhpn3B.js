import{C as ge}from"./cu-scroll-CdZK1_Dd.js";import{_ as H,M as Y,Y as ke,bw as ve,Z as ye,e as j,c as be}from"../../index-BNfL3w2j.js";import{r as m,A as $,L as r,M as v,j as n,Q as _,V as s,y as we,a3 as K,a4 as W,a0 as xe,P as M,U as D,u as U,a8 as x,a1 as J,X as g,Y as E,F as S,E as Ce,G as Be,a2 as P}from"./vue-chunks-C0QQWOCx.js";import{a as Le,h as Me,k as Se}from"./index-CNcS6db8.js";import{c as Ie}from"./index-BXwHCWt_.js";import{A as ze}from"./avatar-input-DQCr2n5W.js";import{M as ee}from"./model-select-CKtkPsmv.js";import{F as Z,_ as Ne}from"./index-yFqc4cD2.js";import"./index-BoBIAv4a.js";import{I as Ue}from"./Input-CkTCA1H7.js";import{Q as Oe}from"./QuestionCircleOutlined-4KQaJWl2.js";import{_ as Ae}from"./TextArea-Cl8pxwyC.js";import{_ as Te}from"./index-C7qXvCWR.js";import{S as Ve,a as qe,_ as De}from"./index-0s7_DZpf.js";import{_ as Ee}from"./index-ISsoQRoP.js";import{_ as $e}from"./index-BfzZQ1Qe.js";import{_ as Fe}from"./index-BukpQ8RZ.js";import{_ as Ge}from"./index-3k2SlWGM.js";import"./pull-up.esm-JZ91zQ8P.js";import"./axios-Cm0UX6qg.js";import"./qs-CnxcMLjH.js";import"./crypto-js-C2SrYqGA.js";import"./dayjs-CsGPDCY7.js";import"./PlusOutlined-B5cXtakc.js";import"./index-BhpyymUK.js";import"./partition-upHy18TF.js";import"./colors-B6m1To83.js";import"./Password-C3rJAIql.js";import"./inputProps-CkRR1l6t.js";import"./CheckOutlined-D8d6FGqD.js";import"./useRefs-DDwzsqEq.js";import"./collapseMotion-BOXZQl9Y.js";import"./FormItemContext-DCiQBKp-.js";import"./isPlainObject-B4InAXj5.js";import"./responsiveObserve-BS_1XHbF.js";import"./index-CqC-D0MF.js";import"./Search-DP6Te_4V.js";import"./SearchOutlined-COjt0mX8.js";import"./statusUtils-D6YMZbpq.js";import"./index-B4Ve0Gtb.js";import"./slide-jWfiTdSY.js";import"./isMobile-D_4OiXLP.js";import"./DownOutlined-DZkW1qbV.js";import"./move-Bt6G5yRx.js";const Re=p=>(K("data-v-e0af32c8"),p=p(),W(),p),Qe=Re(()=>s("div",{class:"desc-text"},"开启后，会使用指定模型抽取知识中实体和关系。",-1)),Xe={__name:"open-grapg-modal",emits:["ok"],setup(p,{expose:I,emit:O}){const y=m(!1),e=$({graph_use_model:"",graph_model_config_id:""}),C=O,A=k=>{y.value=!0,k=JSON.parse(JSON.stringify(k)),we(()=>{e.graph_use_model=k.graph_use_model,e.graph_model_config_id=k.graph_model_config_id})},z=()=>{},N=()=>{y.value=!1,Y.confirm({title:"确定开启生成知识图谱吗?",icon:null,content:n("div",{style:"color: #262626;"},[n("span",{},"生成知识图谱依赖大模型能力"),n("span",{style:"color:red;"},"可能会产生比较大的Token消耗"),n("span",{},"。知识图谱擅长精准的实体关系推理和逻辑验证（比如需要查询问题是X商品有哪些优患方案），但对非结构化文本和语义模糊查询支持较弱。建议您优先使用向量，当单纯向量检索无法满足时再尝试知识图谱")]),okText:"确定开启",cancelText:"暂不开启",onOk(){C("ok",{...e})},onCancel(){C("ok",{})}})};return I({show:A}),(k,b)=>{const G=Y;return r(),v("div",null,[n(G,{open:y.value,"onUpdate:open":b[2]||(b[2]=w=>y.value=w),title:"请先选择生成知识图谱模型",onOk:N},{default:_(()=>[s("div",null,[Qe,n(ee,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":b[0]||(b[0]=w=>e.graph_use_model=w),modeId:e.graph_model_config_id,"onUpdate:modeId":b[1]||(b[1]=w=>e.graph_model_config_id=w),style:{width:"300px"},onChange:z},null,8,["modeName","modeId"])])]),_:1},8,["open"])])}}},Ye=H(Xe,[["__scopeId","data-v-e0af32c8"]]),F=p=>(K("data-v-5e09bb26"),p=p(),W(),p),je={class:"add-library-page"},Je={class:"form-box"},Pe=F(()=>s("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const Ze=["src"],He={key:0},Ke={key:1},We={class:"select-card-box"},ea={class:"card-title"},aa=F(()=>s("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),oa={class:"card-title"},na=F(()=>s("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),ta={__name:"knowledge-config",setup(p){const I=xe(),O=I.query,y=ve,e=$({library_name:"",library_intro:"",use_model:"",is_offline:"",model_config_id:"",avatar:y,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[10,12],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90}),C=m(""),A=m(0),z=m({}),N=m([]);Le().then(a=>{N.value=a.data.map(o=>({label:o.name,value:o.no}))});const k=m(!0);(()=>{Me({id:O.id}).then(a=>{z.value=a.data,A.value=z.value.is_offline?2:1,e.library_name=a.data.library_name,e.library_intro=a.data.library_intro,e.use_model=a.data.use_model,e.is_offline=a.data.is_offline,e.model_config_id=a.data.model_config_id,e.avatar=a.data.avatar?a.data.avatar:y,e.avatar_file=a.data.avatar_file?a.data.avatar_file:"",e.graph_switch=a.data.graph_switch!="0",e.graph_model_config_id=a.data.graph_model_config_id>0?a.data.graph_model_config_id:void 0,e.graph_use_model=a.data.graph_use_model,e.chunk_type=+a.data.chunk_type,e.normal_chunk_default_separators_no=a.data.normal_chunk_default_separators_no?a.data.normal_chunk_default_separators_no.split(",").map(o=>+o):[],e.normal_chunk_default_chunk_size=a.data.normal_chunk_default_chunk_size,e.normal_chunk_default_chunk_overlap=a.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=a.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=a.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=a.data.semantic_chunk_default_threshold,k.value=a.data.type==2})})();const G=m([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),w=Z.useForm,ae=$({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:T}=w(e,ae),oe=(a,o)=>{const i=o.current_obj;e.use_model=V.indexOf(i.model_define)>-1&&i.deployment_name?i.deployment_name:i.name,C.value=i.model_define,e.model_config_id=i.id||o.model_config_id,d()},ne=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file,d()},la=()=>!1,B=m([]),V=["azure","ollama","xinference","openaiAgent"],te=["azure"];function le(a,o,i){const l=new Set(a.map(u=>u.model_define));return o.filter(u=>{let f=u[i];l.has(f)&&a.filter(h=>{if(h.model_define==f)return h.children=ye(h.children,u.children),!1})}),a}(()=>{Ie({model_type:"TEXT EMBEDDING",is_offline:!1}).then(a=>{let o=a.data||[],i=[];B.value=o.map(l=>{i=[];for(let u=0;u<l.model_info.vector_model_list.length;u++){const f=l.model_info.vector_model_list[u];i.push({name:f,deployment_name:l.model_config.deployment_name,id:l.model_config.id,model_define:l.model_info.model_define})}return{id:l.model_config.id,name:l.model_info.model_name,model_define:l.model_info.model_define,icon:l.model_info.model_icon_url,children:i,deployment_name:l.model_config.deployment_name}}),B.value=le(ke(B.value,"model_define"),B.value,"model_define")})})();const _e=()=>{d()},q=m([]),ie=a=>{q.value=a},R=m(null),de=a=>{if(a){let o={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&q.value.length>0){let i=q.value[0];if(i){let l=i.children[0];o.graph_use_model=l.name,o.graph_model_config_id=l.model_config_id}}R.value.show(o)}else e.graph_switch=!1,d()},Q=a=>{e.chunk_type=a,d()},re=a=>{a.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=a.graph_model_config_id,e.graph_use_model=a.graph_use_model,d())},d=()=>{if(!e.library_name)return j.error("请输入知识库名称");let a={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:e.normal_chunk_default_separators_no.join(","),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,id:I.query.id};te.indexOf(C.value)>-1&&(a.use_model="默认"),e.avatar_file&&(a.avatar=e.avatar_file),Se(a).then(o=>{j.success("修改成功")})};return(a,o)=>{const i=Ue,l=Ne,u=Ae,f=be,h=Te,se=Ve,ce=qe,X=De,ue=Ee,me=$e,L=Fe,pe=Ge,fe=Z,he=ge;return r(),M(he,null,{default:_(()=>[s("div",je,[s("div",Je,[n(fe,{"label-col":{span:5}},{default:_(()=>[n(l,D({ref:"name",label:"知识库名称"},U(T).library_name),{default:_(()=>[n(i,{onBlur:d,value:e.library_name,"onUpdate:value":o[0]||(o[0]=t=>e.library_name=t),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(l,{label:"知识库简介"},{default:_(()=>[n(u,{onBlur:d,value:e.library_intro,"onUpdate:value":o[1]||(o[1]=t=>e.library_intro=t),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(l,D({ref:"name",label:"知识库封面"},U(T).avatar),{default:_(()=>[n(ze,{value:e.avatar,"onUpdate:value":o[2]||(o[2]=t=>e.avatar=t),onChange:ne},null,8,["value"]),Pe]),_:1},16),n(l,D({label:"嵌入模型"},U(T).use_model),{default:_(()=>[x("",!0),n(X,{onChange:oe,value:e.use_model,"onUpdate:value":o[3]||(o[3]=t=>e.use_model=t),placeholder:"请选择嵌入模型"},{default:_(()=>[(r(!0),v(S,null,J(B.value,t=>(r(),M(ce,{key:t.id},{label:_(()=>[n(h,{align:"center",gap:6},{default:_(()=>[s("img",{class:"model-icon",src:t.icon,alt:""},null,8,Ze),g(E(t.name),1)]),_:2},1024)]),default:_(()=>[(r(!0),v(S,null,J(t.children,c=>(r(),M(se,{value:V.indexOf(t.model_define)>-1&&c.deployment_name?c.deployment_name:c.name+c.id,model_config_id:t.id,current_obj:c,key:c.name+c.id},{default:_(()=>[V.indexOf(t.model_define)>-1&&c.deployment_name?(r(),v("span",He,E(c.deployment_name),1)):(r(),v("span",Ke,E(c.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16),n(l,{label:"生成知识图谱"},{default:_(()=>[n(ue,{onChange:de,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),Ce(n(l,{label:"知识图谱模型"},{default:_(()=>[n(ee,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":o[4]||(o[4]=t=>e.graph_use_model=t),modeId:e.graph_model_config_id,"onUpdate:modeId":o[5]||(o[5]=t=>e.graph_model_config_id=t),style:{width:"300px"},onChange:_e,onLoaded:ie},null,8,["modeName","modeId"])]),_:1},512),[[Be,e.graph_switch]]),k.value?x("",!0):(r(),v(S,{key:0},[n(l,{label:"分段方式",required:""},{default:_(()=>[s("div",We,[s("div",{class:P(["select-card-item",{active:e.chunk_type==1}]),onClick:o[6]||(o[6]=t=>Q(1))},[n(f,{class:"check-arrow",name:"check-arrow-filled"}),s("div",ea,[n(f,{name:"ordinary-segmentation",class:"title-icon"}),g(" 普通分段 ")]),aa],2),s("div",{class:P(["select-card-item",{active:e.chunk_type==2}]),onClick:o[7]||(o[7]=t=>Q(2))},[n(f,{class:"check-arrow",name:"check-arrow-filled"}),s("div",oa,[n(f,{name:"semantic-segmentation",class:"title-icon"}),g(" 语义分段 ")]),na],2)]),e.chunk_type==2?(r(),M(me,{key:0,style:{"margin-top":"12px",width:"650px"},message:"提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段"})):x("",!0)]),_:1}),e.chunk_type==1?(r(),v(S,{key:0},[n(l,{label:"分段标识符",required:""},{default:_(()=>[n(X,{onChange:d,value:e.normal_chunk_default_separators_no,"onUpdate:value":o[8]||(o[8]=t=>e.normal_chunk_default_separators_no=t),mode:"multiple",style:{width:"100%"},placeholder:"请选择分段标识符",options:N.value},null,8,["value","options"])]),_:1}),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(h,{gap:8,align:"center"},{default:_(()=>[n(L,{onBlur:d,value:e.normal_chunk_default_chunk_size,"onUpdate:value":o[9]||(o[9]=t=>e.normal_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),g(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(h,{gap:8,align:"center"},{default:_(()=>[n(L,{onBlur:d,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":o[10]||(o[10]=t=>e.normal_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),g(" 字符 ")]),_:1})]),_:1})],64)):x("",!0),e.chunk_type==2?(r(),v(S,{key:1},[e.chunk_type==2?(r(),M(l,{key:0,required:""},{label:_(()=>[g(" 分段阈值 "),n(pe,null,{title:_(()=>[g("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:_(()=>[n(U(Oe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:_(()=>[n(L,{onBlur:d,value:e.semantic_chunk_default_threshold,"onUpdate:value":o[11]||(o[11]=t=>e.semantic_chunk_default_threshold=t),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):x("",!0),n(l,{label:"分段最大长度",required:""},{default:_(()=>[n(h,{gap:8,align:"center"},{default:_(()=>[n(L,{onBlur:d,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":o[12]||(o[12]=t=>e.semantic_chunk_default_chunk_size=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),g(" 字符 ")]),_:1})]),_:1}),n(l,{label:"分段重叠长度"},{default:_(()=>[n(h,{gap:8,align:"center"},{default:_(()=>[n(L,{onBlur:d,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":o[13]||(o[13]=t=>e.semantic_chunk_default_chunk_overlap=t),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),g(" 字符 ")]),_:1})]),_:1})],64)):x("",!0)],64))]),_:1})]),n(Ye,{onOk:re,ref_key:"openGrapgModalRef",ref:R},null,512)])]),_:1})}}},Ha=H(ta,[["__scopeId","data-v-5e09bb26"]]);export{Ha as default};
