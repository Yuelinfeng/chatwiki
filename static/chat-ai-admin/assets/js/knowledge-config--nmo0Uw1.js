import{_ as $,M as E,Y as ie,bw as _e,Z as de,e as F,c as re}from"../../index-DcJEzH23.js";import{r as p,A as U,L as u,M as v,j as l,Q as _,V as x,y as se,a3 as X,a4 as Y,a0 as me,U as A,u as O,a8 as ce,F as G,a1 as R,P as q,X as pe,Y as V,E as ue,G as fe}from"./vue-chunks-C0QQWOCx.js";import{h as ge,k as he}from"./index-Bi_Nxc27.js";import{c as ve}from"./index-BPb_ZgN6.js";import{A as ye}from"./avatar-input-D1wTG_of.js";import{M as J}from"./model-select-BLAx-hDo.js";import{F as z,_ as ke}from"./index-Sta_Y59L.js";import"./index-DmcpLdX2.js";import{I as be}from"./Input-BE8OsswY.js";import{_ as we}from"./TextArea-BamCH5zI.js";import{_ as xe}from"./index-BO7Ob9gq.js";import{S as Me,a as Ie,_ as Le}from"./index-y-d3D7NY.js";import{_ as Ce}from"./index-BqsmAxnu.js";import"./axios-Cm0UX6qg.js";import"./qs-CnxcMLjH.js";import"./crypto-js-C2SrYqGA.js";import"./dayjs-CsGPDCY7.js";import"./PlusOutlined-BwYwtvAz.js";import"./index-NaDoPIyx.js";import"./partition-C-358mO6.js";import"./colors-CColrw2T.js";import"./Password-DBULDdj2.js";import"./inputProps-BHHToL0U.js";import"./index-BwNDRnlZ.js";import"./CheckOutlined-B1GJKVT2.js";import"./useRefs-DDwzsqEq.js";import"./collapseMotion-BOXZQl9Y.js";import"./FormItemContext-DCloBD6y.js";import"./isPlainObject-DjMieya_.js";import"./responsiveObserve-Ck_WQTyU.js";import"./QuestionCircleOutlined-CSAM4WCa.js";import"./index-BXsRfD5R.js";import"./Search-BOHwgB3-.js";import"./SearchOutlined-Blr9NEwQ.js";import"./statusUtils-LyMOdK-9.js";import"./index-CKH6zFnW.js";import"./slide-jqmqq7Ho.js";import"./isMobile-D_4OiXLP.js";import"./DownOutlined-srf5KA0S.js";import"./move-BdTigM8H.js";const Ne=s=>(X("data-v-e0af32c8"),s=s(),Y(),s),Se=Ne(()=>x("div",{class:"desc-text"},"开启后，会使用指定模型抽取知识中实体和关系。",-1)),Be={__name:"open-grapg-modal",emits:["ok"],setup(s,{expose:M,emit:C}){const f=p(!1),e=U({graph_use_model:"",graph_model_config_id:""}),y=C,N=h=>{f.value=!0,h=JSON.parse(JSON.stringify(h)),se(()=>{e.graph_use_model=h.graph_use_model,e.graph_model_config_id=h.graph_model_config_id})},I=()=>{},T=()=>{f.value=!1,E.confirm({title:"确定开启生成知识图谱吗?",icon:null,content:l("div",{style:"color: #262626;"},[l("span",{},"生成知识图谱依赖大模型能力"),l("span",{style:"color:red;"},"可能会产生比较大的Token消耗"),l("span",{},"。知识图谱擅长精准的实体关系推理和逻辑验证（比如需要查询问题是X商品有哪些优患方案），但对非结构化文本和语义模糊查询支持较弱。建议您优先使用向量，当单纯向量检索无法满足时再尝试知识图谱")]),okText:"确定开启",cancelText:"暂不开启",onOk(){y("ok",{...e})},onCancel(){y("ok",{})}})};return M({show:N}),(h,c)=>{const S=E;return u(),v("div",null,[l(S,{open:f.value,"onUpdate:open":c[2]||(c[2]=m=>f.value=m),title:"请先选择生成知识图谱模型",onOk:T},{default:_(()=>[x("div",null,[Se,l(J,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":c[0]||(c[0]=m=>e.graph_use_model=m),modeId:e.graph_model_config_id,"onUpdate:modeId":c[1]||(c[1]=m=>e.graph_model_config_id=m),style:{width:"300px"},onChange:I},null,8,["modeName","modeId"])])]),_:1},8,["open"])])}}},Ae=$(Be,[["__scopeId","data-v-e0af32c8"]]),Oe=s=>(X("data-v-a45b02e9"),s=s(),Y(),s),Ve={class:"add-library-page"},Ue={class:"form-box"},Te=Oe(()=>x("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1));const De=["src"],Ee={key:0},Fe={key:1},Ge={__name:"knowledge-config",setup(s){const M=me(),C=M.query,f=_e,e=U({library_name:"",library_intro:"",use_model:"",is_offline:"",model_config_id:"",avatar:f,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:""}),y=p(""),N=p(0),I=p({});(()=>{ge({id:C.id}).then(o=>{I.value=o.data,N.value=I.value.is_offline?2:1,e.library_name=o.data.library_name,e.library_intro=o.data.library_intro,e.use_model=o.data.use_model,e.is_offline=o.data.is_offline,e.model_config_id=o.data.model_config_id,e.avatar=o.data.avatar?o.data.avatar:f,e.avatar_file=o.data.avatar_file?o.data.avatar_file:"",e.graph_switch=o.data.graph_switch!="0",e.graph_model_config_id=o.data.graph_model_config_id>0?o.data.graph_model_config_id:void 0,e.graph_use_model=o.data.graph_use_model})})();const h=p([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),c=z.useForm,S=U({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:m}=c(e,S),P=(o,a)=>{const i=a.current_obj;e.use_model=B.indexOf(i.model_define)>-1&&i.deployment_name?i.deployment_name:i.name,y.value=i.model_define,e.model_config_id=i.id||a.model_config_id,g()},j=o=>{e.avatar=o.imageUrl,e.avatar_file=o.file,g()},Re=()=>!1,k=p([]),B=["azure","ollama","xinference","openaiAgent"],Q=["azure"];function Z(o,a,i){const n=new Set(o.map(r=>r.model_define));return a.filter(r=>{let b=r[i];n.has(b)&&o.filter(w=>{if(w.model_define==b)return w.children=de(w.children,r.children),!1})}),o}(()=>{ve({model_type:"TEXT EMBEDDING",is_offline:!1}).then(o=>{let a=o.data||[],i=[];k.value=a.map(n=>{i=[];for(let r=0;r<n.model_info.vector_model_list.length;r++){const b=n.model_info.vector_model_list[r];i.push({name:b,deployment_name:n.model_config.deployment_name,id:n.model_config.id,model_define:n.model_info.model_define})}return{id:n.model_config.id,name:n.model_info.model_name,model_define:n.model_info.model_define,icon:n.model_info.model_icon_url,children:i,deployment_name:n.model_config.deployment_name}}),k.value=Z(ie(k.value,"model_define"),k.value,"model_define")})})();const H=()=>{g()},L=p([]),K=o=>{L.value=o},D=p(null),W=o=>{if(o){let a={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&(L.value,L.value.length>0)){let i=L.value[0];if(i){let n=i.children[0];a.graph_use_model=n.name,a.graph_model_config_id=n.model_config_id}}D.value.show(a)}else e.graph_switch=!1,g()},ee=o=>{o.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=o.graph_model_config_id,e.graph_use_model=o.graph_use_model,g())},g=()=>{if(!e.library_name)return F.error("请输入知识库名称");let o={library_name:e.library_name,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,id:M.query.id};Q.indexOf(y.value)>-1&&(o.use_model="默认"),e.avatar_file&&(o.avatar=e.avatar_file),he(o).then(a=>{F.success("修改成功")})};return(o,a)=>{const i=be,n=ke,r=we,b=re,w=xe,oe=Me,ae=Ie,ne=Le,le=Ce,te=z;return u(),v("div",Ve,[x("div",Ue,[l(te,{"label-col":{span:4}},{default:_(()=>[l(n,A({ref:"name",label:"知识库名称"},O(m).library_name),{default:_(()=>[l(i,{onBlur:g,value:e.library_name,"onUpdate:value":a[0]||(a[0]=t=>e.library_name=t),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),l(n,{label:"知识库简介"},{default:_(()=>[l(r,{onBlur:g,value:e.library_intro,"onUpdate:value":a[1]||(a[1]=t=>e.library_intro=t),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),l(n,A({ref:"name",label:"知识库封面"},O(m).avatar),{default:_(()=>[l(ye,{value:e.avatar,"onUpdate:value":a[2]||(a[2]=t=>e.avatar=t),onChange:j},null,8,["value"]),Te]),_:1},16),l(n,A({label:"嵌入模型"},O(m).use_model),{default:_(()=>[ce("",!0),l(ne,{onChange:P,value:e.use_model,"onUpdate:value":a[3]||(a[3]=t=>e.use_model=t),placeholder:"请选择嵌入模型"},{default:_(()=>[(u(!0),v(G,null,R(k.value,t=>(u(),q(ae,{key:t.id},{label:_(()=>[l(w,{align:"center",gap:6},{default:_(()=>[x("img",{class:"model-icon",src:t.icon,alt:""},null,8,De),pe(V(t.name),1)]),_:2},1024)]),default:_(()=>[(u(!0),v(G,null,R(t.children,d=>(u(),q(oe,{value:B.indexOf(t.model_define)>-1&&d.deployment_name?d.deployment_name:d.name+d.id,model_config_id:t.id,current_obj:d,key:d.name+d.id},{default:_(()=>[B.indexOf(t.model_define)>-1&&d.deployment_name?(u(),v("span",Ee,V(d.deployment_name),1)):(u(),v("span",Fe,V(d.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16),l(n,{label:"生成知识图谱"},{default:_(()=>[l(le,{onChange:W,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),ue(l(n,{label:"知识图谱模型"},{default:_(()=>[l(J,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":a[4]||(a[4]=t=>e.graph_use_model=t),modeId:e.graph_model_config_id,"onUpdate:modeId":a[5]||(a[5]=t=>e.graph_model_config_id=t),style:{width:"300px"},onChange:H,onLoaded:K},null,8,["modeName","modeId"])]),_:1},512),[[fe,e.graph_switch]])]),_:1})]),l(Ae,{onOk:ee,ref_key:"openGrapgModalRef",ref:D},null,512)])}}},Bo=$(Ge,[["__scopeId","data-v-a45b02e9"]]);export{Bo as default};
